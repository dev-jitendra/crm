
define("views/admin/layouts/base",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope;type;events={'click button[data-action="save"]':function(){this.actionSave()},'click button[data-action="cancel"]':function(){this.cancel()},'click button[data-action="resetToDefault"]':function(){this.confirm(this.translate("confirmation","messages"),()=>{this.resetToDefault()})},'click button[data-action="remove"]':function(){this.actionDelete()}};buttonList=[{name:"save",label:"Save",style:"primary"},{name:"cancel",label:"Cancel"}];dataAttributes=null;dataAttributesDefs=null;dataAttributesDynamicLogicDefs=null;setup(){this.buttonList=_.clone(this.buttonList),this.events=_.clone(this.events),this.scope=this.options.scope,this.type=this.options.type,this.realType=this.options.realType,this.setId=this.options.setId,this.em=this.options.em;var e=this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.type])??{};this.typeDefs=e,this.dataAttributeList=Espo.Utils.clone(e.dataAttributeList||this.dataAttributeList),this.isCustom=!!e.isCustom,this.isCustom&&this.em&&this.buttonList.push({name:"remove",label:"Remove"}),this.isCustom||this.buttonList.push({name:"resetToDefault",label:"Reset to Default"})}actionSave(){this.disableButtons(),Espo.Ui.notify(this.translate("saving","messages")),this.save(this.enableButtons.bind(this))}disableButtons(){this.$el.find(".button-container button").attr("disabled","disabled")}enableButtons(){this.$el.find(".button-container button").removeAttr("disabled")}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}setIsChanged(){this.isChanged=!0,this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}save(e){var t=this.fetch();if(!this.validate(t))return this.enableButtons(),!1;this.getHelper().layoutManager.set(this.scope,this.type,t,()=>{Espo.Ui.success(this.translate("Saved")),this.setIsNotChanged(),"function"==typeof e&&e(),this.getHelper().broadcastChannel.postMessage("update:layout")},this.setId).catch(()=>this.enableButtons())}resetToDefault(){this.getHelper().layoutManager.resetToDefault(this.scope,this.type,()=>{this.loadLayout(()=>{this.setIsNotChanged(),this.prepareLayout().then(()=>this.reRender())})},this.options.setId)}prepareLayout(){return Promise.resolve()}reset(){this.render()}fetch(){}unescape(e){if(null===e)return"";const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"};var i=new RegExp("("+_.keys(t).join("|")+")","g");return(""+e).replace(i,e=>t[e])}getEditAttributesModalViewOptions(e){return{name:e.name,scope:this.scope,attributeList:this.dataAttributeList,attributeDefs:this.dataAttributesDefs,dynamicLogicDefs:this.dataAttributesDynamicLogicDefs,attributes:e,languageCategory:this.languageCategory,headerText:" "}}openEditDialog(e){const s=e.name;e=this.getEditAttributesModalViewOptions(e);this.createView("editModal","views/admin/layouts/modals/edit-attributes",e,a=>{a.render(),this.listenToOnce(a,"after:save",e=>{this.trigger("update-item",s,e);const t=$("#layout ul > li[data-name='"+s+"']");for(const i in e)t.attr("data-"+i,e[i]),t.data(i,e[i]),t.find("."+i+"-value").text(e[i]);a.close(),this.setIsChanged()})})}cancel(){this.loadLayout(()=>{this.setIsNotChanged(),this.em?this.trigger("cancel"):this.prepareLayout().then(()=>this.reRender())})}validate(e){return!0}actionDelete(){this.confirm(this.translate("confirmation","messages")).then(()=>{this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Layout/action/delete",{scope:this.scope,name:this.type}).then(()=>{Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.trigger("after-delete")}).catch(()=>{this.enableButtons()})})}}e.default=a}),define("views/admin/layouts/rows",["views/admin/layouts/base"],function(e){return e.extend({template:"admin/layouts/rows",dataAttributeList:null,dataAttributesDefs:{},editable:!1,data:function(){return{scope:this.scope,type:this.type,buttonList:this.buttonList,enabledFields:this.enabledFields,disabledFields:this.disabledFields,layout:this.rowLayout,dataAttributeList:this.dataAttributeList,dataAttributesDefs:this.dataAttributesDefs,editable:this.editable}},setup:function(){this.itemsData={},e.prototype.setup.call(this),this.events['click a[data-action="editItem"]']=e=>{e=$(e.target).closest("li").data("name");this.editRow(e)},this.on("update-item",(e,t)=>{this.itemsData[e]=Espo.Utils.cloneDeep(t)}),Espo.loader.require("res!client/css/misc/layout-manager-rows.css",e=>{this.$style=$("<style>").html(e).appendTo($("body"))})},onRemove:function(){this.$style&&this.$style.remove()},editRow:function(e){const t=Espo.Utils.cloneDeep(this.itemsData[e]||{});t.name=e,this.openEditDialog(t)},afterRender:function(){$("#layout ul.enabled, #layout ul.disabled").sortable({connectWith:"#layout ul.connected",update:e=>{$(e.target).hasClass("disabled")||(this.onDrop(e),this.setIsChanged())}}),this.$el.find(".enabled-well").focus()},onDrop:function(e){},fetch:function(){const s=[];return $("#layout ul.enabled > li").each((e,t)=>{const i={};t=$(t).data("name");const a=this.itemsData[t]||{};a.name=t,this.dataAttributeList.forEach(e=>{var t;(this.dataAttributesDefs[e]||{}).notStorable||(t=a[e]||null)&&(i[e]=t)}),s.push(i)}),s},validate:function(e){return 0!==e.length||(this.notify("Layout cannot be empty","error"),!1)}})}),define("views/admin/layouts/side-panels-detail",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name","dynamicLogicVisible","style","dynamicLogicStyled","sticked"],dataAttributesDefs:{dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicVisible"},style:{type:"enum",options:["default","success","danger","warning","info"],default:"default",translation:"LayoutManager.options.style",tooltip:"panelStyle"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},sticked:{type:"bool",tooltip:"sticked"},name:{readOnly:!0}},dataAttributesDynamicLogicDefs:{fields:{dynamicLogicStyled:{visible:{conditionGroup:[{type:"and",value:[{attribute:"style",type:"notEquals",value:"default"},{attribute:"style",type:"isNotEmpty"}]}]}}}},editable:!0,ignoreList:[],ignoreTypeList:[],viewType:"detail",setup:function(){e.prototype.setup.call(this),this.dataAttributesDefs=Espo.Utils.cloneDeep(this.dataAttributesDefs),this.dataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.dataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(t){this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(e),t&&t()})},readDataFromLayout:function(l){var t=[],r={},d={};l=Espo.Utils.cloneDeep(l),!1===this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.viewType])||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"])||(t.push("default"),r.default="Default"),(this.getMetadata().get(["clientDefs",this.scope,"sidePanels",this.viewType])||[]).forEach(e=>{e.name&&(t.push(e.name),e.label&&(r[e.name]=e.label),d[e.name]=e)}),this.disabledFields=[],l=l||{},this.rowLayout=[],t.push("_delimiter_"),l._delimiter_||(l._delimiter_={disabled:!0}),t.forEach((t,e)=>{let i=!1;var a,s,n=l[t]||{};if(n.disabled&&(i=!0),l[t]||(d[t]||{}).disabled&&(i=!0),a=r[t]?this.getLanguage().translate(r[t],"labels",this.scope):this.getLanguage().translate(t,"panels",this.scope),i){let e={name:t,label:a};return"_"===e.name[0]&&(e.notEditable=!0,"_delimiter_"===e.name&&(e.label=". . .")),void this.disabledFields.push(e)}let o={name:t,label:a};for(s in"_"===o.name[0]&&(o.notEditable=!0,"_delimiter_"===o.name&&(o.label=". . .")),o.name in d&&this.dataAttributeList.forEach(e=>{var t;"name"===e||e in(t=d[o.name]||{})&&(o[e]=t[e])}),n)o[s]=n[s];o.index="index"in n?n.index:e,this.rowLayout.push(o),this.itemsData[o.name]=Espo.Utils.cloneDeep(o)}),this.rowLayout.sort((e,t)=>e.index-t.index)},fetch:function(){let n={};return $("#layout ul.disabled > li").each((e,t)=>{t=$(t).attr("data-name");n[t]={disabled:!0}}),$("#layout ul.enabled > li").each((e,t)=>{let i=$(t),a={};t=i.attr("data-name");let s=this.itemsData[t]||{};s.name=t,this.dataAttributeList.forEach(e=>{"name"!==e&&e in s&&(a[e]=s[e])}),a.index=e,n[t]=a}),n}})}),define("views/admin/dynamic-logic/conditions-string/item-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",data:function(){return{valueViewKey:this.getValueViewKey(),scope:this.scope,operator:this.operator,operatorString:this.operatorString,field:this.field,leftString:this.getLeftPartString()}},setup:function(){this.itemData=this.options.itemData,this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.operatorString=this.options.operatorString||this.operatorString,this.additionalData=this.itemData.data||{},this.field=(this.itemData.data||{}).field||this.itemData.attribute,this.wait(!0),this.isCurrentUser=this.itemData.attribute&&this.itemData.attribute.startsWith("$user."),this.isCurrentUser&&(this.scope="User"),this.getModelFactory().create(this.scope,e=>{this.model=e,this.populateValues(),this.createValueFieldView(),this.wait(!1)})},getLeftPartString:function(){if("$user.id"===this.itemData.attribute)return"$"+this.translate("User","scopeNames");let e=this.translate(this.field,"fields",this.scope);return e=this.isCurrentUser?"$"+this.translate("User","scopeNames")+"."+e:e},populateValues:function(){this.itemData.attribute&&this.model.set(this.itemData.attribute,this.itemData.value),this.model.set(this.additionalData.values||{})},getValueViewKey:function(){return"view-"+this.level.toString()+"-"+this.number.toString()+"-0"},getFieldValueView:function(){if("$user.id"===this.itemData.attribute)return"views/admin/dynamic-logic/fields/user-id";var e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base";return this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e)},createValueFieldView:function(){var e=this.getValueViewKey(),t=this.getFieldValueView();this.createView("value",t,{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]'})}})}),define("views/admin/layouts/grid",["views/admin/layouts/base"],function(e){return e.extend({template:"admin/layouts/grid",dataAttributeList:null,panels:null,columnCount:2,panelDataAttributeList:["panelName","style"],panelDataAttributesDefs:{},panelDynamicLogicDefs:null,data:function(){return{scope:this.scope,type:this.type,buttonList:this.buttonList,enabledFields:this.enabledFields,disabledFields:this.disabledFields,panels:this.panels,columnCount:this.columnCount,panelDataList:this.getPanelDataList()}},emptyCellTemplate:'<li class="empty disabled cell"><a role="button" data-action="minusCell" class="remove-field"><i class="fas fa-minus"></i></a></li>',additionalEvents:{'click #layout a[data-action="addPanel"]':function(){this.addPanel(),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="removePanel"]':function(e){$(e.target).closest("ul.panels > li").find("ul.cells > li").each((e,t)=>{$(t).attr("data-name")&&$(t).appendTo($("#layout ul.disabled"))}),$(e.target).closest("ul.panels > li").remove();const i=$(e.currentTarget).data("number");this.clearView("panels-"+i);let a=-1;this.panels.forEach((e,t)=>{e.number===i&&(a=t)}),~a&&this.panels.splice(a,1),this.normalizeDisabledItemList(),this.setIsChanged()},'click #layout a[data-action="addRow"]':function(e){var t=this.unescape($("#layout-row-tpl").html()),t=_.template(t);$(e.target).closest("ul.panels > li").find("ul.rows").append(t),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="removeRow"]':function(e){$(e.target).closest("ul.rows > li").find("ul.cells > li").each((e,t)=>{$(t).attr("data-name")&&$(t).appendTo($("#layout ul.disabled"))}),$(e.target).closest("ul.rows > li").remove(),this.normalizeDisabledItemList(),this.setIsChanged()},'click #layout a[data-action="removeField"]':function(e){const t=$(e.target).closest("li");e=t.index();const i=t.parent(),a=(t.appendTo($("ul.disabled")),$($("#empty-cell-tpl").html()));if(1===parseInt(i.attr("data-cell-count")))for(let e=0;e<this.columnCount;e++)i.append(a.clone());else 0===e?i.prepend(a):a.insertAfter(i.children(":nth-child("+e+")"));const s=i.children().length;i.attr("data-cell-count",s.toString()),i.closest("li").attr("data-cell-count",s.toString()),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="minusCell"]':function(e){if(!(this.columnCount<2)){const t=$(e.currentTarget).closest("li"),i=t.parent(),a=(t.remove(),parseInt(i.children().length||2));this.setIsChanged(),this.makeDraggable(),i.attr("data-cell-count",a.toString()),i.closest("li").attr("data-cell-count",a.toString())}},'click #layout a[data-action="plusCell"]':function(e){const t=$(e.currentTarget).closest("li"),i=t.find("ul");e=$($("#empty-cell-tpl").html());i.append(e);const a=i.children().length;i.attr("data-cell-count",a.toString()),i.closest("li").attr("data-cell-count",a.toString()),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="edit-panel-label"]':function(e){const t=$(e.target).closest("header"),i=t.children("label");e=i.text();const a=t.closest("li").data("number").toString(),s={panelName:e};this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(s[e]=this.panelsData[a][e])});var e=this.panelDataAttributeList,n=this.panelDataAttributesDefs;this.createView("dialog","views/admin/layouts/modals/panel-attributes",{attributeList:e,attributeDefs:n,attributes:s,dynamicLogicDefs:this.panelDynamicLogicDefs},e=>{e.render(),this.listenTo(e,"after:save",t=>{i.text(t.panelName),i.attr("data-is-custom","true"),this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(this.panelsData[a][e]=t[e])}),e.close(),this.$el.find(".well").focus(),this.setIsChanged()})})}},normalizeDisabledItemList:function(){},setup:function(){e.prototype.setup.call(this),this.events={...this.additionalEvents,...this.events},this.panelsData={},Espo.loader.require("res!client/css/misc/layout-manager-grid.css",e=>{this.$style=$("<style>").html(e).appendTo($("body"))})},onRemove:function(){this.$style&&this.$style.remove()},addPanel:function(){this.lastPanelNumber++;const e=this.lastPanelNumber;var t={customLabel:null,rows:[[]],number:e};this.panels.push(t);const i={};for(const n in this.panelDataAttributesDefs){var a=this.panelDataAttributesDefs[n];"default"in a&&(i[n]=a.default)}this.panelsData[e.toString()]=i;const s=$('<li class="panel-layout"></li>');s.attr("data-number",e),this.$el.find("ul.panels").append(s),this.createPanelView(t,!0,e=>{e.render()})},getPanelDataList:function(){const i=[];return this.panels.forEach(e=>{const t={};t.viewKey="panel-"+e.number,t.number=e.number,i.push(t)}),i},prepareLayout:function(){return new Promise(e=>{let t=0;this.setupPanels(()=>{++t===this.panels.length&&e()})})},setupPanels:function(i){this.lastPanelNumber=-1,this.panels=Espo.Utils.cloneDeep(this.panels),this.panels.forEach((e,t)=>{e.number=t,this.lastPanelNumber++,this.createPanelView(e,!1,i),this.panelsData[t.toString()]=e})},createPanelView:function(e,a,t){e.label=e.label||"",e.isCustomLabel=!1,e.customLabel?(e.labelTranslated=e.customLabel,e.isCustomLabel=!0):e.labelTranslated=this.translate(e.label,"labels",this.scope),e.style=e.style||null,e.rows.forEach(t=>{var i=this.columnCount-t.length;if(a)for(let e=0;e<i;e++)t.push(!1);for(const e in t)!1!==t[e]&&(t[e].label=this.getLanguage().translate(t[e].name,"fields",this.scope),"customLabel"in t[e]&&(t[e].hasCustomLabel=!0))}),this.createView("panel-"+e.number,"view",{selector:'li.panel-layout[data-number="'+e.number+'"]',template:"admin/layouts/grid-panel",data:()=>{const t=Espo.Utils.clone(e);return t.dataAttributeList=[],this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&t.dataAttributeList.push(e)}),t}},t)},makeDraggable:function(){const s=this,e=$("#layout ul.panels"),t=$("#layout ul.rows"),i=(e.sortable({distance:4,update:()=>{this.setIsChanged()}}),e.disableSelection(),t.sortable({distance:4,connectWith:".rows",update:()=>{this.setIsChanged()}}),t.disableSelection(),$("#layout ul.cells > li"));i.draggable({revert:"invalid",revertDuration:200,zIndex:10}).css("cursor","pointer"),i.droppable().droppable("destroy"),$("#layout ul.cells:not(.disabled) > li").droppable({accept:".cell",zIndex:10,hoverClass:"ui-state-hover",drop:function(e,t){var i=t.draggable.index();const a=t.draggable.parent();a.get(0)===$(this).parent().get(0)?$(this).index()<t.draggable.index()?$(this).before(t.draggable):$(this).after(t.draggable):(t.draggable.insertAfter($(this)),0===i?$(this).prependTo(a):$(this).insertAfter(a.children(":nth-child("+i+")"))),t.draggable.css({top:0,left:0}),$(this).parent().hasClass("disabled")&&!$(this).data("name")&&$(this).remove(),s.makeDraggable(),s.setIsChanged()}})},afterRender:function(){this.makeDraggable();const e=this.$el.find(".enabled-well").get(0);e.focus({preventScroll:!0})},fetch:function(){const o=[];return $("#layout ul.panels > li").each((e,t)=>{const i=$(t).find("header label"),a=$(t).data("number").toString(),n={rows:[]};this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(n[e]=this.panelsData[a][e])}),n.style=n.style||"default";var s=$(t).find("header").data("name");s&&(n.name=s),i.attr("data-is-custom")?n.customLabel=i.text():n.label=i.data("label"),$(t).find("ul.rows > li").each((e,t)=>{const s=[];$(t).find("ul.cells > li").each((e,i)=>{let a=!1;$(i).hasClass("empty")||(a={},this.dataAttributeList.forEach(e=>{var t;(this.dataAttributesDefs[e]||{}).notStorable||("customLabel"!==e?(t=$(i).data(Espo.Utils.toDom(e))||null)&&(a[e]=t):$(i).get(0).hasAttribute("data-custom-label")&&(a[e]=$(i).attr("data-custom-label")))})),s.push(a)}),n.rows.push(s)}),o.push(n)}),o},validate:function(e){let t=0;return e.forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{!1!==e&&null!==e&&t++})})}),0!==t||(Espo.Ui.error(this.translate("cantBeEmpty","messages","LayoutManager")),!1)}})}),define("views/admin/layouts/default-page",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent=`
        <div class="margin-bottom">{{translate 'selectLayout' category='messages' scope='Admin'}}</div>
        <div class="button-container">
            <button data-action="createLayout" class="btn btn-link">{{translate 'Create'}}</button>
        </div>
    `}e.default=a}),define("views/admin/layouts/bottom-panels-detail",["views/admin/layouts/side-panels-detail"],function(s){return s.extend({hasStream:!0,hasRelationships:!0,TAB_BREAK_KEY:"_tabBreak_{n}",setup:function(){s.prototype.setup.call(this),this.on("update-item",(t,i)=>{if(this.isTabName(t)){let e=$("#layout ul > li[data-name='"+t+"']");e.find(".left > span").text(this.composeTabBreakLabel(i))}})},composeTabBreakLabel:function(e){let t=". . . "+this.translate("tabBreak","fields","LayoutManager");return e.tabLabel&&(t+=" : "+e.tabLabel),t},readDataFromLayout:function(l){let t=[],r={},d={};for(var e in l=Espo.Utils.cloneDeep(l),this.hasStream&&this.getMetadata().get(["scopes",this.scope,"stream"])&&(t.push("stream"),r.stream=this.translate("Stream"),d.stream={name:"stream",sticked:!0,index:2}),(this.getMetadata().get(["clientDefs",this.scope,"bottomPanels",this.viewType])||[]).forEach(e=>{e.name&&(t.push(e.name),e.label&&(r[e.name]=e.label),d[e.name]=Espo.Utils.clone(e),"order"in e&&(d[e.name].index=e.order))}),l){var i=l[e];i.tabBreak&&(t.push(e),r[e]=this.composeTabBreakLabel(i),d[e]={name:i.name,index:i.index,tabBreak:!0,tabLabel:i.tabLabel||null})}var a;this.links={},this.hasRelationships&&(a=this.getMetadata().get(["entityDefs",this.scope,"links"])||{},Object.keys(a).forEach(e=>{var i;a[e].disabled||a[e].utility||a[e].layoutRelationshipsDisabled||~["hasMany","hasChildren"].indexOf(a[e].type)&&(t.push(e),r[e]=this.translate(e,"links",this.scope),i={name:e,index:5},this.dataAttributeList.forEach(e=>{var t;e in i||null!==(t=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i.name,e]))&&(i[e]=t)}),this.links[e]=!0,d[i.name]=i)})),this.disabledFields=[],l=l||{},this.rowLayout=[],(t=t.sort((e,t)=>d[e].index-d[t].index)).push("_delimiter_"),l._delimiter_||(l._delimiter_={disabled:!0}),r[this.TAB_BREAK_KEY]=". . . "+this.translate("tabBreak","fields","LayoutManager"),t.push(this.TAB_BREAK_KEY),t.forEach((t,e)=>{var i,a=!1,s=l[t]||{};if(s.disabled&&(a=!0),l[t]||(d[t]||{}).disabled&&(a=!0),this.links[t]&&(l[t]||(a=!0)),t===this.TAB_BREAK_KEY&&(a=!0),i=r[t]?this.getLanguage().translate(r[t],"labels",this.scope):this.getLanguage().translate(t,"panels",this.scope),a){let e={name:t,label:i};return"_"===e.name[0]&&"_delimiter_"===e.name&&(e.notEditable=!0,e.label=". . ."),void this.disabledFields.push(e)}var n,o={name:t,label:i};for(n in"_"===o.name[0]&&"_delimiter_"===o.name&&(o.notEditable=!0,o.label=". . ."),o.name in d&&this.dataAttributeList.forEach(e=>{var t;"name"===e||e in(t=d[o.name]||{})&&(o[e]=t[e])}),s)o[n]=s[n];o.index="index"in s?s.index:e,this.rowLayout.push(o),this.itemsData[o.name]=Espo.Utils.cloneDeep(o)}),this.rowLayout.sort((e,t)=>(e.index||0)-(t.index||0))},onDrop:function(){let s=-1,a=null;this.$el.find("ul.enabled").children().each((e,t)=>{let i=$(t),a=i.attr("data-name");this.isTabName(a)&&(a===this.TAB_BREAK_KEY||(t=parseInt(a.split("_")[2]))>s&&(s=t))}),s++,this.$el.find("ul.enabled").children().each((e,t)=>{let i=$(t);var t=i.attr("data-name");this.isTabName(t)&&t===this.TAB_BREAK_KEY&&(a=i.clone(),t=this.TAB_BREAK_KEY.slice(0,-3)+s,i.attr("data-name",t),delete this.itemsData[t])}),a||this.$el.find("ul.disabled").children().each((e,t)=>{let i=$(t);t=i.attr("data-name");this.isTabName(t)&&t!==this.TAB_BREAK_KEY&&i.remove()}),a&&a.appendTo(this.$el.find("ul.disabled"))},isTabName:function(e){return e.substring(0,this.TAB_BREAK_KEY.length-3)===this.TAB_BREAK_KEY.slice(0,-3)},getEditAttributesModalViewOptions:function(e){let t=s.prototype.getEditAttributesModalViewOptions.call(this,e);return this.isTabName(e.name)&&(t.attributeList=["tabLabel"],t.attributeDefs={tabLabel:{type:"varchar"}}),t},fetch:function(){var e,t,i=s.prototype.fetch.call(this);let a={};for(e in i)i[e].disabled&&this.links[e]||(a[e]=i[e],this.isTabName(e)&&e!==this.TAB_BREAK_KEY?(t=this.itemsData[e]||{},a[e].tabBreak=!0,a[e].tabLabel=t.tabLabel):(delete a[e].tabBreak,delete a[e].tabLabel));return delete a[this.TAB_BREAK_KEY],a}})}),define("views/admin/layouts/modals/create",["exports","views/modal","views/record/edit-for-modal","model","views/fields/enum","views/fields/varchar"],function(e,t,i,a,s,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=o(t),i=o(i),a=o(a),s=o(s),n=o(n);class l extends t.default{templateContent=`
        <div class="complex-text-container">{{complexText info}}</div>
        <div class="record no-side-margin">{{{record}}}</div>
    `;className="dialog dialog-record";constructor(e){super(),this.scope=e.scope}data(){return{info:this.translate("createInfo","messages","LayoutManager")}}setup(){this.headerText=this.translate("Create"),this.buttonList=[{name:"create",style:"danger",label:"Create",onClick:()=>this.actionCreate()},{name:"cancel",label:"Cancel"}],this.model=new a.default({type:"list",name:"listForMyEntityType",label:"List (for MyEntityType)"}),this.recordView=new i.default({model:this.model,detailLayout:[{columns:[[{view:new s.default({name:"type",params:{readOnly:!0,translation:"Admin.layouts",options:["list"]},labelText:this.translate("type","fields","Admin")})},{view:new n.default({name:"name",params:{required:!0,noSpellCheck:!0,pattern:"$latinLetters"},labelText:this.translate("name","fields")})},{view:new n.default({name:"label",params:{required:!0,pattern:"$noBadCharacters"},labelText:this.translate("label","fields","Admin")})}],[]]}]}),this.assignView("record",this.recordView,".record")}actionCreate(){this.recordView.fetch(),this.recordView.validate()||(this.disableButton("create"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Layout/action/create",{scope:this.scope,type:this.model.get("type"),name:this.model.get("name"),label:this.model.get("label")}).then(()=>{this.reRender(),Espo.Ui.success("Created",{suppress:!0}),this.trigger("done"),this.close()}).catch(()=>{this.enableButton("create")}))}}e.default=l}),define("views/admin/dynamic-logic/conditions-string/item-operator-only-base",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-operator-only-base",createValueFieldView:function(){}})}),define("views/admin/dynamic-logic/conditions/field-types/base",["exports","view","ui/select"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{template="admin/dynamic-logic/conditions/field-types/base";events={'click > div > div > [data-action="remove"]':function(e){e.stopPropagation(),this.trigger("remove-item")}};data(){return{type:this.type,field:this.field,scope:this.scope,typeList:this.typeList,leftString:this.translateLeftString()}}translateLeftString(){return this.translate(this.field,"fields",this.scope)}setup(){this.type=this.options.type,this.field=this.options.field,this.scope=this.options.scope,this.fieldType=this.options.fieldType,this.itemData=this.options.itemData,this.additionalData=this.itemData.data||{},this.typeList=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",this.fieldType,"typeList"]),this.wait(!0),this.createModel().then(e=>{this.model=e,this.populateValues(),this.manageValue(),this.wait(!1)})}createModel(){return this.getModelFactory().create(this.scope)}afterRender(){this.$type=this.$el.find('select[data-name="type"]'),i.default.init(this.$type.get(0)),this.$type.on("change",()=>{this.type=this.$type.val(),this.manageValue()})}populateValues(){this.itemData.attribute&&this.model.set(this.itemData.attribute,this.itemData.value),this.model.set(this.additionalData.values||{})}getValueViewName(){var e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base";return this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e)}getValueFieldName(){return this.field}manageValue(){var e,t,i=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",this.fieldType,"conditionTypes",this.type,"valueType"])||this.getMetadata().get(["clientDefs","DynamicLogic","conditionTypes",this.type,"valueType"]);"field"===i?(e=this.getValueViewName(),t=this.getValueFieldName(),this.createView("value",e,{model:this.model,name:t,selector:".value-container",mode:"edit",readOnlyDisabled:!0},e=>{this.isRendered()&&e.render()})):"custom"===i?(this.clearView("value"),this["createValueView"+Espo.Utils.upperCaseFirst(this.type)]()):"varchar"===i?this.createView("value","views/fields/varchar",{model:this.model,name:this.getValueFieldName(),selector:".value-container",mode:"edit",readOnlyDisabled:!0},e=>{this.isRendered()&&e.render()}):this.clearView("value")}fetch(){const e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t}}e.default=s}),define("views/outbound-email/fields/test-send",["views/fields/base"],function(e){return e.extend({templateContent:'<button class="btn btn-default hidden" data-action="sendTestEmail">'+"{{translate 'Send Test Email' scope='Email'}}</button>",events:{'click [data-action="sendTestEmail"]':function(){this.send()}},fetch:function(){return{}},checkAvailability:function(){this.model.get("smtpServer")?this.$el.find("button").removeClass("hidden"):this.$el.find("button").addClass("hidden")},afterRender:function(){this.checkAvailability(),this.stopListening(this.model,"change:smtpServer"),this.listenTo(this.model,"change:smtpServer",()=>{this.checkAvailability()})},getSmtpData:function(){return{server:this.model.get("smtpServer"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,fromName:this.model.get("outboundEmailFromName"),fromAddress:this.model.get("outboundEmailFromAddress"),type:"outboundEmail"}},send:function(){var i=this.getSmtpData();this.createView("popup","views/outbound-email/modals/test-send",{emailAddress:this.getUser().get("emailAddress")},t=>{t.render(),this.listenToOnce(t,"send",e=>{this.$el.find("button").addClass("disabled"),i.emailAddress=e,this.notify("Sending..."),t.close(),Espo.Ajax.postRequest("Email/sendTest",i).then(()=>{this.$el.find("button").removeClass("disabled"),Espo.Ui.success(this.translate("testEmailSent","messages","Email"))}).catch(e=>{i=(i=e.getResponseHeader("X-Status-Reason")||"").replace(/ $/,"").replace(/,$/,"");var t=this.translate("Error");if(200!==e.status&&(t+=" "+e.status),e.responseText)try{var i=JSON.parse(e.responseText).message||i}catch(e){return void console.error("Could not parse error response body.")}i&&(t+=": "+i),Espo.Ui.error(t,!0),console.error(t),e.errorIsHandled=!0,this.$el.find("button").removeClass("disabled")})})})}})}),define("views/role/record/table",["view"],function(e){return e.extend({template:"role/table",scopeList:null,actionList:["create","read","edit","delete","stream"],accessList:["not-set","enabled","disabled"],fieldLevelList:["yes","no"],fieldActionList:["read","edit"],levelListMap:{recordAllTeamOwnNo:["all","team","own","no"],recordAllTeamNo:["all","team","no"],recordAllOwnNo:["all","own","no"],recordAllNo:["all","no"],record:["all","team","own","no"]},type:"acl",levelList:["yes","all","team","own","no"],booleanLevelList:["yes","no"],booleanActionList:["create"],defaultLevels:{delete:"no"},colors:{yes:"#6BC924",all:"#6BC924",account:"#999900",contact:"#999900",team:"#999900",own:"#CC9900",no:"#F23333",enabled:"#6BC924",disabled:"#F23333","not-set":"#A8A8A8"},mode:"detail",tableData:null,data:function(){var e={},t=(e.editMode="edit"===this.mode,e.actionList=this.actionList,e.accessList=this.accessList,e.fieldActionList=this.fieldActionList,e.fieldLevelList=this.fieldLevelList,e.colors=this.colors,e.tableDataList=this.getTableDataList(),e.fieldTableDataList=this.fieldTableDataList,!1);return this.fieldTableDataList.forEach(e=>{e.list.length&&(t=!0)}),e.hasFieldLevelData=t,e},events:{'click .action[data-action="addField"]':function(e){e=$(e.currentTarget).data().scope;this.showAddFieldModal(e)},'click .action[data-action="removeField"]':function(e){var t=$(e.currentTarget).data().scope,e=$(e.currentTarget).data().field;this.removeField(t,e)},'change select[data-type="access"]':function(e){var t=$(e.currentTarget).attr("name"),t=this.$el.find('select[data-scope="'+t+'"]');"enabled"===$(e.currentTarget).val()?(t.removeAttr("disabled"),t.removeClass("hidden"),t.each((e,t)=>{let i=$(t);var a,s;this.lowestLevelByDefault?i.find("option").last().prop("selected",!0):(t=!0,a=null,!(a=(s=i.data("role-action"))?this.defaultLevels[s]:a)||(s=i.find('option[value="'+a+'"]')).length&&(s.prop("selected",!0),t=!1),t&&i.find("option").first().prop("selected",!0)),i.trigger("change"),this.controlSelectColor(i)})):(t.attr("disabled","disabled"),t.addClass("hidden")),this.controlSelectColor($(e.currentTarget))},"change select.scope-action":function(e){this.controlSelectColor($(e.currentTarget))},"change select.field-action":function(e){this.controlSelectColor($(e.currentTarget))}},getTableDataList:function(){var l=this.acl.data,e=[];return this.scopeList.forEach(a=>{var s="not-set",n=(this.final&&(s="enabled"),a in l&&(s=!1===l[a]?"disabled":"enabled"),[]),o=this.aclTypeMap[a];"boolean"!==this.aclTypeMap[a]&&this.actionList.forEach(e=>{var t,i=this.getMetadata().get(["scopes",a,this.type+"ActionList"]);!i||~i.indexOf(e)?"stream"!==e||this.getMetadata().get("scopes."+a+".stream")?(i="no",~this.booleanActionList.indexOf(e)&&(i="no"),a in l&&("enabled"===s?!0!==l[a]&&e in l[a]&&(i=l[a][e]):i="no"),t=this.getMetadata().get(["scopes",a,this.type+"ActionLevelListMap",e])||this.getMetadata().get(["scopes",a,this.type+"LevelList"])||this.levelListMap[o]||[],~this.booleanActionList.indexOf(e)&&(t=this.booleanLevelList),n.push({level:i,name:a+"-"+e,action:e,levelList:t})):n.push({action:"stream",levelList:!1,level:null}):n.push({action:e,levelList:!1,level:null})}),e.push({list:n,access:s,name:a,type:o})}),e},setup:function(){this.mode=this.options.mode||"detail",this.final=this.options.final||!1,this.setupData(),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("data")||this.model.hasChanged("fieldData"))&&this.setupData()}),this.listenTo(this.model,"sync",()=>{this.setupData(),this.isRendered()&&this.reRender()}),this.template="role/table","edit"===this.mode&&(this.template="role/table-edit"),this.once("remove",()=>{$(window).off("scroll.scope-"+this.cid),$(window).off("resize.scope-"+this.cid),$(window).off("scroll.field-"+this.cid),$(window).off("resize.field-"+this.cid)})},setupData:function(){this.acl={},this.options.acl?this.acl.data=this.options.acl.data:this.acl.data=Espo.Utils.cloneDeep(this.model.get("data")||{}),this.options.acl?this.acl.fieldData=this.options.acl.fieldData:this.acl.fieldData=Espo.Utils.cloneDeep(this.model.get("fieldData")||{}),this.setupScopeList(),this.setupFieldTableDataList()},setupScopeList:function(){this.aclTypeMap={},this.scopeList=[],Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))).forEach(e=>{var t;this.getMetadata().get("scopes."+e+".disabled")||(t=this.getMetadata().get("scopes."+e+".acl"))&&(this.scopeList.push(e),!0===(this.aclTypeMap[e]=t)&&(this.aclTypeMap[e]="record"))})},setupFieldTableDataList:function(){this.fieldTableDataList=[],this.scopeList.forEach(e=>{if((this.getMetadata().get("scopes."+e)||{}).entity){if(!(e in this.acl.fieldData))return"edit"===this.mode?void this.fieldTableDataList.push({name:e,list:[]}):void 0;var a=this.acl.fieldData[e],t=this.getFieldManager().getEntityTypeFieldList(e),s=(this.getLanguage().sortFieldList(e,t),[]);t.forEach(t=>{var i;t in a&&(i=[],this.fieldActionList.forEach(e=>{i.push({name:e,value:a[t][e]||"yes"})}),"detail"===this.mode&&!i.length||s.push({name:t,list:i}))}),this.fieldTableDataList.push({name:e,list:s})}})},fetchScopeData:function(){var e,t={},i=this.scopeList,a=this.actionList,s=this.aclTypeMap;for(e in i){var n=i[e];if("not-set"!==this.$el.find('select[name="'+n+'"]').val())if("disabled"===this.$el.find('select[name="'+n+'"]').val())t[n]=!1;else{var o=!0;if("boolean"!==s[n])for(var l in o={},a){l=a[l];o[l]=this.$el.find('select[name="'+n+"-"+l+'"]').val()}t[n]=o}}return t},fetchFieldData:function(){var i={};return this.fieldTableDataList.forEach(e=>{var t={},s=e.name;e.list.forEach(e=>{var i=e.name,a={};this.fieldActionList.forEach(e=>{var t=this.$el.find('select[data-scope="'+s+'"][data-field="'+i+'"][data-action="'+e+'"]');t.length&&(a[e]=t.val())}),t[i]=a}),i[s]=t}),i},afterRender:function(){"edit"===this.mode&&(this.scopeList.forEach(t=>{var i=this.$el.find('select[name="'+t+'-read"]'),a=(i.on("change",()=>{var e=i.val();this.controlEditSelect(t,e),this.controlDeleteSelect(t,e),this.controlStreamSelect(t,e)}),this.$el.find('select[name="'+t+'-edit"]'));a.on("change",()=>{var e=a.val();this.controlDeleteSelect(t,e)}),this.controlEditSelect(t,i.val(),!0),this.controlStreamSelect(t,i.val(),!0),this.controlDeleteSelect(t,a.val(),!0)}),this.fieldTableDataList.forEach(e=>{var a=e.name;e.list.forEach(e=>{var t=e.name,i=this.$el.find('select[data-scope="'+a+'"][data-field="'+t+'"][data-action="read"]');i.on("change",()=>{var e=i.val();this.controlFieldEditSelect(a,t,e)}),this.controlFieldEditSelect(a,t,i.val(),!0)})}),this.setSelectColors()),"edit"!==this.mode&&"detail"!==this.mode||(this.initStickyHeader("scope"),this.initStickyHeader("field"))},controlFieldEditSelect:function(e,t,i,a){e=this.$el.find('select[data-scope="'+e+'"][data-field="'+t+'"][data-action="edit"]');a||this.fieldLevelList.indexOf(e.val())<this.fieldLevelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.fieldLevelList.indexOf(t.val())<this.fieldLevelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},controlEditSelect:function(e,i,t){e=this.$el.find('select[name="'+e+'-edit"]');t||this.levelList.indexOf(e.val())<this.levelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.levelList.indexOf(t.val())<this.levelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},controlStreamSelect:function(e,i,t){e=this.$el.find('select[name="'+e+'-stream"]');t||this.levelList.indexOf(e.val())<this.levelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.levelList.indexOf(t.val())<this.levelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},controlDeleteSelect:function(e,i,t){e=this.$el.find('select[name="'+e+'-delete"]');t||this.levelList.indexOf(e.val())<this.levelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.levelList.indexOf(t.val())<this.levelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},showAddFieldModal:function(a){this.trigger("change");var e=Object.keys(this.acl.fieldData[a]||{});this.createView("addField","views/role/modals/add-field",{scope:a,ignoreFieldList:e,type:this.type},e=>{e.render(),this.listenTo(e,"add-field",i=>{e.close(),this.fieldTableDataList.forEach(e=>{var t;e.name===a&&(t=!1,e.list.forEach(e=>{e.name===i&&(t=!0)}),t||e.list.unshift({name:i,list:[{name:"read",value:"yes"},{name:"edit",value:"yes"}]}))}),this.reRender()})})},removeField:function(t,a){this.trigger("change"),this.fieldTableDataList.forEach(e=>{var i;e.name===t&&(i=-1,e.list.forEach((e,t)=>{e.name===a&&(i=t)}),~i&&(e.list.splice(i,1),this.reRender()))})},initStickyHeader:function(e){var t,n=this.$el.find(".sticky-header-"+e),o=$(window),l=this.getThemeManager().getParam("screenWidthXs"),r=$(".detail-button-container"),d=this.$el.find("table."+e+"-level");d.length&&r.length&&(t=()=>{var e,t,i,a,s;$(window.document).width()<l?n.addClass("hidden"):(e=r.get(0).getBoundingClientRect().top+r.outerHeight(),t=d.position().top,i=(t=(t=(t-=r.height())+d.find("tr > th").height())-this.getThemeManager().getParam("navbarHeight"))+d.outerHeight(!0)-r.height(),a=o.scrollTop(),s=d.width(),t<a&&a<i?(n.css({position:"fixed",marginTop:e+"px",top:0,width:s+"px",marginLeft:"1px"}),n.removeClass("hidden")):n.addClass("hidden"))},o.off("scroll."+e+"-"+this.cid),o.on("scroll."+e+"-"+this.cid,t),o.off("resize."+e+"-"+this.cid),o.on("resize."+e+"-"+this.cid,t))},setSelectColors:function(){this.$el.find('select[data-type="access"]').each((e,t)=>{t=$(t);this.controlSelectColor(t)}),this.$el.find("select.scope-action").each((e,t)=>{t=$(t);this.controlSelectColor(t)}),this.$el.find("select.field-action").each((e,t)=>{t=$(t);this.controlSelectColor(t)})},controlSelectColor:function(e){var t=e.val(),i=this.colors[t]||"";e.css("color",i="not-set"===t?"":i),e.children().each((e,t)=>{var t=$(t),i=t.val(),a=this.colors[i]||"";"not-set"===i&&(a=""),t.attr("disabled")&&(a=""),t.css("color",a)})}})}),define("views/role/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove","export"],checkAllResultDisabled:!0})}),define("views/role/record/edit",["views/record/edit"],function(r){return r.extend({tableView:"views/role/record/table",sideView:!1,isWide:!0,stickButtonsContainerAllTheWay:!0,fetch:function(){var e,t=r.prototype.fetch.call(this),i=(t.data={},this.getView("extra").scopeList),a=this.getView("extra").actionList,s=this.getView("extra").aclTypeMap;for(e in i){var n=i[e];if("not-set"!==this.$el.find('select[name="'+n+'"]').val())if("disabled"===this.$el.find('select[name="'+n+'"]').val())t.data[n]=!1;else{var o=!0;if("boolean"!==s[n])for(var l in o={},a){l=a[l];o[l]=this.$el.find('select[name="'+n+"-"+l+'"]').val()}t.data[n]=o}}return t.data=this.getView("extra").fetchScopeData(),t.fieldData=this.getView("extra").fetchFieldData(),t},getDetailLayout:function(e){e({type:"record",layout:this._convertSimplifiedLayout([{label:"",cells:[{name:"name",type:"varchar"}]}])})},setup:function(){r.prototype.setup.call(this),this.createView("extra",this.tableView,{mode:"edit",selector:".extra",model:this.model},e=>{this.listenTo(e,"change",()=>{var e=this.fetch();this.model.set(e)})})}})}),define("views/role/record/detail",["views/record/detail"],function(e){return e.extend({tableView:"views/role/record/table",sideView:!1,isWide:!0,editModeDisabled:!0,stickButtonsContainerAllTheWay:!0,setup:function(){e.prototype.setup.call(this),this.createView("extra",this.tableView,{selector:".extra",model:this.model})}})}),define("views/inbound-email/record/detail",["views/record/detail"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.setupFieldsBehaviour(),this.initSslFieldListening()},modifyDetailLayout:function(e){e.filter(e=>"$label:SMTP"===e.tabLabel).forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{let t=this.translate(e.name,"fields","InboundEmail");t&&0===t.indexOf("SMTP ")&&(e.labelText=Espo.Utils.upperCaseFirst(t.substring(5)))})})})},wasFetched:function(){return!this.model.isNew()&&!!(this.model.get("fetchData")||{}).lastUID},initSmtpFieldsControl:function(){this.controlSmtpFields(),this.controlSentFolderField(),this.listenTo(this.model,"change:useSmtp",this.controlSmtpFields,this),this.listenTo(this.model,"change:smtpAuth",this.controlSmtpFields,this),this.listenTo(this.model,"change:storeSentEmails",this.controlSentFolderField,this)},controlSmtpFields:function(){if(this.model.get("useSmtp"))return this.showField("smtpHost"),this.showField("smtpPort"),this.showField("smtpAuth"),this.showField("smtpSecurity"),this.showField("smtpTestSend"),this.showField("fromName"),this.showField("smtpIsShared"),this.showField("smtpIsForMassEmail"),this.showField("storeSentEmails"),this.setFieldRequired("smtpHost"),this.setFieldRequired("smtpPort"),void this.controlSmtpAuthField();this.hideField("smtpHost"),this.hideField("smtpPort"),this.hideField("smtpAuth"),this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.hideField("smtpSecurity"),this.hideField("smtpTestSend"),this.hideField("fromName"),this.hideField("smtpIsShared"),this.hideField("smtpIsForMassEmail"),this.hideField("storeSentEmails"),this.hideField("sentFolder"),this.setFieldNotRequired("smtpHost"),this.setFieldNotRequired("smtpPort"),this.setFieldNotRequired("smtpUsername")},controlSentFolderField:function(){if(this.model.get("useSmtp")&&this.model.get("storeSentEmails"))return this.showField("sentFolder"),void this.setFieldRequired("sentFolder");this.hideField("sentFolder"),this.setFieldNotRequired("sentFolder")},controlSmtpAuthField:function(){if(this.model.get("smtpAuth"))return this.showField("smtpUsername"),this.showField("smtpPassword"),this.showField("smtpAuthMechanism"),void this.setFieldRequired("smtpUsername");this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.setFieldNotRequired("smtpUsername")},controlStatusField:function(){let e=["username","port","host","monitoredFolders"];"Active"===this.model.get("status")&&this.model.get("useImap")?e.forEach(e=>{this.setFieldRequired(e)}):e.forEach(e=>{this.setFieldNotRequired(e)})},setupFieldsBehaviour:function(){this.controlStatusField(),this.listenTo(this.model,"change:status",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.listenTo(this.model,"change:useImap",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.wasFetched()?this.setFieldReadOnly("fetchSince"):this.setFieldNotReadOnly("fetchSince"),this.initSmtpFieldsControl();let a=e=>{e.get("createCase")?this.showField("caseDistribution"):this.hideField("caseDistribution"),e.get("createCase")&&-1!==["Round-Robin","Least-Busy"].indexOf(e.get("caseDistribution"))?(this.setFieldRequired("team"),this.showField("targetUserPosition")):(this.setFieldNotRequired("team"),this.hideField("targetUserPosition")),e.get("createCase")&&"Direct-Assignment"===e.get("caseDistribution")?(this.setFieldRequired("assignToUser"),this.showField("assignToUser")):(this.setFieldNotRequired("assignToUser"),this.hideField("assignToUser")),e.get("createCase")&&""!==e.get("createCase")?this.showField("team"):this.hideField("team")};this.listenTo(this.model,"change:createCase",(e,t,i)=>{a(e),i.ui&&(e.get("createCase")||this.model.set({caseDistribution:"",teamId:null,teamName:null,assignToUserId:null,assignToUserName:null,targetUserPosition:""}))}),a(this.model),this.listenTo(this.model,"change:caseDistribution",(e,t,i)=>{a(e),i.ui&&setTimeout(()=>{this.model.get("caseDistribution")?("Direct-Assignment"===this.model.get("caseDistribution")&&this.model.set({targetUserPosition:""}),this.model.set({assignToUserId:null,assignToUserName:null})):this.model.set({assignToUserId:null,assignToUserName:null,targetUserPosition:""})},10)})},initSslFieldListening:function(){this.listenTo(this.model,"change:security",(e,t,i)=>{i.ui&&(t?this.model.set("port",993):this.model.set("port",143))}),this.listenTo(this.model,"change:smtpSecurity",(e,t,i)=>{i.ui&&("SSL"===t?this.model.set("smtpPort",465):"TLS"===t?this.model.set("smtpPort",587):this.model.set("smtpPort",25))})}})}),define("views/admin/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/index";events={"click [data-action]":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};data(){return{panelDataList:this.panelDataList,iframeUrl:this.iframeUrl,iframeHeight:this.getConfig().get("adminPanelIframeHeight")||1330,iframeDisabled:this.getConfig().get("adminPanelIframeDisabled")||!1}}afterRender(){let e=this.$el.find('input[data-name="quick-search"]');this.quickSearchText&&(e.val(this.quickSearchText),this.processQuickSearch(this.quickSearchText)),e.get(0).focus({preventScroll:!0})}setup(){this.panelDataList=[];var e,i=this.getMetadata().get("app.adminPanel")||{};for(e in i){let t=Espo.Utils.cloneDeep(i[e]);t.name=e,t.itemList=t.itemList||[],t.label=this.translate(t.label,"labels","Admin"),t.itemList&&t.itemList.forEach(e=>{e.label=this.translate(e.label,"labels","Admin"),e.description?e.keywords=(this.getLanguage().get("Admin","keywords",e.description)||"").split(","):e.keywords=[]}),t.items&&t.items.forEach(e=>{e.label=this.translate(e.label,"labels","Admin"),t.itemList.push(e),e.keywords=[]}),this.panelDataList.push(t)}this.panelDataList.sort((e,t)=>("order"in e||!("order"in t))&&"order"in t?e.order-t.order:0);let t=["version="+encodeURIComponent(this.getConfig().get("version")),"css="+encodeURIComponent(this.getConfig().get("siteUrl")+"/"+this.getThemeManager().getStylesheet())];this.iframeUrl=this.getConfig().get("adminPanelIframeUrl")||"https:
        <div class="record-container no-side-margin">{{{record}}}</div>
    `;setup(){this.headerText=this.translate("Export"),this.buttonList=[{name:"export",label:"Export",style:"danger",onClick:()=>this.export()},{name:"cancel",label:"Cancel"}];var e=this.getConfig().get("customExportManifest")||{};this.model=new i.default({name:e.name??null,module:e.module??null,version:e.version??"0.0.1",author:e.author??null,description:e.description??null}),this.recordView=new a.default({model:this.model,detailLayout:[{rows:[[{view:new s.default({name:"name",labelText:this.translate("name","fields"),params:{pattern:"$latinLettersDigitsWhitespace",required:!0}})},{view:new s.default({name:"module",labelText:this.translate("module","fields","EntityManager"),params:{pattern:"[A-Z][a-z][A-Za-z]+",required:!0}})}],[{view:new s.default({name:"version",labelText:this.translate("version","fields","EntityManager"),params:{pattern:"[0-9]+\\.[0-9]+\\.[0-9]+",required:!0}})},!1],[{view:new s.default({name:"author",labelText:this.translate("author","fields","EntityManager"),params:{required:!0}})},{view:new s.default({name:"description",labelText:this.translate("description","fields"),params:{}})}]]}]}),this.assignView("record",this.recordView)}export(){const t=this.recordView.fetch();this.recordView.validate()||(this.disableButton("export"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("EntityManager/action/exportCustom",t).then(e=>{this.close(),this.getConfig().set("customExportManifest",t),Espo.Ui.success(this.translate("Done")),window.location=this.getBasePath()+"?entryPoint=download&id="+e.id}).catch(()=>this.enableButton("create")))}}e.default=o}),define("views/admin/dynamic-logic/conditions-string/item-operator-only-date",["views/admin/dynamic-logic/conditions-string/item-operator-only-base"],function(t){return t.extend({template:"admin/dynamic-logic/conditions-string/item-operator-only-date",data:function(){var e=t.prototype.data.call(this);return e.dateValue=this.dateValue,e}})}),define("views/admin/dynamic-logic/conditions-string/group-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/group-base",data:function(){return this.conditionList.length?{viewDataList:this.viewDataList,operator:this.operator,level:this.level}:{isEmpty:!0}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.itemData=this.options.itemData||{},this.viewList=[];const a=this.conditionList=this.itemData.value||[];this.viewDataList=[],a.forEach((e,t)=>{var i="view-"+this.level.toString()+"-"+this.number.toString()+"-"+t.toString();this.createItemView(t,i,e),this.viewDataList.push({key:i,isEnd:t===a.length-1})})},getFieldType:function(e){return this.getMetadata().get(["entityDefs",this.scope,"fields",e.attribute,"type"])||"base"},createItemView:function(t,i,a){this.viewList.push(i);var s=((a=a||{}).data||{}).type||a.type||"equals",n=this.getFieldType(a),n=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",n,"conditionTypes",s,"itemView"])||this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",s,"view"]);if(n){var o=this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",s,"operator"]);let e=this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",s,"operatorString"]);e=e||'<i class="small">'+(e=this.getLanguage().translateOption(s,"operators","DynamicLogic").toLowerCase())+"</i>",this.createView(i,n,{itemData:a,scope:this.scope,level:this.level+1,selector:'[data-view-key="'+i+'"]',number:t,operator:o,operatorString:e})}}})}),define("views/admin/dynamic-logic/conditions/group-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/group-base",data:function(){return{viewDataList:this.viewDataList,operator:this.operator,level:this.level,groupOperator:this.getGroupOperator()}},events:{'click > div.group-head > [data-action="remove"]':function(e){e.stopPropagation(),this.trigger("remove-item")},'click > div.group-bottom [data-action="addField"]':function(){this.actionAddField()},'click > div.group-bottom [data-action="addAnd"]':function(){this.actionAddGroup("and")},'click > div.group-bottom [data-action="addOr"]':function(){this.actionAddGroup("or")},'click > div.group-bottom [data-action="addNot"]':function(){this.actionAddGroup("not")},'click > div.group-bottom [data-action="addCurrentUser"]':function(){this.addCurrentUser()},'click > div.group-bottom [data-action="addCurrentUserTeams"]':function(){this.addCurrentUserTeams()}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.itemData=this.options.itemData||{},this.viewList=[];const e=this.conditionList=this.itemData.value||[];this.viewDataList=[],e.forEach((e,t)=>{var i=this.getKey(t);this.createItemView(t,i,e),this.addViewDataListItem(t,i)})},getGroupOperator:function(){return"or"===this.operator?"or":"and"},getKey:function(e){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+e.toString()},createItemView:function(t,e,i){this.viewList.push(e),this.isCurrentUser=i.attribute&&i.attribute.startsWith("$user.");var a=this.isCurrentUser?"User":this.scope,s=(i=i||{}).data||{},n=s.type||i.type||"equals",s=s.field||i.attribute;let o,l;["and","or","not"].includes(n)?o="views/admin/dynamic-logic/conditions/"+n:(l=this.getMetadata().get(["entityDefs",a,"fields",s,"type"]),"id"===s&&(l="id"),"$user.id"===i.attribute&&(l="currentUser"),(l="$user.teamsIds"===i.attribute?"currentUserTeams":l)&&(o=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",l,"view"]))),o&&this.createView(e,o,{itemData:i,scope:a,level:this.level+1,selector:'[data-view-key="'+e+'"]',number:t,type:n,field:s,fieldType:l},e=>{this.isRendered()&&e.render(),this.controlAddItemVisibility(),this.listenToOnce(e,"remove-item",()=>{this.removeItem(t)})})},fetch:function(){const i=[];return this.viewDataList.forEach(e=>{const t=this.getView(e.key);i.push(t.fetch())}),{type:this.operator,value:i}},removeItem:function(i){var e=this.getKey(i);this.clearView(e),this.$el.find('[data-view-key="'+e+'"]').remove(),this.$el.find('[data-view-ref-key="'+e+'"]').remove();let a=-1;this.viewDataList.forEach((e,t)=>{e.index===i&&(a=t)}),~a&&this.viewDataList.splice(a,1),this.controlAddItemVisibility()},actionAddField:function(){this.createView("modal","views/admin/dynamic-logic/modals/add-field",{scope:this.scope},t=>{t.render(),this.listenToOnce(t,"add-field",e=>{this.addField(e),t.close()})})},addCurrentUser:function(){var e=this.getIndexForNewItem(),t=this.getKey(e);this.addItemContainer(e),this.addViewDataListItem(e,t),this.createItemView(e,t,{attribute:"$user.id",data:{type:"equals"}})},addCurrentUserTeams:function(){var e=this.getIndexForNewItem(),t=this.getKey(e);this.addItemContainer(e),this.addViewDataListItem(e,t),this.createItemView(e,t,{attribute:"$user.teamsIds",data:{type:"contains",field:"teams"}})},addField:function(e){let t=this.getMetadata().get(["entityDefs",this.scope,"fields",e,"type"]);if(t||"id"!==e||(t="id"),!this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t]))throw new Error;var i=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t,"typeList"])[0],a=this.getIndexForNewItem(),s=this.getKey(a);this.addItemContainer(a),this.addViewDataListItem(a,s),this.createItemView(a,s,{data:{field:e,type:i}})},getIndexForNewItem:function(){return this.viewDataList.length?this.viewDataList[this.viewDataList.length-1].index+1:0},addViewDataListItem:function(e,t){this.viewDataList.push({index:e,key:t})},addItemContainer:function(e){var t=$('<div data-view-key="'+this.getKey(e)+'"></div>'),t=(this.$el.find("> .item-list").append(t),this.translate(this.getGroupOperator(),"logicalOperators","Admin")),e=$('<div class="group-operator" data-view-ref-key="'+this.getKey(e)+'">'+t+"</div>");this.$el.find("> .item-list").append(e)},actionAddGroup:function(e){var t=this.getIndexForNewItem(),i=this.getKey(t);this.addItemContainer(t),this.addViewDataListItem(t,i),this.createItemView(t,i,{type:e,value:[]})},afterRender:function(){this.controlAddItemVisibility()},controlAddItemVisibility:function(){}})}),define("views/admin/dynamic-logic/conditions/field-types/link-multiple",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({getValueFieldName:function(){return this.name},getValueViewName:function(){return"views/fields/link"},createValueViewContains:function(){this.createLinkValueField()},createValueViewNotContains:function(){this.createLinkValueField()},createLinkValueField:function(){this.createView("value","views/fields/link",{model:this.model,name:"link",selector:".value-container",mode:"edit",readOnlyDisabled:!0,foreignScope:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"entity"])||this.getMetadata().get(["entityDefs",this.scope,"links",this.field,"entity"])},e=>{this.isRendered()&&e.render()})},fetch:function(){const e=this.getView("value"),t={type:this.type,attribute:this.field+"Ids",data:{field:this.field}};if(e){e.fetchToModel(),t.value=this.model.get("linkId");const i={};i.linkName=this.model.get("linkName"),i.linkId=this.model.get("linkId"),t.data.values=i}return t}})}),define("views/email-account/fields/test-send",["views/outbound-email/fields/test-send"],function(e){return e.extend({checkAvailability:function(){this.model.get("smtpHost")?this.$el.find("button").removeClass("hidden"):this.$el.find("button").addClass("hidden")},afterRender:function(){this.checkAvailability(),this.stopListening(this.model,"change:smtpHost"),this.listenTo(this.model,"change:smtpHost",()=>{this.checkAvailability()})},getSmtpData:function(){return{server:this.model.get("smtpHost"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,authMechanism:this.model.get("smtpAuthMechanism"),fromName:this.getUser().get("name"),fromAddress:this.model.get("emailAddress"),type:"emailAccount",id:this.model.id,userId:this.model.get("assignedUserId")}}})}),define("views/email-account/fields/test-connection",["views/fields/base"],function(e){return e.extend({readOnly:!0,templateContent:'<button class="btn btn-default disabled" data-action="testConnection">'+"{{translate 'Test Connection' scope='EmailAccount'}}</button>",url:"EmailAccount/action/testConnection",events:{'click [data-action="testConnection"]':function(){this.test()}},fetch:function(){return{}},checkAvailability:function(){this.model.get("host")?this.$el.find("button").removeClass("disabled").removeAttr("disabled"):this.$el.find("button").addClass("disabled").attr("disabled","disabled")},afterRender:function(){this.checkAvailability(),this.stopListening(this.model,"change:host"),this.listenTo(this.model,"change:host",()=>{this.checkAvailability()})},getData:function(){return{host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),password:this.model.get("password")||null,id:this.model.id,emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")}},test:function(){var e=this.getData();let a=this.$el.find("button");a.addClass("disabled"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(this.url,e).then(()=>{a.removeClass("disabled"),Espo.Ui.success(this.translate("connectionIsOk","messages","EmailAccount"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=(t=t.replace(/ $/,"")).replace(/,$/,""),this.translate("Error"));200!==parseInt(e.status)&&(i+=" "+e.status),t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,a.removeClass("disabled")})}})}),define("views/email-account/fields/folders",["views/fields/array"],function(e){return e.extend({getFoldersUrl:"EmailAccount/action/getFolders",setupOptions:function(){this.params.options=["INBOX"]},fetchFolders:function(){return new Promise(t=>{var e={host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")};this.model.has("password")&&(e.password=this.model.get("password")),this.model.isNew()||(e.id=this.model.id),Espo.Ajax.postRequest(this.getFoldersUrl,e).then(e=>{t(e)}).catch(e=>{Espo.Ui.error(this.translate("couldNotConnectToImap","messages","EmailAccount")),e.errorIsHandled=!0,t(["INBOX"])})})},actionAddItem:function(){Espo.Ui.notify(" ... "),this.fetchFolders().then(e=>{Espo.Ui.notify(!1),this.createView("addModal",this.addItemModalView,{options:e}).then(t=>{t.render(),t.once("add",e=>{this.addValue(e),t.close()}),t.once("add-mass",e=>{e.forEach(e=>{this.addValue(e)}),t.close()})})})}})}),define("views/email-account/fields/folder",["views/fields/base"],function(e){return e.extend({editTemplate:"email-account/fields/folder/edit",getFoldersUrl:"EmailAccount/action/getFolders",events:{'click [data-action="selectFolder"]':function(){Espo.Ui.notify(this.translate("pleaseWait","messages"));var e={host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")};this.model.has("password")&&(e.password=this.model.get("password")),this.model.isNew()||(e.id=this.model.id),Espo.Ajax.postRequest(this.getFoldersUrl,e).then(e=>{this.createView("modal","views/email-account/modals/select-folder",{folders:e},t=>{Espo.Ui.notify(!1),t.render(),this.listenToOnce(t,"select",e=>{t.close(),this.addFolder(e)})})}).catch(e=>{Espo.Ui.error(this.translate("couldNotConnectToImap","messages","EmailAccount")),e.errorIsHandled=!0})}},addFolder:function(e){this.$element.val(e)}})}),define("helpers/misc/authentication-provider",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.metadata=e.getMetadata(),this.model=e.model;const t=e.getMetadata().get(["authenticationMethods"])||{};this.methodList=Object.keys(t).filter(e=>{return(t[e].provider||{}).isAvailable}),this.authFields={},this.dynamicLogicDefs={fields:{},panels:{}}}setupPanelsVisibility(e){this.handlePanelsVisibility(e),this.view.listenTo(this.model,"change:method",()=>this.handlePanelsVisibility(e))}getFromMetadata(e,t){return this.metadata.get(["authenticationMethods",e,"provider",t])||this.metadata.get(["authenticationMethods",e,"settings",t])}setupMethods(){return this.methodList.forEach(e=>this.setupMethod(e)),this.dynamicLogicDefs}setupMethod(e){let t=this.getFromMetadata(e,"fieldList")||[];t=t.filter(e=>this.model.hasField(e)),this.authFields[e]=t;var i,a=(this.getFromMetadata(e,"dynamicLogic")||{}).fields||{};for(const s in a)t.includes(s)&&(i=this.modifyDynamicLogic(a[s]),this.dynamicLogicDefs.fields[s]=Espo.Utils.cloneDeep(i))}modifyDynamicLogic(t){if(t=Espo.Utils.clone(t),Array.isArray(t))return t.map(e=>this.modifyDynamicLogic(e));if("object"!=typeof t)return t;{const i={};for(const a in t){let e=t[a];"attribute"===a&&"authenticationMethod"===e&&(e="method"),i[a]=this.modifyDynamicLogic(e)}return i}}modifyDetailLayout(i){this.methodList.forEach(e=>{let t=this.getFromMetadata(e,"layout");t&&((t=Espo.Utils.cloneDeep(t)).name=e,this.prepareLayout(t,e),i.push(t))})}prepareLayout(e,i){e.rows.forEach(e=>{e.filter(e=>!e.noLabel&&!e.labelText&&e.name).forEach(e=>{if(null!==e){const t=this.view.translate(e.name,"fields","Settings");e.options=e.options||{},t&&0===t.toLowerCase().indexOf(i.toLowerCase()+" ")&&(e.labelText=t.substring(i.length+1)),e.options.tooltipText=this.view.translate(e.name,"tooltips","Settings")}})}),e.rows=e.rows.map(e=>e=e.map(e=>!(e&&e.name&&!this.model.hasField(e.name))&&e))}handlePanelsVisibility(i){const a=this.model.get("method");this.methodList.forEach(e=>{const t=this.authFields[e]||[];if(e!==a)return this.view.hidePanel(e),void t.forEach(e=>{this.view.hideField(e)});this.view.showPanel(e),t.forEach(e=>this.view.showField(e)),i()})}}}),define("views/settings/record/edit",["views/record/edit"],function(e){return e.extend({saveAndContinueEditingAction:!1,sideView:null,layoutName:"settings",setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"after:save",()=>{this.getConfig().set(this.model.getClonedAttributes())})},afterRender:function(){e.prototype.afterRender.call(this)},exit:function(e){"cancel"===e&&this.getRouter().navigate("#Admin",{trigger:!0})}})}),define("views/settings/edit",["exports","views/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="Settings";setupHeader(){this.createView("header",this.headerView,{model:this.model,fullSelector:"#main > .header",template:this.options.headerTemplate,label:this.options.label})}}e.default=a}),define("views/templates/event/record/detail",["views/record/detail"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.getAcl().checkModel(this.model,"edit")&&-1===["Held","Not Held"].indexOf(this.model.get("status"))&&(this.dropdownItemList.push({html:this.translate("Set Held","labels",this.scope),name:"setHeld"}),this.dropdownItemList.push({html:this.translate("Set Not Held","labels",this.scope),name:"setNotHeld"}))},actionSetHeld:function(){this.model.save({status:"Held"},{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Saved","labels","Meeting")),this.removeButton("setHeld"),this.removeButton("setNotHeld")})},actionSetNotHeld:function(){this.model.save({status:"Not Held"},{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Saved","labels","Meeting")),this.removeButton("setHeld"),this.removeButton("setNotHeld")})}})}),define("views/scheduled-job/list",["views/list"],function(e){return e.extend({searchPanel:!1,setup:function(){e.prototype.setup.call(this),this.menu.buttons.push({link:"#Admin/jobs",text:this.translate("Jobs","labels","Admin")}),this.createView("search","views/base",{fullSelector:"#main > .search-container",template:"scheduled-job/cronjob"})},afterRender:function(){e.prototype.afterRender.call(this),Espo.Ajax.getRequest("Admin/action/cronMessage").then(e=>{this.$el.find(".cronjob .message").html(e.message),this.$el.find(".cronjob .command").html("<strong>"+e.command+"</strong>")})},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration","labels","Admin")),this.getLanguage().translate(this.scope,"scopeNamesPlural")])}})}),define("views/scheduled-job/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove","massUpdate"]})}),define("views/scheduled-job/record/detail",["views/record/detail"],function(e){return e.extend({duplicateAction:!1})}),define("views/scheduled-job/record/panels/log",["views/record/panels/relationship"],function(e){return e.extend({setupListLayout:function(){~(this.getMetadata().get(["clientDefs","ScheduledJob","jobWithTargetList"])||[]).indexOf(this.model.get("job"))&&(this.listLayoutName="listSmallWithTarget")}})}),define("views/scheduled-job/fields/scheduling",["views/fields/varchar"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this),(this.isEditMode()||this.isDetailMode())&&this.wait(Espo.loader.requirePromise("lib!cronstrue").then(e=>{this.Cronstrue=e,this.listenTo(this.model,"change:"+this.name,()=>this.showText())}))},afterRender:function(){var e;t.prototype.afterRender.call(this),(this.isEditMode()||this.isDetailMode())&&(e=this.$text=$('<div class="small text-success"/>'),this.$el.append(e),this.showText())},showText:function(){if(this.$text&&this.$text.length&&this.Cronstrue){var e=this.model.get(this.name);if(e)if("* * * * *"!==e){var t="en",i=Object.keys(this.Cronstrue.default.locales),a=this.getLanguage().name;~i.indexOf(a)?t=a:~i.indexOf(a.split("_")[0])&&(t=a.split("_")[0]);try{var s=this.Cronstrue.toString(e,{use24HourTimeFormat:!this.getDateTime().hasMeridian(),locale:t})}catch(e){s=this.translate("Not valid")}this.$text.text(s)}else this.$text.text(this.translate("As often as possible","labels","ScheduledJob"));else this.$text.text("")}}})}),define("views/scheduled-job/fields/job",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),(this.isEditMode()||this.isDetailMode())&&(this.wait(!0),Espo.Ajax.getRequest("Admin/jobs").then(e=>{this.params.options=e.filter(e=>!this.getMetadata().get(["entityDefs","ScheduledJob","jobs",e,"isSystem"])),this.params.options.unshift(""),this.wait(!1)})),this.model.isNew()&&this.on("change",()=>{var e,t=this.model.get("job");if(t)return e=this.getLanguage().translateOption(t,"job","ScheduledJob"),t=this.getMetadata().get("entityDefs.ScheduledJob.jobSchedulingMap."+t)||"*/10 * * * *",this.model.set("name",e),void this.model.set("scheduling",t);this.model.set("name",""),this.model.set("scheduling","")})}})}),define("views/role/list",["views/list"],function(e){return e.extend({searchPanel:!1})}),define("views/role/record/detail-side",["views/record/detail-side"],function(e){return e.extend({panelList:[{name:"default",label:!1,view:"views/role/record/panels/side"}]})}),define("views/role/record/panels/side",["views/record/panels/side"],function(e){return e.extend({template:"role/record/panels/side"})}),define("views/role/modals/add-field",["views/modal"],function(e){return e.extend({template:"role/modals/add-field",events:{'click a[data-action="addField"]':function(e){this.trigger("add-field",$(e.currentTarget).data().name)}},data:function(){var i=[];return this.fieldList.forEach((e,t)=>{t%4==0&&i.push([]),i[i.length-1].push(e)}),{dataList:i,scope:this.scope}},setup:function(){this.headerText=this.translate("Add Field");var e=this.scope=this.options.scope,i=this.getMetadata().get("entityDefs."+e+".fields")||{},a=[];Object.keys(i).forEach(e=>{var t=i[e];e in this.options.ignoreFieldList||t.disabled||null===this.getMetadata().get(["app",this.options.type,"mandatory","scopeFieldLevel",this.scope,e])&&a.push(e)}),this.fieldList=this.getLanguage().sortFieldList(e,a)}})}),define("views/portal-role/list",["views/list"],function(e){return e.extend({searchPanel:!1})}),define("views/portal-role/record/table",["views/role/record/table"],function(e){return e.extend({levelListMap:{recordAllAccountContactOwnNo:["all","account","contact","own","no"],recordAllAccountOwnNo:["all","account","own","no"],recordAllContactOwnNo:["all","contact","own","no"],recordAllAccountNo:["all","account","no"],recordAllContactNo:["all","contact","no"],recordAllAccountContactNo:["all","account","contact","no"],recordAllOwnNo:["all","own","no"],recordAllNo:["all","no"],record:["all","own","no"]},levelList:["all","account","contact","own","no"],type:"aclPortal",lowestLevelByDefault:!0,setupScopeList:function(){this.aclTypeMap={},this.scopeList=[],Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))).forEach(e=>{var t;this.getMetadata().get("scopes."+e+".disabled")||this.getMetadata().get("scopes."+e+".disabledPortal")||(t=this.getMetadata().get("scopes."+e+".aclPortal"))&&(this.scopeList.push(e),!0===(this.aclTypeMap[e]=t)&&(this.aclTypeMap[e]="record"))})}})}),define("views/portal-role/record/list",["views/role/record/list"],function(e){return e.extend({})}),define("views/portal-role/record/edit",["views/role/record/edit"],function(e){return e.extend({tableView:"views/portal-role/record/table",stickButtonsContainerAllTheWay:!0})}),define("views/portal-role/record/detail",["views/role/record/detail"],function(e){return e.extend({tableView:"views/portal-role/record/table",stickButtonsContainerAllTheWay:!0})}),define("views/lead-capture-log-record/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,fullFormDisabled:!0})}),define("views/lead-capture/opt-in-confirmation-success",["view","model"],function(e,t){return e.extend({template:"lead-capture/opt-in-confirmation-success",setup:function(){let e=new t;this.resultData=this.options.resultData,this.resultData.message&&(e.set("message",this.resultData.message),this.createView("messageField","views/fields/text",{selector:'.field[data-name="message"]',mode:"detail",inlineEditDisabled:!0,model:e,name:"message"}))},data:function(){return{resultData:this.options.resultData,defaultMessage:this.getLanguage().translate("optInIsConfirmed","messages","LeadCapture")}}})}),define("views/lead-capture/opt-in-confirmation-expired",["view","model"],function(e,t){return e.extend({template:"lead-capture/opt-in-confirmation-expired",setup:function(){this.resultData=this.options.resultData},data:function(){return{defaultMessage:this.getLanguage().translate("optInConfirmationExpired","messages","LeadCapture")}}})}),define("views/lead-capture/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","massUpdate","export"]})}),define("views/lead-capture/record/detail",["views/record/detail"],function(e){return e.extend({setupActionItems:function(){e.prototype.setupActionItems.call(this),this.dropdownItemList.push({label:"Generate New API Key",name:"generateNewApiKey"})},actionGenerateNewApiKey:function(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("LeadCapture/action/generateNewApiKey",{id:this.model.id}).then(e=>{this.model.set(e)})})}})}),define("views/lead-capture/record/panels/request",["views/record/panels/side"],function(e){return e.extend({fieldList:["exampleRequestUrl","exampleRequestMethod","exampleRequestHeaders","exampleRequestPayload"]})}),define("views/lead-capture/fields/smtp-account",["views/fields/enum"],function(t){return t.extend({dataUrl:"LeadCapture/action/smtpAccountDataList",getAttributeList:function(){return[this.name,"inboundEmailId"]},data:function(){var e=t.prototype.data.call(this);return e.valueIsSet=!0,e.isNotEmpty=!0,e},setupOptions:function(){var e;t.prototype.setupOptions.call(this),this.params.options=[],this.translatedOptions={},this.params.options.push("system"),this.loadedOptionList?this.loadedOptionList.forEach(e=>{this.params.options.push(e),this.translatedOptions[e]=(this.loadedOptionTranslations[e]||e)+" ("+this.translate("group","labels","MassEmail")+")"}):this.model.get("inboundEmailId")&&(e="inboundEmail:"+this.model.get("inboundEmailId"),this.params.options.push(e),this.translatedOptions[e]=(this.model.get("inboundEmailName")||this.model.get("inboundEmailId"))+" ("+this.translate("group","labels","MassEmail")+")"),this.translatedOptions.system=this.getConfig().get("outboundEmailFromAddress")+" ("+this.translate("system","labels","MassEmail")+")"},getValueForDisplay:function(){return!this.model.has(this.name)&&this.isReadMode()?this.model.has("inboundEmailId")?this.model.get("inboundEmailId")?"inboundEmail:"+this.model.get("inboundEmailId"):"system":"...":this.model.get(this.name)},setup:function(){t.prototype.setup.call(this),(this.getAcl().checkScope("MassEmail","create")||this.getAcl().checkScope("MassEmail","edit"))&&Espo.Ajax.getRequest(this.dataUrl).then(e=>{e.length&&(this.loadedOptionList=[],this.loadedOptionTranslations={},this.loadedOptionAddresses={},this.loadedOptionFromNames={},e.forEach(e=>{this.loadedOptionList.push(e.key),this.loadedOptionTranslations[e.key]=e.emailAddress,this.loadedOptionAddresses[e.key]=e.emailAddress,this.loadedOptionFromNames[e.key]=e.fromName||""}),this.setupOptions(),this.reRender())})},fetch:function(){var e={},t=this.$element.val();return(e[this.name]=t)&&"system"!==t?1<(t=t.split(":")).length&&(e.inboundEmailId=t[1],e.inboundEmailName=this.translatedOptions[e.inboundEmailId]||e.inboundEmailId):(e.inboundEmailId=null,e.inboundEmailName=null),e}})}),define("views/lead-capture/fields/phone-number-country",["exports","views/fields/enum","intl-tel-input-globals"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{setupOptions(){this.params.options=["",...i.default.getCountryData().map(e=>e.iso2)],this.translatedOptions=i.default.getCountryData().reduce((e,t)=>(e[t.iso2]=t.iso2.toUpperCase()+" +"+t.dialCode,e),{})}}e.default=s}),define("views/lead-capture/fields/field-list",["views/fields/multi-enum"],function(e){return e.extend({setupOptions:function(){this.params.options=[],this.translatedOptions={};var e,t=this.getMetadata().get(["entityDefs","Lead","fields"])||{},i=this.getMetadata().get(["entityDefs","LeadCapture","fields","fieldList","ignoreFieldList"])||[];for(e in t){var a=t[e];a.disabled||a.readOnly||~i.indexOf(e)||(this.params.options.push(e),this.translatedOptions[e]=this.translate(e,"fields","Lead"))}}})}),define("views/lead-capture/fields/api-key",["views/fields/varchar"],function(e){return e.extend({})}),define("views/layout-set/layouts",["exports","views/admin/layouts/index"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){let t=this.setId=this.options.layoutSetId;this.baseUrl="#LayoutSet/editLayouts/id="+t,super.setup(),this.wait(this.getModelFactory().create("LayoutSet").then(e=>((this.sModel=e).id=t,e.fetch())))}getLayoutScopeDataList(){let e=[],s=this.sModel.get("layoutList")||[],t=[];return s.forEach(e=>{e=e.split(".")[0];~t.indexOf(e)||t.push(e)}),t.forEach(t=>{let i={},a=(i.scope=t,i.url=this.baseUrl+"&scope="+t,i.typeDataList=[],[]);s.forEach(e=>{var[e,t]=e.split(".");e===i.scope&&a.push(t)}),a.forEach(e=>{i.typeDataList.push({type:e,url:this.baseUrl+"&scope="+t+"&type="+e,label:this.translateLayoutName(e,t)})}),i.typeList=a,e.push(i)}),e}getHeaderHtml(){var e=' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ';return $("<span>").append($("<a>").attr("href","#LayoutSet").text(this.translate("LayoutSet","scopeNamesPlural")),e,$("<a>").attr("href","#LayoutSet/view/"+this.sModel.id).text(this.sModel.get("name")),e,$("<span>").text(this.translate("Edit Layouts","labels","LayoutSet"))).get(0).outerHTML}navigate(e,t){e="#LayoutSet/editLayouts/id="+this.setId+"&scope="+e+"&type="+t;this.getRouter().navigate(e,{trigger:!1})}}e.default=a}),define("views/layout-set/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","export"]})}),define("views/layout-set/fields/layout-list",["views/fields/multi-enum","views/admin/layouts/index"],function(e,i){return e.extend({typeList:["list","detail","listSmall","detailSmall","bottomPanelsDetail","filters","massUpdate","sidePanelsDetail","sidePanelsEdit","sidePanelsDetailSmall","sidePanelsEditSmall"],setupOptions:function(){this.params.options=[],this.translatedOptions={},this.scopeList=Object.keys(this.getMetadata().get("scopes")).filter(e=>this.getMetadata().get(["scopes",e,"layouts"])).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames")));let e=i.prototype.getLayoutScopeDataList.call(this);e.forEach(i=>{i.typeList.forEach(e=>{var t=i.scope+"."+e;"Portal"!==e.substr(-6)&&(this.params.options.push(t),this.translatedOptions[t]=this.translate(i.scope,"scopeNames")+"."+this.translate(e,"layouts","Admin"))})})},translateLayoutName:function(e,t){return i.prototype.translateLayoutName.call(this,e,t)}})}),define("views/layout-set/fields/edit",["views/fields/base"],function(e){return e.extend({detailTemplateContent:'<a class="btn btn-default" href="#LayoutSet/editLayouts/id={{model.id}}">'+"{{translate 'Edit Layouts' scope='LayoutSet'}}</a>",editTemplateContent:""})}),define("views/inbound-email/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove","massUpdate"],checkAllResultDisabled:!0})}),define("views/inbound-email/record/edit",["views/record/edit","views/inbound-email/record/detail"],function(e,t){return e.extend({setup:function(){e.prototype.setup.call(this),t.prototype.setupFieldsBehaviour.call(this),t.prototype.initSslFieldListening.call(this),t.prototype.wasFetched.call(this)&&this.setFieldReadOnly("fetchSince")},modifyDetailLayout:function(e){t.prototype.modifyDetailLayout.call(this,e)},controlStatusField:function(){t.prototype.controlStatusField.call(this)},initSmtpFieldsControl:function(){t.prototype.initSmtpFieldsControl.call(this)},controlSmtpFields:function(){t.prototype.controlSmtpFields.call(this)},controlSentFolderField:function(){t.prototype.controlSentFolderField.call(this)},controlSmtpAuthField:function(){t.prototype.controlSmtpAuthField.call(this)},wasFetched:function(){t.prototype.wasFetched.call(this)}})}),define("views/inbound-email/fields/test-send",["views/email-account/fields/test-send"],function(e){return e.extend({getSmtpData:function(){return{server:this.model.get("smtpHost"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,authMechanism:this.model.get("smtpAuthMechanism"),fromName:this.model.get("fromName"),fromAddress:this.model.get("emailAddress"),type:"inboundEmail",id:this.model.id}}})}),define("views/inbound-email/fields/test-connection",["views/email-account/fields/test-connection"],function(e){return e.extend({url:"InboundEmail/action/testConnection"})}),define("views/inbound-email/fields/target-user-position",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.translatedOptions={"":"--"+this.translate("All")+"--"},this.params.options=[""],this.model.get("targetUserPosition")&&this.model.get("teamId")&&this.params.options.push(this.model.get("targetUserPosition")),this.loadRoleList(()=>{"edit"===this.mode&&this.isRendered()&&this.render()}),this.listenTo(this.model,"change:teamId",()=>{this.loadRoleList(()=>{this.render()})})},loadRoleList:function(t,i){var a=this.model.get("teamId");a||(this.params.options=[""]),this.getModelFactory().create("Team",e=>{e.id=a,this.listenToOnce(e,"sync",()=>{this.params.options=e.get("positionList")||[],this.params.options.unshift(""),t.call(i)}),e.fetch()})}})}),define("views/inbound-email/fields/folders",["views/email-account/fields/folders"],function(e){return e.extend({getFoldersUrl:"InboundEmail/action/getFolders"})}),define("views/inbound-email/fields/folder",["views/email-account/fields/folder"],function(e){return e.extend({getFoldersUrl:"InboundEmail/action/getFolders"})}),define("views/inbound-email/fields/email-address",["views/fields/email-address"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.on("change",()=>{var e=this.model.get("emailAddress");this.model.set("name",e),!this.model.isNew()&&this.model.get("replyToAddress")||this.model.set("replyToAddress",e)})}})}),define("views/authentication-provider/record/edit",["views/record/edit","helpers/misc/authentication-provider"],function(e,t){return e.extend({saveAndNewAction:!1,helper:null,setup:function(){this.helper=new t(this),e.prototype.setup.call(this)},setupBeforeFinal:function(){this.dynamicLogicDefs=this.helper.setupMethods(),e.prototype.setupBeforeFinal.call(this),this.helper.setupPanelsVisibility(()=>{this.processDynamicLogic()})},modifyDetailLayout:function(e){this.helper.modifyDetailLayout(e)}})}),define("views/authentication-provider/record/detail",["views/record/detail","helpers/misc/authentication-provider"],function(e,t){return e.extend({editModeDisabled:!0,helper:null,setup:function(){this.helper=new t(this),e.prototype.setup.call(this)},setupBeforeFinal:function(){this.dynamicLogicDefs=this.helper.setupMethods(),e.prototype.setupBeforeFinal.call(this),this.helper.setupPanelsVisibility(()=>{this.processDynamicLogic()})},modifyDetailLayout:function(e){this.helper.modifyDetailLayout(e)}})}),define("views/authentication-provider/fields/method",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){let t=this.getMetadata().get(["authenticationMethods"])||{},e=Object.keys(t).filter(e=>{return(t[e].provider||{}).isAvailable});e.unshift(""),this.params.options=e}})}),define("views/admin/user-interface",["views/settings/record/edit"],function(e){return e.extend({layoutName:"userInterface",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.controlColorsField(),this.listenTo(this.model,"change:scopeColorsDisabled",this.controlColorsField,this),this.on("save",e=>{this.model.get("theme")===e.theme&&(this.model.get("themeParams").navbar||{})===e.themeParams.navbar||(this.setConfirmLeaveOut(!1),window.location.reload())})},controlColorsField:function(){this.model.get("scopeColorsDisabled")?this.hideField("tabColorsDisabled"):this.showField("tabColorsDisabled")}})}),define("views/admin/sms",["views/settings/record/edit"],function(e){return e.extend({layoutName:"sms"})}),define("views/admin/settings",["views/settings/record/edit"],function(e){return e.extend({layoutName:"settings",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.hideField("cronDisabled"),this.hideField("maintenanceMode"),this.setFieldReadOnly("useWebSocket"),this.setFieldReadOnly("siteUrl"))}})}),define("views/admin/outbound-emails",["views/settings/record/edit"],function(e){return e.extend({layoutName:"outboundEmails",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{smtpUsername:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]},required:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]}},smtpPassword:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]}},smtpPort:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]},required:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}},smtpSecurity:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}},smtpAuth:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}}}},setup:function(){e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this);var t=this.getFieldView("smtpSecurity");this.listenTo(t,"change",function(){var e=t.fetch().smtpSecurity;"SSL"==e?this.model.set("smtpPort","465"):"TLS"==e?this.model.set("smtpPort","587"):this.model.set("smtpPort","25")}.bind(this))}})}),define("views/admin/notifications",["views/settings/record/edit"],function(e){return e.extend({layoutName:"notifications",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{assignmentEmailNotificationsEntityList:{visible:{conditionGroup:[{type:"isTrue",attribute:"assignmentEmailNotifications"}]}},adminNotificationsNewVersion:{visible:{conditionGroup:[{type:"isTrue",attribute:"adminNotifications"}]}},adminNotificationsNewExtensionVersion:{visible:{conditionGroup:[{type:"isTrue",attribute:"adminNotifications"}]}}}},setup:function(){e.prototype.setup.call(this),this.controlStreamEmailNotificationsEntityList(),this.listenTo(this.model,"change",function(e){(e.hasChanged("streamEmailNotifications")||e.hasChanged("portalStreamEmailNotifications"))&&this.controlStreamEmailNotificationsEntityList()},this)},controlStreamEmailNotificationsEntityList:function(){this.model.get("streamEmailNotifications")||this.model.get("portalStreamEmailNotifications")?(this.showField("streamEmailNotificationsEntityList"),this.showField("streamEmailNotificationsTypeList")):(this.hideField("streamEmailNotificationsEntityList"),this.hideField("streamEmailNotificationsTypeList"))}})}),define("views/admin/jobs-settings",["views/settings/record/edit"],function(e){return e.extend({layoutName:"jobsSettings",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{jobPoolConcurrencyNumber:{visible:{conditionGroup:[{type:"isTrue",attribute:"jobRunInParallel"}]}}}},setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.setFieldReadOnly("jobRunInParallel"),this.setFieldReadOnly("jobMaxPortion"),this.setFieldReadOnly("jobPoolConcurrencyNumber"),this.setFieldReadOnly("daemonInterval"),this.setFieldReadOnly("daemonMaxProcessNumber"),this.setFieldReadOnly("daemonProcessTimeout"))}})}),define("views/admin/inbound-emails",["views/settings/record/edit"],function(e){return e.extend({layoutName:"inboundEmails",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this)}})}),define("views/admin/currency",["views/settings/record/edit"],function(e){return e.extend({layoutName:"currency",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:currencyList",function(e,t,i){i.ui&&(i=Espo.Utils.clone(e.get("currencyList")),this.setFieldOptionList("defaultCurrency",i),this.setFieldOptionList("baseCurrency",i),this.controlCurrencyRatesVisibility())},this),this.listenTo(this.model,"change",function(e,t){t.ui&&(!e.hasChanged("currencyList")&&!e.hasChanged("baseCurrency")||(t=this.getFieldView("currencyRates"))&&t.reRender())},this),this.controlCurrencyRatesVisibility()},controlCurrencyRatesVisibility:function(){this.model.get("currencyList").length<2?this.hideField("currencyRates"):this.showField("currencyRates")}})}),define("views/admin/authentication",["views/settings/record/edit"],function(i){return i.extend({layoutName:"authentication",saveAndContinueEditingAction:!1,setup:function(){this.methodList=[];var e,t=this.getMetadata().get(["authenticationMethods"])||{};for(e in t)t[e].settings&&t[e].settings.isAvailable&&this.methodList.push(e);this.authFields={},i.prototype.setup.call(this),this.handlePanelsVisibility(),this.listenTo(this.model,"change:authenticationMethod",()=>{this.handlePanelsVisibility()}),this.manage2FAFields(),this.listenTo(this.model,"change:auth2FA",()=>{this.manage2FAFields()}),this.managePasswordRecoveryFields(),this.listenTo(this.model,"change:passwordRecoveryDisabled",()=>{this.managePasswordRecoveryFields()})},setupBeforeFinal:function(){this.dynamicLogicDefs={fields:{},panels:{}},this.methodList.forEach(e=>{var t=this.getMetadata().get(["authenticationMethods",e,"settings","fieldList"]),i=(t&&(this.authFields[e]=t),this.getMetadata().get(["authenticationMethods",e,"settings","dynamicLogic","fields"]));if(i)for(var a in i)this.dynamicLogicDefs.fields[a]=Espo.Utils.cloneDeep(i[a])}),i.prototype.setupBeforeFinal.call(this)},modifyDetailLayout:function(i){this.methodList.forEach(e=>{let t=this.getMetadata().get(["authenticationMethods",e,"settings","layout"]);t&&((t=Espo.Utils.cloneDeep(t)).name=e,this.prepareLayout(t,e),i.push(t))})},prepareLayout:function(e,i){e.rows.forEach(e=>{e.filter(e=>!e.noLabel&&!e.labelText&&e.name).forEach(e=>{let t=this.translate(e.name,"fields","Settings");t&&0===t.toLowerCase().indexOf(i.toLowerCase()+" ")&&(e.labelText=t.substring(i.length+1))})})},handlePanelsVisibility:function(){var i=this.model.get("authenticationMethod");this.methodList.forEach(e=>{var t=this.authFields[e]||[];if(e!==i)return this.hidePanel(e),void t.forEach(e=>{this.hideField(e)});this.showPanel(e),t.forEach(e=>{this.showField(e)}),this.processDynamicLogic()})},manage2FAFields:function(){if(this.model.get("auth2FA"))return this.showField("auth2FAForced"),this.showField("auth2FAMethodList"),this.showField("auth2FAInPortal"),void this.setFieldRequired("auth2FAMethodList");this.hideField("auth2FAForced"),this.hideField("auth2FAMethodList"),this.hideField("auth2FAInPortal"),this.setFieldNotRequired("auth2FAMethodList")},managePasswordRecoveryFields:function(){if(!this.model.get("passwordRecoveryDisabled"))return this.showField("passwordRecoveryForAdminDisabled"),this.showField("passwordRecoveryForInternalUsersDisabled"),void this.showField("passwordRecoveryNoExposure");this.hideField("passwordRecoveryForAdminDisabled"),this.hideField("passwordRecoveryForInternalUsersDisabled"),this.hideField("passwordRecoveryNoExposure")}})}),define("views/admin/upgrade/ready",["views/modal"],function(e){return e.extend({cssName:"ready-modal",header:!1,template:"admin/upgrade/ready",createButton:!0,data:function(){return{version:this.upgradeData.version,text:this.translate("upgradeVersion","messages","Admin").replace("{version}",this.upgradeData.version)}},setup:function(){this.buttonList=[{name:"run",label:this.translate("Run Upgrade","labels","Admin"),style:"danger"},{name:"cancel",label:"Cancel"}],this.upgradeData=this.options.upgradeData,this.header=this.getLanguage().translate("Ready for upgrade","labels","Admin")},actionRun:function(){this.trigger("run"),this.remove()}})}),define("views/admin/upgrade/index",["view"],function(e){return e.extend({template:"admin/upgrade/index",packageContents:null,data:function(){return{versionMsg:this.translate("Current version")+": "+this.getConfig().get("version"),infoMsg:this.translate("upgradeInfo","messages","Admin").replace("{url}","https:
            <div class="panel panel-default no-side-margin">
                <div class="panel-body">
                    <div class="edit-container">{{{edit}}}</div>
                </div>
            </div>
        `,className:"dialog dialog-record",shortcutKeys:{"Control+Enter":function(e){this.actionSave(),e.preventDefault(),e.stopPropagation()}},setup:function(){this.buttonList=[{name:"save",text:this.translate("Apply"),style:"primary"},{name:"cancel",text:"Cancel"}];let e=new a;e.name="LayoutManager",e.set(this.options.attributes||{});var t=this.options.attributeList,i=this.options.attributeDefs;this.createView("edit","views/admin/layouts/record/edit-attributes",{selector:".edit-container",attributeList:t,attributeDefs:i,model:e,dynamicLogicDefs:this.options.dynamicLogicDefs})},actionSave:function(){let e=this.getView("edit");var t=e.fetch();if(e.model.set(t,{silent:!0}),!e.validate())return t=e.model.attributes,this.trigger("after:save",t),!0}})}),define("views/admin/layouts/modals/edit-attributes",["views/modal","model"],function(e,a){return e.extend({templateContent:`
            <div class="panel panel-default no-side-margin">
                <div class="panel-body">
                    <div class="edit-container">{{{edit}}}</div>
                </div>
            </div>
        `,className:"dialog dialog-record",shortcutKeys:{"Control+Enter":function(e){this.actionSave(),e.preventDefault(),e.stopPropagation()}},setup:function(){this.buttonList=[{name:"save",text:this.translate("Apply"),style:"primary"},{name:"cancel",text:this.translate("Cancel")}];const e=new a;e.name="LayoutManager",e.set(this.options.attributes||{}),this.headerText=null,this.options.languageCategory&&(this.headerText=this.translate(this.options.name,this.options.languageCategory,this.options.scope));let t=Espo.Utils.clone(this.options.attributeList||[]);const i=[];t.forEach(e=>{var t=this.options.attributeDefs[e]||{};t.readOnly||t.hidden||i.push(e)}),t=i,this.createView("edit","views/admin/layouts/record/edit-attributes",{selector:".edit-container",attributeList:t,attributeDefs:this.options.attributeDefs,dynamicLogicDefs:this.options.dynamicLogicDefs,model:e})},actionSave:function(){const e=this.getView("edit");var t=e.fetch();if(e.model.set(t,{silent:!0}),!e.validate())return t=e.model.attributes,this.trigger("after:save",t),!0}})}),define("views/admin/layouts/fields/width-complex",["exports","views/fields/base","views/fields/enum","model","views/fields/float"],function(e,t,i,a,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),a=n(a),s=n(s);class o extends t.default{editTemplateContent=`
        <div class="row">
            <div data-name="value" class="col-sm-6">{{{value}}}</div>
            <div data-name="unit" class="col-sm-6">{{{unit}}}</div>
        </div>

    `;getAttributeList(){return["width","widthPx"]}setup(){this.auxModel=new a.default,this.syncAuxModel(),this.listenTo(this.model,"change",()=>this.syncAuxModel());var e=new i.default({name:"unit",mode:"edit",model:this.auxModel,params:{options:["%","px"]}}),t=new s.default({name:"value",mode:"edit",model:this.auxModel});this.assignView("unit",e,'[data-name="unit"]'),this.assignView("value",t,'[data-name="value"]'),this.listenTo(this.auxModel,"change",(e,t)=>{t.ui&&this.model.set(this.fetch(),{ui:!0})})}fetch(){return"px"===this.auxModel.get("unit")?{width:null,widthPx:this.auxModel.get("value")}:{width:this.auxModel.get("value"),widthPx:null}}syncAuxModel(){var e=this.model.get("width"),t=this.model.get("widthPx"),i=e||!t?"%":"px";this.auxModel.set({unit:i,value:"px"==i?t:e})}}e.default=o}),define("views/admin/label-manager/index",["exports","view","ui/select"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{template="admin/label-manager/index";scopeList=null;scope=null;language=null;languageList=null;events={'click [data-action="selectScope"]':function(e){let t=$(e.currentTarget).data("name");this.getRouter().checkConfirmLeaveOut(()=>{this.selectScope(t)})},'change select[data-name="language"]':function(e){let t=$(e.currentTarget).val();this.getRouter().checkConfirmLeaveOut(()=>{this.selectLanguage(t)})}};data(){return{scopeList:this.scopeList,languageList:this.languageList,scope:this.scope,language:this.language}}setup(){this.languageList=this.getMetadata().get(["app","language","list"])||["en_US"],this.languageList.sort((e,t)=>this.getLanguage().translateOption(e,"language").localeCompare(this.getLanguage().translateOption(t,"language"))),this.wait(!0),Espo.Ajax.postRequest("LabelManager/action/getScopeList").then(e=>{this.scopeList=e,this.scopeList.sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),this.scopeList=this.scopeList.filter(e=>{if(!("Global"===e||this.getMetadata().get(["scopes",e])&&this.getMetadata().get(["scopes",e,"disabled"])))return!0}),this.scopeList.unshift("Global"),this.wait(!1)}),this.scope=this.options.scope||"Global",this.language=this.options.language||this.getConfig().get("language"),this.once("after:render",()=>{this.selectScope(this.scope,!0)})}afterRender(){i.default.init(this.element.querySelector('select[data-name="language"]'))}selectLanguage(e){this.language=e,this.scope?this.getRouter().navigate("#Admin/labelManager/scope="+this.scope+"&language="+this.language,{trigger:!1}):this.getRouter().navigate("#Admin/labelManager/language="+this.language,{trigger:!1}),this.createRecordView()}selectScope(e,t){this.scope=e,t||this.getRouter().navigate("#Admin/labelManager/scope="+e+"&language="+this.language,{trigger:!1}),this.$el.find('[data-action="selectScope"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('[data-name="'+e+'"][data-action="selectScope"]').addClass("disabled").attr("disabled","disabled"),this.createRecordView()}createRecordView(){Espo.Ui.notify(" ... "),this.createView("record","views/admin/label-manager/edit",{selector:".language-record",scope:this.scope,language:this.language},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Label Manager","labels","Admin"))}}e.default=s}),define("views/admin/label-manager/edit",["view"],function(e){return e.extend({template:"admin/label-manager/edit",data:function(){return{categoryList:this.getCategoryList(),scope:this.scope}},events:{'click [data-action="showCategory"]':function(e){e=$(e.currentTarget).data("name");this.showCategory(e)},'click [data-action="hideCategory"]':function(e){e=$(e.currentTarget).data("name");this.hideCategory(e)},'click [data-action="cancel"]':function(e){this.actionCancel()},'click [data-action="save"]':function(e){this.actionSave()},"change input.label-value":function(e){var t=$(e.currentTarget).data("name"),e=$(e.currentTarget).val();this.setLabelValue(t,e)}},setup:function(){this.scope=this.options.scope,this.language=this.options.language,this.dirtyLabelList=[],this.wait(!0),Espo.Ajax.postRequest("LabelManager/action/getScopeData",{scope:this.scope,language:this.language}).then(e=>{this.scopeData=e,this.scopeDataInitial=Espo.Utils.cloneDeep(this.scopeData),this.wait(!1)})},getCategoryList:function(){return Object.keys(this.scopeData).sort((e,t)=>e.localeCompare(t))},setLabelValue:function(e,t){var i=e.split("[.]")[0];t=(t=t.replace(/\\\\n/i,"\n")).trim(),this.scopeData[i][e]=t,this.dirtyLabelList.push(e),this.setConfirmLeaveOut(!0),this.hasView(i)&&(this.getView(i).categoryData[e]=t)},setConfirmLeaveOut:function(e){this.getRouter().confirmLeaveOut=e},afterRender:function(){this.$save=this.$el.find('button[data-action="save"]'),this.$cancel=this.$el.find('button[data-action="cancel"]')},actionSave:function(){this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled");var i={};this.dirtyLabelList.forEach(e=>{var t=e.split("[.]")[0],t=this.scopeData[t][e];i[e]=t}),Espo.Ui.notify(this.translate("saving","messages")),Espo.Ajax.postRequest("LabelManager/action/saveLabels",{scope:this.scope,language:this.language,labels:i}).then(e=>{for(var t in this.scopeDataInitial=Espo.Utils.cloneDeep(this.scopeData),this.dirtyLabelList=[],this.setConfirmLeaveOut(!1),this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),e){var i=t.split("[.]").splice(1).join("[.]");this.$el.find('input.label-value[data-name="'+i+'"]').val(e[t])}Espo.Ui.success(this.translate("Saved")),this.getHelper().broadcastChannel.postMessage("update:language"),this.getLanguage().loadSkipCache()}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled")})},actionCancel:function(){this.scopeData=Espo.Utils.cloneDeep(this.scopeDataInitial),this.dirtyLabelList=[],this.setConfirmLeaveOut(!1),this.getCategoryList().forEach(e=>{this.hasView(e)&&(this.getView(e).categoryData=this.scopeData[e],this.getView(e).reRender())})},showCategory:function(t){if(this.$el.find('a[data-action="showCategory"][data-name="'+t+'"]').addClass("hidden"),this.hasView(t))return this.$el.find('a[data-action="hideCategory"][data-name="'+t+'"]').removeClass("hidden"),void this.$el.find('.panel-body[data-name="'+t+'"]').removeClass("hidden");this.createView(t,"views/admin/label-manager/category",{selector:'.panel-body[data-name="'+t+'"]',categoryData:this.getCategoryData(t),scope:this.scope,language:this.language},e=>{this.$el.find('.panel-body[data-name="'+t+'"]').removeClass("hidden"),this.$el.find('a[data-action="hideCategory"][data-name="'+t+'"]').removeClass("hidden"),e.render()})},hideCategory:function(e){this.clearView(e),this.$el.find('.panel-body[data-name="'+e+'"]').addClass("hidden"),this.$el.find('a[data-action="showCategory"][data-name="'+e+'"]').removeClass("hidden"),this.$el.find('a[data-action="hideCategory"][data-name="'+e+'"]').addClass("hidden")},getCategoryData:function(e){return this.scopeData[e]||{}}})}),define("views/admin/label-manager/category",["view"],function(e){return e.extend({template:"admin/label-manager/category",data:function(){return{categoryDataList:this.getCategoryDataList()}},events:{},setup:function(){this.scope=this.options.scope,this.language=this.options.language,this.categoryData=this.options.categoryData},getCategoryDataList:function(){var e=Object.keys(this.categoryData),i=(e.sort((e,t)=>e.localeCompare(t)),[]);return e.forEach(e=>{var t=this.categoryData[e],t={name:e,value:t=(t=null===t?"":t).replace?t.replace(/\n/i,"\\n"):t},e=e.split("[.]");t.label=e.slice(1).join(" . "),i.push(t)}),i}})}),define("views/admin/job/list",["views/list"],function(e){return e.extend({createButton:!1,setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()||this.addMenuItem("buttons",{link:"#Admin/jobsSettings",text:this.translate("Settings","labels","Admin")})},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration")),$("<span>").text(this.getLanguage().translate("Jobs","labels","Admin"))])},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Jobs","labels","Admin"))}})}),define("views/admin/job/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"],rowActionsColumnWidth:"5%"})}),define("views/admin/job/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideView:null,isWide:!0})}),define("views/admin/job/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,fullFormDisabled:!0})}),define("views/admin/job/fields/name",["views/fields/varchar"],function(e){return e.extend({getValueForDisplay:function(){if("list"===this.mode||"detail"===this.mode||"listLink"===this.mode)return this.model.get("name")?this.model.get("name"):this.model.get("serviceName")+": "+this.model.get("methodName")}})}),define("views/admin/integrations/oauth2",["views/admin/integrations/edit"],function(t){return t.extend({template:"admin/integrations/oauth2",data:function(){var e=this.redirectUri||this.getConfig().get("siteUrl")+"?entryPoint=oauthCallback";return _.extend({redirectUri:e},t.prototype.data.call(this))}})}),define("views/admin/integrations/index",["view"],function(e){return e.extend({template:"admin/integrations/index",integrationList:null,integration:null,data:function(){return{integrationList:this.integrationList,integration:this.integration}},events:{"click #integrations-menu a.integration-link":function(e){e=$(e.currentTarget).data("name");this.openIntegration(e)}},setup:function(){this.integrationList=Object.keys(this.getMetadata().get("integrations")||{}).sort((e,t)=>this.translate(e,"titles","Integration").localeCompare(this.translate(t,"titles","Integration"))),this.integration=this.options.integration||null,this.on("after:render",()=>{this.renderHeader(),this.integration?this.openIntegration(this.integration):this.renderDefaultPage()})},openIntegration:function(e){this.integration=e,this.getRouter().navigate("#Admin/integrations/name="+e,{trigger:!1});var t=this.getMetadata().get("integrations."+e+".view")||"views/admin/integrations/"+Espo.Utils.camelCaseToHyphen(this.getMetadata().get("integrations."+e+".authMethod"));Espo.Ui.notify(" ... "),this.createView("content",t,{fullSelector:"#integration-content",integration:e},e=>{this.renderHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},renderDefaultPage:function(){$("#integration-header").html("").hide();let e;e=this.integrationList.length?this.translate("selectIntegration","messages","Integration"):'<p class="lead">'+this.translate("noIntegrations","messages","Integration")+"</p>",$("#integration-content").html(e)},renderHeader:function(){this.integration?$("#integration-header").show().html(this.translate(this.integration,"titles","Integration")):$("#integration-header").html("")},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Integrations","labels","Admin"))}})}),define("views/admin/integrations/google-maps",["views/admin/integrations/edit"],function(e){return e.extend({})}),define("views/admin/formula-sandbox/index",["view","model"],function(e,s){return e.extend({template:"admin/formula-sandbox/index",targetEntityType:null,storageKey:"formulaSandbox",data:function(){return{}},setup:function(){var e,t=[""].concat(this.getMetadata().getScopeEntityList().filter(e=>this.getMetadata().get(["scopes",e,"object"])));let i={script:null,targetId:null,targetType:null,output:null},a=(this.getSessionStorage().has(this.storageKey)&&(e=this.getSessionStorage().get(this.storageKey),i.script=e.script||null,i.targetId=e.targetId||null,i.targetName=e.targetName||null,i.targetType=e.targetType||null),this.model=new s);a.name="Formula",a.setDefs({fields:{targetType:{type:"enum",options:t,translation:"Global.scopeNames",view:"views/fields/entity-type"},target:{type:"link",entity:i.targetType},script:{type:"formula",view:"views/fields/formula"},output:{type:"text",readOnly:!0,displayRawText:!0,tooltip:!0},errorMessage:{type:"text",readOnly:!0,displayRawText:!0}}}),a.set(i),this.createRecordView(),this.listenTo(this.model,"change:targetType",(e,t,i)=>{i.ui&&setTimeout(()=>{this.targetEntityType=this.model.get("targetType"),this.model.set({targetId:null,targetName:null},{silent:!0});var e=Espo.Utils.cloneDeep(this.model.attributes);this.clearView("record"),this.model.set(e,{silent:!0}),this.model.defs.fields.target.entity=this.targetEntityType,this.createRecordView().then(e=>e.render())},10)}),this.listenTo(this.model,"run",()=>this.run()),this.listenTo(this.model,"change",(e,t)=>{t.ui&&(t={script:this.model.get("script"),targetType:this.model.get("targetType"),targetId:this.model.get("targetId"),targetName:this.model.get("targetName")},this.getSessionStorage().set(this.storageKey,t))})},createRecordView:function(){return this.createView("record","views/admin/formula-sandbox/record/edit",{selector:".record",model:this.model,targetEntityType:this.targetEntityType,confirmLeaveDisabled:!0,shortcutKeysEnabled:!0})},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Formula Sandbox","labels","Admin"))},run:function(){var e=this.model.get("script");if(this.model.set({output:null,errorMessage:null}),""===e||null===e)return this.model.set("output",null),void Espo.Ui.warning(this.translate("emptyScript","messages","Formula"));Espo.Ajax.postRequest("Formula/action/run",{expression:e,targetId:this.model.get("targetId"),targetType:this.model.get("targetType")}).then(t=>{this.model.set("output",t.output||null);let e=null;if(t.isSuccess||(e=t.message||null),this.model.set("errorMessage",e),t.isSuccess)Espo.Ui.success(this.translate("runSuccess","messages","Formula"));else{if(t.isSyntaxError){let e=this.translate("checkSyntaxError","messages","Formula");return t.message&&(e+=" "+t.message),void Espo.Ui.error(e)}let e=this.translate("runError","messages","Formula");t.message&&(e+=" "+t.message),Espo.Ui.error(e)}})}})}),define("views/admin/formula-sandbox/record/edit",["views/record/edit"],function(e){return e.extend({scriptAreaHeight:400,bottomView:null,sideView:null,buttonList:[{name:"run",label:"Run",style:"danger",title:"Ctrl+Enter"}],dropdownItemList:[],isWide:!0,accessControlDisabled:!0,saveAndContinueEditingAction:!1,saveAndNewAction:!1,shortcutKeyCtrlEnterAction:"run",setup:function(){this.scope="Formula";this.detailLayout=[{rows:[[!1,{name:"targetType",labelText:this.translate("targetType","fields","Formula")},{name:"target",labelText:this.translate("target","fields","Formula")}]]},{rows:[[{name:"script",noLabel:!0,options:{targetEntityType:this.model.get("targetType"),height:this.scriptAreaHeight,additionalFunctionDataList:[{name:"output\\print",insertText:"output\\print(VALUE)"},{name:"output\\printLine",insertText:"output\\printLine(VALUE)"}]}}]]},{name:"output",rows:[[{name:"errorMessage",labelText:this.translate("error","fields","Formula")}],[{name:"output",labelText:this.translate("output","fields","Formula")}]]}],e.prototype.setup.call(this),this.model.get("targetType")?this.showField("target"):this.hideField("target"),this.controlTargetTypeField(),this.listenTo(this.model,"change:targetId",()=>this.controlTargetTypeField()),this.controlOutputField(),this.listenTo(this.model,"change",()=>this.controlOutputField())},controlTargetTypeField:function(){this.model.get("targetId")?this.setFieldReadOnly("targetType"):this.setFieldNotReadOnly("targetType")},controlOutputField:function(){this.model.get("errorMessage")?this.showField("errorMessage"):this.hideField("errorMessage")},actionRun:function(){this.model.trigger("run")}})}),define("views/admin/formula/modals/add-function",["views/modal","model"],function(e,t){return e.extend({template:"admin/formula/modals/add-function",fitHeight:!0,backdrop:!0,events:{'click [data-action="add"]':function(e){this.trigger("add",$(e.currentTarget).data("value"))}},data:function(){var e=this.translate("formulaFunctions","messages","Admin").replace("{documentationUrl}",this.documentationUrl),e=this.getHelper().transformMarkdownText(e,{linksInNewTab:!0}).toString();return{functionDataList:this.functionDataList,text:e}},setup:function(){this.header=this.translate("Function"),this.documentationUrl="https:
            <div class="panel no-side-margin">
                <table class="table table-bordered">
                    {{#each typeList}}
                    <tr>
                        <td style="width: 40%">
                            <a
                                class="btn btn-default btn-lg btn-full-wide"
                                href="#Admin/entityManager/formula&scope={{../scope}}&type={{this}}"
                            >
                            {{translate this category='fields' scope='EntityManager'}}
                            </a>
                        </td>
                        <td style="width: 60%">
                            <div class="complex-text">{{complexText (translate this category='messages' scope='EntityManager')}}
                        </td>
                    </tr>
                    {{/each}}
                </table>
            </div>
        `,backdrop:!0,data:function(){return{typeList:this.typeList,scope:this.scope}},setup:function(){this.scope=this.options.scope,this.typeList=["beforeSaveCustomScript","beforeSaveApiScript"],this.headerText=this.translate("Formula","labels","EntityManager")}})}),define("views/admin/entity-manager/fields/icon-class",["views/fields/base"],function(e){return e.extend({editTemplate:"admin/entity-manager/fields/icon-class/edit",setup:function(){e.prototype.setup.call(this),this.events['click [data-action="selectIcon"]']=function(){this.selectIcon()}},selectIcon:function(){this.createView("dialog","views/admin/entity-manager/modals/select-icon",{},t=>{t.render(),this.listenToOnce(t,"select",e=>{this.model.set(this.name,e=""===e?null:e),t.close()})})},fetch:function(){let e={};return e[this.name]=this.model.get(this.name),e}})}),define("views/admin/entity-manager/fields/duplicate-check-field-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{fieldTypeList=["varchar","personName","email","phone","url","barcode"];setupOptions(){let t=this.model.get("name"),e=this.getFieldManager().getEntityTypeFieldList(t,{typeList:this.fieldTypeList,onlyAvailable:!0}).sort((e,t)=>this.getLanguage().translate(e,"fields",this.entityType).localeCompare(this.getLanguage().translate(t,"fields",this.entityType)));this.translatedOptions={},e.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",t)}),this.params.options=e}}e.default=a}),define("views/admin/dynamic-logic/modals/edit",["views/modal"],function(e){return e.extend({template:"admin/dynamic-logic/modals/edit",className:"dialog dialog-record",data:function(){return{}},events:{},buttonList:[{name:"apply",label:"Apply",style:"primary"},{name:"cancel",label:"Cancel"}],setup:function(){this.conditionGroup=Espo.Utils.cloneDeep(this.options.conditionGroup||[]),this.scope=this.options.scope,this.createView("conditionGroup","views/admin/dynamic-logic/conditions/and",{selector:".top-group-container",itemData:{value:this.conditionGroup},scope:this.options.scope})},actionApply:function(){var e=this.getView("conditionGroup").fetch().value;this.trigger("apply",e),this.close()}})}),define("views/admin/dynamic-logic/modals/add-field",["views/modal","model"],function(e,i){return e.extend({templateContent:'<div class="field" data-name="field">{{{field}}}</div>',events:{'click a[data-action="addField"]':function(e){this.trigger("add-field",$(e.currentTarget).data().name)}},setup:function(){this.header=this.translate("Add Field"),this.scope=this.options.scope;const t=new i;this.createView("field","views/admin/dynamic-logic/fields/field",{selector:'[data-name="field"]',model:t,mode:"edit",scope:this.scope,defs:{name:"field",params:{}}},e=>{this.listenTo(e,"change",()=>{var e=t.get("field")||[];e.length&&this.trigger("add-field",e[0])})})}})}),define("views/admin/dynamic-logic/fields/user-id",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{detailTemplateContent=`
        <a href="#User/view/{{id}}">{{name}}</a>
    `;data(){return{id:this.model.get("$user.id"),name:this.model.get("name")}}}e.default=a}),define("views/admin/dynamic-logic/fields/field",["views/fields/multi-enum","ui/multi-select"],function(e,t){return e.extend({getFieldList:function(){let i=this.getMetadata().get("entityDefs."+this.options.scope+".fields"),e=Object.keys(i).filter(e=>{var t=i[e].type||null;if(!i[e].disabled&&!i[e].utility&&t&&this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t]))return!0});return e.push("id"),e.sort((e,t)=>this.translate(e,"fields",this.options.scope).localeCompare(this.translate(t,"fields",this.options.scope))),e},setupTranslatedOptions:function(){this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",this.options.scope)})},setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.getFieldList(),this.setupTranslatedOptions()},afterRender:function(){e.prototype.afterRender.call(this),this.$element&&t.focus(this.$element)}})}),define("views/admin/dynamic-logic/conditions-string/item-value-varchar",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/varchar",{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]'})}})}),define("views/admin/dynamic-logic/conditions-string/item-value-link",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/link",{model:this.model,name:"link",selector:'[data-view-key="'+e+'"]',foreignScope:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"entity"])||this.getMetadata().get(["entityDefs",this.scope,"links",this.field,"entity"])})}})}),define("views/admin/dynamic-logic/conditions-string/item-value-enum",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/enum",{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]',params:{options:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"options"])||[]}})}})}),define("views/admin/dynamic-logic/conditions-string/item-multiple-values-base",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-multiple-values-base",data:function(){return{valueViewDataList:this.valueViewDataList,scope:this.scope,operator:this.operator,operatorString:this.operatorString,field:this.field}},populateValues:function(){},getValueViewKey:function(e){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+e.toString()},createValueFieldView:function(){var a=this.itemData.value||[],e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base",s=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e);this.valueViewDataList=[],a.forEach(function(e,t){var i=this.model.clone(),e=(i.set(this.itemData.attribute,e),this.getValueViewKey(t));this.valueViewDataList.push({key:e,isEnd:t===a.length-1}),this.createView(e,s,{model:i,name:this.field,selector:'[data-view-key="'+e+'"]'})},this)}})}),define("views/admin/dynamic-logic/conditions-string/item-is-today",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"today"})}),define("views/admin/dynamic-logic/conditions-string/item-in-past",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"past"})}),define("views/admin/dynamic-logic/conditions-string/item-in-future",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"future"})}),define("views/admin/dynamic-logic/conditions-string/group-not",["views/admin/dynamic-logic/conditions-string/group-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/group-not",data:function(){return{viewKey:this.viewKey,operator:this.operator}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.itemData=this.options.itemData||{},this.viewList=[];var e="view-"+this.level.toString()+"-"+this.number.toString()+"-"+0..toString();this.createItemView(0,e,this.itemData.value),this.viewKey=e}})}),define("views/admin/dynamic-logic/conditions/or",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({operator:"or"})}),define("views/admin/dynamic-logic/conditions/not",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/not",operator:"not",data:function(){return{viewKey:this.viewKey,operator:this.operator,hasItem:this.hasView(this.viewKey),level:this.level,groupOperator:this.getGroupOperator()}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.itemData=this.options.itemData||{},this.viewList=[];var e=this.getKey();this.createItemView(0,e,this.itemData.value),this.viewKey=e},removeItem:function(){var e=this.getKey();this.clearView(e),this.controlAddItemVisibility()},getKey:function(){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+0..toString()},getIndexForNewItem:function(){return 0},addItemContainer:function(){},addViewDataListItem:function(){},fetch:function(){const e=this.getView(this.viewKey);if(!e)return{type:"and",value:[]};var t=e.fetch();return{type:this.operator,value:t}},controlAddItemVisibility:function(){this.getView(this.getKey())?this.$el.find(" > .group-bottom").addClass("hidden"):this.$el.find(" > .group-bottom").removeClass("hidden")}})}),define("views/admin/dynamic-logic/conditions/and",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({operator:"and"})}),define("views/admin/dynamic-logic/conditions/field-types/multi-enum",["views/admin/dynamic-logic/conditions/field-types/base"],function(t){return t.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t},getValueViewName:function(){var e=t.prototype.getValueViewName.call(this);return e=~["has","notHas"].indexOf(this.type)?"views/fields/enum":e}})}),define("views/admin/dynamic-logic/conditions/field-types/link",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field+"Id",data:{field:this.field}};return e&&(e.fetchToModel(),t.value=this.model.get(this.field+"Id"),(e={})[this.field+"Name"]=this.model.get(this.field+"Name"),t.data.values=e),t}})}),define("views/admin/dynamic-logic/conditions/field-types/link-parent",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({fetch:function(){var e,t=this.getView("value");return t&&t.fetchToModel(),"equals"===this.type||"notEquals"===this.type?((e={})[this.field+"Id"]=t.model.get(this.field+"Id"),e[this.field+"Name"]=t.model.get(this.field+"Name"),e[this.field+"Type"]=t.model.get(this.field+"Type"),"equals"===this.type?{type:"and",value:[{type:"equals",attribute:this.field+"Id",value:t.model.get(this.field+"Id")},{type:"equals",attribute:this.field+"Type",value:t.model.get(this.field+"Type")}],data:{field:this.field,type:"equals",values:e}}:{type:"or",value:[{type:"notEquals",attribute:this.field+"Id",value:t.model.get(this.field+"Id")},{type:"notEquals",attribute:this.field+"Type",value:t.model.get(this.field+"Type")}],data:{field:this.field,type:"notEquals",values:e}}):{type:this.type,attribute:this.field+"Id",data:{field:this.field}}}})}),define("views/admin/dynamic-logic/conditions/field-types/enum",["views/admin/dynamic-logic/conditions/field-types/base"],function(t){return t.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t},getValueViewName:function(){var e=t.prototype.getValueViewName.call(this);return e=~["in","notIn"].indexOf(this.type)?"views/fields/multi-enum":e}})}),define("views/admin/dynamic-logic/conditions/field-types/date",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({})}),define("views/admin/dynamic-logic/conditions/field-types/current-user",["exports","views/admin/dynamic-logic/conditions/field-types/base","model"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{getValueViewName(){return"views/fields/user"}getValueFieldName(){return"link"}createModel(){const e=new i.default;return e.setDefs({fields:{link:{type:"link",entity:"User"}}}),Promise.resolve(e)}populateValues(){this.itemData.attribute&&this.model.set("linkId",this.itemData.value);var e=(this.additionalData.values||{}).name;this.model.set("linkName",e)}translateLeftString(){return"$"+this.translate("User","scopeNames")}fetch(){const e=this.getView("value");return e.fetchToModel(),{type:this.type,attribute:"$user.id",data:{values:{name:this.model.get("linkName")}},value:this.model.get("linkId")}}}e.default=s}),define("views/admin/dynamic-logic/conditions/field-types/current-user-teams",["exports","views/admin/dynamic-logic/conditions/field-types/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{translateLeftString(){return"$"+this.translate("User","scopeNames")+"."+super.translateLeftString()}fetch(){const e=super.fetch();return e.attribute="$user.teamsIds",e}}e.default=a}),define("views/admin/complex-expression/modals/add-function",["views/modal","model"],function(e,t){return e.extend({template:"admin/formula/modals/add-function",fitHeight:!0,backdrop:!0,events:{'click [data-action="add"]':function(e){this.trigger("add",$(e.currentTarget).data("value"))}},data:function(){var e=this.translate("formulaFunctions","messages","Admin").replace("{documentationUrl}",this.documentationUrl),e=this.getHelper().transformMarkdownText(e,{linksInNewTab:!0}).toString();return{functionDataList:this.functionDataList,text:e}},setup:function(){this.header=this.translate("Function"),this.documentationUrl="https:
            <button
                class="btn btn-default"
                data-action="testConnection"
            >{{translate 'Test Connection' scope='Settings'}}</button>
        `,events:{'click [data-action="testConnection"]':function(){this.testConnection()}},fetch:function(){return{}},getConnectionData:function(){return{host:this.model.get("ldapHost"),port:this.model.get("ldapPort"),useSsl:this.model.get("ldapSecurity"),useStartTls:this.model.get("ldapSecurity"),username:this.model.get("ldapUsername"),password:this.model.get("ldapPassword"),bindRequiresDn:this.model.get("ldapBindRequiresDn"),accountDomainName:this.model.get("ldapAccountDomainName"),accountDomainNameShort:this.model.get("ldapAccountDomainNameShort"),accountCanonicalForm:this.model.get("ldapAccountCanonicalForm")}},testConnection:function(){var e=this.getConnectionData();this.$el.find("button").prop("disabled",!0),this.notify("Connecting",null,null,"Settings"),Espo.Ajax.postRequest("Ldap/action/testConnection",e).then(()=>{this.$el.find("button").prop("disabled",!1),Espo.Ui.success(this.translate("ldapTestConnection","messages","Settings"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=(t=t.replace(/ $/,"")).replace(/,$/,""),this.translate("Error")+" "+e.status);t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,this.$el.find("button").prop("disabled",!1)})}})}),define("views/admin/auth-token/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.menu.buttons=[]},getHeader:function(){return'<a href="#Admin">'+this.translate("Administration")+'</a> <span class="chevron-right"></span> '+this.getLanguage().translate("Auth Tokens","labels","Admin")},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Auth Tokens","labels","Admin"))}})}),define("views/admin/auth-token/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/admin/auth-token/record/row-actions/default",massActionList:["remove","setInactive"],checkAllResultMassActionList:["remove","setInactive"],massActionSetInactive:function(){let e=null;this.allResultIsChecked||(e=this.checkedList);Espo.Ajax.postRequest("MassAction",{action:"update",entityType:this.entityType,params:{ids:e||null,where:e&&0!==e.length?null:this.collection.getWhere(),searchParams:e&&0!==e.length?null:this.collection.data},data:{isActive:!1}}).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done")),e&&e.forEach(e=>{this.checkRecord(e)})})})},actionSetInactive:function(e){!e.id||(e=this.collection.get(e.id))&&(Espo.Ui.notify(this.translate("pleaseWait","messages")),e.save({isActive:!1},{patch:!0}).then(()=>{Espo.Ui.notify(!1)}))}})}),define("views/admin/auth-token/record/detail",["views/record/detail"],function(e){return e.extend({sideDisabled:!0,readOnly:!0})}),define("views/admin/auth-token/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideDisabled:!0,isWide:!0,bottomView:"views/record/detail-bottom"})}),define("views/admin/auth-token/record/row-actions/default",["views/record/row-actions/default"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:isActive",()=>{setTimeout(()=>{this.reRender()},10)})},getActionList:function(){var e=[];return e.push({action:"quickView",label:"View",data:{id:this.model.id}}),this.model.get("isActive")&&e.push({action:"setInactive",label:"Set Inactive",data:{id:this.model.id}}),e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}})}),define("views/admin/auth-token/modals/detail",["views/modals/detail"],function(e){return e.extend({sideDisabled:!0,editDisabled:!0})}),define("views/admin/auth-log-record/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this)},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration")),$("<span>").text(this.getLanguage().translate("Auth Log","labels","Admin"))])},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Auth Log","labels","Admin"))}})}),define("views/admin/auth-log-record/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"],checkAllResultMassActionList:["remove"]})}),define("views/admin/auth-log-record/record/detail",["views/record/detail"],function(e){return e.extend({sideDisabled:!0,readOnly:!0})}),define("views/admin/auth-log-record/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideDisabled:!0,isWide:!0,bottomView:"views/record/detail-bottom"})}),define("views/admin/auth-log-record/modals/detail",["views/modals/detail"],function(e){return e.extend({sideDisabled:!0,editDisabled:!0})}),define("controllers/role",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=a}),define("controllers/portal-role",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=a}),define("controllers/layout-set",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionEditLayouts(e){var t=e.id;if(!t)throw new Error("ID not passed.");this.main("views/layout-set/layouts",{layoutSetId:t,scope:e.scope,type:e.type})}}e.default=a}),define("controllers/inbound-email",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=a}),define("controllers/api-user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="User";getCollection(e){return super.getCollection().then(e=>(e.data.userType="api",e))}createViewView(e,t,i){if(!t.isApi())return t.isPortal()?void this.getRouter().dispatch("PortalUser","view",{id:t.id,model:t}):void this.getRouter().dispatch("User","view",{id:t.id,model:t});super.createViewView(e,t,i)}actionCreate(e){(e=e||{}).attributes=e.attributes||{},e.attributes.type="api",super.actionCreate(e)}}e.default=a}),define("controllers/admin",["exports","controller","search-manager","views/settings/edit","views/admin/index"],function(e,t,i,n,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i),n=s(n),a=s(a);class o extends t.default{checkAccessGlobal(){return!!this.getUser().isAdmin()}actionPage(e){const t=e.page;if(e.options&&delete(e={...Espo.Utils.parseUrlOptionsParam(e.options),...e}).options,!t)throw new Error;var i="action"+Espo.Utils.upperCaseFirst(t);if(this[i])this[i](e);else{const a=this.getPageDefs(t);if(!a)throw new Espo.Exceptions.NotFound;if(a.view)this.main(a.view,e);else{if(!a.recordView)throw new Espo.Exceptions.NotFound;const s=this.getSettingsModel();s.fetch().then(()=>{s.id="1";var e=new n.default({model:s,headerTemplate:"admin/settings/headers/page",recordView:a.recordView,page:t,label:a.label,optionsToPass:["page","label"]});this.main(e)})}}}actionIndex(e){let t=e.isReturn;var e=this.name+"Index",i=(!(t=this.getRouter().backProcessed?!0:t)&&this.getStoredMainView(e)&&this.clearStoredMainView(e),new a.default);this.main(i,null,e=>{e.render(),this.listenTo(e,"clear-cache",this.clearCache),this.listenTo(e,"rebuild",this.rebuild)},{useStored:t,key:e})}actionUsers(){this.getRouter().dispatch("User","list",{fromAdmin:!0})}actionPortalUsers(){this.getRouter().dispatch("PortalUser","list",{fromAdmin:!0})}actionApiUsers(){this.getRouter().dispatch("ApiUser","list",{fromAdmin:!0})}actionTeams(){this.getRouter().dispatch("Team","list",{fromAdmin:!0})}actionRoles(){this.getRouter().dispatch("Role","list",{fromAdmin:!0})}actionPortalRoles(){this.getRouter().dispatch("PortalRole","list",{fromAdmin:!0})}actionPortals(){this.getRouter().dispatch("Portal","list",{fromAdmin:!0})}actionLeadCapture(){this.getRouter().dispatch("LeadCapture","list",{fromAdmin:!0})}actionEmailFilters(){this.getRouter().dispatch("EmailFilter","list",{fromAdmin:!0})}actionGroupEmailFolders(){this.getRouter().dispatch("GroupEmailFolder","list",{fromAdmin:!0})}actionEmailTemplates(){this.getRouter().dispatch("EmailTemplate","list",{fromAdmin:!0})}actionPdfTemplates(){this.getRouter().dispatch("Template","list",{fromAdmin:!0})}actionDashboardTemplates(){this.getRouter().dispatch("DashboardTemplate","list",{fromAdmin:!0})}actionWebhooks(){this.getRouter().dispatch("Webhook","list",{fromAdmin:!0})}actionLayoutSets(){this.getRouter().dispatch("LayoutSet","list",{fromAdmin:!0})}actionWorkingTimeCalendar(){this.getRouter().dispatch("WorkingTimeCalendar","list",{fromAdmin:!0})}actionAttachments(){this.getRouter().dispatch("Attachment","list",{fromAdmin:!0})}actionAuthenticationProviders(){this.getRouter().dispatch("AuthenticationProvider","list",{fromAdmin:!0})}actionEmailAddresses(){this.getRouter().dispatch("EmailAddress","list",{fromAdmin:!0})}actionPhoneNumbers(){this.getRouter().dispatch("PhoneNumber","list",{fromAdmin:!0})}actionPersonalEmailAccounts(){this.getRouter().dispatch("EmailAccount","list",{fromAdmin:!0})}actionGroupEmailAccounts(){this.getRouter().dispatch("InboundEmail","list",{fromAdmin:!0})}actionActionHistory(){this.getRouter().dispatch("ActionHistoryRecord","list",{fromAdmin:!0})}actionImport(){this.getRouter().dispatch("Import","index",{fromAdmin:!0})}actionLayouts(e){var t=e.scope||null,i=e.type||null,e=e.em||!1;this.main("views/admin/layouts/index",{scope:t,type:i,em:e})}actionLabelManager(e){var t=e.scope||null,e=e.language||null;this.main("views/admin/label-manager/index",{scope:t,language:e})}actionTemplateManager(e){e=e.name||null;this.main("views/admin/template-manager/index",{name:e})}actionFieldManager(e){var t=e.scope||null,e=e.field||null;this.main("views/admin/field-manager/index",{scope:t,field:e})}actionEntityManager(e){var t=e.scope||null;t&&e.edit?this.main("views/admin/entity-manager/edit",{scope:t}):e.create?this.main("views/admin/entity-manager/edit"):t&&e.formula?this.main("views/admin/entity-manager/formula",{scope:t,type:e.type}):t?this.main("views/admin/entity-manager/scope",{scope:t}):this.main("views/admin/entity-manager/index")}actionLinkManager(e){e=e.scope||null;this.main("views/admin/link-manager/index",{scope:e})}actionSystemRequirements(){this.main("views/admin/system-requirements/index")}getSettingsModel(){const e=this.getConfig().clone();return e.defs=this.getConfig().defs,this.listenTo(e,"after:save",()=>{this.getConfig().load(),this._broadcastChannel.postMessage("update:config")}),e}actionAuthTokens(){this.collectionFactory.create("AuthToken",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/auth-token/list",{scope:"AuthToken",collection:e,searchManager:t})})}actionAuthLog(){this.collectionFactory.create("AuthLogRecord",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/auth-log-record/list",{scope:"AuthLogRecord",collection:e,searchManager:t})})}actionJobs(){this.collectionFactory.create("Job",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/job/list",{scope:"Job",collection:e,searchManager:t})})}actionIntegrations(e){e=e.name||null;this.main("views/admin/integrations/index",{integration:e})}actionExtensions(){this.main("views/admin/extensions/index")}rebuild(){if(!this.rebuildRunning){this.rebuildRunning=!0;const t=this.get("master");Espo.Ui.notify(t.translate("pleaseWait","messages")),Espo.Ajax.postRequest("Admin/rebuild").then(()=>{var e=t.translate("Rebuild has been done","labels","Admin");Espo.Ui.success(e),this.rebuildRunning=!1}).catch(()=>{this.rebuildRunning=!1})}}clearCache(){if(!this.clearCacheRunning){this.clearCacheRunning=!0;const t=this.get("master");Espo.Ui.notify(t.translate("pleaseWait","messages")),Espo.Ajax.postRequest("Admin/clearCache").then(()=>{var e=t.translate("Cache has been cleared","labels","Admin");Espo.Ui.success(e),this.clearCacheRunning=!1}).catch(()=>{this.clearCacheRunning=!1})}}getPageDefs(e){var t=this.getMetadata().get(["app","adminPanel"])||{};let i=null;for(const a in t){for(const s of t[a].itemList||[])if(s.url==="#Admin/"+e){i=s;break}if(i)break}return i}}e.default=o});
