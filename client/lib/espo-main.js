
define("view",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends t.View{whenReady(){return this.isReady?Promise.resolve():new Promise(e=>{this.once("ready",()=>e())})}addActionHandler(e,t){this.events[`click [data-action="${e}"]`]=e=>{t.call(this,e.originalEvent,e.currentTarget)}}escapeString(e){return Handlebars.Utils.escapeExpression(e)}notify(e,t,i,s){e?(s=s||null,i=t?i||2e3:void 0,e=this.getLanguage().translate(e,"labels",s),Espo.Ui.notify(e,t,i)):Espo.Ui.notify(!1)}getHelper(){return this._helper}getUser(){return this._helper.user}getPreferences(){return this._helper.preferences}getConfig(){return this._helper.settings}getAcl(){return this._helper.acl}getModelFactory(){return this._helper.modelFactory}getCollectionFactory(){return this._helper.collectionFactory}getRouter(){return this._helper.router}getStorage(){return this._helper.storage}getSessionStorage(){return this._helper.sessionStorage}getLanguage(){return this._helper.language}getMetadata(){return this._helper.metadata}getCache(){return this._helper.cache}getDateTime(){return this._helper.dateTime}getNumberUtil(){return this._helper.numberUtil}getFieldManager(){return this._helper.fieldManager}getBaseController(){return this._helper.baseController}getThemeManager(){return this._helper.themeManager}updatePageTitle(){var e=this.getConfig().get("applicationName")||"EspoCRM";this.setPageTitle(e)}setPageTitle(e){this.getHelper().pageTitle.setTitle(e)}translate(e,t,i){return this.getLanguage().translate(e,t,i)}getBasePath(){return this._helper.basePath||""}ajaxRequest(e,t,i,s){return Espo.Ajax.request(e,t,i,s)}ajaxPostRequest(e,t,i){return Espo.Ajax.postRequest(e,t,i)}ajaxGetRequest(e,t,i){return Espo.Ajax.getRequest(e,t,i)}confirm(e,t,i){let s;"string"==typeof e||e instanceof String?(s=e,e={}):(e=e||{},s=e.message),s=s&&this.getHelper().transformMarkdownText(s,{linksInNewTab:!0}).toString();var a=e.confirmText||this.translate("Yes"),o=e.confirmStyle||null,n=e.cancelText||this.translate("Cancel");return Espo.Ui.confirm(s,{confirmText:a,cancelText:n,confirmStyle:o,backdrop:!("backdrop"in e)||e.backdrop,isHtml:!0},t,i)}}e.default=i}),define("ui/select",["exports","lib!selectize"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};const d={init:function(e,t={}){const i=t.score,s=$(e),a=(t=d.applyDefaultOptions(t||{}),[]),o=(d.loadEspoSelectPlugin(),a.push("espo_select"),{}),n=s.children().toArray().map(e=>{var t=e.getAttributeNode("value").value;return e.classList&&(o[t]=e.classList.toString()),t});let l=null;e=s.closest(".modal-body");e.length&&(l=e);const r={sortField:[{field:t.sortBy,direction:t.sortDirection}],load:t.load,loadThrottle:1,plugins:a,highlight:!1,selectOnTab:t.selectOnTab,copyClassesToDropdown:!1,allowEmptyOption:n.includes(""),showEmptyOptionInDropdown:!0,$relativeParent:l,render:{item:function(e){return $("<div>").addClass("item").addClass(o[e.value]||"").text(e.text).get(0).outerHTML},option:function(e){const t=$("<div>").addClass("option").addClass(""===e.value?"selectize-dropdown-emptyoptionlabel":"").addClass(o[e.value]||"").val(e.value).text(e.text);return""===e.text&&t.html("&nbsp;"),t.get(0).outerHTML}},onDelete:function(e){for(;e.length;)this.removeItem(e.pop(),!0);this.showInput(),this.positionDropdown(),this.refreshOptions(!0)}};t.matchAnyWord||(r.score=function(t){const i=this.getScoreFunction(t);return t=t.toLowerCase(),function(e){return 0===e.text.toLowerCase().indexOf(t)?i(e):0}}),t.matchAnyWord&&(r.score=function(i){const s=this.getScoreFunction(i);return i=i.toLowerCase(),function(e){const t=e.text.toLowerCase();return t.split(" ").find(e=>e.startsWith(i))||t.startsWith(i)?s(e):0}}),t.score&&(r.score=function(t){return function(e){return i(t,e)}}),s.selectize(r)},focus:function(e,t){e=$(e);if(t=t||{},e[0]&&e[0].selectize){const i=e[0].selectize;t.noTrigger&&(i.focusNoTrigger=!0),i.focus(),t.noTrigger&&setTimeout(()=>i.focusNoTrigger=!1,100)}},setOptions:function(e,t){const i=$(e),s=i.get(0).selectize;s.clearOptions(!0),s.load(e=>{e(t.map(e=>({value:e.value,text:e.text||e.label})))})},setValue:function(e,t){const i=e.get(0).selectize;i.setValue(t,!0)},destroy:function(e){e.length&&e[0].selectize&&e[0].selectize.destroy()},applyDefaultOptions:function(e){e=Espo.Utils.clone(e);var t={selectOnTab:!1,matchAnyWord:!1,sortBy:"$order",sortDirection:"asc"};for(const i in t)i in e||(e[i]=t[i]);return e},loadEspoSelectPlugin:function(){if(!("espo_select"in t.default.plugins)){const s=/Mac/.test(navigator.userAgent);t.default.define("espo_select",function(){const r=this;this.setup=function(){const e=r.setup;return function(){e.apply(this,arguments),r.selectedValue=r.items[0],r.$dropdown.on("mouseup","[data-selectable]",function(){return $(document).off("mouseup.select"),r.onOptionSelect.apply(r,arguments)}),r.$dropdown.on("mousedown","[data-selectable]",function(){$(document).one("mouseup.select",function(){r.focusOnControlSilently()})}),r.$control_input.css({width:"4px"})}}(),this.focusOnControlSilently=function(){r.preventReOpenOnFocus=!0,r.$control_input[0].focus(),r.preventReOpenOnFocus=!1},this.refreshOptions=function(){const e=r.refreshOptions;return function(){r.focusNoTrigger?e.apply(this,[!1]):e.apply(this,arguments)}}(),this.blur=function(){const e=r.blur;return function(){r.preventClose||e.apply(this,arguments)}}(),this.close=function(){const e=r.close;return function(){r.preventClose||e.apply(this,arguments)}}(),this.onOptionSelect=function(){const t=r.onOptionSelect;return function(e){if("mousedown"===e.type||"click"===e.type)return r.preventClose=!0,void setTimeout(()=>r.preventClose=!1,100);r.preventClose=!1,"mouseup"===e.type&&setTimeout(()=>r.focusOnControlSilently(),50),t.apply(this,arguments),r.selectedValue=$(e.currentTarget).attr("data-value")}}(),this.open=function(){const s=r.open;return function(){var e=!(r.isLocked||r.isOpen);if(s.apply(this,arguments),e){const t=r.$dropdown.children().first(),i=t.find(".selected");if(i.length){let e=i.get(0).offsetTop-t.get(0).clientHeight;e=0<=e?e:0,t.find(".selectize-dropdown-content").scrollTop(e)}}}}(),this.onMouseDown=function(){const t=r.onMouseDown;return function(e){if(r.isOpen||r.isInputHidden||!r.$control_input.val())return r.isOpen&&(r.closedByMouseDown=!0),t.apply(this,arguments)}}(),this.onFocus=function(){const t=r.onFocus;return function(e){if(!r.preventReOpenOnFocus){if(!r.closedByMouseDown)return r.closedByMouseDown=!1,t.apply(this,arguments);r.closedByMouseDown=!1}}}(),this.restoreSelectedValue=function(){this.preventRevertLoop||(this.preventRevertLoop=!0,setTimeout(()=>this.preventRevertLoop=!1,10),this.setValue(this.selectedValue,!0))},this.onBlur=function(){const e=r.onBlur;return function(){if(!r.preventClose)return r.restoreSelectedValue(),r.$control_input.css({width:"4px"}),e.apply(this,arguments)}}(),this.onKeyDown=function(){const i=r.onKeyDown;return function(e){var t;if(s?!e.metaKey:!e.ctrlKey)return"Escape"===e.code&&(!r.isOpen&&r.isInputHidden||e.stopPropagation(),r.isOpen&&r.close(),r.isInputHidden||r.hideInput(),r.addItem(this.selectedValue,!0)),(r.isFull()||r.isInputHidden)&&1===e.key.length&&(e.code.match(/Key[A-Z]/i)||e.key.match(/[0-9]/)||RegExp(/^\p{L}/,"u").test(e.key))&&(t=e.keyCode,e.keyCode=8,r.deleteSelection(e),e.keyCode=t,r.$control_input.width(15)),i.apply(this,arguments);r.items.length||(r.restoreSelectedValue(),r.focus())}}(),this.positionDropdown=function(){const l={top:"top",bottom:"bottom"};return function(){const e=r.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0);var i=r.$dropdown.prop("scrollHeight")+5,s=r.$control.get(0).getBoundingClientRect().top,a=r.$wrapper.height(),o=r.$control.get(0).getBoundingClientRect().bottom,n=this.settings.$relativeParent?this.settings.$relativeParent.get(0).getBoundingClientRect().top:0,s=s+i+a>window.innerHeight&&n<=o-i-a?l.top:l.bottom,n={width:e.outerWidth(),left:t.left};s===l.top?(Object.assign(n,{bottom:t.top,top:"unset",margin:"0 0 0 0"}),r.$dropdown.addClass("selectize-position-top")):(Object.assign(n,{top:t.top,bottom:"unset",margin:"0 0 0 0"}),r.$dropdown.removeClass("selectize-position-top")),r.$dropdown.css(n)}}()})}}};var i=d;e.default=i}),define("view-record-helper",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e,t){this.defaultFieldStates=e||{},this.defaultPanelStates=t||{},this.fieldStateMap={},this.panelStateMap={},this.hiddenFields={},this.hiddenPanels={},this.fieldOptionListMap={}}getHiddenFields(){return this.hiddenFields}getHiddenPanels(){return this.hiddenPanels}setFieldStateParam(e,t,i){"hidden"===t&&(i?this.hiddenFields[e]=!0:delete this.hiddenFields[e]),this.fieldStateMap[e]=this.fieldStateMap[e]||{},this.fieldStateMap[e][t]=i,this.trigger("field-change")}getFieldStateParam(e,t){return e in this.fieldStateMap&&t in this.fieldStateMap[e]?this.fieldStateMap[e][t]:t in this.defaultFieldStates?this.defaultFieldStates[t]:null}setPanelStateParam(e,t,i){"hidden"===t&&(i?this.hiddenPanels[e]=!0:delete this.hiddenPanels[e]),this.panelStateMap[e]=this.panelStateMap[e]||{},this.panelStateMap[e][t]=i}getPanelStateParam(e,t){return e in this.panelStateMap&&t in this.panelStateMap[e]?this.panelStateMap[e][t]:t in this.defaultPanelStates?this.defaultPanelStates[t]:null}setFieldOptionList(e,t){this.fieldOptionListMap[e]=t}clearFieldOptionList(e){delete this.fieldOptionListMap[e]}getFieldOptionList(e){return this.fieldOptionListMap[e]||null}hasFieldOptionList(e){return e in this.fieldOptionListMap}}Object.assign(i.prototype,t.Events),e.default=i}),define("dynamic-logic",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.defs=e||{},this.recordView=t,this.fieldTypeList=["visible","required","readOnly"],this.panelTypeList=["visible","styled"]}process(){const t=this.defs.fields||{};Object.keys(t).forEach(s=>{const e=t[s]||{};this.fieldTypeList.forEach(t=>{if(t in e&&e[t]){var i=e[t]||{};if(i.conditionGroup){i=this.checkConditionGroup(i.conditionGroup);let e;this[e=i?"makeField"+Espo.Utils.upperCaseFirst(t)+"True":"makeField"+Espo.Utils.upperCaseFirst(t)+"False"](s)}}})});var e=this.defs.panels||{};Object.keys(e).forEach(t=>{this.panelTypeList.forEach(e=>{this.processPanel(t,e)})});const o=this.defs.options||{};Object.keys(o).forEach(t=>{var i=o[t];if(o[t]){let e=!1;for(const a in i){var s=i[a];if(this.checkConditionGroup(s.conditionGroup)){this.setOptionList(t,s.optionList||[]),e=!0;break}}e||this.resetOptionList(t)}})}processPanel(t,i){var s=(this.defs.panels||{})[t]||{};if(i in s){s=s[i]||{};if(s.conditionGroup){s=this.checkConditionGroup(s.conditionGroup);let e;this[e=s?"makePanel"+Espo.Utils.upperCaseFirst(i)+"True":"makePanel"+Espo.Utils.upperCaseFirst(i)+"False"](t)}}}checkConditionGroup(e,t){let i,s=!1;if("and"===(t=t||"and")){i=e||[],s=!0;for(const a in i)if(!this.checkCondition(i[a])){s=!1;break}}else if("or"===t){for(const o in i=e||[])if(this.checkCondition(i[o])){s=!0;break}}else"not"===t&&e&&(s=!this.checkCondition(e));return s}getAttributeValue(e){if(e.startsWith("$")){if("$user.id"===e)return this.recordView.getUser().id;if("$user.teamsIds"===e)return this.recordView.getUser().getTeamIdList()}return this.recordView.model.get(e)}checkCondition(e){var t=(e=e||{}).type||"equals";if(["or","and","not"].includes(t))return this.checkConditionGroup(e.value,t);var i=e.attribute;const s=e.value;if(!i)return!1;const a=this.getAttributeValue(i);if("equals"===t)return!!s&&a===s;if("notEquals"===t)return!!s&&a!==s;if("isEmpty"===t)return Array.isArray(a)?!a.length:null===a||""===a||void 0===a;if("isNotEmpty"===t)return Array.isArray(a)?!!a.length:null!==a&&""!==a&&void 0!==a;if("isTrue"===t)return!!a;if("isFalse"===t)return!a;if("contains"===t||"has"===t)return!!a&&!!~a.indexOf(s);if("notContains"===t||"notHas"===t)return!a||!~a.indexOf(s);if("startsWith"===t)return!!a&&0===a.indexOf(s);if("endsWith"===t)return!!a&&a.indexOf(s)===a.length-s.length;if("matches"===t){if(!a)return!1;e=/^\/(.*)\/([a-z]*)$/.exec(s);return!e||e.length<2?!1:new RegExp(e[1],e[2]).test(a)}if("greaterThan"===t)return a>s;if("lessThan"===t)return a<s;if("greaterThanOrEquals"===t)return a>=s;if("lessThanOrEquals"===t)return a<=s;if("in"===t)return!!~s.indexOf(a);if("notIn"===t)return!~s.indexOf(a);if("isToday"===t){const o=this.recordView.getDateTime();return a?(10<a.length?o.toMoment(a):o.toMomentDate(a)).isSame(o.getNowMoment(),"day"):!1}if("inFuture"===t){const n=this.recordView.getDateTime();return a?(10<a.length?n.toMoment(a):n.toMomentDate(a)).isAfter(n.getNowMoment(),"day"):!1}if("inPast"!==t)return!1;{const l=this.recordView.getDateTime();return a?(10<a.length?l.toMoment(a):l.toMomentDate(a)).isBefore(l.getNowMoment(),"day"):!1}}setOptionList(e,t){this.recordView.setFieldOptionList(e,t)}resetOptionList(e){this.recordView.resetFieldOptionList(e)}makeFieldVisibleTrue(e){this.recordView.showField(e)}makeFieldVisibleFalse(e){this.recordView.hideField(e)}makeFieldRequiredTrue(e){this.recordView.setFieldRequired(e)}makeFieldRequiredFalse(e){this.recordView.setFieldNotRequired(e)}makeFieldReadOnlyTrue(e){this.recordView.setFieldReadOnly(e)}makeFieldReadOnlyFalse(e){this.recordView.setFieldNotReadOnly(e)}makePanelVisibleTrue(e){this.recordView.showPanel(e,"dynamicLogic")}makePanelVisibleFalse(e){this.recordView.hidePanel(e,!1,"dynamicLogic")}makePanelStyledTrue(e){this.recordView.stylePanel(e)}makePanelStyledFalse(e){this.recordView.unstylePanel(e)}addPanelVisibleCondition(e,t){this.defs.panels=this.defs.panels||{},this.defs.panels[e]=this.defs.panels[e]||{},this.defs.panels[e].visible=t,this.processPanel(e,"visible")}addPanelStyledCondition(e,t){this.defs.panels=this.defs.panels||{},this.defs.panels[e]=this.defs.panels[e]||{},this.defs.panels[e].styled=t,this.processPanel(e,"styled")}}}),define("views/fields/base",["exports","view","ui/select","jquery"],function(e,t,i,o){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i),o=s(o);class a extends t.default{constructor(e){super(e),this.name=e.name,this.labelText=e.labelText}type="base";listTemplate="fields/base/list";listLinkTemplate="fields/base/list-link";detailTemplate="fields/base/detail";editTemplate="fields/base/edit";searchTemplate="fields/base/search";listTemplateContent;detailTemplateContent;editTemplateContent;validations=["required"];MODE_LIST="list";MODE_LIST_LINK="listLink";MODE_DETAIL="detail";MODE_EDIT="edit";MODE_SEARCH="search";name;defs=null;params=null;mode="detail";searchParams=null;inlineEditDisabled=!1;disabled=!1;readOnly=!1;labelText;attributeList=null;initialAttributes=null;VALIDATION_POPOVER_TIMEOUT=3e3;validateCallback;validationElementSelector;recordHelper;$label=null;$element=null;initialSearchIsNotIdle=!1;entityType=null;lastValidationMessage=null;dataObject;isRequired(){return this.params.required}get$cell(){return this.$el.parent()}getCellElement(){return this.get$cell()}isInlineEditMode(){return!!this._isInlineEditMode}setDisabled(e){this.disabled=!0,e&&(this.disabledLocked=!0)}setNotDisabled(){this.disabledLocked||(this.disabled=!1)}setRequired(){this.params.required=!0,this.isEditMode()&&(this.isRendered()?this.showRequiredSign():this.once("after:render",()=>{this.showRequiredSign()}))}setNotRequired(){this.params.required=!1,this.get$cell().removeClass("has-error"),this.isEditMode()&&(this.isRendered()?this.hideRequiredSign():this.once("after:render",()=>{this.hideRequiredSign()}))}setReadOnly(e){return this.readOnlyLocked?Promise.reject():(this.readOnly=!0,e&&(this.readOnlyLocked=!0),this.isEditMode()?this.isInlineEditMode()?this.inlineEditClose():this.setDetailMode().then(()=>this.reRender()):Promise.resolve())}setNotReadOnly(){this.readOnlyLocked||(this.readOnly=!1)}getLabelElement(){return this.$label&&this.$label.get(0)&&!document.contains(this.$label.get(0))&&(this.$label=void 0),this.$label&&this.$label.length||(this.$label=this.$el.parent().children("label")),this.$label}hide(){this.$el.addClass("hidden");let e=this.get$cell();e.children("label").addClass("hidden"),e.addClass("hidden-cell")}show(){this.$el.removeClass("hidden");let e=this.get$cell();e.children("label").removeClass("hidden"),e.removeClass("hidden-cell")}data(){let e={scope:this.model.entityType||this.model.name,name:this.name,defs:this.defs,params:this.params,value:this.getValueForDisplay()};return this.isSearchMode()&&(e.searchParams=this.searchParams,e.searchData=this.searchData,e.searchValues=this.getSearchValues(),e.searchType=this.getSearchType(),e.searchTypeList=this.getSearchTypeList()),e}getValueForDisplay(){return this.model.get(this.name)}isReadMode(){return this.mode===this.MODE_LIST||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST_LINK}isListMode(){return this.mode===this.MODE_LIST||this.mode===this.MODE_LIST_LINK}isDetailMode(){return this.mode===this.MODE_DETAIL}isEditMode(){return this.mode===this.MODE_EDIT}isSearchMode(){return this.mode===this.MODE_SEARCH}setDetailMode(){return this.setMode(this.MODE_DETAIL)||Promise.resolve()}setEditMode(){return this.setMode(this.MODE_EDIT)||Promise.resolve()}setMode(e){var t=this.mode!==e&&this.mode,i=this.mode,s=(this.mode=e)+"Template",s=(s in this||(this[s]="fields/"+Espo.Utils.camelCaseToHyphen(this.type)+"/"+this.mode),this._hasTemplateContent||this.setTemplate(this[s]),e+"TemplateContent");return this._hasTemplateContent||s in this&&null!=this[s]&&this.setTemplateContent(this[s]),t?(i&&this.trigger("mode-changed"),this._onModeSet()):Promise.resolve()}prepare(){}_onModeSet(){return this.isListMode()?this.onListModeSet()||Promise.resolve():this.isDetailMode()?this.onDetailModeSet()||Promise.resolve():this.isEditMode()&&this.onEditModeSet()||Promise.resolve()}onDetailModeSet(){return this.prepare()}onEditModeSet(){return this.prepare()}onListModeSet(){return this.prepare()}init(){this.validations=Espo.Utils.clone(this.validations),this._hasTemplateContent=!!this.templateContent,this.defs=this.options.defs||{},this.name=this.options.name||this.defs.name,this.params=this.options.params||this.defs.params||{},this.validateCallback=this.options.validateCallback,this.fieldType=this.model.getFieldParam(this.name,"type")||this.type,this.entityType=this.model.entityType||this.model.name,this.recordHelper=this.options.recordHelper,this.dataObject=Espo.Utils.clone(this.options.dataObject||{}),this.labelText||(this.labelText=this.translate(this.name,"fields",this.entityType)),this.getFieldManager().getParamList(this.type).forEach(e=>{e=e.name;e in this.params||(this.params[e]=this.model.getFieldParam(this.name,e),void 0===this.params[e]&&(this.params[e]=null))});["inlineEditDisabled"].forEach(e=>{this.params[e]=this.model.getFieldParam(this.name,e)||null}),this.readOnly=this.readOnly||this.params.readOnly||this.model.getFieldParam(this.name,"readOnly")||this.model.getFieldParam(this.name,"clientReadOnly"),!this.model.isNew()&&this.model.getFieldParam(this.name,"readOnlyAfterCreate")&&(this.readOnly=!0),this.readOnlyLocked=this.options.readOnlyLocked||this.readOnly,this.inlineEditDisabled=this.options.inlineEditDisabled||this.params.inlineEditDisabled||this.inlineEditDisabled,this.readOnly=this.readOnlyLocked||this.options.readOnly||!1,this.tooltip=this.options.tooltip||this.params.tooltip||this.model.getFieldParam(this.name,"tooltip")||this.tooltip,this.options.readOnlyDisabled&&(this.readOnly=!1),this.disabledLocked=this.options.disabledLocked||!1,this.disabled=this.disabledLocked||this.options.disabled||this.disabled;let e=this.options.mode||this.mode||this.MODE_DETAIL;e===this.MODE_EDIT&&this.readOnly&&(e=this.MODE_DETAIL),this.mode=void 0,this.wait(this.setMode(e)),this.isSearchMode()&&(this.searchParams=_.clone(this.options.searchParams||{}),this.searchData={},this.setupSearch(),this.events["keydown."+this.cid]=e=>{"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&this.trigger("search")}),this.on("highlight",()=>{let e=this.get$cell();e.addClass("highlighted"),e.addClass("transition"),setTimeout(()=>{e.removeClass("highlighted")},3e3),setTimeout(()=>{e.removeClass("transition")},5e3)}),this.on("invalid",()=>{let e=this.get$cell();e.addClass("has-error"),this.$el.one("click",()=>{e.removeClass("has-error")}),this.once("render",()=>{e.removeClass("has-error")})}),this.on("after:render",()=>{if(this.isEditMode())return this.hasRequiredMarker()?void this.showRequiredSign():void this.hideRequiredSign();var e;this.hasRequiredMarker()&&this.hideRequiredSign(),!this.isSearchMode()||(e=this.$el.find("select.search-type")).length&&i.default.init(e,{matchAnyWord:!0})}),(this.isDetailMode()||this.isEditMode())&&this.tooltip&&this.initTooltip(),this.isDetailMode()&&(this.inlineEditDisabled||this.listenToOnce(this,"after:render",()=>this.initInlineEdit())),this.isSearchMode()||(this.attributeList=this.getAttributeList(),this.listenTo(this.model,"change",(t,i)=>{if(!i.ui){let e=!1;for(var s of this.getAttributeList())if(t.hasChanged(s)){e=!0;break}if(e&&!(i.skipReRenderInEditMode&&this.isEditMode()||i.skipReRender)){let t=()=>{(this.isRendered()||this.isBeingRendered())&&(this.reRender(),i.highlight&&this.trigger("highlight"))};if(this.isReady){let e=this.prepare();e?e.then(()=>t()):t()}else this.once("ready",()=>{const e=this.prepare();e&&e.then(()=>t())})}}}),this.listenTo(this,"change",()=>{var e=this.fetch();this.model.set(e,{ui:!0})}))}setupFinal(){this.wait(this._onModeSet())}initTooltip(){let a;this.once("after:render",()=>{a=(0,o.default)("<a>").attr("role","button").attr("tabindex","-1").addClass("text-muted field-info").append((0,o.default)("<span>").addClass("fas fa-info-circle"));let e=this.getLabelElement(),t=(e.append(" "),this.getLabelElement().append(a),this.options.tooltipText||this.tooltipText);var i,s;t||"string"!=typeof this.tooltip||([i,s]=this.tooltip.includes(".")?this.tooltip.split("."):[this.entityType,this.tooltip],t=this.translate(s,"tooltips",i)),t=t||this.translate(this.name,"tooltips",this.entityType)||"",t=this.getHelper().transformMarkdownText(t,{linksInNewTab:!0}).toString(),Espo.Ui.popover(a,{placement:"bottom",content:t,preventDestroyOnRender:!0},this)})}showRequiredSign(){let e=this.getLabelElement(),t=e.find("span.required-sign");var i;e.length&&!t.length&&(i=e.find("span.label-text"),(0,o.default)('<span class="required-sign"> *</span>').insertAfter(i),t=e.find("span.required-sign")),t.show()}hideRequiredSign(){let e=this.getLabelElement(),t=e.find("span.required-sign");t.hide()}getSearchParamsData(){return this.searchParams.data||{}}getSearchValues(){return this.getSearchParamsData().values||{}}getSearchType(){return this.getSearchParamsData().type||this.searchParams.type}getSearchTypeList(){return this.searchTypeList}initInlineEdit(){let e=this.get$cell(),t=(0,o.default)("<a>").attr("role","button").addClass("pull-right inline-edit-link hidden").append((0,o.default)("<span>").addClass("fas fa-pencil-alt fa-sm"));0!==e.length?(e.prepend(t),t.on("click",()=>this.inlineEdit()),e.on("mouseenter",e=>{e.stopPropagation(),this.disabled||this.readOnly||this.isDetailMode()&&t.removeClass("hidden")}).on("mouseleave",e=>{e.stopPropagation(),this.isDetailMode()&&t.addClass("hidden")}),this.on("after:render",()=>{this.isDetailMode()||t.addClass("hidden")})):this.listenToOnce(this,"after:render",()=>this.initInlineEdit())}initElement(){this.$element=this.$el.find('[data-name="'+this.name+'"]'),this.$element.length||(this.$element=this.$el.find('[name="'+this.name+'"]')),this.$element.length||(this.$element=this.$el.find(".main-element")),this.isEditMode()&&this.$element.on("change",()=>{this.trigger("change")})}afterRender(){(this.isEditMode()||this.isSearchMode())&&this.initElement(),this.isReadMode()&&this.afterRenderRead(),this.isListMode()&&this.afterRenderList(),this.isDetailMode()&&this.afterRenderDetail(),this.isEditMode()&&this.afterRenderEdit(),this.isSearchMode()&&this.afterRenderSearch()}afterRenderRead(){}afterRenderList(){}afterRenderDetail(){}afterRenderEdit(){}afterRenderSearch(){}setup(){}setupSearch(){}getAttributeList(){return this.getFieldManager().getAttributeList(this.fieldType,this.name)}inlineEditSave(s){if(s=s||{},this.recordHelper)this.recordHelper.trigger("inline-edit-save",this.name,s);else{var a,o=this.fetch();let e=this.model,t=this.initialAttributes,i=(e.set(o,{silent:!0}),!1);for(a in o=e.attributes)_.isEqual(t[a],o[a])||((i=i||{})[a]=o[a]);if(i||this.inlineEditClose(),this.validateCallback?this.validateCallback():this.validate())return Espo.Ui.error(this.translate("Not valid")),void e.set(t,{silent:!0});Espo.Ui.notify(this.translate("saving","messages")),e.save(i,{patch:!0}).then(()=>{this.trigger("after:inline-save"),this.trigger("after:save"),e.trigger("after:save"),Espo.Ui.success(this.translate("Saved"))}).catch(()=>{Espo.Ui.error(this.translate("Error occurred")),e.set(t,{silent:!0}),this.reRender()}),s.bypassClose||this.inlineEditClose(!0)}}removeInlineEditLinks(){let e=this.get$cell();e.find(".inline-save-link").remove(),e.find(".inline-cancel-link").remove(),e.find(".inline-edit-link").addClass("hidden")}addInlineEditLinks(){let e=this.get$cell(),t=(0,o.default)("<a>").attr("role","button").attr("tabindex","-1").addClass("pull-right inline-save-link").attr("title","Ctrl+Enter").text(this.translate("Update")),i=(0,o.default)("<a>").attr("role","button").attr("tabindex","-1").addClass("pull-right inline-cancel-link").attr("title","Esc").text(this.translate("Cancel"));e.prepend(t),e.prepend(i),e.find(".inline-edit-link").addClass("hidden"),t.click(()=>{this.inlineEditSave()}),i.click(()=>{this.inlineEditClose()})}setIsInlineEditMode(e){this._isInlineEditMode=e}inlineEditClose(e){if(this.trigger("inline-edit-off",{noReset:e}),this.$el.off("keydown.inline-edit"),this._isInlineEditMode=!1,!this.isEditMode())return Promise.resolve();e||this.model.set(this.initialAttributes,{skipReRenderInEditMode:!0});var t=this.setDetailMode().then(()=>this.reRender(!0)).then(()=>this.removeInlineEditLinks());return this.trigger("after:inline-edit-off",{noReset:e}),t}inlineEdit(){this.trigger("edit",this),this.initialAttributes=this.model.getClonedAttributes(),this._isInlineEditMode=!0;var e=this.setEditMode().then(()=>this.reRender(!0)).then(()=>this.addInlineEditLinks()).then(()=>{this.$el.on("keydown.inline-edit",e=>{var t=Espo.Utils.getKeyFromKeyEvent(e);return"Control+Enter"===t?(e.stopPropagation(),this.inlineEditSave(),void setTimeout(()=>{this.get$cell().focus()},100)):"Escape"===t?(e.stopPropagation(),void this.inlineEditClose().then(()=>{this.get$cell().focus()})):void("Control+KeyS"===t&&(e.preventDefault(),e.stopPropagation(),this.inlineEditSave({bypassClose:!0})))}),setTimeout(()=>this.focusOnInlineEdit(),10)});return this.trigger("inline-edit-on"),e}focusOnInlineEdit(){let e=this.$element&&this.$element.length?this.$element:this.$el.find(".form-control").first();e&&e.first().focus()}suspendValidationMessage(e){this.validationMessageSuspended=!0,setTimeout(()=>this.validationMessageSuspended=!1,e||200)}showValidationMessage(t,i,s){if(!this.validationMessageSuspended){let e;if(i=i||this.validationElementSelector||".main-element",(e=(e=!(e="string"==typeof i||i instanceof String?this.$el.find(i):(0,o.default)(i)).length&&this.$element?this.$element:e).length?e:this.$el).length){i=e.get(0).getBoundingClientRect();if(this.lastValidationMessage=t,0===i.top&&0===i.bottom&&0===i.left)return}this._popoverMap=this._popoverMap||new WeakMap;i=e.get(0);if(i){if(this._popoverMap.has(i))try{this._popoverMap.get(i).detach()}catch(e){}const a=Espo.Ui.popover(e,{placement:"bottom",container:"body",content:this.getHelper().transformMarkdownText(t).toString(),trigger:"manual",noToggleInit:!0,noHideOnOutsideClick:!0},s||this);a.show(),this._popoverMap.set(i,a),e.closest(".field").one("mousedown click",()=>a.destroy()),this.once("render remove",()=>a.destroy()),this._timeoutMap=this._timeoutMap||new WeakMap,this._timeoutMap.has(i)&&clearTimeout(this._timeoutMap.get(i));t=setTimeout(()=>{a.destroy()},this.VALIDATION_POPOVER_TIMEOUT);this._timeoutMap.set(i,t)}}}validate(){for(var e in this.lastValidationMessage=null,this.validations)if(this["validate"+Espo.Utils.upperCaseFirst(this.validations[e])].call(this))return this.trigger("invalid"),!0;return!1}getLabelText(){return this.labelText}validateRequired(){var e;if(this.isRequired()&&(""===this.model.get(this.name)||null===this.model.get(this.name)))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}hasRequiredMarker(){return this.isRequired()}fetchToModel(){this.model.set(this.fetch(),{silent:!0})}fetch(){if(!this.$element.length)return{};let e={};return e[this.name]=this.$element.val().trim(),e}fetchSearch(){var e=this.$element.val().toString().trim();return e?{type:"equals",value:e}:null}fetchSearchType(){return this.$el.find("select.search-type").val()}}e.default=a}),define("helpers/model/defaults-populator",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.user=e,this.preferences=t,this.acl=i,this.config=s}populate(e){e.populateDefaults();const t={};this.user.isPortal()||this.prepare(e,t),this.user.isPortal()&&this.prepareForPortal(e,t),this.prepareFields(e,t);for(const i in t)e.has(i)&&delete t[i];e.set(t,{silent:!0})}prepare(i,s){var a=i.hasField("assignedUsers")&&"User"===i.getLinkParam("assignedUsers","entity");if(i.hasField("assignedUser")||a){let e="assignedUser",t=(a&&(e="assignedUsers"),!0);this.preferences.get("doNotFillAssignedUserIfNotRequired")&&(t=!1,(i.getFieldParam(e,"required")||"no"===this.acl.getPermissionLevel("assignmentPermission")||"team"===this.acl.getPermissionLevel("assignmentPermission")&&!this.user.get("defaultTeamId")||this.acl.getScopeForbiddenFieldList(i.entityType,"edit").includes(e))&&(t=!0)),t&&(a?(s.assignedUsersIds=[this.user.id],s.assignedUsersNames={},s.assignedUsersNames[this.user.id]=this.user.get("name")):(s.assignedUserId=this.user.id,s.assignedUserName=this.user.get("name")))}a=this.user.get("defaultTeamId");a&&i.hasField("teams")&&!i.getFieldParam("teams","default")&&"entityTeam"===Espo.Utils.lowerCaseFirst(i.getLinkParam("teams","relationName")||"")&&(s.teamsIds=[a],s.teamsNames={},s.teamsNames[a]=this.user.get("defaultTeamName"))}prepareForPortal(e,t){if(e.hasField("account")&&["belongsTo","hasOne"].includes(e.getLinkType("account"))&&"Account"===e.getLinkParam("account","entity")&&this.user.get("accountId")&&(t.accountId=this.user.get("accountId"),t.accountName=this.user.get("accountName")),e.hasField("contact")&&["belongsTo","hasOne"].includes(e.getLinkType("contact"))&&"Contact"===e.getLinkParam("contact","entity")&&this.user.get("contactId")&&(t.contactId=this.user.get("contactId"),t.contactName=this.user.get("contactName")),e.hasField("parent")&&"belongsToParent"===e.getLinkType("parent")&&(this.config.get("b2cMode")?this.user.get("contactId")&&(e.getFieldParam("parent","entityList")||[]).includes("Contact")&&(t.contactId=this.user.get("contactId"),t.parentName=this.user.get("contactName"),t.parentType="Contact"):this.user.get("accountId")&&(e.getFieldParam("parent","entityList")||[]).includes("Account")&&(t.parentId=this.user.get("accountId"),t.parentName=this.user.get("accountName"),t.parentType="Account")),e.hasField("accounts")&&"hasMany"===e.getLinkType("accounts")&&"Account"===e.getLinkParam("accounts","entity")&&this.user.get("accountsIds")&&(t.accountsIds=this.user.get("accountsIds"),t.accountsNames=this.user.get("accountsNames")),e.hasField("contacts")&&"hasMany"===e.getLinkType("contacts")&&"Contact"===e.getLinkParam("contacts","entity")&&this.user.get("contactId")){t.contactsIds=[this.user.get("contactId")];const i={};i[this.user.get("contactId")]=this.user.get("contactName"),t.contactsNames=i}}prepareFields(s,a){s.getFieldList().forEach(t=>{var i=s.getFieldType(t);if(i&&(!s.getFieldParam(t,"disabled")&&!s.getFieldParam(t,"utility")&&"enum"===i)){let e=(s.getFieldParam(t,"options")||[])[0]||"";(e=""!==e?e:null)&&(i=t,t=e,i in a||s.has(i)||(a[i]=t))}})}}}),define("exceptions",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,Espo.Exceptions=Espo.Exceptions||{},Espo.Exceptions.AccessDenied=function(e){this.message=e,Error.apply(this,arguments)},Espo.Exceptions.AccessDenied.prototype=new Error,Espo.Exceptions.AccessDenied.prototype.name="AccessDenied",Espo.Exceptions.NotFound=function(e){this.message=e,Error.apply(this,arguments)},Espo.Exceptions.NotFound.prototype=new Error,Espo.Exceptions.NotFound.prototype.name="NotFound";var t=Espo.Exceptions;e.default=t}),define("views/record/base",["exports","view","view-record-helper","dynamic-logic","underscore","jquery","helpers/model/defaults-populator"],function(e,t,i,s,m,a,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),s=n(s),m=n(m),a=n(a),o=n(o);class l extends t.default{type="edit";entityType=null;scope=null;isNew=!1;dependencyDefs={};dynamicLogicDefs={};fieldList=null;mode=null;lastSaveCancelReason=null;recordHelper=null;MODE_DETAIL="detail";MODE_EDIT="edit";TYPE_DETAIL="detail";TYPE_EDIT="edit";hideField(a,e){this.recordHelper.setFieldStateParam(a,"hidden",!0),e&&this.recordHelper.setFieldStateParam(a,"hiddenLocked",!0);const t=()=>{var e=this.getFieldView(a);if(e){const t=e.$el,i=t.closest('.cell[data-name="'+a+'"]'),s=i.find('label.control-label[data-name="'+a+'"]');t.addClass("hidden"),s.addClass("hidden"),i.addClass("hidden-cell")}else this.$el.find('.cell[data-name="'+a+'"]').addClass("hidden-cell"),this.$el.find('.field[data-name="'+a+'"]').addClass("hidden"),this.$el.find('label.control-label[data-name="'+a+'"]').addClass("hidden")},i=(this.isRendered()?t():this.once("after:render",()=>{t()}),this.getFieldView(a));i&&i.setDisabled(e)}showField(a){if(!this.recordHelper.getFieldStateParam(a,"hiddenLocked")){this.recordHelper.setFieldStateParam(a,"hidden",!1);const e=()=>{var e=this.getFieldView(a);if(e){const t=e.$el,i=t.closest('.cell[data-name="'+a+'"]'),s=i.find('label.control-label[data-name="'+a+'"]');return t.removeClass("hidden"),s.removeClass("hidden"),void i.removeClass("hidden-cell")}this.$el.find('.cell[data-name="'+a+'"]').removeClass("hidden-cell"),this.$el.find('.field[data-name="'+a+'"]').removeClass("hidden"),this.$el.find('label.control-label[data-name="'+a+'"]').removeClass("hidden")},t=(this.isRendered()?e():this.once("after:render",()=>{e()}),this.getFieldView(a));t&&(t.disabledLocked||t.setNotDisabled())}}setFieldReadOnly(t,i){var e=this.recordHelper.getFieldStateParam(t,"readOnly");this.recordHelper.setFieldStateParam(t,"readOnly",!0),i&&this.recordHelper.setFieldStateParam(t,"readOnlyLocked",!0);const s=this.getFieldView(t);s&&s.setReadOnly(i).catch(()=>{}),e||this.trigger("set-field-read-only",t),s||this.isReady||this.once("ready",()=>{const e=this.getFieldView(t);e&&!e.readOnly&&this.recordHelper.getFieldStateParam(t,"readOnly")&&e.setReadOnly(i)})}setFieldNotReadOnly(t){var e=this.recordHelper.getFieldStateParam(t,"readOnly");this.recordHelper.setFieldStateParam(t,"readOnly",!1);const i=this.getFieldView(t);i&&i.readOnly&&(i.setNotReadOnly(),this.mode===this.MODE_EDIT&&!i.readOnlyLocked&&i.isDetailMode()&&i.setEditMode().then(()=>i.reRender())),e&&this.trigger("set-field-not-read-only",t),i||this.isReady||this.once("ready",()=>{const e=this.getFieldView(t);e&&e.readOnly&&!this.recordHelper.getFieldStateParam(t,"readOnly")&&e.setNotReadOnly()})}setFieldRequired(e){var t=this.recordHelper.getFieldStateParam(e,"required");this.recordHelper.setFieldStateParam(e,"required",!0);const i=this.getFieldView(e);i&&i.setRequired(),t||this.trigger("set-field-required",e)}setFieldNotRequired(e){var t=this.recordHelper.getFieldStateParam(e,"required");this.recordHelper.setFieldStateParam(e,"required",!1);const i=this.getFieldView(e);i&&i.setNotRequired(),t&&this.trigger("set-field-not-required",e)}setFieldOptionList(e,t){var i=this.recordHelper.hasFieldOptionList(e),s=this.recordHelper.getFieldOptionList(e);this.recordHelper.setFieldOptionList(e,t);const a=this.getFieldView(e);a&&"setOptionList"in a&&a.setOptionList(t),i&&(0,m.default)(s).isEqual(t)||this.trigger("set-field-option-list",e,t)}resetFieldOptionList(e){var t=this.recordHelper.hasFieldOptionList(e);this.recordHelper.clearFieldOptionList(e);const i=this.getFieldView(e);i&&"resetOptionList"in i&&i.resetOptionList(),t&&this.trigger("reset-field-option-list",e)}showPanel(e,t){this.recordHelper.setPanelStateParam(e,"hidden",!1),this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').removeClass("hidden")}hidePanel(e,t,i){this.recordHelper.setPanelStateParam(e,"hidden",!0),this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').addClass("hidden")}stylePanel(s){this.recordHelper.setPanelStateParam(s,"styled",!0);const e=()=>{const e=this.$el.find('.panel[data-name="'+s+'"]'),t=e.find("> .panel-heading .btn");var i=e.attr("data-style");i&&(e.removeClass("panel-default"),e.addClass("panel-"+i),t.removeClass("btn-default"),t.addClass("btn-"+i))};this.isRendered()?e():this.once("after:render",()=>{e()})}unstylePanel(s){this.recordHelper.setPanelStateParam(s,"styled",!1);const e=()=>{const e=this.$el.find('.panel[data-name="'+s+'"]'),t=e.find("> .panel-heading .btn");var i=e.attr("data-style");i&&(e.removeClass("panel-"+i),e.addClass("panel-default"),t.removeClass("btn-"+i),t.addClass("btn-default"))};this.isRendered()?e():this.once("after:render",()=>{e()})}setConfirmLeaveOut(e){this.getRouter()&&(this.getRouter().confirmLeaveOut=e)}getFieldViews(e){const i={};return this.fieldList.forEach(e=>{var t=this.getFieldView(e);t&&(i[e]=t)}),i}getFields(){return this.getFieldViews()}getFieldView(e){let t=this.getView(e+"Field")||null;return t=t||(this.getView(e)||null)}getField(e){return this.getFieldView(e)}getFieldList(){return Object.keys(this.getFieldViews())}getFieldViewList(){return this.getFieldList().map(e=>this.getFieldView(e)).filter(e=>null!==e)}data(){return{scope:this.scope,entityType:this.entityType,hiddenPanels:this.recordHelper.getHiddenPanels(),hiddenFields:this.recordHelper.getHiddenFields()}}handleDataBeforeRender(t){this.getFieldList().forEach(e=>{t[e]=t[e+"Field"]})}setup(){if(void 0===this.model)throw new Error("Model has not been injected into record view.");this.recordHelper=this.options.recordHelper||new i.default,this.dynamicLogicDefs=this.options.dynamicLogicDefs||this.dynamicLogicDefs,this.on("remove",()=>{this.isChanged&&this.resetModelChanges(),this.setIsNotChanged()}),this.entityType=this.model.entityType||this.model.name||"Common",this.scope=this.options.scope||this.entityType,this.fieldList=this.options.fieldList||this.fieldList||[],this.numId=Math.floor(1e4*Math.random()+1),this.id=Espo.Utils.toDom(this.entityType)+"-"+Espo.Utils.toDom(this.type)+"-"+this.numId,this.model.isNew()&&(this.isNew=!0),this.setupBeforeFinal()}setupBeforeFinal(){this.attributes=this.model.getClonedAttributes(),this.listenTo(this.model,"change",(e,t)=>{if(t.sync)for(const i in e.attributes)e.hasChanged(i)&&(this.attributes[i]=Espo.Utils.cloneDeep(e.get(i)));else this.mode===this.MODE_EDIT&&this.setIsChanged()}),this.options.attributes&&this.model.set(this.options.attributes),this.listenTo(this.model,"sync",()=>{this.attributes=this.model.getClonedAttributes()}),this.initDependency(),this.initDynamicLogic()}setInitialAttributeValue(e,t){this.attributes[e]=t}checkAttributeIsChanged(e){return!m.default.isEqual(this.attributes[e],this.model.get(e))}resetModelChanges(){this.updatedAttributes&&(this.attributes=this.updatedAttributes,this.updatedAttributes=null);for(const e in this.model.attributes)e in this.attributes||this.model.unset(e);this.model.set(this.attributes,{skipReRender:!0})}setModelAttributes(e,t){for(const i in this.model.attributes)i in e||this.model.unset(i);this.model.set(e,t||{})}initDynamicLogic(){this.dynamicLogicDefs=Espo.Utils.clone(this.dynamicLogicDefs||{}),this.dynamicLogicDefs.fields=Espo.Utils.clone(this.dynamicLogicDefs.fields),this.dynamicLogicDefs.panels=Espo.Utils.clone(this.dynamicLogicDefs.panels),this.dynamicLogic=new s.default(this.dynamicLogicDefs,this),this.listenTo(this.model,"change",()=>this.processDynamicLogic()),this.processDynamicLogic()}processDynamicLogic(){this.dynamicLogic.process()}initDependency(){Object.keys(this.dependencyDefs||{}).forEach(e=>{this.listenTo(this.model,"change:"+e,()=>{this._handleDependencyAttribute(e)})}),this._handleDependencyAttributes()}initDependancy(){this.initDependency()}setupFieldLevelSecurity(){const e=this.getAcl().getScopeForbiddenFieldList(this.entityType,"read"),t=(e.forEach(e=>{this.hideField(e,!0)}),this.getAcl().getScopeForbiddenFieldList(this.entityType,"edit"));t.forEach(e=>{this.setFieldReadOnly(e,!0)})}setIsChanged(){this.isChanged=!0}setIsNotChanged(){this.isChanged=!1}validate(){const t=[];return this.getFieldList().forEach(e=>{this.validateField(e)&&t.push(e)}),t.length&&this.onInvalid(t),!!t.length}onInvalid(e){}validateField(t){var e,i=this.translate("fieldInvalid","messages").replace("{field}",this.translate(t,"fields",this.entityType));const s=this.getFieldView(t);if(!s)return!1;let a=!1;return(a=s.isEditMode()&&!s.disabled&&!s.readOnly&&s.validate()||a)?(!s.$el||0===(e=s.$el.get(0).getBoundingClientRect()).top&&0===e.bottom&&0===e.left&&s.$el.closest(".panel.hidden").length&&setTimeout(()=>{var e=this.translate("Not valid")+": "+(s.lastValidationMessage||this.translate(t,"fields",this.entityType));Espo.Ui.error(e,!0)},10),!0):(this.dynamicLogic&&this.dynamicLogicDefs&&this.dynamicLogicDefs.fields&&this.dynamicLogicDefs.fields[t]&&this.dynamicLogicDefs.fields[t].invalid&&this.dynamicLogicDefs.fields[t].invalid.conditionGroup&&(e=this.dynamicLogicDefs.fields[t].invalid.conditionGroup,e=this.dynamicLogic.checkConditionGroup(e),a=e||a,e&&(s.showValidationMessage(i),s.trigger("invalid"))),a)}afterSave(){this.isNew?Espo.Ui.success(this.translate("Created")):Espo.Ui.success(this.translate("Saved")),this.setIsNotChanged()}beforeBeforeSave(){}beforeSave(){Espo.Ui.notify(this.translate("saving","messages"))}afterSaveError(){}afterNotModified(){Espo.Ui.warning(this.translate("notModified","messages")),this.setIsNotChanged()}afterNotValid(){Espo.Ui.error(this.translate("Not valid"))}save(s){const e=(s=s||{}).headers||{},a=this.model;this.lastSaveCancelReason=null,this.beforeBeforeSave();var t=this.fetch();const o=this.attributes,n=this.model.getClonedAttributes();var i=m.default.extend(Espo.Utils.cloneDeep(n),t);let l={};if(a.isNew()&&(l=i),!a.isNew()){for(const r in i)m.default.isEqual(o[r],i[r])||(l[r]=i[r]);var h=this.forcePatchAttributeDependencyMap||{};for(const d in h)if(!(d in l)&&d in t){const u=h[d];!!u.find(e=>e in l)&&(l[d]=i[d])}}if(0===Object.keys(l).length)return s.skipNotModifiedWarning||this.afterNotModified(),this.lastSaveCancelReason="notModified",this.trigger("cancel:save",{reason:"notModified"}),Promise.reject("notModified");if(a.set(l,{silent:!0}),this.validate())return a.attributes=n,this.afterNotValid(),this.lastSaveCancelReason="invalid",this.trigger("cancel:save",{reason:"invalid"}),Promise.reject("invalid");s.afterValidate&&s.afterValidate(),this.getMetadata().get(["entityDefs",this.entityType,"optimisticConcurrencyControl"])&&null!==this.model.get("versionNumber")&&(e["X-Version-Number"]=this.model.get("versionNumber")),this.model.isNew()&&this.options.duplicateSourceId&&(e["X-Duplicate-Source-Id"]=this.options.duplicateSourceId),this.beforeSave(),this.trigger("before:save"),a.trigger("before:save");const c=(e,t,i)=>{this.handleSaveError(e,s,i,t).then(e=>{e||t("error")}),this.afterSaveError(),this.setModelAttributes(n),this.lastSaveCancelReason="error",this.trigger("error:save"),this.trigger("cancel:save",{reason:"error"})};return new Promise((t,i)=>{a.save(l,{patch:!a.isNew(),headers:e}).then(()=>{this.trigger("save",o),this.afterSave(),this.isNew&&(this.isNew=!1),this.trigger("after:save"),a.trigger("after:save"),t()}).catch(e=>{c(e,i,t)})})}handleSaveError(t,s,a,o){let n=null;if(~[409,500].indexOf(t.status)){const e=t.getResponseHeader("X-Status-Reason");if(!e)return Promise.resolve(!1);try{n=JSON.parse(e)}catch(e){}if(!n&&(n={reason:e.toString()},t.responseText)){let e;try{e=JSON.parse(t.responseText)}catch(e){return console.error("Could not parse error response body."),Promise.resolve(!1)}n.data=e}}if(!n||!n.reason)return Promise.resolve(!1);const l=n.reason,r=this.getMetadata().get(["clientDefs",this.scope,"saveErrorHandlers",l])||this.getMetadata().get(["clientDefs","Global","saveErrorHandlers",l]);return new Promise(i=>{return r?(Espo.loader.require(r,e=>{const t=new e(this);t.process(n.data,s),i(!1)}),void(t.errorIsHandled=!0)):(e="errorHandler"+Espo.Utils.upperCaseFirst(l))in this?(t.errorIsHandled=!0,e=this[e](n.data,s,a,o),void i(e||!1)):void i(!1);var e})}fetch(){let e={};var t=this.getFieldViews();for(const i in t){const s=t[i];s.isEditMode()&&(s.disabled||s.readOnly||!s.isFullyRendered()||(e={...e,...s.fetch()}))}return e}processFetch(){var e=this.fetch();return this.model.set(e),this.validate()?null:e}populateDefaults(){const e=new o.default(this.getUser(),this.getPreferences(),this.getAcl(),this.getConfig());e.populate(this.model)}errorHandlerDuplicate(e){}_handleDependencyAttributes(){Object.keys(this.dependencyDefs||{}).forEach(e=>{this._handleDependencyAttribute(e)})}_handleDependencyAttribute(e){const t=this.dependencyDefs[e];e=this.model.get(e);e in(t.map||{})?(t.map[e]||[]).forEach(e=>{this._doDependencyAction(e)}):"default"in t&&(t.default||[]).forEach(e=>{this._doDependencyAction(e)})}_doDependencyAction(e){var t=e.action;if("dependencyAction"+Espo.Utils.upperCaseFirst(t)in this&&"function"==typeof this.methodName)this.methodName(e);else{const i=e.fieldList||e.fields||[],s=e.panelList||e.panels||[];switch(t){case"hide":s.forEach(e=>{this.hidePanel(e)}),i.forEach(e=>{this.hideField(e)});break;case"show":s.forEach(e=>{this.showPanel(e)}),i.forEach(e=>{this.showField(e)});break;case"setRequired":i.forEach(e=>{this.setFieldRequired(e)});break;case"setNotRequired":i.forEach(e=>{this.setFieldNotRequired(e)});break;case"setReadOnly":i.forEach(e=>{this.setFieldReadOnly(e)});break;case"setNotReadOnly":i.forEach(e=>{this.setFieldNotReadOnly(e)})}}}createField(e,t,i,s,a,o){const n={model:this.model,mode:s||"edit",selector:'.field[data-name="'+e+'"]',defs:{name:e,params:i||{}}};if(a&&(n.readOnly=!0),(t=t||this.model.getFieldParam(e,"view"))||(s=this.model.getFieldType(e)||"base",t=this.getFieldManager().getViewName(s)),o)for(const l in o)n[l]=o[l];this.recordHelper.getFieldStateParam(e,"hidden")&&(n.disabled=!0),this.recordHelper.getFieldStateParam(e,"readOnly")&&(n.readOnly=!0),null!==this.recordHelper.getFieldStateParam(e,"required")&&(n.defs.params.required=this.recordHelper.getFieldStateParam(e,"required")),this.recordHelper.hasFieldOptionList(e)&&(n.customOptionList=this.recordHelper.getFieldOptionList(e)),this.createView(e+"Field",t,n),~this.fieldList.indexOf(e)||this.fieldList.push(e)}getFocusedFieldView(){const e=(0,a.default)(window.document.activeElement);if(!e.length)return null;const t=e.closest(".field");if(!t.length)return null;var i=t.attr("data-name");return i?this.getFieldView(i):null}exit(e){}}e.default=l}),define("views/fields/int",["exports","views/fields/base","autonumeric"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{type="int";listTemplate="fields/int/list";detailTemplate="fields/int/detail";editTemplate="fields/int/edit";searchTemplate="fields/int/search";validations=["required","int","range"];thousandSeparator=",";searchTypeList=["isNotEmpty","isEmpty","equals","notEquals","greaterThan","lessThan","greaterThanOrEquals","lessThanOrEquals","between"];autoNumericOptions;autoNumericInstance=null;setup(){super.setup(),this.setupMaxLength(),this.getPreferences().has("thousandSeparator")?this.thousandSeparator=this.getPreferences().get("thousandSeparator"):this.getConfig().has("thousandSeparator")&&(this.thousandSeparator=this.getConfig().get("thousandSeparator")),this.params.disableFormatting&&(this.disableFormatting=!0)}setupFinal(){super.setupFinal(),this.setupAutoNumericOptions()}setupAutoNumericOptions(){var e=(this.disableFormatting?null:this.thousandSeparator)||"";let t="."===e?",":".";this.autoNumericOptions={digitGroupSeparator:e,decimalCharacter:t,modifyValueOnWheel:!1,decimalPlaces:0,selectOnFocus:!1,formulaMode:!0}}afterRender(){var e,t;if(super.afterRender(),this.mode===this.MODE_EDIT&&this.autoNumericOptions&&(e=this.$element.get(0),this.autoNumericInstance=new a.default(e,this.autoNumericOptions)),this.mode===this.MODE_SEARCH){const i=this.$el.find("select.search-type"),s=(this.handleSearchType(i.val()),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}),this.$element.on("input",()=>{this.trigger("change")}),this.$el.find("input.additional"));s.on("input",()=>{this.trigger("change")}),this.autoNumericOptions&&(e=this.$element.get(0),t=s.get(0),new a.default(e,this.autoNumericOptions),new a.default(t,this.autoNumericOptions))}}data(){const e=super.data();return null!==this.model.get(this.name)&&void 0!==this.model.get(this.name)&&(e.isNotEmpty=!0),e.valueIsSet=this.model.has(this.name),this.isSearchMode()&&(e.value=this.searchParams.value,"between"===this.getSearchType()&&(e.value=this.getSearchParamsData().value1||this.searchParams.value1,e.value2=this.getSearchParamsData().value2||this.searchParams.value2)),this.isEditMode()&&(e.value=this.model.get(this.name)),e}getValueForDisplay(){var e=isNaN(this.model.get(this.name))?null:this.model.get(this.name);return this.formatNumber(e)}formatNumber(e){return this.disableFormatting?e:this.formatNumberDetail(e)}formatNumberDetail(e){if(null===e)return"";let t=e.toString();return t=t.replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandSeparator)}setupSearch(){this.events["change select.search-type"]=e=>{this.handleSearchType($(e.currentTarget).val())}}handleSearchType(e){const t=this.$el.find("input.additional"),i=this.$el.find('input[data-name="'+this.name+'"]');"between"===e?(t.removeClass("hidden"),i.removeClass("hidden")):~["isEmpty","isNotEmpty"].indexOf(e)?(t.addClass("hidden"),i.addClass("hidden")):(t.addClass("hidden"),i.removeClass("hidden"))}getMaxValue(){let e=this.model.getFieldParam(this.name,"max")||null;return e||0===e||(e=null),e="max"in this.params?this.params.max:e}getMinValue(){let e=this.model.getFieldParam(this.name,"min");return e||0===e||(e=null),e="min"in this.params?this.params.min:e}setupMaxLength(){let e=this.getMaxValue();"undefined"!=typeof max&&null!==max&&(e=this.formatNumber(e),this.params.maxLength=e.toString().length)}validateInt(){var e=this.model.get(this.name);if(isNaN(e))return e=this.translate("fieldShouldBeInt","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}validateRange(){var e=this.model.get(this.name);if(null===e)return!1;var t,i=this.getMinValue(),s=this.getMaxValue();if(null!==i&&null!==s){if(e<i||s<e)return t=this.translate("fieldShouldBeBetween","messages").replace("{field}",this.getLabelText()).replace("{min}",i).replace("{max}",s),this.showValidationMessage(t),!0}else if(null!==i){if(e<i)return t=this.translate("fieldShouldBeGreater","messages").replace("{field}",this.getLabelText()).replace("{value}",i),this.showValidationMessage(t),!0}else if(null!==s)if(s<e)return i=this.translate("fieldShouldBeLess","messages").replace("{field}",this.getLabelText()).replace("{value}",s),this.showValidationMessage(i),!0}validateRequired(){if(this.isRequired()){var e=this.model.get(this.name);if(null===e||!1===e)return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}}parse(e){return null===(e=""!==e?e:null)?null:-1!==(e=e.split(this.thousandSeparator).join("")).indexOf(".")||-1!==e.indexOf(",")?NaN:parseInt(e)}fetch(){var e=this.$element.val(),e=this.parse(e);const t={};return t[this.name]=e,t}fetchSearch(){var e=this.parse(this.$element.val()),t=this.fetchSearchType();let i;if(isNaN(e))return!1;if("between"===t){var s=this.parse(this.$el.find("input.additional").val());if(isNaN(s))return!1;i={type:t,value:[e,s],data:{value1:e,value2:s}}}else i="isEmpty"===t?{type:"isNull",typeFront:"isEmpty"}:"isNotEmpty"===t?{type:"isNotNull",typeFront:"isNotEmpty"}:{type:t,value:e,data:{value1:e}};return i}getSearchType(){return this.searchParams.typeFront||this.searchParams.type}}e.default=s}),define("helpers/record-modal",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.metadata=e,this.acl=t}showDetail(t,e){var i=e.id,s=e.scope,a=e.model;if(!i||!s)return console.error("Bad data."),Promise.reject();if(a&&!this.acl.checkScope(a.entityType,"read"))return Promise.reject();var o=this.metadata.get(["clientDefs",s,"modalViews","detail"])||"views/modals/detail",s=(Espo.Ui.notify(" ... "),{scope:s,model:a,id:i,quickEditDisabled:e.editDisabled,rootUrl:e.rootUrl});return t.createView("modal",o,s,e=>{e.render().then(()=>Espo.Ui.notify(!1)),t.listenToOnce(e,"remove",()=>{t.clearView("modal")})})}}}),define("helpers/action-item-setup",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.metadata=e,this.viewHelper=t,this.acl=i,this.language=s}setup(a,e,i,o,t,n,s){s=s||{};const l=[],r=a.scope||a.model.entityType;if(!r)throw new Error;const h=[...this.metadata.get(["clientDefs","Global",e+"ActionList"])||[],...this.metadata.get(["clientDefs",r,e+"ActionList"])||[]];if(h.forEach(s=>{"string"==typeof s&&(s={name:s});var e=(s=Espo.Utils.cloneDeep(s)).name;s.label||(s.html=this.language.translate(e,"actions",r)),s.data=s.data||{};const t=s.handler||s.data.handler;t&&!s.data.handler&&(s.data.handler=t),o(s),Espo.Utils.checkActionAvailability(this.viewHelper,s)&&(Espo.Utils.checkActionAccess(this.acl,a.model,s,!0)||(s.hidden=!0),l.push(s),t&&(s.initFunction||s.checkVisibilityFunction)&&i(new Promise(i=>{Espo.loader.require(t,e=>{const t=new e(a);s.initFunction&&t[s.initFunction].call(t),s.checkVisibilityFunction&&!t[s.checkVisibilityFunction].call(t)&&n(s.name),s.handlerInstance=t,i()})})))}),l.length){const d=()=>{l.forEach(e=>{if(e.handlerInstance&&e.checkVisibilityFunction&&!e.handlerInstance[e.checkVisibilityFunction].call(e.handlerInstance))return void n(e.name);(Espo.Utils.checkActionAccess(this.acl,a.model,e,!0)?t:n)(e.name)})};s.listenToViewModelSync?a.listenTo(a,"model-sync",()=>d()):a.listenTo(a.model,"sync",()=>d())}}}}),define("utils",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const i=/Mac/.test(navigator.userAgent),s=(Espo.Utils={handleAction:function(i,s,e,t){t=t||{};const a=$(e);var o=t.action||a.data("action");const n=a.data("name")||o;let l,r;if(n&&t.actionItems&&(!t.className||e.classList.contains(t.className))){const d=t.actionItems.find(e=>e.name===n||e.action===n);if(d&&d.onClick)return d.onClick(),!0;d&&(r=d.handler,l=d.actionFunction)}if(!o&&!t.actionFunction&&!l)return!1;if(s.ctrlKey||s.metaKey||s.shiftKey){e=a.attr("href");if(e&&"javascript:"!==e)return!1}const d=a.data();l=t.actionFunction||l||"action"+Espo.Utils.upperCaseFirst(o);let h=!1;return(r=t.handler||r||d.handler)?(s.preventDefault(),s.stopPropagation(),h=!0,Espo.loader.require(r,e=>{const t=new e(i);t[l].call(t,d,s)})):"function"==typeof i[l]&&(i[l].call(i,d,s),s.preventDefault(),s.stopPropagation(),h=!0),!!h&&(this._processAfterActionDropdown(a),!0)},_processAfterActionDropdown:function(e){const t=e.closest(".dropdown-menu");if(t.length){const i=t.parent().find('[data-toggle="dropdown"]');if(i.length){let e=!1;i.attr("disabled")&&(e=!0,i.removeAttr("disabled").removeClass("disabled")),i.dropdown("toggle"),i.focus(),e&&i.attr("disabled","disabled").addClass("disabled")}}},checkActionAvailability:function(e,s){const a=e.config;if(s.configCheck){let e=s.configCheck,t=!1,i=("!"===e.substring(0,1)&&(t=!0,e=e.substring(1)),a.getByPath(e.split(".")));if(!(i=t?!i:i))return!1}return!0},checkActionAccess:function(e,t,i,s){let a=!0;return i.acl?a=i.aclScope?e.check(i.aclScope,i.acl):t?"string"==typeof t||t instanceof String?e.check(t,i.acl):e.checkModel(t,i.acl,s):e.check(i.scope,i.acl):i.aclScope&&(a=e.checkScope(i.aclScope)),a},checkAccessDataList:function(e,t,i,s,a){if(!e||!e.length)return!0;for(const o in e){const n=e[o];if(n.scope){if(n.action){if(!t.check(n.scope,n.action))return!1}else if(!t.checkScope(n.scope))return!1}else if(n.action&&s&&!t.check(s,n.action))return!1;if(n.teamIdList&&i&&(!a||!i.isAdmin())){let t=!1;if(i.getLinkMultipleIdList("teams").forEach(e=>{~n.teamIdList.indexOf(e)&&(t=!0)}),!t)return!1}if(n.portalIdList&&i&&(!a||!i.isAdmin())){let t=!1;if(i.getLinkMultipleIdList("portals").forEach(e=>{~n.portalIdList.indexOf(e)&&(t=!0)}),!t)return!1}if(n.isPortalOnly){if(i&&(!a||!i.isAdmin())&&!i.isPortal())return!1}else if(n.inPortalDisabled&&i&&(!a||!i.isAdmin())&&i.isPortal())return!1;if(n.isAdminOnly&&i&&!i.isAdmin())return!1}return!0},convert:function(e,t){if(null===e)return e;let i=e;switch(t){case"c-h":case"C-h":i=Espo.Utils.camelCaseToHyphen(e);break;case"h-c":i=Espo.Utils.hyphenToCamelCase(e);break;case"h-C":i=Espo.Utils.hyphenToUpperCamelCase(e)}return i},isObject:function(e){return null!==e&&"object"==typeof e},clone:function(e){return Espo.Utils.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},cloneDeep:function(e){if(e=Espo.Utils.clone(e),Espo.Utils.isObject(e)||_.isArray(e))for(const t in e)e[t]=this.cloneDeep(e[t]);return e},composeClassName:function(e,t,i){return e?(e=this.camelCaseToHyphen(e),t=this.camelCaseToHyphen(t).split(".").join("/"),e+":"+(i=this.camelCaseToHyphen(i||""))+"/"+t):i+"/"+(t=this.camelCaseToHyphen(t).split(".").join("/"))},composeViewClassName:function(e){return e&&e[0]===e[0].toLowerCase()?e:-1!==e.indexOf(":")?(t=(i=e.split(":"))[0],i=i[1],(t=this.camelCaseToHyphen(t))+":views/"+(i=this.camelCaseToHyphen(i).split(".").join("/"))):"views/"+(e=this.camelCaseToHyphen(e).split(".").join("/"));var t,i},toDom:function(e){return Espo.Utils.convert(e,"c-h").split(".").join("-")},lowerCaseFirst:function(e){return null===e?e:e.charAt(0).toLowerCase()+e.slice(1)},upperCaseFirst:function(e){return null===e?e:e.charAt(0).toUpperCase()+e.slice(1)},hyphenToUpperCamelCase:function(e){return null===e?e:this.upperCaseFirst(e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}))},hyphenToCamelCase:function(e){return null===e?e:e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},camelCaseToHyphen:function(e){return null===e?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},trimSlash:function(e){return"/"===e.slice(-1)?e.slice(0,-1):e},parseUrlOptionsParam:function(e){if(!e)return{};if(-1===e.indexOf("&")&&-1===e.indexOf("="))return{};const t={};return void 0!==e&&e.split("&").forEach(e=>{e=e.split("=");t[e[0]]=!0,1<e.length&&(t[e[0]]=e[1])}),t},getKeyFromKeyEvent:function(e){let t=e.code;return t=s[t]||t,e.shiftKey&&(t="Shift+"+t),e.altKey&&(t="Alt+"+t),t=(i?e.metaKey:e.ctrlKey)?"Control+"+t:t},generateId:function(){return Math.floor(10000001*Math.random()).toString()},obtainBaseUrl:function(){let e=window.location.origin+window.location.pathname;return e="/"!==e.slice(-1)?window.location.pathname.includes(".")?e.slice(0,e.lastIndexOf("/"))+"/":e+"/":e}},{NumpadEnter:"Enter"});Espo.utils=Espo.Utils;var t=Espo.Utils;e.default=t}),define("search-manager",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s,a,o){if(this.collection=e,this.scope=e.entityType,this.storage=i,this.type=t||"list",this.dateTime=s,this.emptyOnReset=o,this.emptyData={textFilter:"",bool:{},advanced:{},primary:null},a){this.defaultData=a;for(const n in this.emptyData)n in a||(a[n]=Espo.Utils.clone(this.emptyData[n]))}this.data=Espo.Utils.clone(a)||this.emptyData,this.sanitizeData()}sanitizeData(){"advanced"in this.data||(this.data.advanced={}),"bool"in this.data||(this.data.bool={}),"textFilter"in this.data||(this.data.textFilter="")}getWhere(){const e=[];if(this.data.textFilter&&""!==this.data.textFilter&&e.push({type:"textFilter",value:this.data.textFilter}),this.data.bool){const s={type:"bool",value:[]};for(const a in this.data.bool)this.data.bool[a]&&s.value.push(a);s.value.length&&e.push(s)}var t;if(!this.data.primary||(t={type:"primary",value:this.data.primary}).value.length&&e.push(t),this.data.advanced)for(const o in this.data.advanced){var i=this.data.advanced[o];i&&(i=this.getWherePart(o,i),e.push(i))}return e}getWherePart(e,t){let i=e;if("object"!=typeof t)return console.error("Bad where clause"),{};if("where"in t)return t.where;e=t.type;let s;if("or"!==e&&"and"!==e)return"field"in t&&(i=t.field),"attribute"in t&&(i=t.attribute),t.dateTime?{type:e,attribute:i,value:t.value,dateTime:!0,timeZone:this.dateTime.timeZone||"UTC"}:(s=t.value,{type:e,attribute:i,value:s});{const a=[];for(const o in s=t.value||{})a.push(this.getWherePart(o,s[o]));return{type:e,value:a}}}loadStored(){return this.data=this.storage.get(this.type+"Search",this.scope)||Espo.Utils.clone(this.defaultData)||Espo.Utils.clone(this.emptyData),this.sanitizeData(),this}get(){return this.data}setAdvanced(e){this.data=Espo.Utils.clone(this.data),this.data.advanced=e}setBool(e){this.data=Espo.Utils.clone(this.data),this.data.bool=e}setPrimary(e){this.data=Espo.Utils.clone(this.data),this.data.primary=e}set(e){this.data=e,this.storage&&(delete(e=Espo.Utils.clone(e)).textFilter,this.storage.set(this.type+"Search",this.scope,e))}empty(){this.data=Espo.Utils.clone(this.emptyData),this.storage&&this.storage.clear(this.type+"Search",this.scope)}reset(){this.emptyOnReset?this.empty():(this.data=Espo.Utils.clone(this.defaultData)||Espo.Utils.clone(this.emptyData),this.storage&&this.storage.clear(this.type+"Search",this.scope))}}}),define("model",["exports","bullbone","underscore"],function(e,t,d){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,d=(i=d)&&i.__esModule?i:{default:i};class s{urlRoot=null;url=null;name=null;entityType=null;lastSyncPromise=null;_pending;_changing;constructor(e,t){t=t||{},this.idAttribute="id",this.id=null,this.cid=d.default.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),this.set(e||{}),this.defs=t.defs||{},this.defs.fields||(this.defs.fields={}),t.entityType&&(this.entityType=t.entityType,this.name=t.entityType,this.urlRoot=t.entityType),this.urlRoot=t.urlRoot||this.urlRoot,this.url=t.url||this.url,this.dateTime=t.dateTime||null,this.changed={},this._previousAttributes=null}sync(e,t,s){var i={create:"POST",update:"PUT",patch:"PUT",delete:"DELETE",read:"GET"}[e];if(!i)throw new Error(`Bad request method '${e}'.`);s=s||{};var a=this.composeSyncUrl();if(!a)throw new Error("No 'url'.");e=t&&["create","update","patch"].includes(e)?s.attributes||t.getClonedAttributes():null;const o=s.error;s.error=(e,t,i)=>{s.textStatus=t,s.errorThrown=i,o&&o.call(s.context,e,t,i)};var n=e?JSON.stringify(e):null,n=s.bypassRequest?Promise.resolve():Espo.Ajax.request(a,i,n,s);return s.xhr=n.xhr,t.trigger("request",a,i,e,n,s),n}set(e,t,i){if(null==e)return this;let s;return"object"==typeof e?this.setMultiple(e,t):((s={})[e]=t,this.setMultiple(s,i))}setMultiple(e,t){this.idAttribute in e&&(this.id=e[this.idAttribute]),t=t||{};const i=[];var s=this._changing;this._changing=!0,s||(this._previousAttributes=d.default.clone(this.attributes),this.changed={});const a=this.attributes,o=this.changed;var n=this._previousAttributes;for(const r in e){var l=e[r];d.default.isEqual(a[r],l)||i.push(r),d.default.isEqual(n[r],l)?delete o[r]:o[r]=l,t.unset?delete a[r]:a[r]=l}if(!t.silent){i.length&&(this._pending=t);for(let e=0;e<i.length;e++)this.trigger("change:"+i[e],this,a[i[e]],t)}if(s)return this;if(!t.silent)for(;this._pending;)t=this._pending,this._pending=!1,this.trigger("change",this,t);return this._pending=!1,this._changing=!1,this}unset(e,t){t={...t,unset:!0};const i={};return i[e]=null,this.setMultiple(i,t)}get(e){return e===this.idAttribute&&this.id?this.id:this.attributes[e]}has(e){return void 0!==this.get(e)}clear(e){const t={};for(const i in this.attributes)t[i]=void 0;return e={...e,unset:!0},this.set(t,e)}isNew(){return!this.id}hasChanged(e){return e?d.default.has(this.changed,e):!d.default.isEmpty(this.changed)}changedAttributes(){return this.hasChanged()?d.default.clone(this.changed):{}}previousAttributes(){return d.default.clone(this._previousAttributes)}previous(e){return this._previousAttributes?this._previousAttributes[e]:null}fetch(i){const s=(i={...i}).success;return i.success=e=>{var t=this.prepareAttributes(e,i);this.set(t,i),s&&s.call(i.context,this,e,i),this.trigger("sync",this,e,i)},this.lastSyncPromise=this.sync("read",this,i),this.lastSyncPromise}save(e,i){i={...i},e&&!i.wait&&this.setMultiple(e,i);const s=i.success,a=this.attributes,t=(i.success=e=>{this.attributes=a;let t=this.prepareAttributes(e,i);(t=i.wait?{...a,...t}:t)&&this.setMultiple(t,i),s&&s.call(i.context,this,e,i),this.trigger("sync",this,e,i)},i.error);i.error=e=>{t&&t.call(i.context,this,e,i),this.trigger("error",this,e,i)},e&&i.wait&&(this.attributes={...a,...e});var o=this.isNew()?"create":i.patch?"patch":"update",e=("patch"==o&&(i.attributes=e),this.sync(o,this,i));return this.attributes=a,e}destroy(t){const i=(t=d.default.clone(t||{})).success,s=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,t)};if(t.success=e=>{t.wait&&s(),i&&i.call(t.context,this,e,t),this.isNew()||this.trigger("sync",this,e,t)},this.isNew())return d.default.defer(t.success),t.wait||s(),Promise.resolve();const a=t.error;t.error=e=>{a&&a.call(t.context,this,e,t),this.trigger("error",this,e,t)};var e=this.sync("delete",this,t);return t.wait||s(),e}composeSyncUrl(){if(this.url)return this.url;let e=this.urlRoot;if(!(e=!e&&this.collection?this.collection.urlRoot:e))throw new Error("No urlRoot.");if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}prepareAttributes(e,t){return e}clone(){return new this.constructor(Espo.Utils.cloneDeep(this.attributes),{entityType:this.entityType,urlRoot:this.urlRoot,url:this.url,defs:this.defs,dateTime:this.dateTime})}setDefs(e){this.defs=e||{},this.defs.fields||(this.defs.fields={})}getClonedAttributes(){return Espo.Utils.cloneDeep(this.attributes)}populateDefaults(){let e={};for(const i in this.defs.fields){if(this.hasFieldParam(i,"default"))try{e[i]=this.parseDefaultValue(this.getFieldParam(i,"default"))}catch(e){console.error(e)}var t=this.getFieldParam(i,"defaultAttributes");if(t)for(const s in t)e[s]=t[s]}for(const a in e=Espo.Utils.cloneDeep(e))this.has(a)&&delete e[a];this.set(e,{silent:!0})}parseDefaultValue(e){var t;return"string"==typeof e&&0===e.indexOf("javascript:")&&(t=e.substring(11),e=new Function("with(this) { "+t+"}").call(this)),e}getLinkMultipleColumn(e,t,i){return((this.get(e+"Columns")||{})[i]||{})[t]}setRelate(e){const t=e=>{var t=e.link;const i=e.model;if(!t||!i)throw new Error("Bad related options");switch(this.defs.links[t].type){case"belongsToParent":this.set(t+"Id",i.id),this.set(t+"Type",i.entityType),this.set(t+"Name",i.get("name"));break;case"belongsTo":this.set(t+"Id",i.id),this.set(t+"Name",i.get("name"));break;case"hasMany":const s=[],a=(s.push(i.id),{});a[i.id]=i.get("name"),this.set(t+"Ids",s),this.set(t+"Names",a)}};"[object Array]"!==Object.prototype.toString.call(e)?t(e):e.forEach(e=>{t(e)})}getFieldList(){return this.defs&&this.defs.fields?Object.keys(this.defs.fields):[]}getFieldType(e){return this.defs&&this.defs.fields&&e in this.defs.fields&&this.defs.fields[e].type||null}getFieldParam(e,t){return this.defs&&this.defs.fields&&e in this.defs.fields&&t in this.defs.fields[e]?this.defs.fields[e][t]:null}hasFieldParam(e,t){return!(!this.defs||!this.defs.fields)&&(e in this.defs.fields&&t in this.defs.fields[e])}getLinkType(e){return this.defs&&this.defs.links&&e in this.defs.links&&this.defs.links[e].type||null}getLinkParam(e,t){return this.defs&&this.defs.links&&e in this.defs.links&&t in this.defs.links[e]?this.defs.links[e][t]:null}isFieldReadOnly(e){return this.getFieldParam(e,"readOnly")||!1}isRequired(e){return this.getFieldParam(e,"required")||!1}getLinkMultipleIdList(e){return this.get(e+"Ids")||[]}getTeamIdList(){return this.get("teamsIds")||[]}hasField(e){return"defs"in this&&"fields"in this.defs&&e in this.defs.fields}hasLink(e){return"defs"in this&&"links"in this.defs&&e in this.defs.links}isEditable(){return!0}isRemovable(){return!0}getEntityType(){return this.name}abortLastFetch(){this.lastSyncPromise&&this.lastSyncPromise.getReadyState()<4&&this.lastSyncPromise.abort()}toJSON(){return console.warn("model.toJSON is deprecated. Use 'getClonedAttributes' instead."),this.getClonedAttributes()}}Object.assign(s.prototype,t.Events),s.extend=t.View.extend,e.default=s}),define("controller",["exports","exceptions","bullbone","jquery"],function(e,a,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=i(a),o=i(o);class s{constructor(e,t){this.params=e||{},this.baseController=t.baseController,this.viewFactory=t.viewFactory,this.modelFactory=t.modelFactory,this.collectionFactory=t.collectionFactory,this._settings=t.settings||null,this._user=t.user||null,this._preferences=t.preferences||null,this._acl=t.acl||null,this._cache=t.cache||null,this._router=t.router||null,this._storage=t.storage||null,this._metadata=t.metadata||null,this._dateTime=t.dateTime||null,this._broadcastChannel=t.broadcastChannel||null,this.baseController||this.on("logout",()=>this.clearAllStoredMainViews()),this.set("masterRendered",!1)}defaultAction="index";name=null;params=null;viewFactory=null;modelFactory=null;masterView=null;setRouter(e){this._router=e,this.trigger("router-set",e)}getConfig(){return this._settings}getUser(){return this._user}getPreferences(){return this._preferences}getAcl(){return this._acl}getCache(){return this._cache}getRouter(){return this._router}getStorage(){return this._storage}getMetadata(){return this._metadata}getDateTime(){return this._dateTime}get(e){return e in this.params?this.params[e]:null}set(e,t){this.params[e]=t}unset(e){delete this.params[e]}has(e){return e in this.params}getStoredMainView(e){return this.get("storedMainView-"+e)}hasStoredMainView(e){return this.has("storedMainView-"+e)}clearStoredMainView(e){const t=this.getStoredMainView(e);t&&t.remove(!0),this.unset("storedMainView-"+e)}storeMainView(t,i){this.set("storedMainView-"+t,i),this.listenTo(i,"remove",e=>{(e=e||{}).ignoreCleaning||(this.stopListening(i,"remove"),this.clearStoredMainView(t))})}clearAllStoredMainViews(){for(const t in this.params){var e;0===t.indexOf("storedMainView-")&&(e=t.slice(15),this.clearStoredMainView(e))}}checkAccess(e){return!0}handleAccessGlobal(){if(!this.checkAccessGlobal())throw new a.default.AccessDenied("Denied access to '"+this.name+"'")}checkAccessGlobal(){return!0}handleCheckAccess(e){if(!this.checkAccess(e))throw e=e?"Denied access to action '"+this.name+"#"+e+"'":"Denied access to scope '"+this.name+"'",new a.default.AccessDenied(e)}doAction(e,t){this.handleAccessGlobal(),e=e||this.defaultAction;var i="action"+Espo.Utils.upperCaseFirst(e);if(!(i in this))throw new a.default.NotFound("Action '"+this.name+"#"+e+"' is not found");var s="before"+Espo.Utils.upperCaseFirst(e),e="after"+Espo.Utils.upperCaseFirst(e);s in this&&this[s].call(this,t||{}),this[i].call(this,t||{}),e in this&&this[e].call(this,t||{})}master(t){const e=this.get("entire");e&&(e.remove(),this.set("entire",null));var i=this.get("master");i?t.call(this,i):(i=this.masterView||"views/site/master",this.viewFactory.create(i,{fullSelector:"body"},e=>{this.set("master",e),this.get("masterRendered")?t.call(this,e):e.render().then(()=>{this.set("masterRendered",!0),t.call(this,e)})}))}_unchainMainView(e){if(e.currentViewKey&&this.hasStoredMainView(e.currentViewKey)){const t=e.getView("main");t&&(t.propagateEvent("remove",{ignoreCleaning:!0}),e.unchainView("main"))}}main(e,s,t,i={}){const a={isCanceled:!1,key:i.key,useStored:i.useStored,callback:t},o=i.useStored||!1,n=i.key,l=(this.listenToOnce(this.baseController,"action",()=>a.isCanceled=!0),e&&"object"==typeof e?e:void 0),r=l?void 0:e||"views/base";this.master(t=>{if(!a.isCanceled){if((s=s||{}).fullSelector="#main",o&&this.hasStoredMainView(n)){const l=this.getStoredMainView(n);let e=!0;l&&"isActualForReuse"in l&&"function"==typeof l.isActualForReuse&&(e=l.isActualForReuse());var i=l&&"lastUrl"in l?l.lastUrl:null;if(e&&(!i||i===this.getRouter().getCurrentUrl()))return this._processMain(l,t,a),void("setupReuse"in l&&"function"==typeof l.setupReuse&&l.setupReuse(s.params||{}));this.clearStoredMainView(n)}if(l)return this._unchainMainView(t),void t.assignView("main",l,"#main").then(()=>{a.isSet=!0,this._processMain(e,t,a)});this.viewFactory.create(r,s,e=>{this._processMain(e,t,a)})}})}_processMain(e,t,i){if(!i.isCanceled){const s=i.key,a=(s&&this.storeMainView(s,e),()=>{e.cancelRender(),i.isCanceled=!0});e.listenToOnce(this.baseController,"action",a),t.currentViewKey&&(this.set("storedScrollTop-"+t.currentViewKey,(0,o.default)(window).scrollTop()),i.isSet||this._unchainMainView(t)),t.currentViewKey=s,i.isSet||t.setView("main",e);t=()=>{setTimeout(()=>e.stopListening(this.baseController,"action",a),500),e.updatePageTitle(),i.useStored&&this.has("storedScrollTop-"+s)?(0,o.default)(window).scrollTop(this.get("storedScrollTop-"+s)):(0,o.default)(window).scrollTop(0)};if(i.callback)return this.listenToOnce(e,"after:render",t),void i.callback.call(this,e);e.render().then(t)}}showLoadingNotification(){const e=this.get("master");e&&e.showLoadingNotification()}hideLoadingNotification(){const e=this.get("master");e&&e.hideLoadingNotification()}entire(e,t,i){const s=this.get("master");if(s&&s.remove(),this.set("master",null),this.set("masterRendered",!1),"object"==typeof e)return e.setElement("body"),void this.viewFactory.prepare(e,()=>{i?i(e):e.render()});(t=t||{}).fullSelector="body",this.viewFactory.create(e,t,e=>{this.set("entire",e),i?i(e):e.render()})}}Object.assign(s.prototype,t.Events),s.extend=t.View.extend,e.default=s}),define("acl",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e,t,i){this.user=e||null,this.scope=t,this.aclAllowDeleteCreated=(i=i||{}).aclAllowDeleteCreated,this.teamsFieldIsForbidden=i.teamsFieldIsForbidden,this.forbiddenFieldList=i.forbiddenFieldList}getUser(){return this.user}checkScope(e,t,i,s){var a=(s=s||{}).inTeam,s=s.isOwner;if(this.getUser().isAdmin())return!1!==e;if(!1===e)return!1;if(!0===e)return!0;if("string"==typeof e)return!0;if(null===e)return!1;if(null===(t=t||null))return!0;if(!(t in e))return!1;e=e[t];if("all"===e)return!0;if("yes"===e)return!0;if("no"===e)return!1;if(void 0===s)return!0;if(s&&("own"===e||"team"===e))return!0;let o=!1;if("team"===e)if(null===(o=a)){if(!i)return!0;o=null}else if(a)return!0;if(null===s){if(!i)return!0;o=null}return o}checkModel(e,t,i,s){if(this.getUser().isAdmin())return!0;e={isOwner:this.checkIsOwner(e),inTeam:this.checkInTeam(e)};return this.checkScope(t,i,s,e)}checkModelDelete(e,t,i){i=this.checkModel(e,t,"delete",i);if(i)return!0;if(!1===t)return!1;if("no"===(t||{}).read)return!1;if(e.has("createdById")&&e.get("createdById")===this.getUser().id&&this.aclAllowDeleteCreated){if(!e.has("assignedUserId"))return!0;if(!e.get("assignedUserId"))return!0;if(e.get("assignedUserId")===this.getUser().id)return!0}return i}checkIsOwner(e){let t=!1;if(e.hasField("assignedUser")){if(this.getUser().id===e.get("assignedUserId"))return!0;e.has("assignedUserId")||(t=null)}else if(e.hasField("createdBy")){if(this.getUser().id===e.get("createdById"))return!0;e.has("createdById")||(t=null)}if(e.hasField("assignedUsers")){if(!e.has("assignedUsersIds"))return null;if(~(e.get("assignedUsersIds")||[]).indexOf(this.getUser().id))return!0;t=!1}return t}checkInTeam(e){const t=this.getUser().getTeamIdList();if(!e.has("teamsIds"))return!!this.teamsFieldIsForbidden||null;const i=e.getTeamIdList();let s=!1;return t.forEach(e=>{~i.indexOf(e)&&(s=!0)}),s}}i.extend=t.View.extend,e.default=i}),define("views/main",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="";name="";menu={};$headerActionsContainer=null;shortcutKeys=null;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.menu.buttons,...this.menu.dropdown],className:"main-header-manu-action"})}};lastUrl;init(){var e;this.scope=this.options.scope||this.scope,this.menu={},this.options.params=this.options.params||{},this.name&&this.scope&&(e=this.name.charAt(0).toLowerCase()+this.name.slice(1),this.menu=this.getMetadata().get(["clientDefs",this.scope,"menu",e])||{}),this.headerActionItemTypeList=["buttons","dropdown","actions"],this.menu=Espo.Utils.cloneDeep(this.menu);let i={};this.name&&(i=Espo.Utils.cloneDeep(this.getMetadata().get(["clientDefs","Global","menu",this.name.charAt(0).toLowerCase()+this.name.slice(1)])||{})),this._reRenderHeaderOnSync=!1,this._menuHandlers={},this.headerActionItemTypeList.forEach(e=>{this.menu[e]=this.menu[e]||[],this.menu[e]=this.menu[e].concat(i[e]||[]);const t=this.menu[e];t.forEach(s=>{const a=this;(s.initFunction||s.checkVisibilityFunction)&&(s.handler||s.data&&s.data.handler)&&this.wait(new Promise(i=>{var e=s.handler||s.data.handler;Espo.loader.require(e,e=>{const t=new e(a);e=s.name||s.action;e&&(this._menuHandlers[e]=t),s.initFunction&&t[s.initFunction].call(t),s.checkVisibilityFunction&&this.model&&(this._reRenderHeaderOnSync=!0),i()})}))})}),this.model&&this.whenReady().then(()=>{this._reRenderHeaderOnSync&&this.listenTo(this.model,"sync",()=>{this.getHeaderView()&&this.getHeaderView().reRender()})}),this.updateLastUrl(),this.on("after:render-internal",()=>{this.$headerActionsContainer=this.$el.find(".page-header .header-buttons")}),this.on("header-rendered",()=>{this.$headerActionsContainer=this.$el.find(".page-header .header-buttons"),this.adjustButtons()}),this.on("after:render",()=>this.adjustButtons()),this.shortcutKeys&&(this.shortcutKeys=Espo.Utils.cloneDeep(this.shortcutKeys))}setupFinal(){this.shortcutKeys&&(this.events["keydown.main"]=e=>{var t,i,s=Espo.Utils.getKeyFromKeyEvent(e);"function"!=typeof this.shortcutKeys[s]?(t=this.shortcutKeys[s])&&(e.preventDefault(),e.stopPropagation(),"function"!=typeof this[i="action"+Espo.Utils.upperCaseFirst(t)]?this[t]():this[i]()):this.shortcutKeys[s].call(this,e.originalEvent)})}updateLastUrl(){this.lastUrl=this.getRouter().getCurrentUrl()}getMenu(){if(this.menuDisabled||!this.menu)return{};const s={};return this.headerActionItemTypeList.forEach(i=>{(this.menu[i]||[]).forEach(e=>{if(!1!==e){if(e=Espo.Utils.clone(e),s[i]=s[i]||[],Espo.Utils.checkActionAvailability(this.getHelper(),e)&&Espo.Utils.checkActionAccess(this.getAcl(),this.model||this.scope,e)&&(!e.accessDataList||Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))){if(e.name=e.name||e.action,e.action=e.action||null,this._menuHandlers[e.name]&&e.checkVisibilityFunction){const t=this._menuHandlers[e.name];if(!t[e.checkVisibilityFunction](e.name))return}e.labelTranslation&&(e.html=this.getHelper().escapeString(this.getLanguage().translatePath(e.labelTranslation))),s[i].push(e)}}else s[i].push(!1)})}),s}getHeader(){return""}buildHeaderHtml(e){const i=e.map(e=>$("<div>").addClass("breadcrumb-item").append(e)),s=$("<div>").addClass("header-breadcrumbs");return i.forEach((e,t)=>{s.append(e),t!==i.length-1&&s.append($("<div>").addClass("breadcrumb-separator").append($("<span>").addClass("chevron-right")))}),s.get(0).outerHTML}getHeaderIconHtml(){return this.getHelper().getScopeColorIconHtml(this.scope)}actionShowModal(e){e=e.view;e&&this.createView("modal",e,{model:this.model,collection:this.collection},e=>{e.render(),this.listenTo(e,"after:save",()=>{this.model&&this.model.fetch(),this.collection&&this.collection.fetch()})})}addMenuItem(e,t,i,s){if(t){t.name=t.name||t.action||Espo.Utils.generateId();const o=t.name;let i=-1;this.menu[e].forEach((e,t)=>{(e=e||{}).name===o&&(i=t)}),~i&&this.menu[e].splice(i,1)}let a=i?"unshift":"push";this.menu[e][a](t),s||!this.isRendered()?!s&&this.isBeingRendered()&&this.once("after:render",()=>{this.getHeaderView().reRender()}):this.getHeaderView().reRender()}removeMenuItem(s,e){let a=-1,o=!1;this.headerActionItemTypeList.forEach(i=>{(this.menu[i]||[]).forEach((e,t)=>{(e=e||{}).name===s&&(a=t,o=i)})}),~a&&o&&this.menu[o].splice(a,1),e||!this.isRendered()?e||!this.isBeingRendered()?e&&this.isRendered()&&this.$headerActionsContainer.find('[data-name="'+s+'"]').remove():this.once("after:render",()=>{this.getHeaderView().reRender()}):this.getHeaderView().reRender()}disableMenuItem(e){this.$headerActionsContainer&&this.$headerActionsContainer.find('[data-name="'+e+'"]').addClass("disabled").attr("disabled")}enableMenuItem(e){this.$headerActionsContainer&&this.$headerActionsContainer.find('[data-name="'+e+'"]').removeClass("disabled").removeAttr("disabled")}actionNavigateToRoot(e,t){t.stopPropagation(),this.getRouter().checkConfirmLeaveOut(()=>{var e=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope;this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.scope,null,{isReturn:!0})})}hideHeaderActionItem(t){this.headerActionItemTypeList.forEach(e=>{(this.menu[e]||[]).forEach(e=>{(e=e||{}).name===t&&(e.hidden=!0)})}),this.isRendered()&&(this.$headerActionsContainer.find('li > .action[data-name="'+t+'"]').parent().addClass("hidden"),this.$headerActionsContainer.find('a.action[data-name="'+t+'"]').addClass("hidden"),this.controlMenuDropdownVisibility(),this.adjustButtons())}showHeaderActionItem(t){this.headerActionItemTypeList.forEach(e=>{(this.menu[e]||[]).forEach(e=>{(e=e||{}).name===t&&(e.hidden=!1)})});const e=()=>{this.$headerActionsContainer.find('li > .action[data-name="'+t+'"]').parent().removeClass("hidden"),this.$headerActionsContainer.find('a.action[data-name="'+t+'"]').removeClass("hidden"),this.controlMenuDropdownVisibility(),this.adjustButtons()};this.isRendered()?e():this.isBeingRendered()&&this.whenRendered().then(()=>e())}hasMenuVisibleDropdownItems(){let t=!1;return(this.menu.dropdown||[]).forEach(e=>{e.hidden||(t=!0)}),t}controlMenuDropdownVisibility(){const e=this.$headerActionsContainer.find(".dropdown-group");if(this.hasMenuVisibleDropdownItems())return e.removeClass("hidden"),void e.find("> button").removeClass("hidden");e.addClass("hidden"),e.find("> button").addClass("hidden")}getHeaderView(){return this.getView("header")}adjustButtons(){const e=this.$headerActionsContainer.find(".btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter(":not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right")}setupReuse(e){}}e.default=s}),define("views/base",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{constructor(e){super(e)}}e.default=s}),define("views/record/detail",["exports","views/record/base","view-record-helper","helpers/action-item-setup"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class o extends t.default{constructor(e){super(e)}template="record/detail";type="detail";layoutName="detail";detailLayout=null;fieldsMode="detail";mode="detail";gridLayout=null;buttonsDisabled=!1;isNew=!1;buttonList=[{name:"edit",label:"Edit",title:"Ctrl+Space"}];dropdownItemList=[{name:"delete",label:"Remove"}];buttonEditList=[{name:"save",label:"Save",style:"primary",edit:!0,title:"Ctrl+Enter"},{name:"cancelEdit",label:"Cancel",edit:!0,title:"Esc"}];dropdownEditItemList=[];allActionItemsDisabled=!1;id=null;returnUrl=null;returnDispatchParams=null;middleView="views/record/detail-middle";sideView="views/record/detail-side";bottomView="views/record/detail-bottom";sideDisabled=!1;bottomDisabled=!1;gridLayoutType="record";editModeDisabled=!1;navigateButtonsDisabled=!1;readOnly=!1;isWide=!1;duplicateAction=!0;selfAssignAction=!1;printPdfAction=!0;convertCurrencyAction=!0;saveAndContinueEditingAction=!0;inlineEditDisabled=!1;portalLayoutDisabled=!1;panelSoftLockedTypeList=["default","acl","delimiter","dynamicLogic"];dynamicLogicDefs={};confirmLeaveDisabled=!1;setupHandlerType="record/detail";currentTab=0;middlePanelDefs=null;middlePanelDefsList=null;$middle=null;$bottom=null;$detailButtonContainer=null;blockUpdateWebSocketPeriod=500;stickButtonsFormBottomSelector;dynamicHandlerClassName;accessControlDisabled;inlineEditModeIsOn=!1;shortcutKeyCtrlEnterAction="save";shortcutKeys={"Control+Enter":function(e){this.handleShortcutKeyCtrlEnter(e)},"Control+Alt+Enter":function(e){this.handleShortcutKeyCtrlAltEnter(e)},"Control+KeyS":function(e){this.handleShortcutKeyCtrlS(e)},"Control+Space":function(e){this.handleShortcutKeyCtrlSpace(e)},Escape:function(e){this.handleShortcutKeyEscape(e)},"Control+Backslash":function(e){this.handleShortcutKeyControlBackslash(e)},"Control+ArrowLeft":function(e){this.handleShortcutKeyControlArrowLeft(e)},"Control+ArrowRight":function(e){this.handleShortcutKeyControlArrowRight(e)}};events={"click .button-container .action":function(e){const t=e.currentTarget;let i=void 0;t.classList.contains("detail-action-item")?i=[...this.buttonList,...this.dropdownItemList]:t.classList.contains("edit-action-item")&&(i=[...this.buttonEditList,...this.dropdownEditItemList]),Espo.Utils.handleAction(this,e.originalEvent,t,{actionItems:i})},'click [data-action="showMoreDetailPanels"]':function(){this.showMoreDetailPanels()},"click .middle-tabs > button":function(e){e=parseInt($(e.currentTarget).attr("data-tab"));this.selectTab(e)}};actionEdit(){if(!this.editModeDisabled)return this.setEditMode(),this.focusOnFirstDiv(),void $(window).scrollTop(0);const e={id:this.model.id,model:this.model};this.options.rootUrl&&(e.rootUrl=this.options.rootUrl),this.getRouter().navigate("#"+this.scope+"/edit/"+this.model.id,{trigger:!1}),this.getRouter().dispatch(this.scope,"edit",e)}actionDelete(){this.delete()}actionSave(e){const t=this.mode;e=this.save((e=e||{}).options).catch(e=>(t===this.MODE_EDIT&&"error"===e&&this.setEditMode(),Promise.reject(e)));return this.lastSaveCancelReason&&"notModified"!==this.lastSaveCancelReason||(this.setDetailMode(),this.focusOnFirstDiv(),$(window).scrollTop(0)),e}actionCancelEdit(){this.cancelEdit(),this.focusOnFirstDiv(),$(window).scrollTop(0)}focusOnFirstDiv(){const e=this.$el.find("> div").get(0);e&&e.focus({preventScroll:!0})}actionSaveAndContinueEditing(e){this.save((e=e||{}).options).catch(()=>{})}actionSelfAssign(){const e={assignedUserId:this.getUser().id,assignedUserName:this.getUser().get("name")};if("getSelfAssignAttributes"in this){var t=this.getSelfAssignAttributes();if(t)for(const i in t)e[i]=t[i]}this.model.save(e,{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Self-Assigned"))})}actionConvertCurrency(){this.createView("modalConvertCurrency","views/modals/convert-currency",{entityType:this.entityType,model:this.model},e=>{e.render(),this.listenToOnce(e,"after:update",e=>{let t=!1;for(const i in e)if(e[i]!==this.model.get(i)){t=!0;break}t?this.model.fetch().then(()=>{Espo.Ui.success(this.translate("done","messages"))}):Espo.Ui.warning(this.translate("notUpdated","messages"))})})}getSelfAssignAttributes(){return null}setupActionItems(){if(this.model.isNew()?(this.isNew=!0,this.removeActionItem("delete")):this.getMetadata().get(["clientDefs",this.scope,"removeDisabled"])&&this.removeActionItem("delete"),this.duplicateAction&&this.getAcl().check(this.entityType,"create")&&!this.getMetadata().get(["clientDefs",this.scope,"duplicateDisabled"])&&this.addDropdownItem({label:"Duplicate",name:"duplicate"}),this.selfAssignAction&&(!this.getAcl().check(this.entityType,"edit")||~this.getAcl().getScopeForbiddenFieldList(this.entityType).indexOf("assignedUser")||this.getUser().isPortal()||this.model.has("assignedUserId")&&(this.dropdownItemList.push({label:"Self-Assign",name:"selfAssign",hidden:!!this.model.get("assignedUserId")}),this.listenTo(this.model,"change:assignedUserId",()=>{this.model.get("assignedUserId")?this.hideActionItem("selfAssign"):this.showActionItem("selfAssign")}))),this.type===this.TYPE_DETAIL&&this.printPdfAction){let e=!0;(e=~(this.getHelper().getAppParam("templateEntityTypeList")||[]).indexOf(this.entityType)?e:!1)&&this.dropdownItemList.push({label:"Print to PDF",name:"printPdf"})}if(this.type===this.TYPE_DETAIL&&this.convertCurrencyAction&&this.getAcl().check(this.entityType,"edit")&&!this.getMetadata().get(["clientDefs",this.scope,"convertCurrencyDisabled"])&&this.getFieldManager().getEntityTypeFieldList(this.entityType,{type:"currency",acl:"edit"}).length&&this.addDropdownItem({label:"Convert Currency",name:"convertCurrency"}),this.type===this.TYPE_DETAIL&&this.getMetadata().get(["scopes",this.scope,"hasPersonalData"])&&"yes"===this.getAcl().getPermissionLevel("dataPrivacyPermission")&&this.dropdownItemList.push({label:"View Personal Data",name:"viewPersonalData"}),this.type===this.TYPE_DETAIL&&this.getMetadata().get(["scopes",this.scope,"stream"])&&this.addDropdownItem({label:"View Followers",name:"viewFollowers"}),this.type===this.TYPE_DETAIL){const e=new s.default(this.getMetadata(),this.getHelper(),this.getAcl(),this.getLanguage());e.setup(this,this.type,e=>this.wait(e),e=>this.addDropdownItem(e),e=>this.showActionItem(e),e=>this.hideActionItem(e)),this.saveAndContinueEditingAction&&this.dropdownEditItemList.push({name:"saveAndContinueEditing",label:"Save & Continue Editing",title:"Ctrl+S"})}}disableActionItems(){this.disableButtons()}enableActionItems(){this.enableButtons()}hideActionItem(e){for(const t of this.buttonList)if(t.name===e){t.hidden=!0;break}for(const i of this.dropdownItemList)if(i.name===e){i.hidden=!0;break}for(const s of this.dropdownEditItemList)if(s.name===e){s.hidden=!0;break}for(const a of this.buttonEditList)if(a.name===e){a.hidden=!0;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().addClass("hidden"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').addClass("hidden"),this.isDropdownItemListEmpty()&&this.$dropdownItemListButton.addClass("hidden"),this.isDropdownEditItemListEmpty()&&this.$dropdownEditItemListButton.addClass("hidden"),this.adjustButtons())}showActionItem(e){for(const t of this.buttonList)if(t.name===e){t.hidden=!1;break}for(const i of this.dropdownItemList)if(i.name===e){i.hidden=!1;break}for(const s of this.dropdownEditItemList)if(s.name===e){s.hidden=!1;break}for(const a of this.buttonEditList)if(a.name===e){a.hidden=!1;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().removeClass("hidden"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').removeClass("hidden"),this.isDropdownItemListEmpty()||this.$dropdownItemListButton.removeClass("hidden"),this.isDropdownEditItemListEmpty()||this.$dropdownEditItemListButton.removeClass("hidden"),this.adjustButtons())}disableActionItem(e){for(const t of this.buttonList)if(t.name===e){t.disabled=!0;break}for(const i of this.dropdownItemList)if(i.name===e){i.disabled=!0;break}for(const s of this.dropdownEditItemList)if(s.name===e){s.disabled=!0;break}for(const a of this.buttonEditList)if(a.name===e){a.disabled=!0;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().addClass("disabled").attr("disabled","disabled"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').addClass("disabled").attr("disabled","disabled"))}enableActionItem(e){for(const t of this.buttonList)if(t.name===e){t.disabled=!1;break}for(const i of this.dropdownItemList)if(i.name===e){i.disabled=!1;break}for(const s of this.dropdownEditItemList)if(s.name===e){s.disabled=!1;break}for(const a of this.buttonEditList)if(a.name===e){a.disabled=!1;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().removeClass("disabled").removeAttr("disabled"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').removeClass("disabled").removeAttr("disabled"))}hasAvailableActionItem(t){if(this.allActionItemsDisabled)return!1;if(this.type===this.TYPE_DETAIL&&this.mode===this.MODE_EDIT){const e=-1!==this.buttonEditList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden);return e?!0:-1!==this.dropdownEditItemList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden)}const e=-1!==this.buttonList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden);return!!e||-1!==this.dropdownItemList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden)}showPanel(t,i){if(!this.recordHelper.getPanelStateParam(t,"hiddenLocked")&&(i=i||"default",this.recordHelper.setPanelStateParam(t,"hidden"+Espo.Utils.upperCaseFirst(i)+"Locked",!1),"dynamicLogic"!==i||!1!==this.recordHelper.getPanelStateParam(t,"hidden"))){for(let e=0;e<this.panelSoftLockedTypeList.length;e++){var s=this.panelSoftLockedTypeList[e];if(s!==i){s="hidden"+Espo.Utils.upperCaseFirst(s)+"Locked";if(this.recordHelper.getPanelStateParam(t,s))return}}const e=this.getMiddleView(),a=(e&&e.showPanelInternal(t),this.getBottomView()),o=(a?"showPanel"in a&&a.showPanel(t):this.bottomView&&this.once("ready",()=>{const e=this.getBottomView();e&&("processShowPanel"in e?e.processShowPanel(t):"showPanel"in e&&e.showPanel(t))}),this.getSideView());o?"showPanel"in o&&o.showPanel(t):this.sideView&&this.once("ready",()=>{const e=this.getSideView();e&&("processShowPanel"in e?e.processShowPanel(t):"showPanel"in e&&e.showPanel(t))}),this.recordHelper.setPanelStateParam(t,"hidden",!1),this.middlePanelDefs[t]&&(this.controlTabVisibilityShow(this.middlePanelDefs[t].tabNumber),this.adjustMiddlePanels()),this.recordHelper.trigger("panel-show")}}hidePanel(t,e,i){if(i=i||"default",e&&this.recordHelper.setPanelStateParam(t,"hiddenLocked",!0),i&&this.recordHelper.setPanelStateParam(t,"hidden"+Espo.Utils.upperCaseFirst(i)+"Locked",!0),"dynamicLogic"!==i||!0!==this.recordHelper.getPanelStateParam(t,"hidden")){const s=this.getMiddleView(),a=(s&&s.hidePanelInternal(t),this.getBottomView()),o=(a?"hidePanel"in a&&a.hidePanel(t):this.bottomView&&this.once("ready",()=>{const e=this.getBottomView();e&&("processHidePanel"in e?e.processHidePanel(t):"hidePanel"in e&&e.hidePanel(t))}),this.getSideView());o?"hidePanel"in o&&o.hidePanel(t):this.sideView&&this.once("ready",()=>{const e=this.getSideView();e&&("processHidePanel"in e?e.processHidePanel(t):"hidePanel"in e&&e.hidePanel(t))}),this.recordHelper.setPanelStateParam(t,"hidden",!0),this.middlePanelDefs[t]&&(this.controlTabVisibilityHide(this.middlePanelDefs[t].tabNumber),this.adjustMiddlePanels())}}afterRender(){this.$middle=this.$el.find(".middle"),this.bottomView&&(this.$bottom=this.$el.find(".bottom")),this.initElementReferences(),this.adjustMiddlePanels(),this.adjustButtons(),this.initStickableButtonsContainer(),this.initFieldsControlBehaviour()}initFieldsControlBehaviour(){var e=this.getFieldViews();let t=null;for(const s in e){var i=e[s];this.listenTo(i,"edit",e=>{t&&t.isEditMode()&&t.inlineEditClose(),t=e}),this.listenTo(i,"inline-edit-on",()=>{this.inlineEditModeIsOn=!0}),this.listenTo(i,"inline-edit-off",e=>{(e=e||{}).all||(this.inlineEditModeIsOn=!1,this.setIsNotChanged())}),this.listenTo(i,"after:inline-edit-off",e=>{this.updatedAttributes&&!e.noReset&&this.resetModelChanges()})}}initStickableButtonsContainer(){const a=this.$el.find(".detail-button-container"),e=this.$el.find(".detail-button-container.record-buttons");if(e.length){const o=this.getThemeManager().getParam("navbarHeight");var t=this.getThemeManager().getParam("screenWidthXs");const n=$(window.document).width()<t;let i=(e=>{let t=e.get(0),i=0;for(;t;)i+=isNaN(t.offsetTop)?0:t.offsetTop,t=t.offsetParent;return n?i:i-o})(e);const l=e.outerHeight(),r=(i-=5,$("<div>").css("height",l+"px").html("&nbsp;").hide().insertAfter(e));let s=this.getMiddleView().$el;const d=$(window),h=$("#navbar .navbar-right");!this.stickButtonsFormBottomSelector||(t=this.$el.find(this.stickButtonsFormBottomSelector)).length&&(s=t),d.off("scroll.detail-"+this.numId),d.on("scroll.detail-"+this.numId,()=>{var e=s.position().top+s.outerHeight(!1)-l,t=d.scrollTop();if(e<=t&&!this.stickButtonsContainerAllTheWay)return a.hide(),h.removeClass("has-sticked-bar"),void r.show();if(!n||!$("#navbar .navbar-body").hasClass("in")){if(t>i)return a.hasClass("stick-sub")||(a.addClass("stick-sub"),r.show()),h.addClass("has-sticked-bar"),void a.show();a.hasClass("stick-sub")&&(a.removeClass("stick-sub"),h.removeClass("has-sticked-bar"),r.hide()),a.show()}})}}fetch(){let e=super.fetch();if(this.hasView("side")){const t=this.getSideView();"fetch"in t&&(e=_.extend(e,t.fetch()))}if(this.hasView("bottom")){const i=this.getBottomView();"fetch"in i&&(e=_.extend(e,i.fetch()))}return e}setEditMode(){return this.trigger("before:set-edit-mode"),this.inlineEditModeIsOn=!1,this.$el.find(".record-buttons").addClass("hidden"),this.$el.find(".edit-buttons").removeClass("hidden"),new Promise(e=>{var t=this.getFieldViews(!0);const i=[];for(const s in t){const a=t[s];a.readOnly||(a.isEditMode()&&(a.fetchToModel(),a.removeInlineEditLinks(),a.setIsInlineEditMode(!1)),i.push(a.setEditMode().then(()=>a.render())))}this.mode=this.MODE_EDIT,this.trigger("after:set-edit-mode"),this.trigger("after:mode-change"),Promise.all(i).then(()=>e())})}setDetailMode(){return this.trigger("before:set-detail-mode"),this.$el.find(".edit-buttons").addClass("hidden"),this.$el.find(".record-buttons").removeClass("hidden"),this.inlineEditModeIsOn=!1,new Promise(e=>{var t=this.getFieldViews(!0);const i=[];for(const s in t){const a=t[s];a.isDetailMode()||(a.isEditMode()&&a.trigger("inline-edit-off",{all:!0}),i.push(a.setDetailMode().then(()=>a.render())))}this.mode=this.MODE_DETAIL,this.trigger("after:set-detail-mode"),this.trigger("after:mode-change"),Promise.all(i).then(()=>e())})}cancelEdit(){this.resetModelChanges(),this.setDetailMode(),this.setIsNotChanged()}isEditMode(){return"edit"===this.mode}resetModelChanges(){let e=!0;this.updatedAttributes&&(this.attributes=this.updatedAttributes,this.updatedAttributes=null,e=!1);for(const t in this.model.attributes)t in this.attributes||this.model.unset(t);this.model.set(this.attributes,{skipReRender:e})}delete(){this.confirm({message:this.translate("removeRecordConfirmation","messages",this.scope),confirmText:this.translate("Remove")},()=>{this.trigger("before:delete"),this.trigger("delete"),Espo.Ui.notify(" ... ");const e=this.model.collection;this.model.destroy({wait:!0}).then(()=>{e&&0<e.total&&e.total--,this.model.set("deleted",!0,{silent:!0}),Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.trigger("after:delete"),this.exit("delete")})})}getFieldViews(e){var t={};return this.hasView("middle")&&"getFieldViews"in this.getMiddleView()&&_.extend(t,Espo.Utils.clone(this.getMiddleView().getFieldViews())),this.hasView("side")&&"getFieldViews"in this.getSideView()&&_.extend(t,this.getSideView().getFieldViews(e)),this.hasView("bottom")&&"getFieldViews"in this.getBottomView()&&_.extend(t,this.getBottomView().getFieldViews(e)),t}getFieldView(e){let t;return(t=!(t=!(t=this.hasView("middle")?(this.getMiddleView().getFieldViews()||{})[e]:t)&&this.hasView("side")?(this.getSideView().getFieldViews(!0)||{})[e]:t)&&this.hasView("bottom")?(this.getBottomView().getFieldViews(!0)||{})[e]:t)||null}handleDataBeforeRender(e){}data(){let e=!this.navigateButtonsDisabled&&!!this.model.collection,t=!1,i=!1;e&&(0<this.indexOfRecord&&(t=!0),(this.indexOfRecord<this.model.collection.total-1||-1===this.model.collection.total||-2===this.model.collection.total&&this.indexOfRecord<this.model.collection.length-1)&&(i=!0),t||i||(e=!1));var s=this.hasTabs(),a=s?this.getMiddleTabDataList():[];return{scope:this.scope,entityType:this.entityType,buttonList:this.buttonList,buttonEditList:this.buttonEditList,dropdownItemList:this.dropdownItemList,dropdownEditItemList:this.dropdownEditItemList,dropdownItemListEmpty:this.isDropdownItemListEmpty(),dropdownEditItemListEmpty:this.isDropdownEditItemListEmpty(),buttonsDisabled:this.buttonsDisabled,id:this.id,isWide:this.isWide,isSmall:"editSmall"===this.type||"detailSmall"===this.type,navigateButtonsEnabled:e,previousButtonEnabled:t,nextButtonEnabled:i,hasMiddleTabs:s,middleTabDataList:a}}init(){this.entityType=this.model.entityType||this.model.name||"Common",this.scope=this.options.scope||this.entityType,this.layoutName=this.options.layoutName||this.layoutName,this.detailLayout=this.options.detailLayout||this.detailLayout,this.type=this.options.type||this.type,this.buttonList=this.options.buttonList||this.buttonList,this.dropdownItemList=this.options.dropdownItemList||this.dropdownItemList,this.buttonList=Espo.Utils.cloneDeep(this.buttonList),this.buttonEditList=Espo.Utils.cloneDeep(this.buttonEditList),this.dropdownItemList=Espo.Utils.cloneDeep(this.dropdownItemList),this.dropdownEditItemList=Espo.Utils.cloneDeep(this.dropdownEditItemList),this.returnAfterCreate=this.options.returnAfterCreate,this.returnUrl=this.options.returnUrl||this.returnUrl,this.returnDispatchParams=this.options.returnDispatchParams||this.returnDispatchParams,this.exit=this.options.exit||this.exit,this.shortcutKeys&&(this.shortcutKeys=Espo.Utils.cloneDeep(this.shortcutKeys))}isDropdownItemListEmpty(){if(0===this.dropdownItemList.length)return!0;let t=!0;return this.dropdownItemList.forEach(e=>{e.hidden||(t=!1)}),t}isDropdownEditItemListEmpty(){if(0===this.dropdownEditItemList.length)return!0;let t=!0;return this.dropdownEditItemList.forEach(e=>{e.hidden||(t=!1)}),t}setup(){if(void 0===this.model)throw new Error("Model has not been injected into record view.");this.recordHelper=this.options.recordHelper||new i.default(this.defaultFieldStates,this.defaultFieldStates),this._initInlineEditSave();const e=this.collection=this.model.collection;e&&(this.listenTo(this.model,"destroy",()=>{e.remove(this.model.id),e.trigger("sync",{})}),"indexOfRecord"in this.options?this.indexOfRecord=this.options.indexOfRecord:this.indexOfRecord=e.indexOf(this.model)),this.middlePanelDefs={},this.middlePanelDefsList=[],this.getUser().isPortal()&&!this.portalLayoutDisabled&&this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.layoutName+"Portal"])&&(this.layoutName+="Portal"),this.numId=Math.floor(1e4*Math.random()+1),$(window).on("fetch-record."+this.cid,()=>this.handleRecordUpdate()),this.once("remove",()=>{this.isChanged&&this.resetModelChanges(),this.setIsNotChanged(),$(window).off("scroll.detail-"+this.numId),$(window).off("fetch-record."+this.cid)}),this.id=Espo.Utils.toDom(this.entityType)+"-"+Espo.Utils.toDom(this.type)+"-"+this.numId,this.isNew=this.model.isNew(),this.editModeDisabled||"editModeDisabled"in this.options&&(this.editModeDisabled=this.options.editModeDisabled),this.confirmLeaveDisabled=this.options.confirmLeaveDisabled||this.confirmLeaveDisabled,this.buttonsDisabled=this.options.buttonsDisabled||this.buttonsDisabled,"buttonsPosition"in this.options&&!this.options.buttonsPosition&&(this.buttonsDisabled=!0),"isWide"in this.options&&(this.isWide=this.options.isWide),"sideView"in this.options&&(this.sideView=this.options.sideView),"bottomView"in this.options&&(this.bottomView=this.options.bottomView),this.sideDisabled=this.options.sideDisabled||this.sideDisabled,this.bottomDisabled=this.options.bottomDisabled||this.bottomDisabled,this.readOnly=this.options.readOnly||this.readOnly,this.readOnly||this.isNew||(this.readOnly=this.getMetadata().get(["clientDefs",this.scope,"editDisabled"])||!1),this.getMetadata().get(["clientDefs",this.scope,"createDisabled"])&&(this.duplicateAction=!1),(this.getConfig().get("currencyList")||[]).length<=1&&(this.convertCurrencyAction=!1),this.readOnlyLocked=this.readOnly,this.inlineEditDisabled=this.inlineEditDisabled||this.getMetadata().get(["clientDefs",this.scope,"inlineEditDisabled"])||!1,this.inlineEditDisabled=this.options.inlineEditDisabled||this.inlineEditDisabled,this.navigateButtonsDisabled=this.options.navigateButtonsDisabled||this.navigateButtonsDisabled,this.portalLayoutDisabled=this.options.portalLayoutDisabled||this.portalLayoutDisabled,this.dynamicLogicDefs=this.options.dynamicLogicDefs||this.dynamicLogicDefs,this.accessControlDisabled=this.options.accessControlDisabled||this.accessControlDisabled,this.setupActionItems(),this.setupBeforeFinal(),this.on("after:render",()=>{this.initElementReferences()}),!this.isNew&&this.getHelper().webSocketManager&&this.getMetadata().get(["scopes",this.entityType,"object"])&&(this.subscribeToWebSocket(),this.once("remove",()=>{this.isSubscribedToWebSocket&&this.unsubscribeFromWebSocket()})),this.wait(this.getHelper().processSetupHandlers(this,this.setupHandlerType)),this.initInlineEditDynamicWithLogicInteroperability(),this.forcePatchAttributeDependencyMap=this.getMetadata().get(["clientDefs",this.scope,"forcePatchAttributeDependencyMap"])||{}}setupBeforeFinal(){this.accessControlDisabled||this.manageAccess(),this.attributes=this.model.getClonedAttributes(),this.options.attributes&&this.model.set(this.options.attributes),this.listenTo(this.model,"sync",()=>{this.attributes=this.model.getClonedAttributes()}),this.listenTo(this.model,"change",(e,t)=>{if(t.sync)for(const i in e.attributes)e.hasChanged(i)&&(this.attributes[i]=Espo.Utils.cloneDeep(e.get(i)));else this.mode!==this.MODE_EDIT&&!this.inlineEditModeIsOn||this.setIsChanged()});var e=Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.entityType,"formDependency"])||{}),e=(this.dependencyDefs=_.extend(e,this.dependencyDefs),this.initDependency(),Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.entityType,"dynamicLogic"])||{}));this.dynamicLogicDefs=_.extend(e,this.dynamicLogicDefs),this.initDynamicLogic(),this.setupFieldLevelSecurity(),this.initDynamicHandler()}_initInlineEditSave(){this.listenTo(this.recordHelper,"inline-edit-save",(e,t)=>{this.inlineEditSave(e,t)})}inlineEditSave(e,t){const i=this.getFieldView(e);if(!i)throw new Error(`No field '${e}'.`);t=_.extend({inline:!0,field:e,afterValidate:()=>{t.bypassClose||i.inlineEditClose(!0)}},t||{}),this.save(t).then(()=>{i.trigger("after:inline-save"),i.trigger("after:save"),t.bypassClose&&(i.initialAttributes=this.model.getClonedAttributes())}).catch(e=>{if("notModified"===e)return t.bypassClose?void 0:void i.inlineEditClose(!0);"error"===e&&(t.bypassClose||i.inlineEdit())})}initInlineEditDynamicWithLogicInteroperability(){let s=!1;const t=(e,t)=>{if(this.inlineEditModeIsOn&&!this.editModeDisabled&&!s){if("required"===e){const i=this.getFieldView(t);if(i.validateRequired){i.suspendValidationMessage();try{if(!i.validateRequired())return}catch(e){}}}s=!0,setTimeout(()=>s=!1,300),setTimeout(()=>{this.setEditMode(),this.getFieldViewList().forEach(e=>e.removeInlineEditLinks())},10)}};this.on("set-field-required",e=>t("required",e)),this.on("set-field-option-list",e=>t("options",e)),this.on("reset-field-option-list",e=>t("options",e))}initDynamicHandler(){const e=this.dynamicHandlerClassName||this.getMetadata().get(["clientDefs",this.scope,"dynamicHandler"]),i=o=>{this.listenTo(this.model,"change",(e,t)=>{"onChange"in o&&o.onChange.call(o,e,t);var i=e.changedAttributes();for(const a in i){var s="onChange"+Espo.Utils.upperCaseFirst(a);s in o&&o[s].call(o,e,i[a],t)}}),"init"in o&&o.init()},t=(e&&this.wait(new Promise(t=>{Espo.loader.require(e,e=>{e=this.dynamicHandler=new e(this);i(e),t()})})),this.getMetadata().get(["clientDefs",this.scope,"dynamicHandlerList"])||[]);if(t.length){const s=this,a=[];t.forEach(e=>{a.push(new Promise(t=>{Espo.loader.require(e,e=>{t(new e(s))})}))}),this.wait(Promise.all(a).then(e=>{e.forEach(e=>{i(e)})}))}}setupFinal(){this.build(),this.shortcutKeys&&this.options.shortcutKeysEnabled&&(this.events["keydown.record-detail"]=e=>{var t,i,s=Espo.Utils.getKeyFromKeyEvent(e);"function"!=typeof this.shortcutKeys[s]?(t=this.shortcutKeys[s])&&(e.preventDefault(),e.stopPropagation(),"function"!=typeof this[i="action"+Espo.Utils.upperCaseFirst(t)]?this[t]():this[i]()):this.shortcutKeys[s].call(this,e.originalEvent)}),this.options.focusForCreate||this.once("after:render",()=>this.focusOnFirstDiv())}setIsChanged(){this.isChanged=!0,this.confirmLeaveDisabled||this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.confirmLeaveDisabled||this.setConfirmLeaveOut(!1)}switchToModelByIndex(e){const t=this.model.collection||this.collection;if(t){var i=t.at(e);if(!i)throw new Error("Model is not found in collection by index.");var s=i.id,a=this.entityType||this.scope;this.getRouter().navigate("#"+a+"/view/"+s,{trigger:!1}),this.getRouter().dispatch(a,"view",{id:s,model:i,indexOfRecord:e,rootUrl:this.options.rootUrl})}}actionPrevious(){var e;if(this.model.abortLastFetch(),!this.model.collection){if(!this.collection)return;this.indexOfRecord--,this.indexOfRecord<0&&(this.indexOfRecord=0)}0<this.indexOfRecord&&(e=this.indexOfRecord-1,this.switchToModelByIndex(e))}actionNext(){this.model.abortLastFetch();let e;if(this.model.collection)e=this.model.collection;else{if(!(e=this.collection))return;this.indexOfRecord--,this.indexOfRecord<0&&(this.indexOfRecord=0)}if(!(!(this.indexOfRecord<e.total-1)&&0<=e.total||-2===e.total&&this.indexOfRecord>=e.length-1)){const t=this.indexOfRecord+1;t<=e.length-1?this.switchToModelByIndex(t):e.fetch({more:!0,remove:!1}).then(()=>{this.switchToModelByIndex(t)})}}actionViewPersonalData(){this.createView("viewPersonalData","views/personal-data/modals/personal-data",{model:this.model},e=>{e.render(),this.listenToOnce(e,"erase",()=>{this.clearView("viewPersonalData"),this.model.fetch()})})}actionViewFollowers(e){var t=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels","followers","viewModalView"])||this.getMetadata().get(["clientDefs","User","modalViews","relatedList"])||"views/modals/followers-list",i=!this.getUser().isAdmin()&&"no"===this.getAcl().getPermissionLevel("followerManagementPermission")&&"no"===this.getAcl().getPermissionLevel("portalPermission");const s={model:this.model,link:"followers",scope:"User",title:this.translate("Followers"),filtersDisabled:!0,url:this.entityType+"/"+this.model.id+"/followers",createDisabled:!0,selectDisabled:i,rowActionsView:"views/user/record/row-actions/relationship-followers"};if(e.viewOptions)for(const a in e.viewOptions)s[a]=e.viewOptions[a];Espo.Ui.notify(" ... "),this.createView("modalRelatedList",t,s,e=>{Espo.Ui.notify(!1),e.render(),this.listenTo(e,"action",(e,t)=>{Espo.Utils.handleAction(this,e,t)}),this.listenToOnce(e,"close",()=>{this.clearView("modalRelatedList")}),e.listenTo(this.model,"after:relate:followers",()=>{this.model.fetch()}),e.listenTo(this.model,"after:unrelate:followers",()=>{this.model.fetch()})})}actionPrintPdf(){this.createView("pdfTemplate","views/modals/select-template",{entityType:this.entityType},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("pdfTemplate"),window.open("?entryPoint=pdf&entityType="+this.entityType+"&entityId="+this.model.id+"&templateId="+e.id,"_blank")})})}afterSave(){this.isNew?Espo.Ui.success(this.translate("Created")):Espo.Ui.success(this.translate("Saved")),this.enableActionItems(),this.setIsNotChanged(),setTimeout(()=>{this.unblockUpdateWebSocket()},this.blockUpdateWebSocketPeriod)}beforeSave(){Espo.Ui.notify(this.translate("saving","messages")),this.blockUpdateWebSocket()}beforeBeforeSave(){this.disableActionItems()}afterSaveError(){this.enableActionItems()}afterNotModified(){var e=this.translate("notModified","messages");Espo.Ui.warning(e),this.enableActionItems(),this.setIsNotChanged()}afterNotValid(){Espo.Ui.error(this.translate("Not valid")),this.enableActionItems()}errorHandlerDuplicate(e,t,i,s){return Espo.Ui.notify(!1),this.createView("duplicate","views/modals/duplicate",{scope:this.entityType,duplicates:e,model:this.model},e=>{e.render(),this.listenToOnce(e,"save",()=>{this.actionSave({options:{headers:{"X-Skip-Duplicate-Check":"true"}}}).then(()=>i())}),this.listenToOnce(e,"cancel",()=>{s()})}),!0}errorHandlerModified(e,t){Espo.Ui.notify(!1);const i=e.versionNumber,s=e.values||{},a=Object.keys(s),o=[];a.forEach(e=>{this.attributes[e]!==s[e]&&o.push(e)}),0!==o.length?this.createView("dialog","views/modals/resolve-save-conflict",{model:this.model,attributeList:o,currentAttributes:Espo.Utils.cloneDeep(this.model.attributes),originalAttributes:Espo.Utils.cloneDeep(this.attributes),actualAttributes:Espo.Utils.cloneDeep(s)}).then(e=>{e.render(),this.listenTo(e,"resolve",()=>{this.model.set("versionNumber",i,{silent:!0}),this.attributes.versionNumber=i;for(const e in s)this.setInitialAttributeValue(e,s[e])})}):setTimeout(()=>{this.model.set("versionNumber",i,{silent:!0}),this.attributes.versionNumber=i,t.inline&&t.field?this.inlineEditSave(t.field):this.actionSave()},5)}getMiddleView(){return this.getView("middle")}getSideView(){return this.getView("side")}getBottomView(){return this.getView("bottom")}setReadOnly(){this.readOnlyLocked||(this.readOnly=!0);const e=this.getBottomView(),t=(e&&"setReadOnly"in e&&e.setReadOnly(),this.getSideView());t&&"setReadOnly"in t&&t.setReadOnly(),this.getFieldList().forEach(e=>{this.setFieldReadOnly(e)})}setNotReadOnly(t){this.readOnlyLocked||(this.readOnly=!1);const e=this.getBottomView(),i=(e&&"setNotReadOnly"in e&&e.setNotReadOnly(t),this.getSideView());i&&"setNotReadOnly"in i&&i.setNotReadOnly(t),this.getFieldList().forEach(e=>{t&&this.recordHelper.getFieldStateParam(e,"readOnly")||this.setFieldNotReadOnly(e)})}manageAccessEdit(e){var t;this.isNew||(!(t=this.getAcl().checkModel(this.model,"edit",!0))||this.readOnlyLocked?(this.readOnly=!0,this.hideActionItem("edit"),this.selfAssignAction&&this.hideActionItem("selfAssign")):(this.showActionItem("edit"),this.selfAssignAction&&(this.hideActionItem("selfAssign"),this.model.has("assignedUserId")&&(this.model.get("assignedUserId")||this.showActionItem("selfAssign"))),this.readOnlyLocked||(this.readOnly&&e&&(this.isReady?this.setNotReadOnly(!0):this.on("ready",()=>this.setNotReadOnly(!0))),this.readOnly=!1)),null===t&&this.listenToOnce(this.model,"sync",()=>{this.manageAccessEdit(!0)}))}manageAccessDelete(){var e;this.isNew||((e=this.getAcl().checkModel(this.model,"delete",!0))?this.showActionItem("delete"):this.hideActionItem("delete"),null===e&&this.listenToOnce(this.model,"sync",()=>{this.manageAccessDelete(!0)}))}manageAccessStream(){var e;this.isNew||(~["no","own"].indexOf(this.getAcl().getLevel("User","read"))&&"no"===this.getAcl().getPermissionLevel("portalPermission")?this.hideActionItem("viewFollowers"):((e=this.getAcl().checkModel(this.model,"stream",!0))?this.showActionItem("viewFollowers"):this.hideActionItem("viewFollowers"),null===e&&this.listenToOnce(this.model,"sync",()=>{this.manageAccessStream(!0)})))}manageAccess(){this.manageAccessEdit(),this.manageAccessDelete(),this.manageAccessStream()}addButton(e,t){var i=e.name;if(i){for(const s of this.buttonList)if(s.name===i)return;t?this.buttonList.unshift(e):this.buttonList.push(e)}}addDropdownItem(e,t){if(e){var i=e.name;if(i){for(const s of this.dropdownItemList)if(s.name===i)return;t?this.dropdownItemList.unshift(e):this.dropdownItemList.push(e)}}else t?this.dropdownItemList.unshift(!1):this.dropdownItemList.push(!1)}addButtonEdit(e,t){var i=e.name;if(i){for(const s of this.buttonEditList)if(s.name===i)return;t?this.buttonEditList.unshift(e):this.buttonEditList.push(e)}}enableButtons(){this.allActionItemsDisabled=!1,this.$el.find(".button-container .actions-btn-group .action").removeAttr("disabled").removeClass("disabled"),this.$el.find(".button-container .actions-btn-group .dropdown-toggle").removeAttr("disabled").removeClass("disabled"),this.buttonList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`button.action[data-action="${e.name}"]`).addClass("disabled").attr("disabled","disabled")}),this.buttonEditList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`button.action[data-action="${e.name}"]`).addClass("disabled").attr("disabled","disabled")}),this.dropdownItemList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`li > .action[data-action="${e.name}"]`).parent().addClass("disabled").attr("disabled","disabled")}),this.dropdownEditItemList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`li > .action[data-action="${e.name}"]`).parent().addClass("disabled").attr("disabled","disabled")})}disableButtons(){this.allActionItemsDisabled=!0,this.$el.find(".button-container .actions-btn-group .action").attr("disabled","disabled").addClass("disabled"),this.$el.find(".button-container .actions-btn-group .dropdown-toggle").attr("disabled","disabled").addClass("disabled")}removeActionItem(e){this.removeButton(e)}removeButton(e){for(var[t,i]of this.buttonList.entries())if(i.name===e){this.buttonList.splice(t,1);break}for(var[s,a]of this.dropdownItemList.entries())if(a.name===e){this.dropdownItemList.splice(s,1);break}this.isRendered()&&this.$el.find('.detail-button-container .action[data-action="'+e+'"]').remove()}convertDetailLayout(t){const i=[];var u=this.getSelector()||"#"+this.id;this.panelFieldListMap={};let s=-1;for(let e=0;e<t.length;e++){const o=t[e],n={};var m,p,f=o.tabBreak||0===e;f&&s++,"customLabel"in o?(n.label=o.customLabel,n.label&&(n.label=this.translate(n.label,"panelCustomLabels",this.entityType))):(n.label=o.label||null,n.label&&(n.label="$"===n.label[0]?this.translate(n.label.substring(1),"panels",this.entityType):this.translate(n.label,"labels",this.entityType))),n.name=o.name||"panel-"+e.toString(),n.style=o.style||"default",n.rows=[],n.tabNumber=s,this.middlePanelDefs[n.name]={name:n.name,style:n.style,tabNumber:n.tabNumber,tabBreak:f,tabLabel:o.tabLabel},this.middlePanelDefsList.push(this.middlePanelDefs[n.name]),o.dynamicLogicVisible&&this.dynamicLogic&&this.dynamicLogic.addPanelVisibleCondition(n.name,o.dynamicLogicVisible),o.dynamicLogicStyled&&this.dynamicLogic&&this.dynamicLogic.addPanelStyledCondition(n.name,o.dynamicLogicStyled),o.hidden&&0===s&&(n.hidden=!0,this.hidePanel(n.name),this.underShowMoreDetailPanelList=this.underShowMoreDetailPanelList||[],this.underShowMoreDetailPanelList.push(n.name));let a="rows";o.columns&&(a="columns",n.columns=[]),n.name&&(this.panelFieldListMap[n.name]=[]);for([m,p]of o[a].entries()){const l=[];for(const r of p)if(!1!==r){let i=r.view,s=r.name;if(s=!s&&i&&"object"==typeof i?i.name:s){let e;i&&"object"==typeof i&&(i.model=this.model,i.mode=this.fieldsMode,e=`.field[data-name="${s}"]`),n.name&&this.panelFieldListMap[n.name].push(s);var g=r.type||this.model.getFieldType(s)||"base";i=i||this.model.getFieldParam(s,"view")||this.getFieldManager().getViewName(g);const d={fullSelector:u+' .middle .field[data-name="'+s+'"]',defs:{name:s,params:r.params||{}},mode:this.fieldsMode};this.readOnly&&(d.readOnly=!0),r.readOnly&&(d.readOnly=!0,d.readOnlyLocked=!0),this.readOnlyLocked&&(d.readOnlyLocked=!0),(this.inlineEditDisabled||r.inlineEditDisabled)&&(d.inlineEditDisabled=!0);let t=r.fullWidth||!1;if(t||1===o[a][m].length&&(t=!0),this.recordHelper.getFieldStateParam(s,"hidden")&&(d.disabled=!0),this.recordHelper.getFieldStateParam(s,"hiddenLocked")&&(d.disabledLocked=!0),this.recordHelper.getFieldStateParam(s,"readOnly")&&(d.readOnly=!0),!d.readOnlyLocked&&this.recordHelper.getFieldStateParam(s,"readOnlyLocked")&&(d.readOnlyLocked=!0),null!==this.recordHelper.getFieldStateParam(s,"required")&&(d.defs.params=d.defs.params||{},d.defs.params.required=this.recordHelper.getFieldStateParam(s,"required")),this.recordHelper.hasFieldOptionList(s)&&(d.customOptionList=this.recordHelper.getFieldOptionList(s)),d.validateCallback=()=>this.validateField(s),d.recordHelper=this.recordHelper,d.dataObject=this.options.dataObject||{},r.options)for(const c in r.options)void 0===d[c]&&(d[c]=r.options[c]);const h={name:s+"Field",view:i,field:s,fullSelector:u+' .middle .field[data-name="'+s+'"]',fullWidth:t,options:d};e&&(h.selector=e),"labelText"in r&&(d.labelText=r.labelText,h.customLabel=r.labelText),"customLabel"in r&&(h.customLabel=r.customLabel),"label"in r&&(h.label=r.label),i&&"object"==typeof i&&!h.customLabel&&!h.label&&i.getLabelText()&&(h.customLabel=i.getLabelText()),"customCode"in r&&(h.customCode=r.customCode),"noLabel"in r&&(h.noLabel=r.noLabel),"span"in r&&(h.span=r.span),l.push(h)}else console.warn("No 'name' specified in detail layout cell.")}else l.push(!1);n[a].push(l)}i.push(n)}return i}getGridLayout(t){if(null===this.gridLayout)return this.detailLayout?(this.gridLayout={type:this.gridLayoutType,layout:this.convertDetailLayout(this.detailLayout)},void t(this.gridLayout)):void this.getHelper().layoutManager.get(this.entityType,this.layoutName,e=>{"function"==typeof this.modifyDetailLayout&&(e=Espo.Utils.cloneDeep(e),this.modifyDetailLayout(e)),this.detailLayout=e,this.gridLayout={type:this.gridLayoutType,layout:this.convertDetailLayout(this.detailLayout)},t(this.gridLayout)});t(this.gridLayout)}createSideView(){var e=this.getSelector()||"#"+this.id;this.createView("side",this.sideView,{model:this.model,scope:this.scope,fullSelector:e+" .side",type:this.type,readOnly:this.readOnly,inlineEditDisabled:this.inlineEditDisabled,recordHelper:this.recordHelper,recordViewObject:this,isReturn:this.options.isReturn,dataObject:this.options.dataObject})}createMiddleView(t){const i=this.getSelector()||"#"+this.id;this.waitForView("middle"),this.getGridLayout(e=>{this.hasTabs()&&this.options.isReturn&&this.isStoredTabForThisRecord()&&this.selectStoredTab(),this.createView("middle",this.middleView,{model:this.model,scope:this.scope,type:this.type,layoutDefs:e,fullSelector:i+" .middle",layoutData:{model:this.model},recordHelper:this.recordHelper,recordViewObject:this,panelFieldListMap:this.panelFieldListMap},t)})}createBottomView(){var e=this.getSelector()||"#"+this.id;this.createView("bottom",this.bottomView,{model:this.model,scope:this.scope,fullSelector:e+" .bottom",readOnly:this.readOnly,type:this.type,inlineEditDisabled:this.inlineEditDisabled,recordHelper:this.recordHelper,recordViewObject:this,portalLayoutDisabled:this.portalLayoutDisabled,isReturn:this.options.isReturn,dataObject:this.options.dataObject})}build(e){!this.sideDisabled&&this.sideView&&this.createSideView(),this.middleView&&this.createMiddleView(e),!this.bottomDisabled&&this.bottomView&&this.createBottomView()}exitAfterCreate(){var e;return!(this.returnAfterCreate||!this.model.id)&&(e="#"+this.scope+"/view/"+this.model.id,this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.scope,"view",{id:this.model.id,rootUrl:this.options.rootUrl,model:this.model,isAfterCreate:!0}),!0)}exit(e){if(e){var t="exitAfter"+Espo.Utils.upperCaseFirst(e);if(t in this)if(this[t]())return}let i,s;if(this.returnUrl)i=this.returnUrl;else{if("delete"===e)return i=this.options.rootUrl||"#"+this.scope,this.getRouter().navigate(i,{trigger:!1}),void this.getRouter().dispatch(this.scope,null,{isReturn:!0});this.model.id?(i="#"+this.scope+"/view/"+this.model.id,this.returnDispatchParams||(this.getRouter().navigate(i,{trigger:!1}),s={id:this.model.id,model:this.model},this.options.rootUrl&&(s.rootUrl=this.options.rootUrl),this.getRouter().dispatch(this.scope,"view",s))):i=this.options.rootUrl||"#"+this.scope}if(this.returnDispatchParams)return t=this.returnDispatchParams.controller,e=this.returnDispatchParams.action,s=this.returnDispatchParams.options||{},this.getRouter().navigate(i,{trigger:!1}),void this.getRouter().dispatch(t,e,s);this.getRouter().navigate(i,{trigger:!0})}subscribeToWebSocket(){var e="recordUpdate."+this.entityType+"."+this.model.id;this.recordUpdateWebSocketTopic=e,this.isSubscribedToWebSocket=!0,this.getHelper().webSocketManager.subscribe(e,()=>{this.handleRecordUpdate()})}unsubscribeFromWebSocket(){this.isSubscribedToWebSocket&&this.getHelper().webSocketManager.unsubscribe(this.recordUpdateWebSocketTopic)}handleRecordUpdate(){if(!this.updateWebSocketIsBlocked)if(this.inlineEditModeIsOn||this.mode===this.MODE_EDIT){const e=this.model.clone();void e.fetch().then(()=>{!this.inlineEditModeIsOn&&this.mode!==this.MODE_EDIT||(this.updatedAttributes=Espo.Utils.cloneDeep(e.attributes))})}else this.model.fetch({highlight:!0})}blockUpdateWebSocket(e){this.updateWebSocketIsBlocked=!0,e&&setTimeout(()=>{this.unblockUpdateWebSocket()},this.blockUpdateWebSocketPeriod)}unblockUpdateWebSocket(){this.updateWebSocketIsBlocked=!1}showMoreDetailPanels(){this.hidePanel("showMoreDelimiter"),this.underShowMoreDetailPanelList.forEach(e=>{this.showPanel(e)})}getTabCount(){if(!this.hasTabs())return 0;let t=1;return(this.detailLayout||[]).forEach(e=>{e.tabBreak&&t++}),t}hasTabs(){if(void 0!==this._hasMiddleTabs)return this._hasMiddleTabs;if(!this.detailLayout)return!1;for(const e of this.detailLayout)if(e.tabBreak)return this._hasMiddleTabs=!0;return this._hasMiddleTabs=!1}getMiddleTabDataList(){const a=this.currentTab,o=this.middlePanelDefsList;return o.filter((e,t)=>0===t||e.tabBreak).map((e,t)=>{let i=e.tabLabel,s=!1;return 0<t&&(s=-1===o.filter(e=>e.tabNumber===t).findIndex(e=>!this.recordHelper.getPanelStateParam(e.name,"hidden"))),i?"$label:"===i.substring(0,7)?i=this.translate(i.substring(7),"labels",this.scope):"$"===i[0]&&(i=this.translate(i.substring(1),"tabs",this.scope)):i=0===t?this.translate("Overview"):(t+1).toString(),{label:i,isActive:a===t,hidden:s}})}selectTab(e){this.currentTab=e,$(".popover.in").removeClass("in"),this.whenRendered().then(()=>{this.$el.find(".middle-tabs > button").removeClass("active"),this.$el.find(`.middle-tabs > button[data-tab="${e}"]`).addClass("active"),this.$el.find(".middle > .panel[data-tab]").addClass("tab-hidden"),this.$el.find(`.middle > .panel[data-tab="${e}"]`).removeClass("tab-hidden"),this.adjustMiddlePanels(),this.recordHelper.trigger("panel-show")}),this.storeTab()}storeTab(){this.getSessionStorage().set("tab_middle",this.currentTab),this.getSessionStorage().set("tab_middle_record",this.entityType+"_"+this.model.id)}selectStoredTab(){var e=this.getSessionStorage().get("tab_middle");0<e&&this.selectTab(e)}isStoredTabForThisRecord(){return this.getSessionStorage().get("tab_middle_record")===this.entityType+"_"+this.model.id}onInvalid(e){if(this.hasTabs()){const i=[];for(const s of e){const a=this.getMiddleView().getFieldView(s);var t;a&&(t=a.$el.closest(".panel.tab-hidden").attr("data-tab"),t=parseInt(t),-1===i.indexOf(t)&&i.push(t))}if(i.length){const o=this.$el.find(".middle-tabs");i.forEach(e=>{const t=o.find(`> [data-tab="${e.toString()}"]`);t.addClass("invalid"),t.one("click",()=>{t.removeClass("invalid")})})}}}controlTabVisibilityShow(e){this.hasTabs()&&0!==e&&(this.isBeingRendered()?this.once("after:render",()=>this.controlTabVisibilityShow(e)):this.$el.find(`.middle-tabs > [data-tab="${e.toString()}"]`).removeClass("hidden"))}controlTabVisibilityHide(t){if(this.hasTabs()&&0!==t)if(this.isBeingRendered())this.once("after:render",()=>this.controlTabVisibilityHide(t));else{const e=this.middlePanelDefsList.filter(e=>e.tabNumber===t);if(-1===e.findIndex(e=>!this.recordHelper.getPanelStateParam(e.name,"hidden"))){const i=this.$el.find(`.middle-tabs > [data-tab="${t.toString()}"]`);i.addClass("hidden"),this.currentTab===t&&this.selectTab(0)}}}adjustMiddlePanels(){if(this.isRendered()&&this.$middle.length){const e=this.$middle.find("> .panel"),s=this.$bottom?this.$bottom.find("> .panel"):null,a=(e.removeClass("first").removeClass("last").removeClass("in-middle"),e.filter(":not(.tab-hidden):not(.hidden)"));a.each((e,t)=>{const i=$(t);if(e===a.length-1)return s&&s.first().hasClass("sticked")?0===e?void i.addClass("first"):void i.addClass("in-middle"):0===e?void 0:void i.addClass("last");0<e&&e<a.length-1?i.addClass("in-middle"):0===e&&i.addClass("first")})}}adjustButtons(){const e=this.$detailButtonContainer.filter(".record-buttons").find("button.btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter("button:not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right"),this.adjustEditButtons()}adjustEditButtons(){const e=this.$detailButtonContainer.filter(".edit-buttons").find("button.btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter("button:not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right")}initElementReferences(){this.$detailButtonContainer&&this.$detailButtonContainer.length||(this.$detailButtonContainer=this.$el.find(".detail-button-container"),this.$dropdownItemListButton=this.$detailButtonContainer.find(".dropdown-item-list-button"),this.$dropdownEditItemListButton=this.$detailButtonContainer.find(".dropdown-edit-item-list-button"))}focusForEdit(){this.$el.find(".field:not(.hidden) .form-control:not([disabled])").first().focus()}focusForCreate(){this.$el.find(".form-control:not([disabled])").first().focus()}handleShortcutKeyCtrlEnter(e){var t=this.shortcutKeyCtrlEnterAction;this.inlineEditModeIsOn||this.buttonsDisabled||!t||this.mode===this.MODE_EDIT&&this.hasAvailableActionItem(t)&&(e.preventDefault(),e.stopPropagation(),this["action"+Espo.Utils.upperCaseFirst(t)]())}handleShortcutKeyCtrlS(e){this.inlineEditModeIsOn||this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.mode===this.MODE_EDIT&&this.saveAndContinueEditingAction&&this.hasAvailableActionItem("saveAndContinueEditing")&&this.actionSaveAndContinueEditing())}handleShortcutKeyCtrlSpace(e){this.inlineEditModeIsOn||this.buttonsDisabled||this.type===this.TYPE_DETAIL&&this.mode===this.MODE_DETAIL&&"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&this.hasAvailableActionItem("edit")&&($(e.currentTarget),e.preventDefault(),e.stopPropagation(),this.actionEdit(),this.editModeDisabled||setTimeout(()=>this.focusForEdit(),200))}handleShortcutKeyEscape(e){this.inlineEditModeIsOn||this.buttonsDisabled||this.type===this.TYPE_DETAIL&&this.mode===this.MODE_EDIT&&(e.preventDefault(),e.stopPropagation(),this.model.set(this.fetch()),this.isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionCancelEdit()):this.actionCancelEdit())}handleShortcutKeyCtrlAltEnter(e){}handleShortcutKeyControlBackslash(t){if(this.hasTabs()){const i=this.$el.find(".middle-tabs > button:not(.hidden)");if(1!==i.length){t.preventDefault(),t.stopPropagation();let e=i.toArray().findIndex(e=>$(e).hasClass("active"));++e>=i.length&&(e=0);const s=$(i.get(e)),a=parseInt(s.attr("data-tab"));this.selectTab(a),this.mode!==this.MODE_EDIT?this.$el.find(`.middle-tabs button[data-tab="${a}"]`).focus():setTimeout(()=>{this.$middle.find(`.panel[data-tab="${a}"] .cell:not(.hidden)`).first().focus()},50)}}}handleShortcutKeyControlArrowLeft(e){if(!this.inlineEditModeIsOn&&!this.buttonsDisabled&&!this.navigateButtonsDisabled&&this.type===this.TYPE_DETAIL&&this.mode===this.MODE_DETAIL&&"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName){const t=this.$el.find('button[data-action="previous"]');t.length&&!t.hasClass("disabled")&&(e.preventDefault(),e.stopPropagation(),this.actionPrevious())}}handleShortcutKeyControlArrowRight(e){if(!this.inlineEditModeIsOn&&!this.buttonsDisabled&&!this.navigateButtonsDisabled&&this.type===this.TYPE_DETAIL&&this.mode===this.MODE_DETAIL&&"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName){const t=this.$el.find('button[data-action="next"]');t.length&&!t.hasClass("disabled")&&(e.preventDefault(),e.stopPropagation(),this.actionNext())}}getMode(){return this.mode}}e.default=o}),define("views/record/list/settings",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent=`
        {{#if toDisplay}}
        <div class="btn-group">
            <a
                role="button"
                class="btn btn-text dropdown-toggle"
                data-toggle="dropdown"
            ><span class="fas fa-cog fa-sm"></span></a>
            <ul class="dropdown-menu pull-right">
            {{#each dataList}}
                <li>
                    <a
                        role="button"
                        tabindex="0"
                        data-action="toggleColumn"
                        data-name="{{name}}"
                    ><span class="check-icon fas fa-check pull-right{{#if hidden}} hidden{{/if}}"></span><div>{{label}}</div></a>
                </li>
            {{/each}}
            {{#if isNotDefault}}
                <li class="divider"></li>
                <li>
                    <a
                        role="button"
                        tabindex="0"
                        data-action="resetToDefault"
                    >{{translate 'Reset'}}</a>
                </li>
            {{/if}}
            </ul>
        </div>
        {{/if}}
    `;data(){const e=this.getDataList();var t=void 0!==e.find(e=>e.hiddenDefault!==e.hidden);return{dataList:e,toDisplay:0<e.length,isNotDefault:t}}constructor(e){super(),this.layoutProvider=e.layoutProvider,this.helper=e.helper,this.entityType=e.entityType,this.onChange=e.onChange}setup(){this.addActionHandler("toggleColumn",(e,t)=>this.toggleColumn(t.dataset.name)),this.addActionHandler("resetToDefault",()=>this.resetToDefault())}getDataList(){const e=this.layoutProvider()||[],s=this.helper.getHiddenColumnMap()||{};return e.filter(e=>e.name&&!e.link&&!e.noLabel&&!e.customLabel).map(e=>{var t=e.label||e.name,i=e.name in s?s[e.name]:!!e.hidden;return{name:e.name,label:this.translate(t,"fields",this.entityType),hidden:i,hiddenDefault:!!e.hidden}})}toggleColumn(t){const e=this.helper.getHiddenColumnMap()||{};var i=this.getDataList().find(e=>e.name===t),i=!!i&&i.hiddenDefault;e[t]=!(t in e?e[t]:i),this.helper.storeHiddenColumnMap(e),this.onChange()}resetToDefault(){this.helper.clearHiddenColumnMap(),this.onChange()}}e.default=s}),define("views/fields/link",["exports","views/fields/base","helpers/record-modal"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="link";listTemplate="fields/link/list";detailTemplate="fields/link/detail";editTemplate="fields/link/edit";searchTemplate="fields/link/search";nameName;idName;foreignScope=null;selectRecordsView="views/modals/select-records";autocompleteDisabled=!1;createDisabled=!1;createButton=!1;forceCreateButton=!1;searchTypeList=["is","isEmpty","isNotEmpty","isNot","isOneOf","isNotOneOf"];selectFilterList=null;selectPrimaryFilterName=null;selectBoolFilterList=null;autocompleteMaxCount=null;forceSelectAllAttributes=!1;mandatorySelectAttributeList=null;autocompleteOnEmpty=!1;events={'auxclick a[href]:not([role="button"])':function(e){this.isReadMode()&&1===e.button&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),this.quickView())}};data(){let e=this.model.has(this.nameName)?this.model.get(this.nameName):this.model.get(this.idName),t=(null===e&&(e=this.model.get(this.idName)),this.isReadMode()&&!e&&this.model.get(this.idName)&&(e=this.translate(this.foreignScope,"scopeNames")),null);this.isDetailMode()&&(t=this.getHelper().getScopeColorIconHtml(this.foreignScope));var i=this.createButton&&(!this.createDisabled||this.forceCreateButton);return{...super.data(),idName:this.idName,nameName:this.nameName,idValue:this.model.get(this.idName),nameValue:e,foreignScope:this.foreignScope,valueIsSet:this.model.has(this.idName),iconHtml:t,url:this.getUrl(),createButton:i}}getUrl(){var e=this.model.get(this.idName);return e?"#"+this.foreignScope+"/view/"+e:null}getSelectFilters(){return null}getSelectBoolFilterList(){return this.selectBoolFilterList}getSelectPrimaryFilterName(){return this.selectPrimaryFilterName}getSelectFilterList(){return this.selectFilterList}getCreateAttributes(){const t=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name,"createAttributeMap"])||{},i={};return Object.keys(t).forEach(e=>i[t[e]]=this.model.get(e)),i}setup(){this.nameName=this.name+"Name",this.idName=this.name+"Id",this.foreignScope=this.options.foreignScope||this.foreignScope,this.foreignScope=this.foreignScope||this.model.getFieldParam(this.name,"entity")||this.model.getLinkParam(this.name,"entity"),"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.isListMode()||(this.addActionHandler("selectLink",()=>this.actionSelect()),this.addActionHandler("clearLink",()=>this.clearLink())),this.isSearchMode()&&(this.addActionHandler("selectLinkOneOf",()=>this.actionSelectOneOf()),this.events['click a[data-action="clearLinkOneOf"]']=e=>{e=$(e.currentTarget).data("id").toString();this.deleteLinkOneOf(e)}),this.autocompleteOnEmpty=this.params.autocompleteOnEmpty||this.autocompleteOnEmpty,this.createButton=this.params.createButton||this.createButton,this.createButton&&!this.getAcl().checkScope(this.foreignScope,"create")&&(this.createButton=!1),this.createButton&&this.addActionHandler("createLink",()=>this.actionCreateLink()),this.panelDefs=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name])||{},this.panelDefs.createDisabled&&(this.createDisabled=!0)}select(t){this.$elementName.val(t.get("name")||t.id),this.$elementId.val(t.get("id")),this.mode===this.MODE_SEARCH&&(this.searchData.idValue=t.get("id"),this.searchData.nameValue=t.get("name")||t.id),this.trigger("change"),this.controlCreateButtonVisibility(),this.getSelectFieldHandler().then(e=>{e.getAttributes(t).then(e=>{this.model.set(e)})})}clearLink(){this.$elementName.val(""),this.$elementId.val(""),this.trigger("change"),this.controlCreateButtonVisibility(),this.getSelectFieldHandler().then(e=>{e.getClearAttributes().then(e=>{this.model.set(e)})})}controlCreateButtonVisibility(){if(this.createButton){const e=this.$el.find('[data-action="createLink"]');this.model.get(this.idName)?e.addClass("hidden"):e.removeClass("hidden")}}getSelectFieldHandler(){return this.panelDefs.selectFieldHandler?new Promise(t=>{Espo.loader.requirePromise(this.panelDefs.selectFieldHandler).then(e=>{e=new e(this.getHelper());t(e)})}):Promise.resolve({getClearAttributes:()=>Promise.resolve({}),getAttributes:()=>Promise.resolve({})})}setupSearch(){this.searchData.oneOfIdList=this.getSearchParamsData().oneOfIdList||this.searchParams.oneOfIdList||[],this.searchData.oneOfNameHash=this.getSearchParamsData().oneOfNameHash||this.searchParams.oneOfNameHash||{},~["is","isNot","equals"].indexOf(this.getSearchType())&&(this.searchData.idValue=this.getSearchParamsData().idValue||this.searchParams.idValue||this.searchParams.value,this.searchData.nameValue=this.getSearchParamsData().nameValue||this.searchParams.nameValue||this.searchParams.valueName),this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}handleSearchType(e){~["is","isNot","isNotAndIsNotEmpty"].indexOf(e)?this.$el.find("div.primary").removeClass("hidden"):this.$el.find("div.primary").addClass("hidden"),~["isOneOf","isNotOneOf","isNotOneOfAndIsNotEmpty"].indexOf(e)?this.$el.find("div.one-of-container").removeClass("hidden"):this.$el.find("div.one-of-container").addClass("hidden")}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}getAutocompleteUrl(e){let s=this.foreignScope+"?maxSize="+this.getAutocompleteMaxCount();if(!this.forceSelectAllAttributes){var t=this.mandatorySelectAttributeList||this.panelDefs.selectMandatoryAttributeList;let e=["id","name"];t&&(e=e.concat(t)),s+="&select="+e.join(",")}if(this.panelDefs.selectHandler)return new Promise(i=>{this._getSelectFilters().then(e=>{e.bool&&(s+="&"+$.param({boolFilterList:e.bool})),e.primary&&(s+="&"+$.param({primaryFilter:e.primary})),e.advanced&&Object.keys(e.advanced).length&&(s+="&"+$.param({where:e.advanced}));var t=e.orderBy||this.panelDefs.selectOrderBy,e=e.orderBy?e.order:this.panelDefs.selectOrderDirection;t&&(s+="&"+$.param({orderBy:t,order:e||"asc"})),i(s)})});var t=[...this.getSelectBoolFilterList()||[],...this.panelDefs.selectBoolFilterList||[]],i=this.getSelectPrimaryFilterName()||this.panelDefs.selectPrimaryFilterName;return t.length&&(s+="&"+$.param({boolFilterList:t})),i&&(s+="&"+$.param({primaryFilter:i})),this.panelDefs.selectOrderBy&&(t=this.panelDefs.selectOrderDirection||"asc",s+="&"+$.param({orderBy:this.panelDefs.selectOrderBy,order:t})),s}afterRender(){if(this.isEditMode()||this.isSearchMode()){this.$elementId=this.$el.find('input[data-name="'+this.idName+'"]'),this.$elementName=this.$el.find('input[data-name="'+this.nameName+'"]'),this.$elementName.on("change",()=>{""===this.$elementName.val()&&this.clearLink()}),this.$elementName.on("blur",e=>{setTimeout(()=>{this.mode===this.MODE_EDIT&&this.model.has(this.nameName)&&(e.currentTarget.value=this.model.get(this.nameName))},100),this.autocompleteDisabled||setTimeout(()=>this.$elementName.autocomplete("clear"),300)});const t=this.$elementName;if(!this.autocompleteDisabled){let s=!1;if(this.getEmptyAutocompleteResult()&&this.$elementName.on("keydown",e=>{"Tab"===e.code&&s&&e.stopImmediatePropagation()}),this.$elementName.autocomplete({beforeRender:e=>{this.$elementName.hasClass("input-sm")&&e.addClass("small"),this.$elementName.get(0)!==document.activeElement&&setTimeout(()=>this.$elementName.autocomplete("hide"),30)},lookup:(t,i)=>{var e;if(!this.autocompleteOnEmpty&&0===t.length)return s=!0,void((e=this.getEmptyAutocompleteResult())&&i(this._transformAutocompleteResult(e)));s=!1,Promise.resolve(this.getAutocompleteUrl(t)).then(e=>{Espo.Ajax.getRequest(e,{q:t}).then(e=>{i(this._transformAutocompleteResult(e))})})},minChars:0,triggerSelectOnValidInput:!1,autoSelectFirst:!0,noCache:!0,formatResult:e=>this.getHelper().escapeString(e.name),onSelect:t=>{this.getModelFactory().create(this.foreignScope,e=>{e.set(t.attributes),this.select(e),this.$elementName.focus()})}}),this.$elementName.off("focus.autocomplete"),this.$elementName.on("focus",()=>{this.$elementName.val()?this.$elementName.get(0).select():this.$elementName.autocomplete("onFocus")}),this.$elementName.attr("autocomplete","espo-"+this.name),this.once("render",()=>{t.autocomplete("dispose")}),this.once("remove",()=>{t.autocomplete("dispose")}),this.isSearchMode()){const i=this.$el.find("input.element-one-of");i.autocomplete({beforeRender:e=>{this.$elementName.hasClass("input-sm")&&e.addClass("small")},serviceUrl:()=>this.getAutocompleteUrl(),minChars:1,paramName:"q",noCache:!0,formatResult:e=>this.getHelper().escapeString(e.name),transformResult:e=>this._transformAutocompleteResult(JSON.parse(e)),onSelect:t=>{this.getModelFactory().create(this.foreignScope,e=>{e.set(t.attributes),this.selectOneOf([e]),i.val(""),setTimeout(()=>i.focus(),50)})}}),i.attr("autocomplete","espo-"+this.name),this.once("render",()=>{i.autocomplete("dispose")}),this.once("remove",()=>{i.autocomplete("dispose")}),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")})}}t.on("change",()=>{this.isSearchMode()||this.model.get(this.idName)||t.val(this.model.get(this.nameName))})}var e;this.isSearchMode()&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e),~["isOneOf","isNotOneOf","isNotOneOfAndIsNotEmpty"].indexOf(e)&&this.searchData.oneOfIdList.forEach(e=>{this.addLinkOneOfHtml(e,this.searchData.oneOfNameHash[e])}))}_transformAutocompleteResult(e){const t=[];return e.list.forEach(e=>{t.push({id:e.id,name:e.name||e.id,data:e.id,value:e.name||e.id,attributes:e})}),{suggestions:t}}getValueForDisplay(){return this.model.get(this.nameName)}validateRequired(){var e;if(this.isRequired()&&null==this.model.get(this.idName))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}deleteLinkOneOf(e){this.deleteLinkOneOfHtml(e);var t=this.searchData.oneOfIdList.indexOf(e);-1<t&&this.searchData.oneOfIdList.splice(t,1),delete this.searchData.oneOfNameHash[e],this.trigger("change")}addLinkOneOf(e,t){~this.searchData.oneOfIdList.indexOf(e)||(this.searchData.oneOfIdList.push(e),this.searchData.oneOfNameHash[e]=t,this.addLinkOneOfHtml(e,t),this.trigger("change"))}deleteLinkOneOfHtml(e){this.$el.find(".link-one-of-container .link-"+e).remove()}addLinkOneOfHtml(e,t){const i=this.$el.find(".link-one-of-container"),s=$("<div>").addClass("link-"+e).addClass("list-group-item");return s.append($("<a>").attr("role","button").addClass("pull-right").attr("data-id",e).attr("data-action","clearLinkOneOf").append($("<span>").addClass("fas fa-times")),$("<span>").text(t)," "),i.append(s),s}fetch(){const e={};return e[this.nameName]=this.$el.find('[data-name="'+this.nameName+'"]').val()||null,e[this.idName]=this.$el.find('[data-name="'+this.idName+'"]').val()||null,e}fetchSearch(){var e=this.$el.find("select.search-type").val(),t=this.$el.find('[data-name="'+this.idName+'"]').val();if(~["isOneOf","isNotOneOf"].indexOf(e)&&!this.searchData.oneOfIdList.length)return{type:"isNotNull",attribute:"id",data:{type:e}};if("isEmpty"===e)return{type:"isNull",attribute:this.idName,data:{type:e}};if("isNotEmpty"===e)return{type:"isNotNull",attribute:this.idName,data:{type:e}};if("isOneOf"===e)return{type:"in",attribute:this.idName,value:this.searchData.oneOfIdList,data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}};if("isNotOneOf"===e)return{type:"or",value:[{type:"notIn",attribute:this.idName,value:this.searchData.oneOfIdList},{type:"isNull",attribute:this.idName}],data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}};if("isNotOneOfAndIsNotEmpty"===e)return{type:"notIn",attribute:this.idName,value:this.searchData.oneOfIdList,data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}};if("isNot"===e){if(!t)return!1;const i=this.$el.find('[data-name="'+this.nameName+'"]').val();return{type:"or",value:[{type:"notEquals",attribute:this.idName,value:t},{type:"isNull",attribute:this.idName}],data:{type:e,idValue:t,nameValue:i}}}if("isNotAndIsNotEmpty"===e){if(!t)return!1;const i=this.$el.find('[data-name="'+this.nameName+'"]').val();return{type:"notEquals",attribute:this.idName,value:t,data:{type:e,idValue:t,nameValue:i}}}if(!t)return!1;const i=this.$el.find('[data-name="'+this.nameName+'"]').val();return{type:"equals",attribute:this.idName,value:t,data:{type:e,idValue:t,nameValue:i}}}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront||this.searchParams.type}quickView(){var e=this.model.get(this.idName);if(e){var t=this.foreignScope;const i=new s.default(this.getMetadata(),this.getAcl());i.showDetail(this,{id:e,scope:t})}}getCreateAttributesProvider(){return()=>{const i=this.getCreateAttributes()||{};return this.panelDefs.createHandler?new Promise(t=>{Espo.loader.requirePromise(this.panelDefs.createHandler).then(e=>new e(this.getHelper())).then(e=>{e.getAttributes(this.model).then(e=>{t({...i,...e})})})}):Promise.resolve(i)}}actionSelect(){Espo.Ui.notify(" ... ");var e=this.panelDefs;const s=e.selectModalView||this.getMetadata().get(["clientDefs",this.foreignScope,"modalViews","select"])||this.selectRecordsView,a=this.mandatorySelectAttributeList||e.selectMandatoryAttributeList,o=this.isEditMode()&&(!this.createDisabled||this.forceCreateButton),n=o?this.getCreateAttributesProvider():null;this._getSelectFilters().then(e=>{var t=e.orderBy||this.panelDefs.selectOrderBy,i=e.orderBy?e.order:this.panelDefs.selectOrderDirection;this.createView("dialog",s,{scope:this.foreignScope,createButton:o,filters:e.advanced,boolFilterList:e.bool,primaryFilterName:e.primary,mandatorySelectAttributeList:a,forceSelectAllAttributes:this.forceSelectAllAttributes,filterList:this.getSelectFilterList(),createAttributesProvider:n,layoutName:this.panelDefs.selectLayout,orderBy:t,orderDirection:i},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),this.select(e)})})})}_applyAdditionalFilter(e){var t,i,s,a=this.model.getLinkParam(this.name,"foreign");a&&(e[a]||(t=this.model.getLinkParam(this.name,"type"),i=this.getMetadata().get(["entityDefs",this.foreignScope,"links",a,"type"]),(s=this.getMetadata().get(["entityDefs",this.foreignScope,"fields",a,"type"]))&&("hasOne"===t||"hasOne"===i)&&["link","linkOne"].includes(s)&&(e[a]={type:"isNull",attribute:a+"Id",data:{type:"isEmpty"}})))}_getSelectFilters(){const e=this.panelDefs.selectHandler,n=this.getSelectBoolFilterList();var t,i;return!e||this.isSearchMode()?(t=n||this.panelDefs.selectBoolFilterList?[...n||[],...this.panelDefs.selectBoolFilterList||[]]:void 0,i=this.getSelectFilters()||{},this._applyAdditionalFilter(i),Promise.resolve({primary:this.getSelectPrimaryFilterName()||this.panelDefs.selectPrimaryFilterName,bool:t,advanced:i})):new Promise(o=>{Espo.loader.requirePromise(e).then(e=>new e(this.getHelper())).then(e=>e.getFilters(this.model)).then(e=>{var t={...this.getSelectFilters()||{},...e.advanced||{}},i=this.getSelectPrimaryFilterName()||e.primary||this.panelDefs.selectPrimaryFilterName,s=n||e.bool||this.panelDefs.selectBoolFilterList?[...n||[],...e.bool||[],...this.panelDefs.selectBoolFilterList||[]]:void 0,a=(this._applyAdditionalFilter(t),e.orderBy),e=a?e.order:void 0;o({bool:s,primary:i,advanced:t,orderBy:a,order:e})})})}actionSelectOneOf(){Espo.Ui.notify(" ... ");var e=this.getMetadata().get(["clientDefs",this.foreignScope,"modalViews","select"])||this.selectRecordsView;this.createView("dialog",e,{scope:this.foreignScope,createButton:!1,filters:this.getSelectFilters(),boolFilterList:this.getSelectBoolFilterList(),primaryFilterName:this.getSelectPrimaryFilterName(),multiple:!0,layoutName:this.panelDefs.selectLayout},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]),this.selectOneOf(e)})})}getEmptyAutocompleteResult(){}actionCreateLink(){const t=this.getMetadata().get(["clientDefs",this.foreignScope,"modalViews","edit"])||"views/modals/edit";Espo.Ui.notify(" ... "),this.getCreateAttributesProvider()().then(e=>{this.createView("dialog",t,{scope:this.foreignScope,fullFormDisabled:!0,attributes:e},t=>{t.render().then(()=>Espo.Ui.notify(!1)),this.listenToOnce(t,"after:save",e=>{t.close(),this.clearView("dialog"),this.select(e)})})})}selectOneOf(e){e.forEach(e=>{this.addLinkOneOf(e.id,e.get("name"))})}}e.default=a}),define("views/fields/float",["exports","views/fields/int"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="float";editTemplate="fields/float/edit";decimalMark=".";validations=["required","float","range"];decimalPlacesRawValue=10;setup(){super.setup(),this.getPreferences().has("decimalMark")?this.decimalMark=this.getPreferences().get("decimalMark"):this.getConfig().has("decimalMark")&&(this.decimalMark=this.getConfig().get("decimalMark")),this.decimalMark||(this.decimalMark="."),this.decimalMark===this.thousandSeparator&&(this.thousandSeparator="")}setupAutoNumericOptions(){this.autoNumericOptions={digitGroupSeparator:this.thousandSeparator||"",decimalCharacter:this.decimalMark,modifyValueOnWheel:!1,selectOnFocus:!1,decimalPlaces:this.decimalPlacesRawValue,decimalPlacesRawValue:this.decimalPlacesRawValue,allowDecimalPadding:!1,showWarnings:!1,formulaMode:!0}}getValueForDisplay(){var e=isNaN(this.model.get(this.name))?null:this.model.get(this.name);return this.formatNumber(e)}formatNumber(e){return this.disableFormatting?e:this.formatNumberDetail(e)}formatNumberDetail(e){if(null===e)return"";var t=this.params.decimalPlaces;0===t?e=Math.round(e):t&&(e=Math.round(e*Math.pow(10,t))/Math.pow(10,t));const i=e.toString().split(".");if(i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandSeparator),0===t)return i[0];if(t){let e=0;if(1<i.length?e=i[1].length:i[1]="",t&&e<t){var s=t-e;for(let e=0;e<s;e++)i[1]+="0"}}return i.join(this.decimalMark)}setupMaxLength(){}validateFloat(){var e=this.model.get(this.name);if(isNaN(e))return e=this.translate("fieldShouldBeFloat","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}parse(e){return null===(e=""!==e?e:null)?null:(e=e.split(this.thousandSeparator).join("").split(this.decimalMark).join("."),parseFloat(e))}fetch(){var e=this.$element.val(),e=this.parse(e);const t={};return t[this.name]=e,t}}e.default=s}),define("ui/multi-select",["exports","lib!selectize"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};const o={init:function(e,t){const i=$(e),s=[],a=((t=o.applyDefaultOptions(t)).removeButton&&s.push("remove_button"),t.draggable&&s.push("drag_drop"),t.restoreOnBackspace&&(o.loadRestoreOnBackspacePlugin(),s.push("restore_on_backspace_espo")),o.loadBypassCtrlEnterPlugin(),s.push("bypass_ctrl_enter"),{options:t.items,plugins:s,delimiter:t.delimiter,labelField:"text",valueField:"value",searchField:["text"],highlight:!1,selectOnTab:t.selectOnTab});t.matchAnyWord||(a.score=function(t){const i=this.getScoreFunction(t);return t=t.toLowerCase(),function(e){return 0===e.text.toLowerCase().indexOf(t)?i(e):0}}),t.matchAnyWord&&(a.score=function(i){const s=this.getScoreFunction(i);return i=i.toLowerCase(),function(e){const t=e.text.toLowerCase();return t.split(" ").find(e=>e.startsWith(i))||t.startsWith(i)?s(e):0}}),t.allowCustomOptions&&(a.persist=!1,a.create=t.create,a.render={option_create:e=>$("<div>").addClass("create").append($("<span>").text(e.input).addClass("text-bold")).append("&hellip;").get(0).outerHTML}),i.selectize(a)},focus:function(e){e=$(e);if(e[0]&&e[0].selectize){const t=e[0].selectize;t.focus()}},applyDefaultOptions:function(e){e=Espo.Utils.clone(e);var t={removeButton:!0,draggable:!1,selectOnTab:!1,delimiter:":,:",matchAnyWord:!1,allowCustomOptions:!1};for(const i in t)i in e||(e[i]=t[i]);return e},loadBypassCtrlEnterPlugin:function(){if(!("bypass_ctrl_enter"in t.default.plugins)){const i=/Mac/.test(navigator.userAgent);t.default.define("bypass_ctrl_enter",function(){const e=this;this.onKeyDown=function(){const t=e.onKeyDown;return function(e){if("Enter"!==e.code||(i?!e.metaKey:!e.ctrlKey))return t.apply(this,arguments)}}()})}},loadRestoreOnBackspacePlugin:function(){"restore_on_backspace_espo"in t.default.plugins||t.default.define("restore_on_backspace_espo",function(s){s.text=s.text||function(e){return e[this.settings.labelField]};const e=this;this.onKeyDown=function(){const i=e.onKeyDown;return function(e){var t;return"Backspace"===e.code&&""===this.$control_input.val()&&!this.$activeItems.length&&0<=(t=this.caretPos-1)&&t<this.items.length?(t={value:(t=this.options[this.items[t]]).value,$order:t.$order,text:t.value},this.deleteSelection(e)&&(this.setTextboxValue(s.text.apply(this,[t])),this.refreshOptions(!0)),void e.preventDefault()):i.apply(this,arguments)}}()})}};var i=o;e.default=i}),define("helpers/mass-action",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.config=e.getConfig()}checkIsIdle(e){return!this.view.getUser().isPortal()&&(-1===(e=void 0===(e=void 0===e?this.view.options.totalCount:e)&&this.view.collection?this.view.collection.total:e)||e>this.config.get("massActionIdleCountThreshold"))}process(e,t){return Espo.Ui.notify(!1),new Promise(i=>{this.view.createView("dialog","views/modals/mass-action",{id:e,action:t,scope:this.view.scope||this.view.entityType}).then(t=>{t.render(),i(t),this.view.listenToOnce(t,"success",e=>{i(e),this.view.listenToOnce(t,"close",()=>{t.trigger("close:success",e)})})})})}}}),define("helpers/export",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.config=e.getConfig()}checkIsIdle(e){return!this.view.getUser().isPortal()&&(-1===(e=void 0===e?this.view.options.totalCount:e)||e>this.config.get("exportIdleCountThreshold"))}process(e){return Espo.Ui.notify(!1),new Promise(i=>{this.view.createView("dialog","views/export/modals/idle",{id:e}).then(t=>{t.render(),i(t),this.view.listenToOnce(t,"success",e=>{i(e),this.view.listenToOnce(t,"close",()=>{t.trigger("close:success",e)})})})})}}}),define("helpers/list/select-provider",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i){this.layoutManager=e,this.metadata=t,this.fieldManager=i}get(i,e){return new Promise(t=>{this.layoutManager.get(i,e||"list",e=>{e=this.getFromLayout(i,e);t(e)})})}getFromLayout(t,e){let i=[];return e.forEach(e=>{e.name&&(e=e.name,this.metadata.get(["entityDefs",t,"fields",e,"type"])&&(i=[this.fieldManager.getEntityTypeFieldAttributeList(t,e),...i]))}),i}}}),define("helpers/list/settings",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.storage=s,this.layoutColumnsKey=t+`-${e}-`+i,this.hiddenColumnMapCache={}}getHiddenColumnMap(){return this.hiddenColumnMapCache[this.layoutColumnsKey]||this.storage.get("listHiddenColumns",this.layoutColumnsKey)||{}}storeHiddenColumnMap(e){delete this.hiddenColumnMapCache[this.layoutColumnsKey],this.storage.set("listHiddenColumns",this.layoutColumnsKey,e)}clearHiddenColumnMap(){delete this.hiddenColumnMapCache[this.layoutColumnsKey],this.storage.clear("listHiddenColumns",this.layoutColumnsKey)}}}),define("helpers/reg-exp-pattern",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.metadata=e,this.language=t}validate(e,t,i,s){if(""===t||null===t)return null;let a="fieldNotMatchingPattern";var o,n;"$"===e[0]&&(o=e.slice(1),(n=this.metadata.get(["app","regExpPatterns",o,"pattern"]))&&(a+="$"+o,e=n));const l=new RegExp("^"+e+"$");if(l.test(t))return null;let r=this.language.translate(a,"messages").replace("{pattern}",e);return{message:r=i&&s?r.replace("{field}",this.language.translate(i,"fields",s)):r}}}}),define("web-socket-manager",["exports","js-base64"],function(e,a){"use strict";var t;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=(t=a)&&t.__esModule?t:{default:t};e.default=class{constructor(e){this.config=e,this.subscribeQueue=[],this.isConnected=!1,this.connection=null,this.url="",this.protocolPart="";const t=this.config.get("webSocketUrl");if(t)0===t.indexOf("wss:
        <div class="title-container">
            <a role="button" data-action="expand" class="title">{{title}}</a>
        </div>
        <div class="close-container">
            <a role="button" data-action="close"><span class="fas fa-times"></span></a>
        </div>
    `;events={'click [data-action="expand"]':function(){this.expand()},'click [data-action="close"]':function(){this.close()}};data(){let e=this.title;return{title:e=this.duplicateNumber?this.title+" "+this.duplicateNumber:e}}setup(){this.title=this.options.title||"no-title",this.duplicateNumber=this.options.duplicateNumber||null}expand(){this.trigger("expand")}close(){this.trigger("close")}}e.default=s}),define("views/collapsed-modal-bar",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{maxNumberToDisplay=3;templateContent=`
        {{#each dataList}}
        <div class="collapsed-modal" data-number="{{number}}">{{var key ../this}}</div>
        {{/each}}
    `;data(){return{dataList:this.getDataList()}}init(){this.on("render",()=>{0===$(".collapsed-modal-bar").length&&$("<div />").addClass("collapsed-modal-bar").appendTo("body")})}setup(){this.lastNumber=0,this.numberList=[]}getDataList(){const i=[];let e=Espo.Utils.clone(this.numberList);return(e=this.numberList.length>this.maxNumberToDisplay?e.slice(this.numberList.length-this.maxNumberToDisplay):e).reverse().forEach((e,t)=>{i.push({number:e.toString(),key:"key-"+e,index:t})}),i}calculateDuplicateNumber(t){let i=0;return this.numberList.forEach(e=>{e=this.getModalViewByNumber(e);e&&e.title===t&&i++}),0===i?null:i}getModalViewByNumber(e){return this.getView("key-"+e)}addModalView(t,e){const i=this.lastNumber;this.numberList.push(this.lastNumber);var s="key-"+i;this.createView(s,"views/collapsed-modal",{title:e.title,duplicateNumber:this.calculateDuplicateNumber(e.title),selector:'[data-number="'+i+'"]'}).then(e=>{this.listenToOnce(e,"close",()=>{this.removeModalView(i)}),this.listenToOnce(e,"expand",()=>{this.removeModalView(i,!0),setTimeout(()=>{var e="dialog-"+i;this.setView(e,t),t.setSelector(t.containerSelector),this.getView(e).render()},5)}),this.reRender(!0)}),this.lastNumber++}removeModalView(e,t){var i="key-"+e,s=this.numberList.indexOf(e);~s&&this.numberList.splice(s,1),this.isRendered()&&this.$el.find('.collapsed-modal[data-number="'+e+'"]').remove(),t||this.reRender(),this.clearView(i)}}e.default=s}),define("views/clear-cache",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="clear-cache";el="> body";events={'click .action[data-action="clearLocalCache"]':function(){this.clearLocalCache()},'click .action[data-action="returnToApplication"]':function(){this.returnToApplication()}};data(){return{cacheIsEnabled:!!this.options.cache}}clearLocalCache(){this.options.cache.clear(),this.$el.find('.action[data-action="clearLocalCache"]').remove(),this.$el.find(".message-container").removeClass("hidden"),this.$el.find(".message-container span").html(this.translate("Cache has been cleared")),this.$el.find('.action[data-action="returnToApplication"]').removeClass("hidden")}returnToApplication(){this.getRouter().navigate("",{trigger:!0})}}e.default=s}),define("views/about",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="about";data(){return{version:this.version,text:this.getHelper().transformMarkdownText(this.text)}}setup(){this.wait(Espo.Ajax.getRequest("App/about").then(e=>{this.text=e.text,this.version=e.version}))}}e.default=s}),define("views/stream/panel",["exports","views/record/panels/relationship","jquery-textcomplete"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="stream/panel";postingMode=!1;postDisabled=!1;relatedListFiltersDisabled=!0;layoutName=null;filterList=["all","posts","updates"];additionalEvents={'focus textarea[data-name="post"]':function(){this.enablePostingMode(!0)},"click button.post":function(){this.post()},'click .action[data-action="switchInternalMode"]':function(e){this.isInternalNoteMode=!this.isInternalNoteMode;e=$(e.currentTarget);this.isInternalNoteMode?e.addClass("enabled"):e.removeClass("enabled")},'keydown textarea[data-name="post"]':function(e){"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e.stopPropagation(),e.preventDefault(),this.post())},'input textarea[data-name="post"]':function(){this.controlPreviewButton(),this.controlPostButtonAvailability(this.$textarea.val())},'click .action[data-action="preview"]':function(){this.preview()}};data(){let e=super.data();return e.postDisabled=this.postDisabled,e.placeholderText=this.placeholderText,e.allowInternalNotes=this.allowInternalNotes,e}controlPreviewButton(){this.$previewButton=this.$previewButton||this.$el.find(".stream-post-preview"),""===this.$textarea.val()?this.$previewButton.addClass("hidden"):this.$previewButton.removeClass("hidden")}enablePostingMode(t){var i;this.$el.find(".buttons-panel").removeClass("hide"),this.postingMode||(this.$textarea.val()&&this.$textarea.val().length&&this.getView("postField").controlTextareaHeight(),i=!1,$("body").on("click.stream-panel",e=>{!t||i?$(e.target).parent().hasClass("remove-attachment")||$.contains(this.$postContainer.get(0),e.target)||""===this.$textarea.val()&&($(e.target).closest(".popover-content").get(0)||(this.seed.get("attachmentsIds")||[]).length||this.getView("attachments")&&this.getView("attachments").isUploading||this.disablePostingMode()):i=!0})),this.postingMode=!0,this.controlPreviewButton()}disablePostingMode(){this.postingMode=!1,this.$textarea.val(""),this.hasView("attachments")&&this.getView("attachments").empty(),this.$el.find(".buttons-panel").addClass("hide"),$("body").off("click.stream-panel"),this.$textarea.prop("rows",1)}setup(){this.events={...this.additionalEvents,...this.events},this.entityType=this.model.entityType,this.filter=this.getStoredFilter(),this.setupTitle(),this.placeholderText=this.translate("writeYourCommentHere","messages"),this.allowInternalNotes=!1,this.getUser().isPortal()||(this.allowInternalNotes=this.getMetadata().get(["clientDefs",this.entityType,"allowInternalNotes"])),this.isInternalNoteMode=!1,this.storageTextKey="stream-post-"+this.model.entityType+"-"+this.model.id,this.storageAttachmentsKey="stream-post-attachments-"+this.model.entityType+"-"+this.model.id,this.storageIsInernalKey="stream-post-is-internal-"+this.model.entityType+"-"+this.model.id,this.on("remove",()=>{this.storeControl(),$(window).off("beforeunload.stream-"+this.cid)}),$(window).off("beforeunload.stream-"+this.cid),$(window).on("beforeunload.stream-"+this.cid,()=>{this.storeControl()});var t=this.getSessionStorage().get(this.storageAttachmentsKey);this.setupActions(),this.wait(!0),this.getModelFactory().create("Note",e=>{this.seed=e,t&&(this.hasStoredAttachments=!0,this.seed.set({attachmentsIds:t.idList,attachmentsNames:t.names,attachmentsTypes:t.types})),this.allowInternalNotes&&(this.getMetadata().get(["entityDefs","Note","fields","isInternal","default"])&&(this.isInternalNoteMode=!0),this.getSessionStorage().has(this.storageIsInernalKey)&&(this.isInternalNoteMode=this.getSessionStorage().get(this.storageIsInernalKey))),this.isInternalNoteMode&&this.seed.set("isInternal",!0),this.createView("postField","views/note/fields/post",{selector:".textarea-container",name:"post",mode:"edit",params:{required:!0,rowsMin:1},model:this.seed,placeholderText:this.placeholderText,noResize:!0},e=>{this.initPostEvents(e)}),this.createCollection(()=>{this.wait(!1)}),this.listenTo(this.seed,"change:attachmentsIds",()=>{this.controlPostButtonAvailability()})}),this.defs.hidden||this.subscribeToWebSocket(),this.once("show",()=>{this.isSubscribedToWebSocket||this.subscribeToWebSocket()}),this.once("remove",()=>{this.isSubscribedToWebSocket&&this.unsubscribeFromWebSocket()})}subscribeToWebSocket(){var e;this.getHelper().webSocketManager&&"User"!==this.model.entityType&&(e="streamUpdate."+this.model.entityType+"."+this.model.id,this.streamUpdateWebSocketTopic=e,this.isSubscribedToWebSocket=!0,this.getHelper().webSocketManager.subscribe(e,(e,t)=>{if(t.createdById!==this.getUser().id)if(t.noteId){let e=this.collection.get(t.noteId);void(e&&e.fetch())}else this.collection.fetchNew()}))}unsubscribeFromWebSocket(){this.getHelper().webSocketManager.unsubscribe(this.streamUpdateWebSocketTopic)}setupTitle(){this.title=this.translate("Stream"),this.titleHtml=this.title,this.filter&&"all"!==this.filter&&(this.titleHtml+=" &middot; "+this.translate(this.filter,"filters","Note"))}storeControl(){var e=!1,t=(this.$textarea&&this.$textarea.length&&((t=this.$textarea.val()).length?(this.getSessionStorage().set(this.storageTextKey,t),e=!0):this.hasStoredText&&this.getSessionStorage().clear(this.storageTextKey)),this.seed.get("attachmentsIds")||[]);t.length?(this.getSessionStorage().set(this.storageAttachmentsKey,{idList:t,names:this.seed.get("attachmentsNames")||{},types:this.seed.get("attachmentsTypes")||{}}),e=!0):this.hasStoredAttachments&&this.getSessionStorage().clear(this.storageAttachmentsKey),e?this.getSessionStorage().set(this.storageIsInernalKey,this.isInternalNoteMode):this.getSessionStorage().clear(this.storageIsInernalKey)}createCollection(t,i){this.getCollectionFactory().create("Note",e=>{(this.collection=e).url=this.model.entityType+"/"+this.model.id+"/stream",e.maxSize=this.getConfig().get("recordsPerPageSmall")||5,this.setFilter(this.filter),t.call(i)})}initPostEvents(e){this.listenTo(e,"add-files",e=>{this.getView("attachments").uploadFiles(e),this.postingMode||this.enablePostingMode()})}afterRender(){this.$textarea=this.$el.find('textarea[data-name="post"]'),this.$attachments=this.$el.find("div.attachments"),this.$postContainer=this.$el.find(".post-container"),this.$postButton=this.$el.find("button.post");var e=this.getSessionStorage().get(this.storageTextKey);e&&e.length&&(this.hasStoredText=!0,this.$textarea.val(e)),this.controlPostButtonAvailability(e),this.isInternalNoteMode&&this.$el.find('.action[data-action="switchInternalMode"]').addClass("enabled");let t=this.collection,i=(this.listenToOnce(t,"sync",()=>{this.createView("list","views/stream/record/list",{selector:"> .list-container",collection:t,model:this.model},e=>{e.render()}),this.stopListening(this.model,"all"),this.stopListening(this.model,"destroy"),setTimeout(()=>{this.listenTo(this.model,"all",e=>{~["sync","after:relate"].indexOf(e)&&t.fetchNew()}),this.listenTo(this.model,"destroy",()=>{this.stopListening(this.model,"all")})},500)}),this.defs.hidden?this.once("show",()=>t.fetch()):t.fetch(),this.getAcl().getPermissionLevel("assignmentPermission"));"no"!==i&&(this.$textarea.textcomplete([{match:/(^|\s)@(\w*)$/,index:2,search:(e,t)=>{0!==e.length?Espo.Ajax.getRequest((e=>{e="User?orderBy=name&limit=7&q="+e+"&"+$.param({primaryFilter:"active"});return"team"===i&&(e+="&"+$.param({boolFilterList:["onlyMyTeam"]})),e})(e)).then(e=>t(e.list)):t([])},template:e=>this.getHelper().escapeString(e.name)+' <span class="text-muted">@'+this.getHelper().escapeString(e.userName)+"</span>",replace:e=>"$1@"+e.userName}]),this.once("remove",()=>{this.$textarea.length&&this.$textarea.textcomplete("destroy")}));var e=this.$el.find(".buttons-panel a.stream-post-info"),s=this.translate("infoMention","messages","Stream"),a=this.translate("infoSyntax","messages","Stream");let o=[],n=([["code","`{text}`"],["multilineCode","```{text}```"],["strongText","**{text}**"],["emphasizedText","*{text}*"],["deletedText","~~{text}~~"],["blockquote","> {text}"],["link","[{text}](url)"]].forEach(e=>{var t=this.translate(e[0],"syntaxItems","Stream"),e=e[1].replace("{text}",t);o.push(e)}),$("<ul>").append(o.map(e=>$("<li>").text(e))));s=this.getHelper().transformMarkdownInlineText(s)+"<br><br>"+this.getHelper().transformMarkdownInlineText(a)+":<br>"+n.get(0).outerHTML;Espo.Ui.popover(e,{content:s},this),this.createView("attachments","views/stream/fields/attachment-multiple",{model:this.seed,mode:"edit",selector:"div.attachments-container",defs:{name:"attachments"}},e=>{e.render()})}afterPost(){this.$el.find("textarea.note").prop("rows",1)}post(){let t=this.$textarea.val();this.disablePostButton(),this.$textarea.prop("disabled",!0),this.getModelFactory().create("Note",e=>this.getView("attachments").validateReady()?(this.$textarea.prop("disabled",!1),void this.enablePostButton()):""===t.trim()&&0===(this.seed.get("attachmentsIds")||[]).length?(this.notify("Post cannot be empty","error"),this.$textarea.prop("disabled",!1),this.controlPostButtonAvailability(),void this.$textarea.focus()):(e.set("post",t),e.set("attachmentsIds",Espo.Utils.clone(this.seed.get("attachmentsIds")||[])),e.set("type","Post"),e.set("isInternal",this.isInternalNoteMode),this.prepareNoteForPost(e),Espo.Ui.notify(" ... "),void e.save(null).then(()=>{Espo.Ui.success(this.translate("Posted")),this.collection.fetchNew(),this.$textarea.prop("disabled",!1),this.disablePostingMode(),this.afterPost(),this.getPreferences().get("followEntityOnStreamPost")&&this.model.set("isFollowed",!0),this.getSessionStorage().clear(this.storageTextKey),this.getSessionStorage().clear(this.storageAttachmentsKey),this.getSessionStorage().clear(this.storageIsInernalKey)}).catch(()=>{this.$textarea.prop("disabled",!1),this.controlPostButtonAvailability()})))}prepareNoteForPost(e){e.set("parentId",this.model.id),e.set("parentType",this.model.entityType)}getButtonList(){return[]}setupActions(){this.actionList=[],this.actionList.push({action:"viewPostList",html:$("<span>").append($("<span>").text(this.translate("View List"))," &middot; ",$("<span>").text(this.translate("posts","filters","Note"))).get(0).innerHTML,onClick:()=>this.actionViewPostList()}),this.actionList.push(!1),this.filterList.forEach(e=>{var t="all"===e?!this.filter:e===this.filter;this.actionList.push({action:"selectFilter",html:$("<span>").append($("<span>").addClass("check-icon fas fa-check pull-right").addClass(t?"":" hidden"),$("<div>").text(this.translate(e,"filters","Note"))).get(0).innerHTML,data:{name:e}})})}actionViewPostList(){var e={scope:"Note",viewOptions:{url:this.model.entityType+"/"+this.model.id+"/posts",title:this.translate("Stream")+" @right "+this.translate("posts","filters","Note"),forceSelectAllAttributes:!0}};this.actionViewRelatedList(e)}getStoredFilter(){return this.getStorage().get("state","streamPanelFilter"+this.entityType)||null}storeFilter(e){e?this.getStorage().set("state","streamPanelFilter"+this.entityType,e):this.getStorage().clear("state","streamPanelFilter"+this.entityType)}setFilter(e){this.filter=e,this.collection.data.filter=null,e&&(this.collection.data.filter=e)}actionRefresh(){this.hasView("list")&&this.getView("list").showNewRecords()}preview(){this.createView("dialog","views/modal",{templateContent:'<div class="complex-text">{{complexText viewObject.options.text linksInNewTab=true}}</div>',text:this.$textarea.val(),headerText:this.translate("Preview"),backdrop:!0},e=>{e.render()})}controlPostButtonAvailability(e){var t=this.seed.get("attachmentsIds")||[];let i=this.seed.get("post");if(!(i=void 0!==e?e:i)&&!t.length)return this.$postButton.hasClass("disabled")?void 0:void this.disablePostButton();this.$postButton.hasClass("disabled")&&this.enablePostButton()}disablePostButton(){this.$postButton.addClass("disabled").attr("disabled","disabled")}enablePostButton(){this.$postButton.removeClass("disabled").removeAttr("disabled")}}e.default=a}),define("views/stream/message",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{data(){return this.dataForTemplate}setup(){let t=this.options.messageTemplate;var i,s,a=Espo.Utils.clone(this.options.messageData||{});for(i in this.dataForTemplate={},a){let e=a[i]||"";0!==i.indexOf("html:")?e instanceof jQuery?(this.dataForTemplate[i]=e.get(0).outerHTML,t=t.replace("{"+i+"}","{{{"+i+"}}}")):e instanceof Element?(this.dataForTemplate[i]=e.outerHTML,t=t.replace("{"+i+"}","{{{"+i+"}}}")):e.indexOf&&(t=0!==e.indexOf("field:")?(this.dataForTemplate[i]=e,t.replace("{"+i+"}","{{"+i+"}}")):(s=e.substring(6),this.createField(i,s),s=this.getHelper().escapeString(i),t.replace("{"+i+"}",`<span data-key="${s}">{{{${i}}}}</span>`))):(i=i.substring(5),this.dataForTemplate[i]=e,t=t.replace("{"+i+"}","{{{"+i+"}}}"))}this.templateContent=t}createField(e,t,i,s){i=i||this.model.getFieldType(t)||"base",this.createView(e,this.getFieldManager().getViewName(i),{model:this.model,defs:{name:t,params:s||{}},mode:"detail",readOnly:!0,selector:`[data-key="${e}"]`})}}e.default=s}),define("views/stream/row-actions/default",["views/record/row-actions/edit-and-remove"],function(e){return e.extend({getActionList:function(){var e=[];return this.options.acl.edit&&this.options.isEditable&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id}}),this.options.acl.edit&&this.options.isRemovable&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}})}),define("views/stream/record/list",["exports","views/record/list-expanded"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="listStream";massActionsDisabled=!0;setup(){this.itemViews=this.getMetadata().get("clientDefs.Note.itemViews")||{},super.setup(),this.isRenderingNew=!1,this.listenTo(this.collection,"sync",(e,t,i)=>{if(i.fetchNew&&!this.isRenderingNew){i=i.lengthBeforeFetch||0;if(0!==i){let o=this.$el.find(this.listContainerEl);i=this.collection.length-i;if(0!=i){this.isRenderingNew=!0;for(let a=i-1;0<=a;a--){let s=this.collection.at(a);this.buildRow(a,s,e=>{0===a&&(this.isRenderingNew=!1);let t=$(this.getRowContainerHtml(s.id));var i=this.$el.find(`[data-id="${s.id}"]`);i.length&&(t=i),i.length||o.prepend(t),e.render()})}}}else this.buildRows(()=>this.reRender())}}),this.events["auxclick a[href][data-scope][data-id]"]=t=>{if(1===t.button&&(t.ctrlKey||t.metaKey)){let e=$(t.currentTarget);var i=e.attr("data-id"),s=e.attr("data-scope");t.preventDefault(),t.stopPropagation(),this.actionQuickView({id:i,scope:s})}}}buildRow(e,t,i){var s=t.id,a=(this.rowList.push(s),t.get("type")),a=this.itemViews[a]||"views/stream/notes/"+Espo.Utils.camelCaseToHyphen(a);this.createView(s,a,{model:t,parentModel:this.model,acl:{edit:this.getAcl().checkModel(t,"edit")},isUserStream:this.options.isUserStream,noEdit:this.options.noEdit,optionsToPass:["acl"],name:this.type+"-"+t.entityType,selector:'li[data-id="'+t.id+'"]',setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered()},i)}buildRows(i){if(this.checkedList=[],this.rowList=[],0<this.collection.length){this.wait(!0);let e=this.collection.models.length,t=0;for(var s in this.collection.models){var a=this.collection.models[s];this.buildRow(s,a,()=>{++t===e&&("function"==typeof i&&i(),this.wait(!1),this.trigger("after:build-rows"))})}}else"function"==typeof i&&(i(),this.trigger("after:build-rows"))}showNewRecords(){this.collection.fetchNew()}}e.default=s}),define("views/stream/record/edit",["exports","views/record/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/record/edit";postingMode=!1;dependencyDefs={targetType:{map:{users:[{action:"hide",fields:["teams","portals"]},{action:"show",fields:["users"]},{action:"setNotRequired",fields:["teams","portals"]},{action:"setRequired",fields:["users"]}],teams:[{action:"hide",fields:["users","portals"]},{action:"show",fields:["teams"]},{action:"setRequired",fields:["teams"]},{action:"setNotRequired",fields:["users","portals"]}],portals:[{action:"hide",fields:["users","teams"]},{action:"show",fields:["portals"]},{action:"setRequired",fields:["portals"]},{action:"setNotRequired",fields:["users","teams"]}]},default:[{action:"hide",fields:["teams","users","portals"]},{action:"setNotRequired",fields:["teams","users","portals"]}]}};data(){let e=super.data();return e.interactiveMode=this.options.interactiveMode,e}setup(){super.setup(),this.seed=this.model.clone(),this.options.interactiveMode&&(this.events['focus textarea[data-name="post"]']=()=>{this.enablePostingMode()},this.events['keydown textarea[data-name="post"]']=e=>{"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e.stopPropagation(),e.preventDefault(),this.post())},this.events["click button.post"]=()=>{this.post()});let e=["self"];this.model.set("type","Post"),this.model.set("targetType","self");var t=this.getAcl().getPermissionLevel("message"),i=this.getAcl().getPermissionLevel("portal");"team"!==t&&"all"!==t||(e.push("users"),e.push("teams")),"all"===t&&e.push("all"),"yes"===i&&(e.push("portals"),~e.indexOf("users")||e.push("users")),this.createField("targetType","views/fields/enum",{options:e}),this.createField("users","views/note/fields/users",{}),this.createField("teams","views/fields/teams",{}),this.createField("portals","views/fields/link-multiple",{}),this.createField("post","views/note/fields/post",{required:!0,rowsMin:1,noResize:!0}),this.createField("attachments","views/stream/fields/attachment-multiple",{}),this.listenTo(this.model,"change",()=>{this.postingMode&&this.setConfirmLeaveOut(!0)})}disablePostingMode(){this.postingMode=!1,this.$el.find(".post-control").addClass("hidden"),this.setConfirmLeaveOut(!1),$("body").off("click.stream-create-post"),this.getFieldView("post").$element.prop("rows",1)}enablePostingMode(){if(this.$el.find(".post-control").removeClass("hidden"),!this.postingMode){let e=$("body");e.off("click.stream-create-post"),e.on("click.stream-create-post",e=>{!$.contains(window.document.body,e.target)||$.contains(this.$el.get(0),e.target)||$(e.target).closest(".modal-dialog").length||this.getFieldView("post")&&""===this.getFieldView("post").$element.val()&&((this.model.get("attachmentsIds")||[]).length||this.disablePostingMode())})}this.postingMode=!0}afterRender(){this.$postButton=this.$el.find("button.post");var e=this.getFieldView("post");e&&(this.stopListening(e,"add-files"),this.listenTo(e,"add-files",e=>{this.enablePostingMode();let t=this.getFieldView("attachments");t&&t.uploadFiles(e)}))}validate(){let e=super.validate(),t=this.model.get("post")||"";return e=""!==t.trim()||(this.model.get("attachmentsIds")||[]).length?e:!0}post(){this.save()}beforeBeforeSave(){this.disablePostButton()}beforeSave(){Espo.Ui.notify(" ... ")}afterSave(){Espo.Ui.success(this.translate("Posted")),this.options.interactiveMode&&(this.model.clear(),this.model.set("targetType","self"),this.model.set("type","Post"),this.disablePostingMode(),this.enablePostButton(),this.getFieldView("post").$element.prop("rows",1))}afterNotValid(){this.enablePostButton()}disablePostButton(){this.trigger("disable-post-button"),this.$postButton.addClass("disable").attr("disabled","disabled")}enablePostButton(){this.trigger("enable-post-button"),this.$postButton.removeClass("disable").removeAttr("disabled")}}e.default=s}),define("views/stream/notes/update",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/update";messageName="update";data(){return{...super.data(),fieldsArr:this.fieldsArr,parentType:this.model.get("parentType")}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){this.addActionHandler("expandDetails",(e,t)=>this.toggleDetails(e,t)),this.createMessage(),this.wait(!0),this.getModelFactory().create(this.model.get("parentType"),a=>{let o=a,n=a.clone(),l=this.model.get("data"),e=(l.attributes=l.attributes||{},o.set(l.attributes.was),n.set(l.attributes.became),this.fieldsArr=[],l.fields);e.forEach(e=>{var t,i=a.getFieldType(e)||"base",i=this.getMetadata().get(["entityDefs",a.entityType,"fields",e,"view"])||this.getFieldManager().getViewName(i);let s=!1;for(t of this.getFieldManager().getEntityTypeFieldAttributeList(a.entityType,e))if(t in l.attributes.was){s=!0;break}s?(this.createView(e+"Was",i,{model:o,readOnly:!0,defs:{name:e},mode:"detail",inlineEditDisabled:!0}),this.createView(e+"Became",i,{model:n,readOnly:!0,defs:{name:e},mode:"detail",inlineEditDisabled:!0}),this.fieldsArr.push({field:e,was:e+"Was",became:e+"Became"})):this.fieldsArr.push({field:e,noValues:!0})}),this.wait(!1)})}toggleDetails(e,t){if(this.$el.find(".details").hasClass("hidden"))return this.$el.find(".details").removeClass("hidden"),void $(t).find("span").removeClass("fa-chevron-down").addClass("fa-chevron-up");this.$el.find(".details").addClass("hidden"),$(t).find("span").addClass("fa-chevron-down").removeClass("fa-chevron-up")}}e.default=s}),define("views/stream/notes/unrelate",["exports","views/stream/notes/relate"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create-related";messageName="unrelate"}e.default=s}),define("views/stream/notes/status",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/status";messageName="status";data(){return{...super.data(),style:this.style,statusText:this.statusText}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data"),t=e.field,i=e.value;this.style=e.style||"default",this.statusText=this.getLanguage().translateOption(i,t,this.model.get("parentType")),this.messageData.field=this.translate(t,"fields",this.model.get("parentType")).toLowerCase(),this.createMessage()}}e.default=s}),define("views/stream/notes/post",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/post";messageName="post";isEditable=!0;isRemovable=!0;data(){let e=super.data();return e.showAttachments=!!(this.model.get("attachmentsIds")||[]).length,e.showPost=!!this.model.get("post"),e.isInternal=this.isInternal,e}setup(){if(this.createField("post",null,null,"views/stream/fields/post"),this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple",{previewSize:this.options.isNotification?"small":"medium"}),this.isInternal=this.model.get("isInternal"),!this.model.get("post")&&this.model.get("parentId")&&(this.messageName="attach",this.isThis&&(this.messageName+="This")),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("post")||this.model.hasChanged("attachmentsIds"))&&this.reRender()}),this.model.get("parentId"))this.createMessage();else{if(this.model.get("isGlobal"))return this.messageName="postTargetAll",void this.createMessage();if(this.model.has("teamsIds")&&this.model.get("teamsIds").length){let e=this.model.get("teamsIds"),i=this.model.get("teamsNames")||{},s=(this.messageName="postTargetTeam",1<e.length&&(this.messageName="postTargetTeams"),[]);return e.forEach(e=>{var t=i[e];t&&s.push($("<a>").attr("href","#Team/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=s.join(", "),void this.createMessage()}if(this.model.has("portalsIds")&&this.model.get("portalsIds").length){let e=this.model.get("portalsIds"),i=this.model.get("portalsNames")||{},s=(this.messageName="postTargetPortal",1<e.length&&(this.messageName="postTargetPortals"),[]);return e.forEach(e=>{var t=i[e];t&&s.push($("<a>").attr("href","#Portal/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=s.join(", "),void this.createMessage()}if(this.model.has("usersIds")&&this.model.get("usersIds").length){let i=this.model.get("usersIds"),s=this.model.get("usersNames")||{};if(this.messageName="postTarget",1===i.length&&i[0]===this.model.get("createdById"))return this.messageName="postTargetSelf",void this.createMessage();let a=[];i.forEach(e=>{if(e===this.getUser().id)return this.messageName="postTargetYou",void(1<i.length&&(e===this.model.get("createdById")?this.messageName="postTargetSelfAndOthers":this.messageName="postTargetYouAndOthers"));var t;e!==this.model.get("createdById")?(t=s[e])&&a.push($("<a>").attr("href","#User/view/"+e).attr("data-scope","User").attr("data-id",e).text(t).get(0).outerHTML):this.messageName="postTargetSelfAndOthers"}),this.messageData["html:target"]=a.join(", "),this.createMessage()}else this.createMessage()}}}e.default=s}),define("views/stream/notes/mention-in-post",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/post";messageName="mentionInPost";data(){return{...super.data(),showAttachments:!!(this.model.get("attachmentsIds")||[]).length,showPost:!!this.model.get("post")}}setup(){if(this.model.get("post")&&this.createField("post",null,null,"views/stream/fields/post"),(this.model.get("attachmentsIds")||[]).length&&this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple",{previewSize:this.options.isNotification?"small":null}),this.messageData.mentioned=this.options.userId,this.model.get("parentId")||(this.messageName="mentionInPostTarget"),this.isUserStream&&this.options.userId===this.getUser().id){if(this.model.get("parentId"))return this.messageName="mentionYouInPost",void this.createMessage();if(this.messageName="mentionYouInPostTarget",this.model.get("isGlobal"))return this.messageName="mentionYouInPostTargetAll",void this.createMessage();if(this.messageName="mentionYouInPostTarget",this.model.has("teamsIds")&&this.model.get("teamsIds").length){let e=this.model.get("teamsIds"),i=this.model.get("teamsNames")||{},s=[];return e.forEach(e=>{var t=i[e];t&&s.push($("<a>").attr("href","#Team/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=s.join(", "),void this.createMessage()}if(this.model.has("usersIds")&&this.model.get("usersIds").length){var e=this.model.get("usersIds"),s=this.model.get("usersNames")||{};if(1===e.length&&e[0]===this.model.get("createdById"))return this.messageName="mentionYouInPostTargetNoTarget",void this.createMessage();let i=[];return e.forEach(e=>{var t=s[e];t&&i.push($("<a>").attr("href","#User/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=i.join(", "),void this.createMessage()}"self"===this.model.get("targetType")&&(this.messageName="mentionYouInPostTargetNoTarget"),this.createMessage()}else this.createMessage()}}e.default=s}),define("views/stream/notes/email-sent",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/email-sent";isRemovable=!1;data(){return{...super.data(),emailId:this.emailId,emailName:this.emailName,hasPost:this.hasPost,hasAttachments:this.hasAttachments,emailIconClassName:this.getMetadata().get(["clientDefs","Email","iconClass"])||""}}setup(){var e=this.model.get("data")||{};this.emailId=e.emailId,this.emailName=e.emailName,this.parentModel&&this.model.get("parentType")===this.parentModel.entityType&&this.model.get("parentId")===this.parentModel.id&&(this.model.get("post")&&(this.createField("post",null,null,"views/stream/fields/post"),this.hasPost=!0),(this.model.get("attachmentsIds")||[]).length&&(this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple"),this.hasAttachments=!0)),this.messageData.email=$("<a>").attr("href","#Email/view/"+e.emailId).text(e.emailName),this.messageName="emailSent",this.messageData.by=$("<a>").attr("href","#"+e.personEntityType+"/view/"+e.personEntityId).text(e.personEntityName),this.isThis&&(this.messageName+="This"),this.createMessage()}}e.default=s}),define("views/stream/notes/email-received",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/email-received";isRemovable=!1;isSystemAvatar=!0;data(){return{...super.data(),emailId:this.emailId,emailName:this.emailName,hasPost:this.hasPost,hasAttachments:this.hasAttachments,emailIconClassName:this.getMetadata().get(["clientDefs","Email","iconClass"])||""}}setup(){var e=this.model.get("data")||{};this.emailId=e.emailId,this.emailName=e.emailName,this.parentModel&&this.model.get("parentType")===this.parentModel.entityType&&this.model.get("parentId")===this.parentModel.id&&(this.model.get("post")&&(this.createField("post",null,null,"views/stream/fields/post"),this.hasPost=!0),(this.model.get("attachmentsIds")||[]).length&&(this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple"),this.hasAttachments=!0)),this.messageData.email=$("<a>").attr("href","#Email/view/"+e.emailId).text(e.emailName),this.messageName="emailReceived",e.isInitial&&(this.messageName+="Initial"),e.personEntityId&&(this.messageName+="From",this.messageData.from=$("<a>").attr("href","#"+e.personEntityType+"/view/"+e.personEntityId).text(e.personEntityName)),this.model.get("parentType")===e.personEntityType&&this.model.get("parentId")===e.personEntityId&&(this.isThis=!0),this.isThis&&(this.messageName+="This"),this.createMessage()}}e.default=s}),define("views/stream/notes/create",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create";assigned=!1;messageName="create";isRemovable=!1;data(){return{...super.data(),statusText:this.statusText,statusStyle:this.statusStyle}}setup(){this.model.get("data")&&this.setupData(),this.createMessage()}setupData(){var e,t,i=this.model.get("data");this.assignedUserId=i.assignedUserId||null,this.assignedUserName=i.assignedUserName||null,this.messageData.assignee=$("<a>").attr("href","#User/view/"+this.assignedUserId).text(this.assignedUserName);let s=!1;this.isUserStream&&this.assignedUserId===this.getUser().id&&(s=!0),this.assignedUserId&&(this.messageName="createAssigned",this.isThis?(this.messageName+="This",this.assignedUserId===this.model.get("createdById")&&(this.messageName+="Self")):this.assignedUserId===this.model.get("createdById")?this.messageName+="Self":s&&(this.messageName+="You")),i.statusField&&(e=this.statusField=i.statusField,t=i.statusValue,this.statusStyle=i.statusStyle||"default",this.statusText=this.getLanguage().translateOption(t,e,this.model.get("parentType")))}}e.default=s}),define("views/stream/notes/create-related",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create-related";messageName="createRelated";data(){return{...super.data(),relatedTypeString:this.translateEntityType(this.entityType),iconHtml:this.getIconHtml(this.entityType,this.entityId)}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data")||{};this.entityType=this.model.get("relatedType")||e.entityType||null,this.entityId=this.model.get("relatedId")||e.entityId||null,this.entityName=this.model.get("relatedName")||e.entityName||null,this.messageData.relatedEntityType=this.translateEntityType(this.entityType),this.messageData.relatedEntity=$("<a>").attr("href","#"+this.entityType+"/view/"+this.entityId).text(this.entityName),this.createMessage()}}e.default=s}),define("views/stream/notes/assign",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/assign";messageName="assign";init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data");this.assignedUserId=e.assignedUserId||null,this.assignedUserName=e.assignedUserName||null,this.messageData.assignee=$("<a>").attr("href","#User/view/"+e.assignedUserId).text(e.assignedUserName),this.isUserStream?this.assignedUserId?this.assignedUserId===this.model.get("createdById")?this.messageName+="Self":this.assignedUserId===this.getUser().id&&(this.messageName+="You"):this.messageName+="Void":this.assignedUserId?this.assignedUserId===this.model.get("createdById")&&(this.messageName+="Self"):this.messageName+="Void",this.createMessage()}}e.default=s}),define("views/stream/modals/create-post",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent='<div class="record">{{{record}}}</div>';shortcutKeys={"Control+Enter":"post"};setup(){this.headerText=this.translate("Create Post"),this.buttonList=[{name:"post",label:"Post",style:"primary",title:"Ctrl+Enter",onClick:()=>this.post()},{name:"cancel",label:"Cancel",title:"Esc",onClick:e=>{e.close()}}],this.wait(!0),this.getModelFactory().create("Note",e=>{this.createView("record","views/stream/record/edit",{model:e,selector:".record"},e=>{this.listenTo(e,"after:save",()=>{this.trigger("after:save")}),this.listenTo(e,"disable-post-button",()=>this.disableButton("post")),this.listenTo(e,"enable-post-button",()=>this.enableButton("post"))}),this.wait(!1)})}getRecordView(){return this.getView("record")}post(){this.getRecordView().save()}}e.default=s}),define("views/stream/fields/post",["views/fields/text"],function(e){return e.extend({getValueForDisplay:function(){let s=e.prototype.getValueForDisplay.call(this);if(this.isDetailMode()||this.isListMode()){let i=(this.model.get("data")||{}).mentions||{};Object.keys(i).sort((e,t)=>e.length<t.length).forEach(e=>{var t="["+i[e].name+"](#User/view/"+i[e].id+")";s=s.replace(new RegExp(e,"g"),t)})}return s}})}),define("views/stream/fields/attachment-multiple",["views/fields/attachment-multiple"],function(e){return e.extend({showPreviews:!0,showPreviewsInListMode:!0})}),define("views/site/navbar",["exports","view","jquery"],function(e,t,v){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),v=i(v);class s extends t.default{template="site/navbar";currentTab=null;events={"click .navbar-collapse.in a.nav-link":function(e){const t=(0,v.default)(e.currentTarget);t.attr("href")&&this.xsCollapse()},"click a.nav-link":function(){this.isSideMenuOpened&&this.closeSideMenu()},"click a.navbar-brand.nav-link":function(){this.xsCollapse()},"click a.minimizer":function(){this.switchMinimizer()},"click a.side-menu-button":function(){this.switchSideMenu()},"click a.action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)},'click [data-action="toggleCollapsable"]':function(){this.toggleCollapsable()},"click li.show-more a":function(e){e.stopPropagation(),this.showMoreTabs()},"click .not-in-more > .nav-link-group":function(e){this.handleGroupDropdownClick(e)},"click .in-more .nav-link-group":function(e){this.handleGroupDropdownClick(e)}};data(){return{tabDefsList1:this.tabDefsList.filter(e=>!e.isInMore),tabDefsList2:this.tabDefsList.filter(e=>e.isInMore),title:this.options.title,menuDataList:this.getMenuDataList(),userId:this.getUser().id,logoSrc:this.getLogoSrc(),itemDataList:this.getItemDataList()}}handleGroupDropdownClick(e){const t=(0,v.default)(e.currentTarget).parent();if(t.parent().hasClass("more-dropdown-menu"))return e.stopPropagation(),t.hasClass("open")?void t.removeClass("open"):void this.handleGroupDropdownInMoreOpen(t);t.hasClass("open")||this.handleGroupDropdownOpen(t)}handleGroupMenuPosition(t,i){if(this.navbarAdjustmentHandler&&this.navbarAdjustmentHandler.handleGroupMenuPosition())this.handleGroupMenuPosition(t,i);else{var s=i.get(0).getBoundingClientRect(),a=window.innerHeight,o=this.isSide();if(o||i.parent().hasClass("more-dropdown-menu")){var n=t.children().length,o=(o?this.$tabs.find("> .tab:not(.tab-divider)"):this.$tabs.find(".tab-group > ul > li:visible")).height()*n;let e=s.top-1;e+o>a&&(e=a-o-2)<0&&(e=0),t.css({top:e+"px"});const l=a-e;this.handleGroupMenuScrolling(t,i,l)}else{const l=a-s.bottom;void this.handleGroupMenuScrolling(t,i,l)}}}handleGroupMenuScrolling(e,t,i){e.css({maxHeight:i+"px"});const s=(0,v.default)(window);s.off("scroll.navbar-tab-group"),s.on("scroll.navbar-tab-group",()=>{e.get(0)&&t.get(0)&&t.hasClass("open")&&e.scrollTop(s.scrollTop())})}handleGroupDropdownOpen(e){var t=e.find(".dropdown-menu");this.handleGroupMenuPosition(t,e),setTimeout(()=>{this.adjustBodyMinHeight()},50),e.off("hidden.bs.dropdown"),e.on("hidden.bs.dropdown",()=>{this.adjustBodyMinHeight()})}handleGroupDropdownInMoreOpen(e){this.$el.find(".tab-group.tab.dropdown").removeClass("open");const t=this.$el.find(".more-dropdown-menu"),i=(e.addClass("open"),e.find(".dropdown-menu"));var s=t.get(0).getBoundingClientRect(),a=s.right;i.css({left:a+"px"}),this.handleGroupMenuPosition(i,e),this.adjustBodyMinHeight(),this.isSide()||a+i.width()>window.innerWidth&&i.css({left:s.left-i.width()-2})}isCollapsableVisible(){return this.$el.find(".navbar-body").hasClass("in")}toggleCollapsable(){this.isCollapsableVisible()?this.hideCollapsable():this.showCollapsable()}hideCollapsable(){this.$el.find(".navbar-body").removeClass("in")}showCollapsable(){this.$el.find(".navbar-body").addClass("in")}xsCollapse(){this.hideCollapsable()}isMinimized(){return this.$body.hasClass("minimized")}switchSideMenu(){this.isMinimized()&&(this.isSideMenuOpened?this.closeSideMenu():this.openSideMenu())}openSideMenu(){this.isSideMenuOpened=!0,this.$body.addClass("side-menu-opened"),this.$sideMenuBackdrop=(0,v.default)("<div>").addClass("side-menu-backdrop").click(()=>this.closeSideMenu()).appendTo(this.$body),this.$sideMenuBackdrop2=(0,v.default)("<div>").addClass("side-menu-backdrop").click(()=>this.closeSideMenu()).appendTo(this.$navbarRightContainer)}closeSideMenu(){this.isSideMenuOpened=!1,this.$body.removeClass("side-menu-opened"),this.$sideMenuBackdrop.remove(),this.$sideMenuBackdrop2.remove()}switchMinimizer(){const e=this.$body;if(this.isMinimized()?(this.isSideMenuOpened&&this.closeSideMenu(),e.removeClass("minimized"),this.getStorage().set("state","siteLayoutState","expanded")):(e.addClass("minimized"),this.getStorage().set("state","siteLayoutState","collapsed")),window.Event)try{window.dispatchEvent(new Event("resize"))}catch(e){}}getLogoSrc(){var e=this.getConfig().get("companyLogoId");return e?this.getBasePath()+"?entryPoint=LogoImage&id="+e:this.getBasePath()+(this.getThemeManager().getParam("logo")||"client/img/logo.svg")}getTabList(){let e=(this.getPreferences().get("useCustomTabList")?this.getPreferences():this.getConfig()).get("tabList");return e=Espo.Utils.cloneDeep(e||[]),this.isSide()&&e.unshift("Home"),e}setup(){this.getRouter().on("routed",e=>{e.controller?this.selectTab(e.controller):this.selectTab(!1)});const i=this.getMetadata().get(["app","clientNavbar","items"])||{},e=(this.itemList=Object.keys(i).filter(e=>!i[e].disabled).sort((e,t)=>{return(i[e].order||0)-(i[t].order||0)}),this.createView("notificationsBadge","views/notification/badge",{selector:".notifications-badge-container"}),()=>(this.setupTabDefsList(),Promise.all(this.itemList.map(e=>this.createItemView(e))))),t=()=>{e().then(()=>this.reRender())};this.setupGlobalSearch(),e(),this.listenTo(this.getHelper().settings,"sync",()=>t()),this.listenTo(this.getHelper().language,"sync",()=>t()),this.once("remove",()=>{(0,v.default)(window).off("resize.navbar"),(0,v.default)(window).off("scroll.navbar"),(0,v.default)(window).off("scroll.navbar-tab-group"),this.$body.removeClass("has-navbar")})}getItemDataList(){const i={};return this.itemList.forEach(e=>{i[e]=this.getItemDefs(e)}),this.itemList.filter(e=>{if(!i[e])return!1;const t=this.getView(e+"Item");return!("isAvailable"in t)||t.isAvailable()}).map(e=>({key:e+"Item",name:e,class:i[e].class||""}))}getItemDefs(e){return this.getMetadata().get(["app","clientNavbar","items",e])}createItemView(e){var t=this.getItemDefs(e);return t&&t.view?this.createView(e+"Item",t.view,{selector:`[data-item="${e}"]`}):Promise.resolve()}filterTabItem(e){if(~["Home","_delimiter_","_delimiter-ext_"].indexOf(e))return!0;var t=this.getMetadata().get("scopes")||{};if(!t[e])return!1;t=t[e]||{};return t.disabled?void 0:t.acl?this.getAcl().check(e):!t.tabAclPermission||(e=this.getAcl().getPermissionLevel(t.tabAclPermission))&&"no"!==e}setupGlobalSearch(){this.globalSearchAvailable=!1,(this.getConfig().get("globalSearchEntityList")||[]).forEach(e=>{this.globalSearchAvailable||this.getAcl().checkScope(e)&&(this.globalSearchAvailable=!0)}),this.globalSearchAvailable&&this.createView("globalSearch","views/global-search/global-search",{selector:".global-search-container"})}adjustTop(){const t=this.getThemeManager().getParam("screenWidthXs"),a=this.getNavbarHeight(),e=(0,v.default)(window),o=this.$tabs,n=this.$more,l=this.$moreDropdown,i=(e.on("resize.navbar",()=>d()),e.on("scroll.navbar",()=>{this.isMoreDropdownShown&&n.scrollTop(e.scrollTop())}),this.$moreDropdown.on("shown.bs.dropdown",()=>{n.scrollTop(e.scrollTop())}),this.on("show-more-tabs",()=>{n.scrollTop(e.scrollTop())}),()=>{var e=window.innerHeight;window.innerWidth<t?(n.css("max-height",""),n.css("overflow-y","")):(n.css("overflow-y","hidden"),n.css("max-height",e-a+"px"))}),h=(e.on("resize.navbar",()=>{i()}),i(),()=>{var e=o.children().length;if(!(e<=1)){const t=o.children().eq(e-2);t.prependTo(n)}}),c=()=>{const e=n.children().eq(0);e.length&&e.insertBefore(l)},r=(0,v.default)("#navbar .navbar"),u=(window.innerWidth>=t&&(o.children("li").each(()=>{h()}),r.css("max-height","unset"),r.css("overflow","visible")),this.getThemeManager().getParam("navbarBaseWidth")||555),m=this.tabList.length,p=a+1,f=(this.adjustBodyMinHeightMethodName="adjustBodyMinHeightTop",(0,v.default)("#nav-more-tabs-dropdown")),g=f.closest("li"),d=()=>{var e=window.innerWidth,i=g.width();if(n.children("li.not-in-more").each(()=>{c()}),!(e<t)){r.css("max-height",a+"px"),r.css("overflow","hidden"),n.parent().addClass("hidden");var s=this.$el.width()-u-i;let e=o.width(),t=0;for(;e>s;)if(h(),e=o.width(),++t>=m){setTimeout(()=>d(),100);break}r.css("max-height","unset"),r.css("overflow","visible"),0<n.children().length&&l.removeClass("hidden")}},s=e=>{if(r.height()>p)return d(),void setTimeout(()=>s(!0),200);e||(d(),setTimeout(()=>s(!0),10)),setTimeout(()=>s(!0),1e3)};r.height()<=p&&0===n.children().length&&n.parent().addClass("hidden"),s()}adjustSide(){const i=this.getThemeManager().getParam("screenWidthXs"),s=this.getStaticItemsHeight(),e=(0,v.default)(window),a=this.$tabs,o=this.$more,t=(this.adjustBodyMinHeightMethodName="adjustBodyMinHeightSide",0===o.children().length&&o.parent().addClass("hidden"),e.on("scroll.navbar",()=>{e.scrollTop()?this.$navbarRight.addClass("shadowed"):this.$navbarRight.removeClass("shadowed"),a.scrollTop(e.scrollTop()),this.isMoreDropdownShown&&o.scrollTop(e.scrollTop())}),this.$moreDropdown.on("shown.bs.dropdown",()=>{o.scrollTop(e.scrollTop())}),this.on("show-more-tabs",()=>{o.scrollTop(e.scrollTop())}),()=>{var e=window.innerHeight,t=window.innerWidth;if(this.$minimizer.removeClass("hidden"),t<i)return a.css("height","auto"),void o.css("max-height","");a.css("height",e-s+"px"),o.css("max-height",e+"px")});(0,v.default)(window).on("resize.navbar",()=>{t()}),t(),this.adjustBodyMinHeight()}getNavbarHeight(){return this.getThemeManager().getParam("navbarHeight")||43}isSide(){return"side"===this.getThemeManager().getParam("navbar")}getStaticItemsHeight(){return this.getThemeManager().getParam("navbarStaticItemsHeight")||97}adjustBodyMinHeight(){this.adjustBodyMinHeightMethodName&&this[this.adjustBodyMinHeightMethodName]()}adjustBodyMinHeightSide(){let s=this.$tabs.get(0).scrollHeight+this.getStaticItemsHeight(),a=0;this.$more.find("> li:visible").each((e,t)=>{const i=(0,v.default)(t);a+=i.outerHeight(!0)}),s=Math.max(s,a);const o=this.$tabs.find("> .tab:not(.tab-divider)").height();this.tabList.forEach((e,t)=>{if("object"==typeof e){const i=this.$el.find('li.tab[data-name="group-'+t+'"]');i.hasClass("open")&&(t=(e.itemList||[]).length,(e=o*t)>s&&(s=e))}}),this.$body.css("minHeight",s+"px")}adjustBodyMinHeightTop(){let s=this.getNavbarHeight();this.$more.find("> li").each((e,t)=>{const i=(0,v.default)(t);if(this.isMoreTabsShown){if(i.hasClass("show-more"))return}else if(i.hasClass("after-show-more"))return;s+=i.height()});const a=this.$tabs.find(".tab-group > ul > li:visible").height();this.tabList.forEach((e,t)=>{if("object"==typeof e){const i=this.$el.find('li.tab[data-name="group-'+t+'"]');i.hasClass("open")&&(t=(e.itemList||[]).length,(e=a*t)>s&&(s=e))}}),this.$body.css("minHeight",s+"px")}afterRender(){this.$body=(0,v.default)("body"),this.$tabs=this.$el.find("ul.tabs"),this.$more=this.$tabs.find("li.more > ul"),this.$minimizer=this.$el.find("a.minimizer"),this.$body.addClass("has-navbar");const e=this.$moreDropdown=this.$tabs.find("li.more");e.on("shown.bs.dropdown",()=>{this.isMoreDropdownShown=!0,this.adjustBodyMinHeight()}),e.on("hidden.bs.dropdown",()=>{this.isMoreDropdownShown=!1,this.hideMoreTabs(),this.adjustBodyMinHeight()}),this.selectTab(this.getRouter().getLast().controller);let t=this.getStorage().get("state","siteLayoutState"),i=(t=t||(1320<(0,v.default)(window).width()?"expanded":"collapsed"),!1);(i="collapsed"===t?!0:i)&&this.$body.addClass("minimized"),this.$navbar=this.$el.find("> .navbar"),this.$navbarRightContainer=this.$navbar.find("> .navbar-body > .navbar-right-container"),this.$navbarRight=this.$navbarRightContainer.children();var s=this.getThemeManager().getParam("navbarAdjustmentHandler");s?Espo.loader.require(s,e=>{const t=new e(this);(this.navbarAdjustmentHandler=t).process()}):this.getThemeManager().getParam("skipDefaultNavbarAdjustment")||this.adjustAfterRender()}adjustAfterRender(){if(this.isSide()){const e=()=>{this.$navbar.height()<(0,v.default)(window).height()/2?setTimeout(()=>e(),50):this.getThemeManager().isUserTheme()?setTimeout(()=>this.adjustSide(),10):this.adjustSide()};void e()}else{const t=()=>{this.$el.width()<(0,v.default)(window).width()/2?setTimeout(()=>t(),50):this.getThemeManager().isUserTheme()?setTimeout(()=>this.adjustTop(),10):this.adjustTop()};t()}}selectTab(e){this.currentTab!==e&&(this.$el.find("ul.tabs li.active").removeClass("active"),e&&this.$el.find('ul.tabs li[data-name="'+e+'"]').addClass("active"),this.currentTab=e)}setupTabDefsList(){function s(e){return"_delimiter_"===e||"_delimiter-ext_"===e}function a(e){return"object"==typeof e&&"divider"===e.type}this.tabList=this.getTabList().filter(e=>{if(!e)return!1;if("object"!=typeof e)return this.filterTabItem(e);{if("divider"===e.type)return!!this.isSide();let i=(e.itemList||[]).filter(e=>!!a(e)||this.filterTabItem(e));return i=(i=i.filter((e,t)=>{if(!a(e))return!0;e=i[t+1];return!e||!a(e)})).filter((e,t)=>!a(e)||0!==t&&t!==i.length-1),!!(e.itemList=i).length}});let o=!1;this.tabList=this.tabList.filter((e,t)=>{var i=this.tabList[t+1],t=this.tabList[t-1];return s(e)&&(o=!0),!a(e)||(!i||!a(i)&&!(a(t)&&s(i)&&o))});const i=[];const n={colorsDisabled:this.getPreferences().get("scopeColorsDisabled")||this.getPreferences().get("tabColorsDisabled")||this.getConfig().get("scopeColorsDisabled")||this.getConfig().get("tabColorsDisabled"),tabIconsDisabled:this.getConfig().get("tabIconsDisabled")},l={moreIsMet:!1,isHidden:!1};this.tabList.forEach((e,t)=>{if(s(e))return l.moreIsMet?t===this.tabList.length-1?void 0:(l.isHidden=!0,void i.push({name:"show-more",isInMore:!0,className:"show-more",html:'<span class="fas fa-ellipsis-h more-icon"></span>'})):void(l.moreIsMet=!0);i.push(this.prepareTabItemDefs(n,e,t,l))}),this.tabDefsList=i}prepareTabItemDefs(i,e,h,s){let t,a,o=null,n=null,l=!1,r=!1,c=e,u="nav-link";var m=e=>0===e.indexOf("$")?this.translate(e.slice(1),"navbarTabs"):e,h=("Home"===e?(t=this.getLanguage().translate(e),a="#"):"object"==typeof e&&"divider"===e.type?(r=!0,t=e.text,u="nav-divider-text",c="divider-"+h,t=t&&m(t)):"object"==typeof e?(l=!0,t=e.text||"",n=e.color,o=e.iconClass,c="group-"+h,a=null,u="nav-link-group",t=t&&m(t)):(t=this.getLanguage().translate(e,"scopeNamesPlural"),a="#"+e),(t=t||"").substring(0,2));i.colorsDisabled||l||r||(n=this.getMetadata().get(["clientDefs",e,"color"])),i.tabIconsDisabled||l||r||(o=this.getMetadata().get(["clientDefs",e,"iconClass"]));const d={link:a,label:t,shortLabel:h,name:c,isInMore:s.moreIsMet,color:n,iconClass:o,isAfterShowMore:s.isHidden,aClassName:u,isGroup:l,isDivider:r};return l&&(d.itemList=e.itemList.map((e,t)=>this.prepareTabItemDefs(i,e,t,s))),s.isHidden&&(d.className="after-show-more"),n&&!o&&(d.colorIconClass="color-icon fas fa-square"),d}getMenuDataList(){let e=this.getHelper().getAvatarHtml(this.getUser().id,"small",16,"avatar-link"),t=(e&&(e+=" "),[{link:"#User/view/"+this.getUser().id,html:e+this.getHelper().escapeString(this.getUser().get("name"))},{divider:!0}]);return this.getUser().isAdmin()&&t.push({link:"#Admin",label:this.getLanguage().translate("Administration")}),t.push({link:"#Preferences",label:this.getLanguage().translate("Preferences")}),this.getConfig().get("actionHistoryDisabled")||(t.push({divider:!0}),t.push({action:"showLastViewed",link:"#LastViewed",label:this.getLanguage().translate("LastViewed","scopeNamesPlural")})),t=t.concat([{divider:!0},{link:"#About",label:this.getLanguage().translate("About")},{action:"logout",label:this.getLanguage().translate("Log Out")}])}actionLogout(){this.getRouter().logout()}actionShowLastViewed(){Espo.Ui.notify(" ... "),this.createView("dialog","views/modals/last-viewed",{},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"close",()=>{this.clearView("dialog")})})}actionShowHistory(){this.createView("dialog","views/modals/action-history",{},e=>{e.render(),this.listenTo(e,"close",()=>{this.clearView("dialog")})})}showMoreTabs(){this.$el.find(".tab-group.tab.dropdown").removeClass("open"),this.isMoreTabsShown=!0,this.$more.addClass("more-expanded"),this.adjustBodyMinHeight(),this.trigger("show-more-tabs")}hideMoreTabs(){this.isMoreTabsShown&&(this.$more.removeClass("more-expanded"),this.adjustBodyMinHeight(),this.isMoreTabsShown=!1)}}e.default=s}),define("views/site/master",["exports","view","jquery"],function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),o=i(o);class s extends t.default{template="site/master";views={header:{id:"header",view:"views/site/header"},main:{id:"main",view:!1},footer:{fullSelector:"body > footer",view:"views/site/footer"}};showLoadingNotification(){Espo.Ui.notify(" ... ")}hideLoadingNotification(){Espo.Ui.notify(!1)}setup(){(0,o.default)(window).on("resize."+this.cid,()=>{this.adjustContent()})}onRemove(){(0,o.default)(window).off("resize."+this.cid)}afterRender(){var e,t=this.getThemeManager().getParam("params");let i=(0,o.default)("body");for(e in t){var s=this.getThemeManager().getParam(e);i.attr("data-"+Espo.Utils.camelCaseToHyphen(e),s)}let a=this.getView("footer");if(a){let e=a.$el.html()||"";if((e.match(/espocrm/gi)||[]).length<2){t="PHAgY2xhc3M9ImNyZWRpdCBzbWFsbCI+JmNvcHk7IDxhIGhyZWY9Imh0dHA6Ly93d3cuZXNwb2NybS5jb20iPkVzcG9DUk08L2E+PC9wPg==";let e;"function"==typeof window.atob?e=window.atob(t):"function"==typeof atob&&(e=atob(t)),e&&a.$el.html(e)}}this.$content=this.$el.find("> #content"),this.adjustContent();t=this.getHelper().getAppParam("extensions")||[];this.getConfig().get("maintenanceMode")?this.createView("dialog","views/modal",{templateContent:'<div class="text-danger">{{complexText viewObject.options.message}}</div>',headerText:this.translate("maintenanceMode","fields","Settings"),backdrop:!0,message:this.translate("maintenanceMode","messages"),buttonList:[{name:"close",label:this.translate("Close")}]},e=>{e.render()}):this.getHelper().getAppParam("auth2FARequired")?this.createView("dialog","views/modals/auth2fa-required",{},e=>{e.render()}):0!==t.length&&this.processExtensions(t)}adjustContent(){if(this.isRendered()){if(window.innerWidth<this.getThemeManager().getParam("screenWidthXs")){this.isSmallScreen=!0;let e=window.innerHeight-this.$content.get(0).getBoundingClientRect().top,t=(0,o.default)("#navbar .navbar-body");(t.hasClass("in")||t.hasClass("collapsing"))&&(e+=t.height());var i=(0,o.default)("#footer").height()||26;return(e-=i)<=0?void this.$content.css("minHeight",""):void this.$content.css("minHeight",e+"px")}this.isSmallScreen&&this.$content.css("minHeight",""),this.isSmallScreen=!1}}processExtensions(e){let i=[];if(e.forEach(e=>{var t;e.notify&&(t=e.licenseStatusMessage??"extensionLicense"+Espo.Utils.upperCaseFirst(Espo.Utils.hyphenToCamelCase(e.licenseStatus.toLowerCase())),i.push(this.translate(t,"messages").replace("{name}",e.name)))}),i.length){let e=i.join("\n\n"),t=(e=this.getHelper().transformMarkdownText(e),new Espo.Ui.Dialog({backdrop:"static",buttonList:[{name:"close",text:this.translate("Close"),className:"btn-s-wide",onClick:()=>t.close()}],className:"dialog-confirm text-danger",body:e.toString()}));t.show()}}}e.default=s}),define("views/site/header",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="site/header";title="EspoCRM";navbarView="views/site/navbar";customViewPath=["clientDefs","App","navbarView"];data={title:this.title};setup(){var e=this.getMetadata().get(this.customViewPath)||this.navbarView;this.createView("navbar",e,{fullSelector:"#navbar",title:this.title})}}e.default=s}),define("views/site/footer",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="site/footer"}e.default=s}),define("views/search/filter",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="search/filter";data(){return{name:this.name,scope:this.model.entityType,notRemovable:this.options.notRemovable}}setup(){var e=this.name=this.options.name,t=this.model.getFieldType(e);t&&(t=this.model.getFieldParam(e,"view")||this.getFieldManager().getViewName(t),this.createView("field",t,{mode:"search",model:this.model,selector:".field",defs:{name:e},searchParams:this.options.params},e=>{this.listenTo(e,"change",()=>{this.trigger("change")}),this.listenTo(e,"search",()=>{this.trigger("search")})}))}getFieldView(){return this.getView("field")}populateDefaults(){const e=this.getView("field");e&&"populateSearchDefaults"in e&&e.populateSearchDefaults()}}e.default=s}),define("views/record/search",["exports","view","helpers/misc/stored-text-search"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{template="record/search";scope="";entityType="";searchManager;fieldFilterList=null;fieldFilterTranslations=null;textFilter="";primary=null;presetFilterList=null;advanced;bool=null;disableSavePreset=!1;textFilterDisabled=!1;toShowApplyFiltersButton=!1;toShowResetFiltersText=!1;isSearchedWithAdvancedFilter=!1;viewModeIconClassMap={list:"fas fa-align-justify",kanban:"fas fa-align-left fa-rotate-90"};FIELD_QUICK_SEARCH_COUNT_THRESHOLD=4;autocompleteLimit=7;data(){return{scope:this.scope,entityType:this.entityType,textFilter:this.textFilter,bool:this.bool||{},boolFilterList:this.boolFilterList,hasFieldQuickSearch:this.fieldFilterList.length>=this.FIELD_QUICK_SEARCH_COUNT_THRESHOLD,filterFieldDataList:this.getFilterFieldDataList(),filterDataList:this.getFilterDataList(),presetName:this.presetName,presetFilterList:this.getPresetFilterList(),leftDropdown:this.isLeftDropdown(),textFilterDisabled:this.textFilterDisabled,viewMode:this.viewMode,viewModeDataList:this.viewModeDataList||[],hasViewModeSwitcher:this.viewModeList&&1<this.viewModeList.length,isWide:this.options.isWide,toShowApplyFiltersButton:this.toShowApplyFiltersButton,toShowResetFiltersText:this.toShowResetFiltersText}}setup(){this.entityType=this.collection.entityType,this.scope=this.options.scope||this.entityType,this.searchManager=this.options.searchManager,this.storedTextSearchHelper=new a.default(this.scope,this.getHelper().storage),this.textSearchStoringDisabled=this.getPreferences().get("textSearchStoringDisabled"),this.textFilterDisabled=this.options.textFilterDisabled||this.textFilterDisabled||this.getMetadata().get(["clientDefs",this.scope,"textFilterDisabled"]),"disableSavePreset"in this.options&&(this.disableSavePreset=this.options.disableSavePreset),this.viewMode=this.options.viewMode,this.viewModeList=this.options.viewModeList,this.addReadyCondition(()=>null!==this.fieldFilterList),this.boolFilterList=Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.scope,"boolFilterList"])||[]).filter(e=>"string"==typeof e||!(e=e||{}).aux&&((!e.inPortalDisabled||!this.getUser().isPortal())&&(!(e.isPortalOnly&&!this.getUser().isPortal())&&!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))))).map(e=>"string"==typeof e?e:(e=e||{}).name),this.fieldFilterTranslations={};const i=this.getAcl().getScopeForbiddenFieldList(this.entityType)||[];this.wait(new Promise(t=>{this.getHelper().layoutManager.get(this.entityType,"filters",e=>{this.fieldFilterList=[],(e||[]).forEach(e=>{~i.indexOf(e)||(this.fieldFilterList.push(e),this.fieldFilterTranslations[e]=this.translate(e,"fields",this.entityType))}),t()})}));var e=this.options.filterList||this.getMetadata().get(["clientDefs",this.scope,"filterList"])||[];if(this.presetFilterList=Espo.Utils.clone(e).filter(e=>"string"==typeof e||!(e=e||{}).aux&&((!e.inPortalDisabled||!this.getUser().isPortal())&&(!(e.isPortalOnly&&!this.getUser().isPortal())&&!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))))),((this.getPreferences().get("presetFilters")||{})[this.scope]||[]).forEach(e=>{this.presetFilterList.push(e)}),this.getMetadata().get(["scopes",this.entityType,"stream"])&&this.boolFilterList.push("followed"),this.loadSearchData(),this.hasAdvancedFilter()&&(this.isSearchedWithAdvancedFilter=!0),this.presetName){let e=!1;for(const s in this.presetFilterList){var t=this.presetFilterList[s]||{};if(("string"==typeof t?t:t.name)===this.presetName){e=!0;break}}e||this.presetFilterList.push(this.presetName)}this.model=this.collection.prepareModel(),this.model.clear(),this.createFilters(),this.setupViewModeDataList(),this.listenTo(this.collection,"order-changed",()=>{this.controlResetButtonVisibility()}),this.wait(this.getHelper().processSetupHandlers(this,"record/search"))}setupViewModeDataList(){if(!this.viewModeList)return[];const t=[];this.viewModeList.forEach(e=>{e={name:e,title:this.translate(e,"listViewModes"),iconClass:this.viewModeIconClassMap[e]};t.push(e)}),this.viewModeDataList=t}setViewMode(e,t,i){this.viewMode=e,this.isRendered()?(this.$el.find('[data-action="switchViewMode"]').removeClass("active"),this.$el.find('[data-action="switchViewMode"][data-name="'+e+'"]').addClass("active")):this.isBeingRendered()&&!t&&this.once("after:render",()=>{this.setViewMode(e,!0)}),i&&this.trigger("change-view-mode",e)}isLeftDropdown(){return this.presetFilterList.length||this.boolFilterList.length||Object.keys(this.advanced||{}).length}handleLeftDropdownVisibility(){this.isLeftDropdown()?this.$leftDropdown.removeClass("hidden"):this.$leftDropdown.addClass("hidden")}createFilters(e){let t=0;const i=Object.keys(this.advanced||{}).length;0===i&&"function"==typeof e&&e();for(const s in this.advanced)this.createFilter(s,this.advanced[s],()=>{++t===i&&"function"==typeof e&&e()})}events={'keydown input[data-name="textFilter"]':function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Enter"!==e.code&&"Enter"!==t&&"Control+Enter"!==t||(this.search(),this.hideApplyFiltersButton())},'focus input[data-name="textFilter"]':function(e){e.currentTarget.select()},'click .advanced-filters-apply-container a[data-action="applyFilters"]':function(){this.search(),this.hideApplyFiltersButton(),this.$el.find("button.search").focus()},'click button[data-action="search"]':function(){this.search(),this.hideApplyFiltersButton()},'click a[data-action="addFilter"]':function(e){const t=$(e.currentTarget);e=t.data("name");t.closest("li").addClass("hidden"),this.addFilter(e)},"click .advanced-filters a.remove-filter":function(e){const t=$(e.currentTarget);e=t.data("name");this.removeFilter(e)},'click button[data-action="reset"]':function(){this.resetFilters()},'click button[data-action="refresh"]':function(){this.refresh()},'click a[data-action="selectPreset"]':function(e){const t=$(e.currentTarget);e=t.data("name")||null;this.selectPreset(e)},'click .dropdown-menu a[data-action="savePreset"]':function(){this.createView("savePreset","views/modals/save-filters",{},t=>{t.render(),this.listenToOnce(t,"save",e=>{this.savePreset(e),t.close(),this.removeFilters(),this.createFilters(()=>{this.render()})})})},'click .dropdown-menu a[data-action="removePreset"]':function(){const e=this.presetName;this.confirm(this.translate("confirmation","messages"),()=>{this.removePreset(e)})},'change .search-row ul.filter-menu input[data-role="boolFilterCheckbox"]':function(e){e.stopPropagation(),this.search(),this.manageLabels()},'click [data-action="switchViewMode"]':function(e){e=$(e.currentTarget).data("name");e!==this.viewMode&&this.setViewMode(e,!1,!0)},"keyup input.field-filter-quick-search-input":function(e){this.processFieldFilterQuickSearch(e.currentTarget.value)},"keydown input.field-filter-quick-search-input":function(e){"Enter"!==e.code?"Escape"===e.code&&this.closeAddFieldDropdown():this.addFirstFieldFilter()}};removeFilter(e){this.$el.find('ul.filter-list li[data-name="'+e+'"]').removeClass("hidden");const t=this.getView("filter-"+e).$el.closest("div.filter");if(this.clearView("filter-"+e),t.remove(),delete this.advanced[e],this.presetName=this.primary,this.updateAddFilterButton(),this.fetch(),this.updateSearch(),this.manageLabels(),this.handleLeftDropdownVisibility(),this.controlResetButtonVisibility(),this.isSearchedWithAdvancedFilter)return this.hasAdvancedFilter()?this.showApplyFiltersButton():this.showResetFiltersButton(),void this.$applyFilters.focus();this.hasAdvancedFilter()||this.hideApplyFiltersButton()}addFilter(e){this.advanced[e]={},this.presetName=this.primary,this.createFilter(e,{},e=>{e.populateDefaults(),this.fetch(),this.updateSearch(),e.getFieldView().initialSearchIsNotIdle&&this.showApplyFiltersButton()}),this.updateAddFilterButton(),this.handleLeftDropdownVisibility(),this.manageLabels(),this.controlResetButtonVisibility()}refresh(){Espo.Ui.notify(" ... "),this.collection.abortLastFetch(),this.collection.reset(),this.collection.fetch().then(()=>{Espo.Ui.notify(!1)})}selectPreset(e,t){var i=!(this.primary===this.presetName),e=(this.presetName=e,this.getPresetData()),s=(this.primary=this.getPrimaryFilterName(),!(this.primary===this.presetName));(t||i||s||Object.keys(e).length)&&(this.removeFilters(),this.advanced=e),this.updateSearch(),this.manageLabels(),this.createFilters(()=>{this.reRender().then(()=>{this.$el.find(".filters-button").get(0).focus({preventScroll:!0})})}),this.updateCollection()}removeFilters(){this.$advancedFiltersPanel.empty();for(const e in this.advanced)this.clearView("filter-"+e)}resetFilters(){this.trigger("reset"),this.collection.resetOrderToDefault(),this.textFilter="",this.selectPreset(this.presetName,!0),this.hideApplyFiltersButton(),this.trigger("update-ui")}savePreset(e){var t="f"+Math.floor(1000001*Math.random()).toString();this.fetch(),this.updateSearch();const i=this.getPreferences().get("presetFilters")||{};this.scope in i||(i[this.scope]=[]);e={id:t,name:t,label:e,data:this.advanced,primary:this.primary};i[this.scope].push(e),this.presetFilterList.push(e),this.getPreferences().once("sync",()=>{this.getPreferences().trigger("update"),this.updateSearch()}),this.getPreferences().save({presetFilters:i},{patch:!0}),this.presetName=t}removePreset(i){const e=this.getPreferences().get("presetFilters")||{};this.scope in e||(e[this.scope]=[]);let s;(s=e[this.scope]).forEach((e,t)=>{e.id===i&&s.splice(t,1)}),(s=this.presetFilterList).forEach((e,t)=>{e.id===i&&s.splice(t,1)}),this.getPreferences().set("presetFilters",e),this.getPreferences().save({patch:!0}),this.getPreferences().trigger("update"),this.presetName=this.primary,this.advanced={},this.removeFilters(),this.render(),this.updateSearch(),this.updateCollection()}updateAddFilterButton(){const e=this.$el.find("ul.filter-list");0===e.children().not(".hidden").not(".dropdown-header").not(".quick-search-list-item").length?this.$addFilterButton.addClass("disabled"):this.$addFilterButton.removeClass("disabled"),this.trigger("update-ui")}afterRender(){this.$filtersLabel=this.$el.find(".search-row span.filters-label"),this.$filtersButton=this.$el.find(".search-row button.filters-button"),this.$leftDropdown=this.$el.find("div.search-row div.left-dropdown"),this.$resetButton=this.$el.find('[data-action="reset"]'),this.$applyFiltersContainer=this.$el.find(".advanced-filters-apply-container"),this.$applyFilters=this.$applyFiltersContainer.find('[data-action="applyFilters"]'),this.$filterList=this.$el.find("ul.filter-list"),this.$fieldQuickSearch=this.$filterList.find("input.field-filter-quick-search-input"),this.$addFilterButton=this.$el.find("button.add-filter-button"),this.$textFilter=this.$el.find("input.text-filter"),this.updateAddFilterButton(),this.$advancedFiltersPanel=this.$el.find(".advanced-filters"),this.manageLabels(),this.controlResetButtonVisibility(),this.initQuickSearchUi(),this.initTextSearchAutocomplete()}initTextSearchAutocomplete(){if(!this.textSearchStoringDisabled){let t=!1;this.$textFilter.autocomplete({minChars:0,noCache:!0,triggerSelectOnValidInput:!1,beforeRender:e=>{e.addClass("text-search-suggestions"),e.off("mousedown"),e.on("mousedown",e=>{0===e.originalEvent.button&&(t=!0,setTimeout(()=>t=!1,201))}),e.find('a[data-action="clearStoredTextSearch"]').on("click",e=>{e.stopPropagation(),e.preventDefault();e=e.currentTarget.getAttribute("data-value");this.storedTextSearchHelper.remove(e),setTimeout(()=>this.$textFilter.focus(),205)})},formatResult:e=>$("<span>").append($("<a>").attr("data-action","clearStoredTextSearch").attr("role","button").attr("data-value",e.value).attr("title",this.translate("Remove")).html('<span class="fas fa-times fa-sm"></span>').addClass("pull-right text-soft"),$("<span>").text(e.value)).get(0).innerHTML,lookup:(e,t)=>{t({suggestions:this.storedTextSearchHelper.match(e,this.autocompleteLimit).map(e=>({value:e}))})},onSelect:()=>{this.$textFilter.focus(),this.$textFilter.autocomplete("hide")}}),this.$textFilter.on("blur",()=>{t||setTimeout(()=>this.$textFilter.autocomplete("hide"),1)}),this.$textFilter.on("focus",()=>{this.$textFilter.val()&&this.$textFilter.autocomplete("hide")}),this.once("render",()=>this.$textFilter.autocomplete("dispose")),this.once("remove",()=>this.$textFilter.autocomplete("dispose"))}}initQuickSearchUi(){this.$addFilterButton.parent().on("show.bs.dropdown",()=>{setTimeout(()=>{this.$fieldQuickSearch.focus();var e=this.$fieldQuickSearch.outerWidth();this.$fieldQuickSearch.css("minWidth",e)},1)}),this.$addFilterButton.parent().on("hide.bs.dropdown",()=>{this.resetFieldFilterQuickSearch(),this.$fieldQuickSearch.css("minWidth","")})}manageLabels(){this.$el.find("ul.dropdown-menu > li.preset-control").addClass("hidden"),this.currentFilterLabelList=[],this.managePresetFilters(),this.manageBoolFilters(),this.$filtersLabel.html(this.currentFilterLabelList.join(" &middot; "))}toShowResetButton(){if(this.textFilter)return!0;var e=this.presetName||null,t=this.primary;return!(e&&e!==t||!Object.keys(this.advanced).length)||(this.collection.orderBy!==this.collection.defaultOrderBy||this.collection.order!==this.collection.defaultOrder)}controlResetButtonVisibility(){this.toShowResetButton()?this.$resetButton.css("visibility","visible"):this.$resetButton.css("visibility","hidden")}managePresetFilters(){let a=this.presetName||null;var e,t=this.primary;this.$el.find("ul.filter-menu a.preset span").remove();let o=this.translate("all","presetFilters",this.entityType),n="default";if((a=!a&&t?t:a)&&a!==t){this.$advancedFiltersPanel.addClass("hidden");let t=null,i="default",s=null;this.presetFilterList.forEach(e=>{e.name===a&&(t=e.label||!1,i=e.style||"default",s=e.id)}),t=t||this.translate(this.presetName,"presetFilters",this.entityType),o=t,n=i,s&&(this.$el.find("ul.dropdown-menu > li.divider.preset-control").removeClass("hidden"),this.$el.find("ul.dropdown-menu > li.preset-control.remove-preset").removeClass("hidden"))}else this.$advancedFiltersPanel.removeClass("hidden"),0!==Object.keys(this.advanced).length&&(this.disableSavePreset||(this.$el.find("ul.dropdown-menu > li.divider.preset-control").removeClass("hidden"),this.$el.find("ul.dropdown-menu > li.preset-control.save-preset").removeClass("hidden"),this.$el.find("ul.dropdown-menu > li.preset-control.remove-preset").addClass("hidden"))),t&&(t=this.translate(t,"presetFilters",this.entityType),e=this.getPrimaryFilterStyle(),o=t,n=e);this.currentFilterLabelList.push(o),this.$filtersButton.removeClass("btn-default").removeClass("btn-primary").removeClass("btn-danger").removeClass("btn-success").removeClass("btn-info"),this.$filtersButton.addClass("btn-"+n),a=a||"",this.$el.find('ul.filter-menu a.preset[data-name="'+a+'"]').prepend('<span class="fas fa-check pull-right"></span>')}manageBoolFilters(){(this.boolFilterList||[]).forEach(e=>{this.bool[e]&&(e=this.translate(e,"boolFilters",this.entityType),this.currentFilterLabelList.push(e))})}search(){this.fetch(),this.updateSearch(),this.updateCollection(),this.controlResetButtonVisibility(),this.storeTextSearch(),this.isSearchedWithAdvancedFilter=this.hasAdvancedFilter()}hasAdvancedFilter(){return 0<Object.keys(this.advanced).length}getFilterDataList(){const e=[];for(const t in this.advanced)e.push({key:"filter-"+t,name:t});return e}updateCollection(){this.collection.abortLastFetch(),this.collection.reset(),this.collection.where=this.searchManager.getWhere(),this.collection.offset=0,Espo.Ui.notify(" ... "),this.collection.fetch().then(()=>{Espo.Ui.notify(!1)})}getPresetFilterList(){const t=[];return this.presetFilterList.forEach(e=>{"string"==typeof e&&(e={name:e}),t.push(e)}),t}getPresetData(){let t={};return this.getPresetFilterList().forEach(e=>{e.name===this.presetName&&(t=Espo.Utils.clone(e.data||{}))}),t}getPrimaryFilterName(){let t=null;return this.getPresetFilterList().forEach(e=>{e.name===this.presetName&&("data"in e?e.primary&&(t=e.primary):t=e.name)}),t}getPrimaryFilterStyle(){let t=null;return this.getPresetFilterList().forEach(e=>{e.name===this.primary&&(t=e.style||"default")}),t}loadSearchData(){var e=this.searchManager.get();this.textFilter=e.textFilter,"presetName"in e&&(this.presetName=e.presetName);let t=!1;"primary"in e&&(this.primary=e.primary,this.presetName||(this.presetName=this.primary),t=!0),this.presetName?(this.advanced=_.extend(Espo.Utils.clone(this.getPresetData()),e.advanced),t||(this.primary=this.getPrimaryFilterName())):this.advanced=Espo.Utils.clone(e.advanced),this.bool=e.bool}createFilter(e,t,i,s){t=t||{};let a=!1;this.isRendered()&&(a=!0,this.$advancedFiltersPanel.append('<div data-name="'+e+'" class="filter filter-'+e+'" />')),this.createView("filter-"+e,"views/search/filter",{name:e,model:this.model,params:t,selector:'.filter[data-name="'+e+'"]'},t=>{"function"==typeof i&&t.once("after:render",()=>{i(t)}),a&&!s&&t.render(),this.listenTo(t,"change",()=>{let e=this.isSearchedWithAdvancedFilter;e||t.getView("field").fetchSearch()&&(e=!0),e&&this.showApplyFiltersButton()}),this.listenTo(t,"search",()=>{this.search(),this.hideApplyFiltersButton()})})}fetch(){this.textFilter=(this.$el.find('input[data-name="textFilter"]').val()||"").trim(),this.bool={},this.boolFilterList.forEach(e=>{this.bool[e]=this.$el.find('input[data-name="'+e+'"][data-role="boolFilterCheckbox"]').prop("checked")});for(const e in this.advanced){const t=this.getView("filter-"+e).getView("field");this.advanced[e]=t.fetchSearch(),t.searchParams=Espo.Utils.clone(this.advanced[e]||{})}}updateSearch(){this.searchManager.set({textFilter:this.textFilter,advanced:this.advanced,bool:this.bool,presetName:this.presetName,primary:this.primary})}getFilterFieldDataList(){const e=[];for(const i in this.fieldFilterList){var t=this.fieldFilterList[i],t={name:t,checked:t in this.advanced,label:this.fieldFilterTranslations[t]||t};e.push(t)}return e}showResetFiltersButton(){this.toShowApplyFiltersButton=!0,this.toShowResetFiltersText=!0,this.$applyFiltersContainer.removeClass("hidden"),this.$applyFiltersContainer.find(".text-apply").addClass("hidden"),this.$applyFiltersContainer.find(".text-reset").removeClass("hidden")}showApplyFiltersButton(){this.toShowApplyFiltersButton=!0,this.toShowResetFiltersText=!1,this.$applyFiltersContainer.removeClass("hidden"),this.$applyFiltersContainer.find(".text-reset").addClass("hidden"),this.$applyFiltersContainer.find(".text-apply").removeClass("hidden")}hideApplyFiltersButton(){this.toShowApplyFiltersButton=!1,this.toShowResetFiltersText=!1,this.$applyFiltersContainer.addClass("hidden")}selectPreviousPreset(){const e=Espo.Utils.clone(this.getPresetFilterList());var t;e.unshift({name:null}),1!==e.length&&((t=e.findIndex(e=>e.name===this.presetName)-1)<0||(t=e[t],this.selectPreset(t.name)))}selectNextPreset(){const e=Espo.Utils.clone(this.getPresetFilterList());var t;e.unshift({name:null}),1!==e.length&&((t=e.findIndex(e=>e.name===this.presetName)+1)>=e.length||(t=e[t],this.selectPreset(t.name)))}processFieldFilterQuickSearch(a){a=(a=a.trim()).toLowerCase();const o=this.$filterList.find("li.filter-item");""!==a?(o.addClass("search-hidden"),this.fieldFilterList.forEach(e=>{let t=this.fieldFilterTranslations[e]||e;const i=(t=t.toLowerCase()).split(" ");let s=0===t.indexOf(a);(s=s||0<i.filter(e=>3<e.length&&0===e.indexOf(a)).length)&&o.filter(`[data-name="${e}"]`).removeClass("search-hidden")})):o.removeClass("search-hidden")}resetFieldFilterQuickSearch(){this.$fieldQuickSearch.val(""),this.$filterList.find("li.filter-item").removeClass("search-hidden")}addFirstFieldFilter(){const e=this.$filterList.find("li.filter-item:not(.hidden):not(.search-hidden)").first();var t;e.length&&(t=e.attr("data-name"),e.addClass("hidden"),this.closeAddFieldDropdown(),this.addFilter(t),this.resetFieldFilterQuickSearch())}closeAddFieldDropdown(){this.$addFilterButton.parent().find('[data-toggle="dropdown"]').dropdown("toggle")}storeTextSearch(){this.textFilter&&(this.textSearchStoringDisabled||this.storedTextSearchHelper.store(this.textFilter))}}e.default=s}),define("views/record/panel-actions",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/panel-actions";data(){return{defs:this.options.defs,buttonList:this.getButtonList(),actionList:this.getActionList(),entityType:this.options.entityType,scope:this.options.scope}}setup(){this.buttonList=this.options.defs.buttonList||[],this.actionList=this.options.defs.actionList||[],this.defs=this.options.defs}getButtonList(){const t=[];return this.buttonList.forEach(e=>{e.hidden||t.push(e)}),t}getActionList(){return this.actionList.filter(e=>!e.hidden).map(e=>((e=Espo.Utils.clone(e)).action&&(e.data=Espo.Utils.clone(e.data||{}),e.data.panel=this.options.defs.name),e))}}e.default=s}),define("views/record/merge",["exports","view","jquery"],function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),r=i(r);class s extends t.default{template="record/merge";scope="";events={'change input[type="radio"][name="check-all"]':function(e){e.stopPropagation();e=e.currentTarget.value;(0,r.default)('input[data-id="'+e+'"]').prop("checked",!0)},'click button[data-action="cancel"]':function(){this.getRouter().navigate("#"+this.scope,{trigger:!0})},'click button[data-action="merge"]':function(){const t=(0,r.default)('input[type="radio"][name="check-all"]:checked').val();let n;this.models.forEach(e=>{e.id===t&&(n=e)});const l={};(0,r.default)("input.field-radio:checked").each((e,i)=>{var s=i.name;const a=(0,r.default)(i).attr("data-id");if(n.id!==a){i=n.getFieldParam(s,"type");const o=this.getFieldManager().getActualAttributeList(i,s);let t;this.models.forEach(e=>{e.id===a&&(t=e)}),o.forEach(e=>{l[e]=t.get(e)})}}),Espo.Ui.notify(" ... ");var e=this.models.filter(e=>e.id!==n.id).map(e=>e.id);Espo.Ajax.postRequest("Action",{entityType:this.scope,action:"merge",id:n.id,data:{sourceIdList:e,attributes:l}}).then(()=>{Espo.Ui.success(this.translate("Merged"),{suppress:!0}),this.getRouter().navigate("#"+this.scope+"/view/"+n.id,{trigger:!0}),this.collection&&this.collection.fetch()})}};data(){const e=[];return this.fields.forEach(t=>{const i={name:t,scope:this.scope,columns:[]};this.models.forEach(e=>{i.columns.push({id:e.id,fieldVariable:e.id+"-"+t,isReadOnly:this.readOnlyFields[t]||!1})}),e.push(i)}),{rows:e,modelList:this.models,scope:this.scope,hasCreatedAt:this.hasCreatedAt,width:Math.round((80-5*this.models.length)/this.models.length*10)/10,dataList:this.getDataList()}}afterRender(){(0,r.default)('input[data-id="'+this.models[0].id+'"]').prop("checked",!0)}setup(){this.scope=this.options.models[0].name,this.models=this.options.models;const e=this.getFieldManager();let t=[];var i=this.models[0].defs.fields;this.readOnlyFields={};for(const o in i){var s=i[o].type;if("linkMultiple"!==s&&(!(i[o].disabled||i[o].utility||i[o].mergeDisabled)&&"createdAt"!==o&&"modifiedAt"!==o&&e.isMergeable(s))){const n=e.getActualAttributeList(s,o);let a=!1;n.forEach(t=>{const i=[],s=(this.models.forEach(e=>{i.push(e.get(t))}),i[0]);i.forEach(e=>{_.isEqual(s,e)||(a=!0)})}),a&&(t.push(o),this.models[0].isFieldReadOnly(o)&&(this.readOnlyFields[o]=!0))}}t.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),t=t.sort((e,t)=>!this.readOnlyFields[e]&&this.readOnlyFields[t]?-1:1),this.fields=t,this.fields.forEach(i=>{const s=this.models[0].getFieldParam(i,"type");this.models.forEach(e=>{var t=e.getFieldParam(i,"view")||this.getFieldManager().getViewName(s);this.createView(e.id+"-"+i,t,{model:e,fullSelector:'.merge [data-id="'+e.id+'"] .field[data-name="'+i+'"]',defs:{name:i},mode:"detail",readOnly:!0})})}),this.hasCreatedAt=this.getMetadata().get(["entityDefs",this.scope,"fields","createdAt"]),this.hasCreatedAt&&this.models.forEach(e=>{this.createView(e.id+"-createdAt","views/fields/datetime",{model:e,fullSelector:'.merge [data-id="'+e.id+'"] .field[data-name="createdAt"]',defs:{name:"createdAt"},mode:"detail",readOnly:!0})})}getDataList(){const i=[];return this.models.forEach(e=>{const t={};t.id=e.id,t.name=e.get("name"),t.createdAtViewName=e.id+"-createdAt",i.push(t)}),i}}e.default=s}),define("views/record/list-tree",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-tree";showMore=!1;showCount=!1;checkboxes=!1;rowActionsView=!1;presentationType="tree";header=!1;listContainerEl=" > .list > ul";checkAllResultDisabled=!0;showRoot=!1;massActionList=["remove"];selectable=!1;createDisabled=!1;selectedData=null;level=0;itemViewName="views/record/list-tree-item";data(){const e=super.data();return e.createDisabled=this.createDisabled,e.showRoot=this.showRoot,e.showRoot&&(e.rootName=this.rootName||this.translate("Root")),e.showEditLink=this.showEditLink,0===this.level&&this.selectable&&null===(this.selectedData||{}).id&&(e.rootIsSelected=!0),0===this.level&&this.options.hasExpandedToggler&&(e.hasExpandedToggler=!0),0===this.level&&(e.isExpanded=this.isExpanded),(e.hasExpandedToggler||this.showEditLink)&&(e.showRootMenu=!0),this.options.menuDisabled&&(e.showRootMenu=!1),e.noData=e.createDisabled&&!e.rowList.length&&!e.showRoot,e}setup(){"selectable"in this.options&&(this.selectable=this.options.selectable),this.readOnly=this.options.readOnly,this.createDisabled=this.readOnly||this.options.createDisabled||this.createDisabled,this.isExpanded=this.options.isExpanded,"showRoot"in this.options&&(this.showRoot=this.options.showRoot,"rootName"in this.options&&(this.rootName=this.options.rootName)),"showRoot"in this.options&&(this.showEditLink=this.options.showEditLink),"level"in this.options&&(this.level=this.options.level),this.rootView=this.options.rootView||this,0===this.level&&(this.selectedData={id:null,path:[],names:{}}),"selectedData"in this.options&&(this.selectedData=this.options.selectedData),super.setup(),this.selectable&&this.on("select",e=>{e.id&&(this.$el.find('a.link[data-id="'+e.id+'"]').addClass("text-bold"),0===this.level&&(this.$el.find("a.link").removeClass("text-bold"),this.$el.find('a.link[data-id="'+e.id+'"]').addClass("text-bold"),this.setSelected(e.id),e.selectedData=this.selectedData)),0<this.level&&this.getParentView().trigger("select",e)})}setSelected(i){this.selectedData.id=null===i?null:i,this.rowList.forEach(e=>{const t=this.getView(e);t.model.id===i?t.setIsSelected():t.isSelected=!1,t.hasView("children")&&t.getChildrenView().setSelected(i)})}buildRows(s){if(this.checkedList=[],this.rowList=[],0<this.collection.length){this.wait(!0);const e=this.collection.models,a=e.length;let i=0;void e.forEach(e=>{var t=e.id;this.rowList.push(t),this.createView(t,this.itemViewName,{model:e,collection:this.collection,selector:this.getRowSelector(e.id),createDisabled:this.createDisabled,readOnly:this.readOnly,level:this.level,isSelected:e.id===this.selectedData.id,selectedData:this.selectedData,selectable:this.selectable,setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered(),rootView:this.rootView},()=>{++i===a&&("function"==typeof s&&s(),this.wait(!1))})})}else"function"==typeof s&&s()}getRowSelector(e){return'li[data-id="'+e+'"]'}getItemEl(e,t){return this.getSelector()+' li[data-id="'+e.id+'"] span.cell[data-name="'+t.name+'"]'}getCreateAttributes(){return{}}actionCreate(e,t){t.stopPropagation();const s=this.getCreateAttributes();let i=0;this.collection.models.forEach(e=>{e.get("order")>i&&(i=e.get("order"))}),s.order=i+1,s.parentId=null,s.parentName=null,this.model&&(s.parentId=this.model.id,s.parentName=this.model.get("name"));var t=this.collection.entityType,a=this.getMetadata().get("clientDefs."+t+".modalViews.edit")||"views/modals/edit";this.createView("quickCreate",a,{scope:t,attributes:s},i=>{i.render(),this.listenToOnce(i,"after:save",e=>{i.close();const t=this.collection;if(e.set("childCollection",t.createSeed()),e.get("parentId")===s.parentId)this.collection.push(e),this.buildRows(()=>{this.render()});else{let e=this;for(;;){if(!e.level)break;e=e.getParentView().getParentView()}void e.collection.fetch()}})})}actionSelectRoot(){this.trigger("select",{id:null}),this.selectable&&(this.$el.find("a.link").removeClass("text-bold"),this.$el.find('a.link[data-action="selectRoot"]').addClass("text-bold"),this.setSelected(null))}}e.default=s}),define("views/record/list-tree-item",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-tree-item";isEnd=!1;level=0;listViewName="views/record/list-tree";data(){return{name:this.model.get("name"),isUnfolded:this.isUnfolded,showFold:this.isUnfolded&&!this.isEnd,showUnfold:!this.isUnfolded&&!this.isEnd,isEnd:this.isEnd,isSelected:this.isSelected,readOnly:this.readOnly}}events={'click [data-action="unfold"]':function(e){this.unfold(),e.stopPropagation()},'click [data-action="fold"]':function(e){this.fold(),e.stopPropagation()},'click [data-action="remove"]':function(e){this.actionRemove(),e.stopPropagation()}};setIsSelected(){this.isSelected=!0,this.selectedData.id=this.model.id;const e=this.selectedData.path,t=this.selectedData.names;e.length=0;let i=this;for(;;){if(e.unshift(i.model.id),t[i.model.id]=i.model.get("name"),!i.getParentListView().level)break;i=i.getParentView().getParentView()}}setup(){"level"in this.options&&(this.level=this.options.level),"isSelected"in this.options&&(this.isSelected=this.options.isSelected),"selectedData"in this.options&&(this.selectedData=this.options.selectedData),this.readOnly=this.options.readOnly,"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.readOnly&&(this.createDisabled=!0),this.rootView=this.options.rootView,this.scope=this.model.entityType,this.isUnfolded=!1;const e=this.model.get("childCollection");e&&0===e.length||this.model.isEnd?this.createDisabled&&(this.isEnd=!0):e&&(e.models.forEach(e=>{~this.selectedData.path.indexOf(e.id)&&(this.isUnfolded=!0)}),this.isUnfolded&&this.createChildren()),this.on("select",e=>{this.getParentListView().trigger("select",e)})}getParentListView(){return this.getParentView()}createChildren(){var e=this.model.get("childCollection");let t=null;this.isRendered()&&(t=e=>{this.listenToOnce(e,"after:render",()=>{this.trigger("children-created")}),e.render()}),this.createView("children",this.listViewName,{collection:e,selector:"> .children",createDisabled:this.options.createDisabled,readOnly:this.options.readOnly,level:this.level+1,selectedData:this.selectedData,model:this.model,selectable:this.options.selectable,rootView:this.rootView},t)}checkLastChildren(){Espo.Ajax.getRequest(this.collection.entityType+"/action/lastChildrenIdList",{parentId:this.model.id}).then(e=>{const s=this.getChildrenView();e.forEach(e=>{const t=this.model.get("childCollection").get(e),i=(t&&(t.isEnd=!0),s.getView(e));i&&(i.isEnd=!0,i.afterIsEnd())}),this.model.lastAreChecked=!0})}unfold(){if(this.createDisabled&&this.once("children-created",()=>{this.model.lastAreChecked||this.checkLastChildren()}),null!==this.model.get("childCollection"))return this.createChildren(),this.isUnfolded=!0,this.afterUnfold(),void this.trigger("after:unfold");this.getCollectionFactory().create(this.scope,e=>{e.url=this.collection.url,e.parentId=this.model.id,e.maxDepth=null,Espo.Ui.notify(" ... "),this.listenToOnce(e,"sync",()=>{Espo.Ui.notify(!1),this.model.set("childCollection",e),this.createChildren(),this.isUnfolded=!0,e.length||!this.createDisabled?(this.afterUnfold(),this.trigger("after:unfold")):(this.isEnd=!0,this.afterIsEnd())}),e.fetch()})}fold(){this.clearView("children"),this.isUnfolded=!1,this.afterFold()}afterRender(){if(this.isUnfolded?this.afterUnfold():this.afterFold(),this.isEnd&&this.afterIsEnd(),!this.readOnly){const e=this.$el.find('> .cell [data-action="remove"]');this.$el.find("> .cell").on("mouseenter",function(){e.removeClass("hidden")}),this.$el.find("> .cell").on("mouseleave",function(){e.addClass("hidden")})}}afterFold(){this.$el.find('a[data-action="fold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('a[data-action="unfold"][data-id="'+this.model.id+'"]').removeClass("hidden"),this.$el.find(" > .children").addClass("hidden")}afterUnfold(){this.$el.find('a[data-action="unfold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('a[data-action="fold"][data-id="'+this.model.id+'"]').removeClass("hidden"),this.$el.find(" > .children").removeClass("hidden")}afterIsEnd(){this.$el.find('a[data-action="unfold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('a[data-action="fold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('span[data-name="white-space"][data-id="'+this.model.id+'"]').removeClass("hidden"),this.$el.find(" > .children").addClass("hidden")}getCurrentPath(){let e=this;const t=[];for(;;){if(t.unshift(e.model.id),e.getParentView()===this.rootView)break;e=e.getParentView().getParentView()}return t}actionRemove(){this.confirm({message:this.translate("removeRecordConfirmation","messages",this.scope),confirmText:this.translate("Remove")},()=>{this.model.destroy({wait:!0}).then(()=>this.remove())})}getChildrenView(){return this.getView("children")}}e.default=s}),define("views/record/list-pagination",["view"],function(e){return e.extend({template:"record/list-pagination",data:function(){var e=0<this.collection.offset,t=this.collection.total-this.collection.offset>this.collection.maxSize||-1===this.collection.total;return{total:this.collection.total,from:this.collection.offset+1,to:this.collection.offset+this.collection.length,previous:e,next:t,noTotal:-1===this.collection.total||-2===this.collection.total}}})}),define("views/record/list-nested-categories",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-nested-categories";isLoading=!1;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)}};data(){const e={};this.isLoading||(e.list=this.getDataList()),e.scope=this.collection.entityType,e.isLoading=this.isLoading,e.currentId=this.collection.currentCategoryId,e.currentName=this.collection.currentCategoryName,e.categoryData=this.collection.categoryData,e.hasExpandedToggler=this.options.hasExpandedToggler,e.showEditLink=this.options.showEditLink,e.hasNavigationPanel=this.options.hasNavigationPanel;var t=this.collection.categoryData||{};return e.upperLink=t.upperId?"#"+this.subjectEntityType+"/list/categoryId="+t.upperId:"#"+this.subjectEntityType,e}getDataList(){const t=[];return this.collection.forEach(e=>{e={id:e.id,name:e.get("name"),recordCount:e.get("recordCount"),isEmpty:e.get("isEmpty"),link:"#"+this.subjectEntityType+"/list/categoryId="+e.id};t.push(e)}),t}setup(){this.listenTo(this.collection,"sync",()=>{this.reRender()}),this.subjectEntityType=this.options.subjectEntityType}actionShowMore(){this.$el.find(".category-item.show-more").addClass("hidden"),this.collection.fetch({remove:!1,more:!0})}}e.default=s}),define("views/record/kanban",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/kanban";itemViewName="views/record/kanban-item";rowActionsView="views/record/row-actions/default-kanban";type="kanban";name="kanban";showCount=!0;headerDisabled=!1;layoutName="kanban";portalLayoutDisabled=!1;minColumnWidthPx=220;showMore=!0;quickDetailDisabled=!1;quickEditDisabled=!1;listLayout=null;_internalLayout=null;buttonsDisabled=!1;backDragStarted=!0;buttonList=[];events={"click a.link":function(e){if(!(e.ctrlKey||e.metaKey||e.shiftKey)&&(e.stopPropagation(),this.scope&&!this.selectable)){e.preventDefault();var e=$(e.currentTarget).data("id"),t=this.collection.get(e),i=this.getModelScope(e);const s={id:e,model:t};this.options.keepCurrentRootUrl&&(s.rootUrl=this.getRouter().getCurrentUrl()),this.getRouter().navigate("#"+i+"/view/"+e,{trigger:!1}),this.getRouter().dispatch(i,"view",s)}},'click [data-action="groupShowMore"]':function(e){const t=$(e.currentTarget);e=t.data("name");this.groupShowMore(e)},"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.buttonList],className:"list-action-item"})},"mouseenter th.group-header":function(e){e=$(e.currentTarget).attr("data-name");this.showPlus(e)},"mouseleave th.group-header":function(e){e=$(e.currentTarget).attr("data-name");this.hidePlus(e)},'click [data-action="createInGroup"]':function(e){e=$(e.currentTarget).attr("data-group");this.actionCreateInGroup(e)},"mousedown .kanban-columns td":function(e){$(e.originalEvent.target).closest(".item").length||this.initBackDrag(e.originalEvent)},"auxclick a.link":function(e){if(1===e.button&&(e.ctrlKey||e.metaKey)){const i=$(e.currentTarget);var t=i.attr("data-id");t&&(this.quickDetailDisabled||i.parent().closest(`[data-id="${t}"]`).find(`ul.list-row-dropdown-menu[data-id="${t}"] a[data-action="quickView"]`).length&&(e.preventDefault(),e.stopPropagation(),this.actionQuickView({id:t})))}}};data(){return{scope:this.scope,header:this.header,topBar:this.displayTotalCount||this.buttonList.length&&!this.buttonsDisabled,showCount:this.showCount&&0<this.collection.total,buttonList:this.buttonList,displayTotalCount:this.displayTotalCount&&0<=this.collection.total,totalCount:this.collection.total,statusList:this.statusList,groupDataList:this.groupDataList,minTableWidthPx:this.minColumnWidthPx*this.statusList.length,isEmptyList:0===this.collection.models.length,totalCountFormatted:this.getNumberUtil().formatInt(this.collection.total),isCreatable:this.isCreatable}}init(){this.listLayout=this.options.listLayout||this.listLayout,this.type=this.options.type||this.type,this.layoutName=this.options.layoutName||this.layoutName||this.type,this.rowActionsView=(_.isUndefined(this.options.rowActionsView)?this:this.options).rowActionsView,this.massActionsDisabled&&!this.selectable&&(this.checkboxes=!1),this.rowActionsDisabled=this.options.rowActionsDisabled||this.rowActionsDisabled,"buttonsDisabled"in this.options&&(this.buttonsDisabled=this.options.buttonsDisabled)}getModelScope(e){return this.scope}setup(){if(void 0===this.collection)throw new Error("Collection has not been injected into Record.List view.");if(this.layoutLoadCallbackList=[],this.entityType=this.collection.entityType||null,this.scope=this.options.scope||this.entityType,this.buttonList=Espo.Utils.clone(this.buttonList),"showCount"in this.options&&(this.showCount=this.options.showCount),this.displayTotalCount=this.showCount&&this.getConfig().get("displayListViewRecordCount"),this.minColumnWidthPx=this.getConfig().get("kanbanMinColumnWidth")||this.minColumnWidthPx,"displayTotalCount"in this.options&&(this.displayTotalCount=this.options.displayTotalCount),this.getUser().isPortal()&&!this.portalLayoutDisabled&&this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.layoutName+"Portal"])&&(this.layoutName+="Portal"),this.orderDisabled=this.getMetadata().get(["scopes",this.scope,"kanbanOrderDisabled"]),this.getUser().isPortal()&&(this.orderDisabled=!0),this.statusField=this.getMetadata().get(["scopes",this.scope,"statusField"]),!this.statusField)throw new Error("No status field for entity type '"+this.scope+"'.");this.statusList=Espo.Utils.clone(this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"options"]));const t=this.getMetadata().get(["scopes",this.scope,"kanbanStatusIgnoreList"])||[];this.statusList=this.statusList.filter(e=>{if(!~t.indexOf(e))return!0}),this.seedCollection=this.collection.clone(),this.seedCollection.reset(),this.seedCollection.url=this.scope,this.seedCollection.maxSize=this.collection.maxSize,this.seedCollection.entityType=this.collection.entityType,this.seedCollection.orderBy=this.collection.defaultOrderBy,this.seedCollection.order=this.collection.defaultOrder,this.setupRowActionDefs(),this.listenTo(this.collection,"sync",()=>{this.hasView("modal")&&this.getView("modal").isRendered()||this.buildRows(()=>{this.render()})}),this.collection.listenTo(this.collection,"change:"+this.statusField,this.onChangeGroup.bind(this),this),this.buildRows(),this.on("remove",()=>{$(window).off("resize.kanban-a-"+this.cid),$(window).off("scroll.kanban-"+this.cid),$(window).off("resize.kanban-"+this.cid)}),this.statusFieldIsEditable=this.getAcl().checkScope(this.entityType,"edit")&&!this.getAcl().getScopeForbiddenFieldList(this.entityType,"edit").includes(this.statusField)&&!this.getMetadata().get(["clientDefs",this.scope,"editDisabled"])&&!this.getMetadata().get(["entityDefs",this.entityType,"fields",this.statusField,"readOnly"]),this.isCreatable=this.statusFieldIsEditable&&this.getAcl().check(this.entityType,"create"),this.wait(this.getHelper().processSetupHandlers(this,"record/kanban"))}afterRender(){const e=$(window);this.$listKanban=this.$el.find(".list-kanban"),this.$content=$("#content"),this.$groupColumnList=this.$listKanban.find(".group-column-list"),this.$container=this.$el.find(".list-kanban-container"),e.off("resize.kanban-a-"+this.cid),e.on("resize.kanban-a-"+this.cid,()=>this.adjustMinHeight()),this.$container.on("scroll",()=>this.syncHeadScroll()),this.adjustMinHeight(),this.statusFieldIsEditable&&this.initSortable(),this.initStickableHeader(),this.$showMore=this.$el.find(".group-column .show-more"),this.plusElementMap={},this.statusList.forEach(e=>{var t=e.replace(/"/g,'\\"');this.plusElementMap[e]=this.$el.find('.kanban-head .create-button[data-group="'+t+'"]')})}initStickableHeader(){const a=this.$headContainer=this.$el.find(".kanban-head-container"),o=this.getThemeManager().getParam("navbarHeight")||30,n=this.getThemeManager().getParam("screenWidthXs"),l=this.$el.find(".kanban-columns-container"),r=$(window),d=$("<div>").addClass("kanban-head-placeholder").html("&nbsp;").hide().insertAfter(a),e=(r.off("scroll.kanban-"+this.cid),r.on("scroll.kanban-"+this.cid,()=>{e()}),r.off("resize.kanban-"+this.cid),r.on("resize.kanban-"+this.cid,()=>e()),()=>{var e,t,i,s=l.width();return $(window.document).width()<n?(a.removeClass("sticked"),a.css("width",""),d.hide(),a.show(),a.get(0).scrollLeft=0,void a.children().css("width","")):(e=this.$listKanban.offset().top-o,i=l.offset().top+l.outerHeight(!0),(t=r.scrollTop())<i?(e<t?(i=this.$container.width()-3,a.children().css("width",s),a.css("width",i+"px"),a.hasClass("sticked")||(a.addClass("sticked"),d.show())):(a.css("width",""),a.hasClass("sticked")&&(a.removeClass("sticked"),d.hide())),a.show(),void this.syncHeadScroll()):(a.css("width",s+"px"),a.hide(),d.show(),a.get(0).scrollLeft=0,void a.children().css("width","")))})}initSortable(){const l=this.$groupColumnList,r=(l.find("> .item").on("touchstart",e=>{e.originalEvent.stopPropagation()}),this.orderDisabled),i=this.$el.find(".group-column-list");l.sortable({distance:10,connectWith:".group-column-list",cancel:".btn-group *",containment:this.getSelector(),scroll:!1,over:function(){$(this).addClass("drop-hover")},out:function(){$(this).removeClass("drop-hover")},sort:e=>{this.blockScrollControl||this.controlHorizontalScroll(e.originalEvent)},start:(e,t)=>{i.addClass("drop-active"),l.sortable("refreshPositions"),$(t.item).find(".btn-group.open > .dropdown-toggle").parent().removeClass("open"),this.draggedGroupFrom=$(t.item).closest(".group-column-list").data("name"),this.$showMore.addClass("hidden"),this.sortIsStarted=!0,this.sortWasCentered=!1,this.$draggable=t.item},stop:(e,t)=>{this.blockScrollControl=!1,this.sortIsStarted=!1,this.$draggable=null;const i=$(t.item),s=(this.$el.find(".group-column-list").removeClass("drop-active"),i.closest(".group-column-list").data("name"));t=i.data("id");const a=this.draggedGroupFrom;if(this.draggedGroupFrom=null,this.$showMore.removeClass("hidden"),s!==a){const o=this.collection.get(t);if(!o)return void l.sortable("cancel");const n={};return n[this.statusField]=s,this.handleAttributesOnGroupChange(o,n,s),l.sortable("disable"),void o.save(n,{patch:!0,isDrop:!0}).then(()=>{Espo.Ui.success(this.translate("Saved")),l.sortable("destroy"),this.initSortable(),this.moveModelBetweenGroupCollections(o,a,s),r||(this.reOrderGroup(s),this.storeGroupOrder(s)),this.rebuildGroupDataList()}).catch(()=>{l.sortable("cancel"),l.sortable("enable")})}if(r)return l.sortable("cancel"),void l.sortable("enable");this.reOrderGroup(s),this.storeGroupOrder(s),this.rebuildGroupDataList()}})}storeGroupOrder(e,t){const i=this.getGroupOrderFromDom(e);return t&&i.unshift(t),Espo.Ajax.putRequest("Kanban/order",{entityType:this.entityType,group:e,ids:i})}getGroupOrderFromDom(e){const i=[],t=this.$el.find('.group-column-list[data-name="'+e+'"]');return t.children().each((e,t)=>{i.push($(t).data("id"))}),i}reOrderGroup(e){const t=this.getGroupCollection(e),i=this.getGroupOrderFromDom(e),s={};for(t.models.forEach(e=>{s[e.id]=e});t.models.length;)t.pop({silent:!0});i.forEach(e=>{e=s[e];e&&t.add(e,{silent:!0})})}rebuildGroupDataList(){this.groupDataList.forEach(e=>{e.dataList=[];for(const t of e.collection.models)e.dataList.push({key:t.id,id:t.id})})}moveModelBetweenGroupCollections(e,t,i){let s=this.getGroupCollection(t);s&&(s.remove(e.id,{silent:!0}),(s=this.getGroupCollection(i))&&s.add(e,{silent:!0}))}handleAttributesOnGroupChange(e,t,i){}adjustMinHeight(){if(0!==this.collection.models.length&&this.$container){let e=this.getHelper().calculateContentContainerHeight(this.$el.find(".kanban-columns-container"));var t=this.$container.get(0);t.scrollWidth>t.clientWidth&&(e-=18),e<100&&(e=100),this.$listKanban.find("td.group-column").css({minHeight:e+"px"})}}getListLayout(t){this.listLayout?t.call(this,this.listLayout):this._loadListLayout(e=>{this.listLayout=e,t.call(this,e)})}getSelectAttributeList(t){super.getSelectAttributeList(e=>{e&&(~e.indexOf(this.statusField)||e.push(this.statusField)),t(e)})}buildRows(s){const o=(this.collection.dataAdditional||{}).groupList||[];this.collection.reset(),this.collection.subCollectionList=[],this.wait(!0),this.groupDataList=[];let n=0,a=0;this.getListLayout(e=>{if(this.listLayout=e,o.forEach((e,t)=>{const i=this.seedCollection.clone(),s=(this.listenTo(i,"destroy",(e,t,i)=>{i.fromList||this.removeRecordFromList(e.id)}),i.total=e.total,i.url=this.collection.url,i.where=this.collection.where,i.entityType=this.seedCollection.entityType,i.maxSize=this.seedCollection.maxSize,i.orderBy=this.seedCollection.orderBy,i.order=this.seedCollection.order,i.whereAdditional=[{field:this.statusField,type:"equals",value:e.name}],i.groupName=e.name,i.set(e.list),this.collection.subCollectionList.push(i),this.collection.add(i.models),[]);i.models.forEach(e=>{n++,s.push({key:e.id,id:e.id})});let a=null;t<o.length-1&&(a=this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"style",o[t+1].name]));t={name:e.name,label:this.getLanguage().translateOption(e.name,this.statusField,this.scope),dataList:s,collection:i,isLast:t===o.length-1,hasShowMore:i.total>i.length||-1===i.total,style:this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"style",e.name]),nextStyle:a};this.groupDataList.push(t)}),0===n)return this.wait(!1),void(s&&s());this.groupDataList.forEach(i=>{i.dataList.forEach((e,t)=>{e=i.collection.get(e.id);this.buildRow(t,e,()=>{++a===n&&(this.wait(!1),s&&s())})})})})}buildRow(e,t,i){var s=t.id;this.createView(s,this.itemViewName,{model:t,selector:'.item[data-id="'+t.id+'"]',itemLayout:this.listLayout,rowActionsDisabled:this.rowActionsDisabled,rowActionsView:this.rowActionsView,rowActionHandlers:this._rowActionHandlers||{},setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered(),statusFieldIsEditable:this.statusFieldIsEditable,additionalRowActionList:this._additionalRowActionList,scope:this.scope},i)}removeRecordFromList(t){this.collection.remove(t),0<this.collection.total&&this.collection.total--,this.totalCount=this.collection.total,this.$el.find(".total-count-span").text(this.totalCount.toString()),this.clearView(t),this.$el.find('.item[data-id="'+t+'"]').remove(),this.collection.subCollectionList.forEach(e=>{e.get(t)&&e.remove(t)});for(const i of this.groupDataList)for(let e=0;e<i.dataList.length;e++)if(i.dataList[e].id===t){i.dataList.splice(e,1),0<i.collection.total&&i.collection.total--,i.hasShowMore=i.collection.total>i.collection.length||-1===i.collection.total;break}}onChangeGroup(e,h,t){const i=e.id;var s=e.get(this.statusField);this.collection.subCollectionList.forEach(e=>{e.get(i)&&(e.remove(i),0<e.total&&e.total--)});let a;for(const n of this.groupDataList)for(let e=0;e<n.dataList.length;e++){var o=n.dataList[e];if(o.id===i){a=o,n.dataList.splice(e,1);break}}if(s&&!t.isDrop){for(const d of this.groupDataList)d.name===s&&(d.collection.unshift(e),d.collection.total++,a&&(d.dataList.unshift(a),d.hasShowMore=d.collection.total>d.collection.length||-1===d.collection.total));const l=this.$el.find('.item[data-id="'+i+'"]'),r=this.$el.find('.group-column[data-name="'+s+'"] .group-column-list');r.length?r.prepend(l):l.remove(),this.orderDisabled||this.storeGroupOrder(s)}}groupShowMore(e){let t;for(const a in this.groupDataList){if((t=this.groupDataList[a]).name===e)break;t=null}if(t){const o=t.collection;var i=this.$el.find('.group-column-list[data-name="'+e+'"]'),s=this.$el.find('.group-column[data-name="'+e+'"] .show-more');o.data.select=this.collection.data.select,this.showMoreRecords({},o,i,s,()=>{this.noRebuild=!1,o.models.forEach(e=>{this.collection.get(e.id)||(this.collection.add(e),t.dataList.push({key:e.id,id:e.id}))})})}}getDomRowItem(e){return this.$el.find('.item[data-id="'+e+'"]')}getRowContainerHtml(e){return $("<div>").attr("data-id",e).addClass("item").get(0).outerHTML}actionMoveOver(e){e=this.collection.get(e.id);this.createView("moveOverDialog","views/modals/kanban-move-over",{model:e,statusField:this.statusField},e=>{e.render()})}getGroupCollection(t){let i=null;return this.collection.subCollectionList.forEach(e=>{e.groupName===t&&(i=e)}),i}showPlus(e){const t=this.plusElementMap[e];t&&t.removeClass("hidden")}hidePlus(e){const t=this.plusElementMap[e];t&&t.addClass("hidden")}actionCreateInGroup(t){const e={};e[this.statusField]=t;var i=this.getMetadata().get("clientDefs."+this.scope+".modalViews.edit")||"views/modals/edit",s={attributes:e,scope:this.scope};this.createView("quickCreate",i,s,e=>{e.getRecordView().setFieldReadOnly(this.statusField,!0),e.render(),this.listenToOnce(e,"after:save",()=>{this.orderDisabled?this.collection.fetch():this.storeGroupOrder(t,e.model.id).then(()=>this.collection.fetch())})})}initBackDrag(e){this.backDragStarted=!0;const t=this.$container.get(0),i=(t.style.cursor="grabbing",t.style.userSelect="none",$(document)),s=t.scrollLeft,a=e.clientX;i.on("mousemove."+this.cid,e=>{e=e.originalEvent.clientX-a;t.scrollLeft=s-e,this.syncHeadScroll()}),i.one("mouseup."+this.cid,()=>{this.stopBackDrag()})}stopBackDrag(){this.$container.get(0).style.cursor="default",this.$container.get(0).style.userSelect="none",$(document).off("mousemove."+this.cid)}syncHeadScroll(){this.$headContainer.hasClass("sticked")&&(this.$headContainer.get(0).scrollLeft=this.$container.get(0).scrollLeft)}controlHorizontalScroll(t){if(this.sortIsStarted&&this.$draggable){var i=this.$draggable.get(0).getBoundingClientRect(),s=i.left,i=i.right;const l=this.$container.get(0);var a=l.getBoundingClientRect();let e=2;var o=a.right-70<i&&l.scrollLeft+l.offsetWidth<l.scrollWidth,n=a.left+70>s&&0<l.scrollLeft;return(this.$groupColumnList.sortable("refreshPositions"),o&&this.sortWasCentered)?(a.right-i<17.5&&(e*=3),i=Math.min(e,l.offsetWidth-l.scrollLeft),l.scrollLeft=l.scrollLeft+i,this.syncHeadScroll(),l.scrollLeft+l.offsetWidth===l.scrollWidth?void(this.blockScrollControl=!1):(this.blockScrollControl=!0,void setTimeout(()=>this.controlHorizontalScroll(t),5))):n&&this.sortWasCentered?(-(a.left-s)<17.5&&(e*=3),i=Math.min(e,l.scrollLeft),l.scrollLeft=l.scrollLeft-i,this.syncHeadScroll(),0===l.scrollLeft?void(this.blockScrollControl=!1):(this.blockScrollControl=!0,void setTimeout(()=>this.controlHorizontalScroll(t),5))):(!this.blockScrollControl||n||o||(this.blockScrollControl=!1),void(n||o||(this.sortWasCentered=!0)))}}}e.default=s}),define("views/record/kanban-item",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/kanban-item";data(){return{layoutDataList:this.layoutDataList,rowActionsDisabled:this.rowActionsDisabled}}events={};setup(){var e;this.itemLayout=this.options.itemLayout,this.rowActionsView=this.options.rowActionsView,this.rowActionsDisabled=this.options.rowActionsDisabled,this.layoutDataList=[],this.itemLayout.forEach((e,t)=>{var i=e.name,s=i+"Field",t={name:i,isAlignRight:"right"===e.align,isLarge:e.isLarge,isFirst:0===t,key:s};this.layoutDataList.push(t);let a=e.view||this.model.getFieldParam(i,"view"),o=(a||(t=this.model.getFieldType(i)||"base",a=this.getFieldManager().getViewName(t)),"list");e.link&&(o="listLink"),this.createView(s,a,{model:this.model,name:i,mode:o,readOnly:!0,selector:'.field[data-name="'+i+'"]'})}),this.rowActionsDisabled||(e={edit:this.getAcl().checkModel(this.model,"edit"),delete:this.getAcl().checkModel(this.model,"delete")},this.createView("itemMenu",this.rowActionsView,{selector:".item-menu-container",model:this.model,acl:e,statusFieldIsEditable:this.options.statusFieldIsEditable,rowActionHandlers:this.options.rowActionHandlers||{},additionalActionList:this.options.additionalRowActionList,scope:this.options.scope}))}}e.default=s}),define("views/record/edit-small",["exports","views/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{bottomView=null}e.default=s}),define("views/record/edit-side",["exports","views/record/detail-side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{mode="edit";defaultPanelDefs={name:"default",label:!1,view:"views/record/panels/side",isForm:!0,options:{fieldList:[{name:":assignedUser"},{name:"teams",view:"views/fields/teams"}]}}}e.default=s}),define("views/record/edit-bottom",["exports","views/record/detail-bottom"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{mode="edit";streamPanel=!1;relationshipPanels=!1}e.default=s}),define("views/record/detail-small",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{bottomView=null}e.default=s}),define("views/record/detail-middle",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.recordHelper=this.options.recordHelper,this.scope=this.model.entityType}data(){return{hiddenPanels:this.recordHelper.getHiddenPanels(),hiddenFields:this.recordHelper.getHiddenFields()}}showPanel(e){this.recordHelper.getPanelStateParam(e,"hiddenLocked")||(this.showPanelInternal(e),this.recordHelper.setPanelStateParam(e,"hidden",!1))}showPanelInternal(e){this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').removeClass("hidden"),!!this.recordHelper.getPanelStateParam(e,"hidden")&&this.options.panelFieldListMap&&this.options.panelFieldListMap[e]&&this.options.panelFieldListMap[e].forEach(e=>{const t=this.getFieldView(e);t&&t.reRender()})}hidePanel(e){this.hidePanelInternal(e),this.recordHelper.setPanelStateParam(e,"hidden",!0)}hidePanelInternal(e){this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').addClass("hidden")}hideField(a){this.recordHelper.setFieldStateParam(a,"hidden",!0);const e=()=>{var e=this.getFieldView(a);if(e){const t=e.$el,i=t.closest('.cell[data-name="'+a+'"]'),s=i.find('label.control-label[data-name="'+a+'"]');t.addClass("hidden"),s.addClass("hidden"),i.addClass("hidden-cell")}else this.$el.find('.cell[data-name="'+a+'"]').addClass("hidden-cell"),this.$el.find('.field[data-name="'+a+'"]').addClass("hidden"),this.$el.find('label.control-label[data-name="'+a+'"]').addClass("hidden")},t=(this.isRendered()?e():this.once("after:render",()=>{e()}),this.getFieldView(a));t&&t.setDisabled()}showField(a){if(!this.recordHelper.getFieldStateParam(a,"hiddenLocked")){this.recordHelper.setFieldStateParam(a,"hidden",!1);const e=()=>{var e=this.getFieldView(a);if(e){const t=e.$el,i=t.closest('.cell[data-name="'+a+'"]'),s=i.find('label.control-label[data-name="'+a+'"]');t.removeClass("hidden"),s.removeClass("hidden"),i.removeClass("hidden-cell")}else this.$el.find('.cell[data-name="'+a+'"]').removeClass("hidden-cell"),this.$el.find('.field[data-name="'+a+'"]').removeClass("hidden"),this.$el.find('label.control-label[data-name="'+a+'"]').removeClass("hidden")},t=(this.isRendered()?e():this.once("after:render",()=>{e()}),this.getFieldView(a));t&&(t.disabledLocked||t.setNotDisabled())}}getFields(){return this.getFieldViews()}getFieldViews(){const e={};for(const i in this.nestedViews){var t=this.nestedViews[i].name;e[t]=this.nestedViews[i]}return e}getFieldView(e){return(this.getFieldViews()||{})[e]}getView(e){let t=super.getView(e);return t=t||this.getFieldView(e)}}e.default=s}),define("views/record/deleted-detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{bottomView=null;sideView="views/record/deleted-detail-side";setupBeforeFinal(){super.setupBeforeFinal(),this.buttonList=[],this.dropdownItemList=[],this.addDropdownItem({name:"restoreDeleted",label:"Restore"})}actionRestoreDeleted(){Espo.Ui.notify(" ... "),Espo.Ajax.postRequest(this.model.entityType+"/action/restoreDeleted",{id:this.model.id}).then(()=>{Espo.Ui.notify(!1),this.model.set("deleted",!1),this.model.trigger("after:restore-deleted")})}}e.default=s}),define("views/record/deleted-detail-side",["exports","views/record/detail-side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{additionalPanelsDisabled=!0}e.default=s}),define("views/record/row-actions/view-only",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){return[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}]}}e.default=s}),define("views/record/row-actions/view-and-remove",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/view-and-edit",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return e=this.options.acl.edit?e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}]):e}}e.default=s}),define("views/record/row-actions/remove-only",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){if(this.options.acl.delete)return[{action:"quickRemove",label:"Remove",data:{id:this.model.id}}]}}e.default=s}),define("views/record/row-actions/relationship-view-only",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){return[{action:"viewRelated",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}]}}e.default=s}),define("views/record/row-actions/relationship-view-and-unlink",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&!this.options.unlinkDisabled&&e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/relationship-view-and-edit",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),e}}e.default=s}),define("views/record/row-actions/relationship-unlink-only",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){if(this.options.acl.edit&&!this.options.unlinkDisabled)return[{action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}}]}}e.default=s}),define("views/record/row-actions/relationship-remove-only",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){if(this.options.acl.delete)return[{action:"removeRelated",label:"Remove",data:{id:this.model.id}}]}}e.default=s}),define("views/record/row-actions/relationship-no-unlink",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&(e=e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}])),this.options.acl.delete&&e.push({action:"removeRelated",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/relationship-no-remove",["views/record/row-actions/relationship"],function(e){return e.extend({getActionList:function(){var e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&(e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.options.unlinkDisabled||e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}})),e}})}),define("views/record/row-actions/relationship-edit-and-remove",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[];return this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id}}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/empty",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){return[]}}e.default=s}),define("views/record/row-actions/default-kanban",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const t=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.statusFieldIsEditable&&t.push({action:"moveOver",label:"Move Over",data:{id:this.model.id}}),this.options.acl.edit&&t.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.getAdditionalActionList().forEach(e=>t.push(e)),this.options.acl.delete&&t.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),t}}e.default=s}),define("views/record/panels/default-side",["exports","views/record/panels/side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{data(){const e=super.data();return(this.complexCreatedDisabled&&this.complexModifiedDisabled||!this.hasComplexCreated&&!this.hasComplexModified)&&(e.complexDateFieldsDisabled=!0),e.hasComplexCreated=this.hasComplexCreated,e.hasComplexModified=this.hasComplexModified,e}setup(){this.fieldList=Espo.Utils.cloneDeep(this.fieldList),this.hasComplexCreated=!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","createdAt"])&&!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","createdBy"]),this.hasComplexModified=!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","modifiedAt"])&&!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","modifiedBy"]),super.setup()}setupFields(){super.setupFields(),this.complexCreatedDisabled?this.recordViewObject.hideField("complexCreated"):this.hasComplexCreated&&(this.fieldList.push({name:"complexCreated",labelText:this.translate("Created"),isAdditional:!0,view:"views/fields/complex-created",readOnly:!0}),this.model.get("createdById")||this.recordViewObject.hideField("complexCreated")),this.complexModifiedDisabled?this.recordViewObject.hideField("complexModified"):(this.hasComplexModified&&this.fieldList.push({name:"complexModified",labelText:this.translate("Modified"),isAdditional:!0,view:"views/fields/complex-created",readOnly:!0,options:{baseName:"modified"}}),this.model.get("modifiedById")||this.recordViewObject.hideField("complexModified")),!this.complexCreatedDisabled&&this.hasComplexCreated&&this.listenTo(this.model,"change:createdById",()=>{this.model.get("createdById")&&this.recordViewObject.showField("complexCreated")}),!this.complexModifiedDisabled&&this.hasComplexModified&&this.listenTo(this.model,"change:modifiedById",()=>{this.model.get("modifiedById")&&this.recordViewObject.showField("complexModified")}),this.getMetadata().get(["scopes",this.model.entityType,"stream"])&&!this.getUser().isPortal()&&(this.fieldList.push({name:"followers",labelText:this.translate("Followers"),isAdditional:!0,view:"views/fields/followers",readOnly:!0}),this.controlFollowersField(),this.listenTo(this.model,"change:followersIds",()=>this.controlFollowersField()))}controlFollowersField(){this.model.get("followersIds")&&this.model.get("followersIds").length?this.recordViewObject.showField("followers"):this.recordViewObject.hideField("followers")}}e.default=s}),define("views/notification/panel",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/panel";setup(){this.addActionHandler("markAllNotificationsRead",()=>this.actionMarkAllRead()),this.addActionHandler("openNotifications",()=>this.actionOpenNotifications()),this.addActionHandler("closePanel",()=>this.close()),this.addHandler("keydown","",e=>{"Escape"===e.code&&this.close()});var e=this.getCollectionFactory().create("Notification",e=>{this.collection=e,this.collection.maxSize=this.getConfig().get("notificationsMaxSize")||5,this.listenTo(this.collection,"sync",()=>{this.trigger("collection-fetched")})});this.wait(e),this.navbarPanelHeightSpace=this.getThemeManager().getParam("navbarPanelHeightSpace")||100,this.navbarPanelBodyMaxHeight=this.getThemeManager().getParam("navbarPanelBodyMaxHeight")||600,this.once("remove",()=>{$(window).off("resize.notifications-height"),this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1),this.collection&&this.collection.abortLastFetch()})}afterRender(){this.collection.fetch().then(()=>this.createRecordView()).then(e=>e.render());const e=$(window);e.off("resize.notifications-height"),e.on("resize.notifications-height",this.processSizing.bind(this)),this.processSizing(),$("#navbar li.notifications-badge-container").addClass("open"),this.$el.find("> .panel").focus()}onRemove(){$("#navbar li.notifications-badge-container").removeClass("open")}createRecordView(){var e=this.getMetadata().get(["clientDefs","Notification","recordViews","list"])||"views/notification/record/list";return this.createView("list",e,{selector:".list-container",collection:this.collection,showCount:!1,listLayout:{rows:[[{name:"data",view:"views/notification/fields/container",options:{containerSelector:this.getSelector()}}]],right:{name:"read",view:"views/notification/fields/read",width:"10px"}}})}actionMarkAllRead(){Espo.Ajax.postRequest("Notification/action/markAllRead").then(()=>this.trigger("all-read"))}processSizing(){const e=$(window);var t=e.height(),i=e.width(),s=this.$el.find(".panel-heading").outerHeight();const a={};if(i<=this.getThemeManager().getParam("screenWidthXs"))return a.height=t-s+"px",a.overflow="auto",$("body").css("overflow","hidden"),this.overflowWasHidden=!0,void this.$el.find(".panel-body").css(a);a.height="unset",a.overflow="none",this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1),t-this.navbarPanelBodyMaxHeight<this.navbarPanelHeightSpace&&(i=t-this.navbarPanelHeightSpace,a.maxHeight=i+"px"),this.$el.find(".panel-body").css(a)}close(){this.trigger("close")}actionOpenNotifications(){this.getRouter().navigate("#Notification",{trigger:!0}),this.close()}}e.default=s}),define("views/notification/list",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/list";setup(){this.addActionHandler("refresh",()=>this.getRecordView().showNewRecords()),this.addActionHandler("markAllNotificationsRead",()=>this.actionMarkAllRead());var e=this.getCollectionFactory().create("Notification").then(e=>{this.collection=e,this.collection.maxSize=this.getConfig().get("recordsPerPage")||20});this.wait(e)}afterRender(){const e=this.getMetadata().get(["clientDefs","Notification","recordViews","list"])||"views/notification/record/list",t={selector:".list-container",collection:this.collection,showCount:!1,listLayout:{rows:[[{name:"data",view:"views/notification/fields/container",options:{containerSelector:this.getSelector()}}]],right:{name:"read",view:"views/notification/fields/read-with-menu",width:"10px"}}};this.collection.fetch().then(()=>this.createView("list",e,t)).then(e=>e.render()).then(e=>{e.$el.find("> .list > .list-group")})}actionMarkAllRead(){Espo.Ajax.postRequest("Notification/action/markAllRead").then(()=>{this.trigger("all-read"),this.$el.find(".badge-circle-warning").remove()})}getRecordView(){return this.getView("list")}}e.default=s}),define("views/notification/badge",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/badge";notificationsCheckInterval=10;groupedCheckInterval=15;useWebSocket=!1;timeout=null;groupedTimeout=null;popupNotificationsData;soundPath="client/sounds/pop_cork";setup(){this.addActionHandler("showNotifications",()=>this.showNotifications()),this.soundPath=this.getBasePath()+(this.getConfig().get("notificationSound")||this.soundPath),this.notificationSoundsDisabled=!0,this.useWebSocket=!!this.getHelper().webSocketManager;const e=()=>{this.timeout&&clearTimeout(this.timeout),this.groupedTimeout&&clearTimeout(this.groupedTimeout);for(const e in this.popupTimeouts)clearTimeout(this.popupTimeouts[e])};this.once("remove",()=>e()),this.listenToOnce(this.getHelper().router,"logout",()=>e()),this.notificationsCheckInterval=this.getConfig().get("notificationsCheckInterval")||this.notificationsCheckInterval,this.groupedCheckInterval=this.getConfig().get("popupNotificationsCheckInterval")||this.groupedCheckInterval,this.lastId=0,this.shownNotificationIds=[],this.closedNotificationIds=[],this.popupTimeouts={},delete localStorage.messageBlockPlayNotificationSound,delete localStorage.messageClosePopupNotificationId,delete localStorage.messageNotificationRead,window.addEventListener("storage",e=>{var t,i;"messageClosePopupNotificationId"===e.key&&(!(t=localStorage.getItem("messageClosePopupNotificationId"))||this.hasView(i="popup-"+t)&&(this.markPopupRemoved(t),this.clearView(i))),"messageNotificationRead"===e.key&&!this.isBroadcastingNotificationRead&&localStorage.getItem("messageNotificationRead")&&this.checkUpdates()},!1)}afterRender(){this.$badge=this.$el.find(".notifications-button"),this.$number=this.$el.find(".number-badge"),this.runCheckUpdates(!0),this.$popupContainer=$("#popup-notifications-container"),$(this.$popupContainer).length||(this.$popupContainer=$("<div>").attr("id","popup-notifications-container").addClass("hidden").appendTo("body"));for(const e in this.popupNotificationsData=this.getMetadata().get("app.popupNotifications")||{})this.checkPopupNotifications(e);this.hasGroupedPopupNotifications()&&this.checkGroupedPopupNotifications()}playSound(){if(!this.notificationSoundsDisabled){const e=$("<audio>").attr("autoplay","autoplay").append($("<source>").attr("src",this.soundPath+".mp3").attr("type","audio/mpeg")).append($("<source>").attr("src",this.soundPath+".ogg").attr("type","audio/ogg")).append($("<embed>").attr("src",this.soundPath+".mp3").attr("hidden","true").attr("autostart","true").attr("false","false")).get(0);e.volume=.3,e.play()}}showNotRead(e){this.$badge.attr("title",this.translate("New notifications")+": "+e),this.$number.removeClass("hidden").html(e.toString()),this.getHelper().pageTitle.setNotificationNumber(e)}hideNotRead(){this.$badge.attr("title",this.translate("Notifications")),this.$number.addClass("hidden").html(""),this.getHelper().pageTitle.setNotificationNumber(0)}checkBypass(){var e=this.getRouter().getLast()||{},t=(e.options||{}).page||null;return!("Admin"!==e.controller||"page"!==e.action||!~["upgrade","extensions"].indexOf(t))}checkUpdates(t){this.checkBypass()||Espo.Ajax.getRequest("Notification/action/notReadCount").then(e=>{!t&&e>this.unreadCount&&(localStorage.getItem("messageBlockPlayNotificationSound")||(this.playSound(),localStorage.setItem("messageBlockPlayNotificationSound","true"),setTimeout(()=>{delete localStorage.messageBlockPlayNotificationSound},1e3*this.notificationsCheckInterval))),(this.unreadCount=e)?this.showNotRead(e):this.hideNotRead()})}runCheckUpdates(e){this.checkUpdates(e),this.useWebSocket?this.getHelper().webSocketManager.subscribe("newNotification",()=>{this.checkUpdates()}):this.timeout=setTimeout(()=>this.runCheckUpdates(),1e3*this.notificationsCheckInterval)}hasGroupedPopupNotifications(){for(const t in this.popupNotificationsData){var e=this.popupNotificationsData[t]||{};if(e.grouped&&(!e.portalDisabled||!this.getUser().isPortal()))return!0}return!1}checkGroupedPopupNotifications(){this.checkBypass()||Espo.Ajax.getRequest("PopupNotification/action/grouped").then(e=>{for(const t in e){const i=e[t];i.forEach(e=>this.showPopupNotification(t,e))}}),this.useWebSocket||(this.groupedTimeout=setTimeout(()=>this.checkGroupedPopupNotifications(),1e3*this.groupedCheckInterval))}checkPopupNotifications(i,t){var e=this.popupNotificationsData[i]||{};const s=e.url,a=e.interval;var o=e.disabled||!1;if(!(o||e.portalDisabled&&this.getUser().isPortal())){const n=this.useWebSocket&&e.useWebSocket;n&&(o="popupNotifications."+(e.webSocketCategory||i),this.getHelper().webSocketManager.subscribe(o,(e,t)=>{t.list&&t.list.forEach(e=>{this.showPopupNotification(i,e)})})),e.grouped||s&&a&&new Promise(e=>{this.checkBypass()?e():Espo.Ajax.getRequest(s).then(e=>e.forEach(e=>this.showPopupNotification(i,e,t))).finally(()=>e())}).then(()=>{n||(this.popupTimeouts[i]=setTimeout(()=>this.checkPopupNotifications(i,!0),1e3*a))})}}showPopupNotification(e,i,s){var a=this.popupNotificationsData[e].view;if(a){let t=i.id||null;if(t){if(t=e+"_"+t,~this.shownNotificationIds.indexOf(t)){const o=this.getView("popup-"+t);return void(o&&o.trigger("update-data",i.data))}if(~this.closedNotificationIds.indexOf(t))return}else t=this.lastId++;this.shownNotificationIds.push(t),this.createView("popup-"+t,a,{notificationData:i.data||{},notificationId:i.id,id:t,isFirstCheck:!s},e=>{e.render(),this.$popupContainer.removeClass("hidden"),this.listenTo(e,"remove",()=>{this.markPopupRemoved(t),localStorage.setItem("messageClosePopupNotificationId",t)})})}}markPopupRemoved(e){var t=this.shownNotificationIds.indexOf(e);-1<t&&this.shownNotificationIds.splice(t,1),0===this.shownNotificationIds.length&&this.$popupContainer.addClass("hidden"),this.closedNotificationIds.push(e)}broadcastNotificationsRead(){this.useWebSocket&&(this.isBroadcastingNotificationRead=!0,localStorage.setItem("messageNotificationRead","true"),setTimeout(()=>{this.isBroadcastingNotificationRead=!1,delete localStorage.messageNotificationRead},500))}showNotifications(){this.closeNotifications();const t=$("<div>").attr("id","notifications-panel"),e=(t.appendTo(this.$el.find(".notifications-panel-container")),this.createView("panel","views/notification/panel",{fullSelector:"#notifications-panel"},e=>{e.render(),this.$el.closest(".navbar-body").removeClass("in"),this.listenTo(e,"all-read",()=>{this.hideNotRead(),this.$el.find(".badge-circle-warning").remove(),this.broadcastNotificationsRead()}),this.listenTo(e,"collection-fetched",()=>{this.checkUpdates(),this.broadcastNotificationsRead()}),this.listenToOnce(e,"close",()=>{this.closeNotifications()})}),$(document));e.on("mouseup.notification",e=>{t.is(e.target)||0!==t.has(e.target).length||$(e.target).closest("div.modal-dialog").length||this.closeNotifications()}),window.innerWidth<this.getThemeManager().getParam("screenWidthXs")&&this.listenToOnce(this.getRouter(),"route",()=>{this.closeNotifications()})}closeNotifications(){const e=$("#notifications-panel"),t=(e.remove(),$(document));this.hasView("panel")&&this.getView("panel").remove(),t.off("mouseup.notification")}}e.default=s}),define("views/note/detail",["views/main"],e=>e.extend({templateContent:`
            <div class="header page-header">{{{header}}}</div>
            <div class="record list-container list-container-panel block-center">{{{record}}}</div>
        `,isDeleted:!1,setup:function(){this.scope=this.model.entityType,this.setupHeader(),this.setupRecord(),this.listenToOnce(this.model,"remove",()=>{this.clearView("record"),this.isDeleted=!0,this.getHeaderView().reRender()})},setupHeader:function(){this.createView("header","views/header",{selector:"> .header",scope:this.scope,fontSizeFlexible:!0})},setupRecord:function(){this.wait(this.getCollectionFactory().create(this.scope).then(e=>{this.collection=e,this.collection.add(this.model),this.createView("record","views/stream/record/list",{selector:"> .record",collection:this.collection,isUserStream:!0})}))},getHeader:function(){var e=this.model.get("parentType"),t=this.model.get("parentId"),i=this.model.get("parentName"),s=this.model.get("type");let a=$("<span>").text(this.getLanguage().translateOption(s,"type","Note"));return(this.model.get("deleted")||this.isDeleted)&&a.css("text-decoration","line-through"),e&&t?this.buildHeaderHtml([$("<a>").attr("href","#"+e).text(this.translate(e,"scopeNamesPlural")),$("<a>").attr("href","#"+e+"/view/"+t).text(i||t),$("<span>").text(this.translate("Stream","scopeNames")),a]):this.buildHeaderHtml([$("<span>").text(this.translate("Stream","scopeNames")),a])}})),define("views/note/record/edit",["views/record/edit"],function(e){return e.extend({sideView:null,isWide:!0,setup:function(){e.prototype.setup.call(this),this.controlRequiredFields(),this.listenTo(this.model,"change:attachmentsIds",()=>{this.controlRequiredFields()})},controlRequiredFields:function(){(this.model.get("attachmentsIds")||[]).length?this.setFieldNotRequired("post"):this.setFieldRequired("post")},afterRender:function(){e.prototype.afterRender.call(this)}})}),define("views/note/modals/edit",["views/modals/edit"],function(e){return e.extend({fullFormDisabled:!0,setup:function(){e.prototype.setup.call(this),this.once("ready",()=>{let t=this.getView("edit")||this.getView("record");var e;!t||(e=t.getFieldView("post"))&&this.listenTo(e,"add-files",e=>{t.getFieldView("attachments")&&t.getFieldView("attachments").uploadFiles(e)})})}})}),define("views/note/fields/users",["views/fields/link-multiple"],function(e){return e.extend({init:function(){this.messagePermission=this.getAcl().getPermissionLevel("message"),this.portalPermission=this.getAcl().getPermissionLevel("portal"),"no"===this.messagePermission&&"no"===this.portalPermission&&(this.readOnly=!0),e.prototype.init.call(this)},getSelectBoolFilterList:function(){return"team"===this.messagePermission?["onlyMyTeam"]:"yes"===this.portalPermission?null:void 0},getSelectPrimaryFilterName:function(){return"yes"===this.portalPermission&&"no"===this.messagePermission?"activePortal":"active"},getSelectFilterList:function(){return"yes"===this.portalPermission?"no"===this.messagePermission?["activePortal"]:["active","activePortal"]:null}})}),define("views/note/fields/post",["views/fields/text","lib!jquery-textcomplete"],function(e,t){return e.extend({setup:function(){e.prototype.setup.call(this),this.events["paste textarea"]=e=>this.handlePaste(e),this.insertedImagesData={}},handlePaste:function(t){if(t.originalEvent.clipboardData){let e=t.originalEvent.clipboardData.getData("text/plain");(e=e&&e.trim())&&this.handlePastedText(e,t.originalEvent)}},afterRenderEdit:function(){var e=this.options.placeholderText||this.translate("writeMessage","messages","Note");this.$element.attr("placeholder",e),this.$textarea=this.$element;let t=this.$textarea,i=(t.off("drop"),t.off("dragover"),t.off("dragleave"),t.off("paste"),t.on("paste",e=>{var t=e.originalEvent.clipboardData.items;if(t)for(var i,s=0;s<t.length;s++)~t[s].type.indexOf("image")&&(i=t[s].getAsFile(),this.trigger("add-files",[i]))}),this.$textarea.on("drop",e=>{e.preventDefault(),e.stopPropagation(),(e=e.originalEvent).dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length&&this.trigger("add-files",e.dataTransfer.files),this.$textarea.attr("placeholder",i)}),this.$textarea.attr("placeholder")),s=(this.$textarea.on("dragover",e=>{e.preventDefault(),this.$textarea.attr("placeholder",this.translate("dropToAttach","messages"))}),this.$textarea.on("dragleave",e=>{e.preventDefault(),this.$textarea.attr("placeholder",i)}),this.getAcl().get("assignmentPermission"));var a=e=>{let t="User?q="+e+"&"+$.param({primaryFilter:"active"})+"&orderBy=name&maxSize="+this.getConfig().get("recordsPerPage")+"&select=id,name,userName";return"team"===s&&(t+="&"+$.param({boolFilterList:["onlyMyTeam"]})),t};"no"!==s&&this.model.isNew()&&(this.$element.textcomplete([{match:/(^|\s)@(\w*)$/,search:(e,t)=>{0!==e.length?Espo.Ajax.getRequest(a(e)).then(e=>{t(e.list)}):t([])},template:e=>this.getHelper().escapeString(e.name)+' <span class="text-muted">@'+this.getHelper().escapeString(e.userName)+"</span>",replace:e=>"$1@"+e.userName}],{zIndex:1100}),this.once("remove",()=>{this.$element.length&&this.$element.textcomplete("destroy")}))},validateRequired:function(){return(!this.isRequired()||!(this.model.get("attachmentsIds")||[]).length)&&e.prototype.validateRequired.call(this)},handlePastedText:function(i,e){if(/^http(s){0,1}\:\/\
        <div class="complex-text">{{complexText viewObject.messageText}}</div>
        <div class="button-container btn-group" style="margin-top: 30px">
        <button class="btn btn-primary" data-action="proceed">{{translate 'Proceed'}}</button>
        <button class="btn btn-default" data-action="logout">{{translate 'Log Out'}}</button></div>
    `;setup(){this.buttonList=[],this.headerText=this.translate("auth2FARequiredHeader","messages","User"),this.messageText=this.translate("auth2FARequired","messages","User")}actionProceed(){this.createView("dialog","views/user/modals/security",{userModel:this.getUser()},e=>{e.render(),this.listenToOnce(e,"done",()=>{this.clearView("dialog"),this.close()})})}actionLogout(){this.getRouter().logout()}}e.default=s}),define("views/modals/array-field-add",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/array-field-add";cssName="add-modal";backdrop=!0;data(){return{optionList:this.optionList,translatedOptions:this.translations}}events={"click .add":function(e){e=$(e.currentTarget).attr("data-value");this.trigger("add",e)},'click input[type="checkbox"]':function(e){var t=$(e.currentTarget).attr("data-value");e.target.checked?this.checkedList.push(t):-1!==(e=this.checkedList.indexOf(t))&&this.checkedList.splice(e,1),this.checkedList.length?this.enableButton("select"):this.disableButton("select")},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};setup(){this.headerText=this.translate("Add Item"),this.checkedList=[],this.translations=Espo.Utils.clone(this.options.translatedOptions||{}),this.optionList=this.options.options||[],this.optionList.forEach(e=>{e in this.translations||(this.translations[e]=e)}),this.buttonList=[{name:"select",style:"danger",label:"Select",disabled:!0,onClick:()=>{this.trigger("add-mass",this.checkedList)}},{name:"cancel",label:"Cancel"}]}afterRender(){this.$noData=this.$el.find(".no-data"),setTimeout(()=>{this.$el.find('input[data-name="quick-search"]').focus()},100)}processQuickSearch(e){e=e.trim();const t=this.$noData;if(t.addClass("hidden"),e){const s=[],a=e.toLowerCase();if(this.optionList.forEach(e=>{const t=this.translations[e].toLowerCase();for(const i of t.split(" "))if(0===i.indexOf(a))return void s.push(e)}),0===s.length)return this.$el.find("ul .list-group-item").addClass("hidden"),void t.removeClass("hidden");this.optionList.forEach(e=>{const t=this.$el.find(`ul .list-group-item[data-name="${e}"]`);~s.indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("ul .list-group-item").removeClass("hidden")}}e.default=s}),define("views/modals/add-dashlet",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/add-dashlet";cssName="add-dashlet";backdrop=!0;events={"click .add":function(e){e=$(e.currentTarget).data("name");this.trigger("add",e),this.close()},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};data(){return{dashletList:this.dashletList}}setup(){this.headerText=this.translate("Add Dashlet");const e=Object.keys(this.getMetadata().get("dashlets")||{}).sort((e,t)=>this.translate(e,"dashlets").localeCompare(this.translate(t,"dashlets")));this.translations={},this.dashletList=e.filter(e=>{var t=this.getMetadata().get(["dashlets",e,"aclScope"])||null;const i=this.getMetadata().get(["dashlets",e,"accessDataList"])||null;return"Settings"===this.options.parentType||("Portal"===this.options.parentType?!i||!i.find(e=>e.inPortalDisabled):!(t&&!this.getAcl().check(t))&&(!(i&&!Espo.Utils.checkAccessDataList(i,this.getAcl(),this.getUser()))&&(this.translations[e]=this.translate(e,"dashlets"),!0)))})}afterRender(){this.$noData=this.$el.find(".no-data"),setTimeout(()=>{this.$el.find('input[data-name="quick-search"]').focus()},100)}processQuickSearch(e){e=e.trim();const t=this.$noData;if(t.addClass("hidden"),e){const s=[],a=e.toLowerCase();if(this.dashletList.forEach(e=>{const t=this.translations[e].toLowerCase();for(const i of t.split(" "))if(0===i.indexOf(a))return void s.push(e)}),0===s.length)return this.$el.find("ul .list-group-item").addClass("hidden"),void t.removeClass("hidden");this.dashletList.forEach(e=>{const t=this.$el.find(`ul .list-group-item[data-name="${e}"]`);~s.indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("ul .list-group-item").removeClass("hidden")}}e.default=s}),define("views/modals/action-history",["exports","views/modal","search-manager"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="modals/action-history";scope="ActionHistoryRecord";className="dialog dialog-record";backdrop=!0;setup(){super.setup(),this.buttonList=[{name:"cancel",label:"Close"}],this.scope=this.entityType=this.options.scope||this.scope,this.$header=$("<a>").attr("href","#ActionHistoryRecord").addClass("action").attr("data-action","listView").text(this.getLanguage().translate(this.scope,"scopeNamesPlural")),this.waitForView("list"),this.getCollectionFactory().create(this.scope,e=>{e.maxSize=this.getConfig().get("recordsPerPage")||20,this.collection=e,this.setupSearch(),this.setupList(),e.fetch()})}actionListView(){this.getRouter().navigate("#ActionHistoryRecord",{trigger:!0}),this.close()}setupSearch(){const e=this.searchManager=new i.default(this.collection,"listSelect",null,this.getDateTime());this.collection.data.boolFilterList=["onlyMy"],this.collection.where=e.getWhere(),this.createView("search","views/record/search",{collection:this.collection,fullSelector:this.containerSelector+" .search-container",searchManager:e,disableSavePreset:!0,textFilterDisabled:!0})}setupList(){const e=this.getMetadata().get(`clientDefs.${this.scope}.recordViews.list`)||"views/record/list";this.listenToOnce(this.collection,"sync",()=>{this.createView("list",e,{collection:this.collection,fullSelector:this.containerSelector+" .list-container",selectable:!1,checkboxes:!1,massActionsDisabled:!0,rowActionsView:"views/record/row-actions/view-only",type:"listSmall",searchManager:this.searchManager,checkAllResultDisabled:!0,buttonsDisabled:!0})})}}e.default=a}),define("views/global-search/scope-badge",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="global-search/scope-badge";data(){return{label:this.translate(this.model.get("_scope"),"scopeNames")}}}e.default=s}),define("views/global-search/panel",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="global-search/panel";setup(){this.addHandler("click",'[data-action="closePanel"]',()=>this.close()),this.maxSize=this.getConfig().get("globalSearchMaxSize")||10,this.navbarPanelHeightSpace=this.getThemeManager().getParam("navbarPanelHeightSpace")||100,this.navbarPanelBodyMaxHeight=this.getThemeManager().getParam("navbarPanelBodyMaxHeight")||600}onRemove(){$(window).off("resize.global-search-height"),this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1)}afterRender(){this.collection.reset(),this.collection.maxSize=this.maxSize,this.collection.fetch().then(()=>this.createRecordView()).then(e=>e.render());const e=$(window);e.off("resize.global-search-height"),e.on("resize.global-search-height",this.processSizing.bind(this)),this.processSizing()}createRecordView(){return this.createView("list","views/record/list-expanded",{selector:".list-container",collection:this.collection,listLayout:{rows:[[{name:"name",view:"views/global-search/name-field"}]],right:{name:"read",view:"views/global-search/scope-badge",width:"80px"}}})}processSizing(){const e=$(window);var t=e.height(),i=e.width(),s=this.$el.find(".panel-heading").outerHeight();let a={};i<=this.getThemeManager().getParam("screenWidthXs")?(a.height=t-s+"px",a.overflow="auto",$("body").css("overflow","hidden"),this.overflowWasHidden=!0):(a.height="unset",a.overflow="none",this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1),t-this.navbarPanelBodyMaxHeight<this.navbarPanelHeightSpace&&(i=t-this.navbarPanelHeightSpace,a.maxHeight=i+"px")),this.$el.find(".panel-body").css(a)}close(){this.trigger("close")}}e.default=s}),define("views/global-search/name-field",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{listTemplate="global-search/name-field";data(){return{scope:this.model.get("_scope"),name:this.model.get("name")||this.translate("None"),id:this.model.id,iconHtml:this.getHelper().getScopeColorIconHtml(this.model.get("_scope"))}}}e.default=s}),define("views/global-search/global-search",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="global-search/global-search";setup(){this.addHandler("keydown","input.global-search-input","onKeydown"),this.addHandler("focus","input.global-search-input","onFocus"),this.addHandler("click",'[data-action="search"]',()=>this.runSearch());var e=this.getCollectionFactory().create("GlobalSearch",e=>{this.collection=e,this.collection.url="GlobalSearch"});this.wait(e),this.closeNavbarOnShow=/iPad|iPhone|iPod/.test(navigator.userAgent)}onFocus(e){let t=e.target;t.select()}onKeydown(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Enter"!==e.code&&"Enter"!==t&&"Control+Enter"!==t?"Escape"===t&&this.closePanel():this.runSearch()}afterRender(){this.$input=this.$el.find("input.global-search-input")}runSearch(){var e=this.$input.val().trim();""!==e&&2<=e.length&&this.search(e)}search(e){this.collection.url=this.collection.urlRoot="GlobalSearch?q="+encodeURIComponent(e),this.showPanel()}showPanel(){this.closePanel(),this.closeNavbarOnShow&&this.$el.closest(".navbar-body").removeClass("in");let t=$("<div>").attr("id","global-search-panel"),e=(t.appendTo(this.$el.find(".global-search-panel-container")),this.createView("panel","views/global-search/panel",{fullSelector:"#global-search-panel",collection:this.collection},e=>{e.render(),this.listenToOnce(e,"close",this.closePanel)}),$(document));e.on("mouseup.global-search",e=>{1===e.which&&(t.is(e.target)||0!==t.has(e.target).length||this.closePanel())}),e.on("click.global-search",e=>{"A"!==e.target.tagName||"showMore"===$(e.target).data("action")||$(e.target).hasClass("global-search-button")||setTimeout(()=>this.closePanel(),100)})}closePanel(){let e=$("#global-search-panel"),t=(e.remove(),$(document));this.hasView("panel")&&this.getView("panel").remove(),t.off("mouseup.global-search"),t.off("click.global-search")}}e.default=s}),define("views/fields/wysiwyg",["exports","views/fields/text","helpers/misc/summernote-custom"],function(e,t,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(s=t)&&s.__esModule?s:{default:s}).default{type="wysiwyg";listTemplate="fields/wysiwyg/detail";detailTemplate="fields/wysiwyg/detail";editTemplate="fields/wysiwyg/edit";height=250;rowsDefault=1e4;fallbackBodySideMargin=5;fallbackBodyTopMargin=4;seeMoreDisabled=!0;fetchEmptyValueAsNull=!1;validationElementSelector=".note-editor";htmlPurificationDisabled=!1;tableClassName="table table-bordered";tableBorderWidth;tableCellPadding;noStylesheet=!1;events={"click .note-editable":function(){this.fixPopovers()},"focus .note-editable":function(){this.$noteEditor.addClass("in-focus")},"blur .note-editable":function(){this.$noteEditor.removeClass("in-focus")}};setup(){super.setup(),this.wait(Espo.loader.requirePromise("lib!summernote").then(()=>{!$.summernote.options||"espoImage"in $.summernote.options||this.initEspoPlugin()})),this.hasBodyPlainField=!!~this.getFieldManager().getEntityTypeFieldList(this.model.entityType).indexOf(this.name+"Plain"),"height"in this.params&&(this.height=this.params.height),"minHeight"in this.params&&(this.minHeight=this.params.minHeight),this.useIframe=this.params.useIframe||this.useIframe,this.setupToolbar(),this.listenTo(this.model,"change:isHtml",(e,t,i)=>{if(i.ui&&this.isEditMode()){if(!this.isRendered())return;if(!e.has("isHtml")||e.get("isHtml")){let e=this.plainToHtml(this.model.get(this.name));return this.lastHtmlValue&&this.model.get(this.name)===this.htmlToPlain(this.lastHtmlValue)&&(e=this.lastHtmlValue),this.model.set(this.name,e,{skipReRender:!0}),void this.enableWysiwygMode()}this.lastHtmlValue=this.model.get(this.name);const t=this.htmlToPlain(this.model.get(this.name));return this.disableWysiwygMode(),void this.model.set(this.name,t)}this.isDetailMode()&&this.isRendered()&&this.reRender()}),this.once("remove",()=>{this.destroySummernote()}),this.on("inline-edit-off",()=>{this.destroySummernote()}),this.on("render",()=>{this.destroySummernote()}),this.once("remove",()=>{$(window).off("resize."+this.cid),this.$scrollable&&this.$scrollable.off("scroll."+this.cid+"-edit")})}data(){const e=super.data();return e.useIframe=this.useIframe,e.isPlain=this.isPlain(),e}setupToolbar(){this.buttons={},this.toolbar=this.params.toolbar||this.toolbar||[["style",["style"]],["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["espoTable","espoLink","espoImage","hr"]],["misc",["codeview","fullscreen"]]],this.params.toolbar||this.params.attachmentField&&(this.toolbar.push(["attachment",["attachment"]]),this.buttons.attachment=()=>{const e=$.summernote.ui,t=e.button({contents:'<i class="fas fa-paperclip"></i>',tooltip:this.translate("Attach File"),click:()=>{this.attachFile(),this.listenToOnce(this.model,"attachment-uploaded:attachments",()=>{this.isEditMode()&&Espo.Ui.success(this.translate("Attached"))})}});return t.render()})}isPlain(){return this.model.has("isHtml")&&!this.model.get("isHtml")}fixPopovers(){$("body > .note-popover").removeClass("hidden")}getValueForDisplay(){var e=super.getValueForDisplay();return this.isPlain()?e:this.sanitizeHtml(e)}sanitizeHtml(e){return(e=e&&(this.htmlPurificationDisabled?this.sanitizeHtmlLight(e):this.getHelper().sanitizeHtml(e)))||""}sanitizeHtmlLight(e){return this.getHelper().moderateSanitizeHtml(e)}getValueForEdit(){var e=this.model.get(this.name)||"";return this.htmlPurificationForEditDisabled?this.sanitizeHtmlLight(e):this.sanitizeHtml(e)}afterRender(){super.afterRender(),this.isEditMode()&&(this.$summernote=this.$el.find(".summernote"));var e=this.getConfig().get("language");e in $.summernote.lang||($.summernote.lang[e]=this.getLanguage().translate("summernote","sets")),this.isEditMode()&&(!this.model.has("isHtml")||this.model.get("isHtml")?this.enableWysiwygMode():this.$element.removeClass("hidden")),this.isReadMode()&&this.renderDetail()}renderDetail(){if(!this.model.has("isHtml")||this.model.get("isHtml"))if(this.useIframe){this.$el.find("iframe").removeClass("hidden");const s=this.$el.find("iframe"),a=this.iframe=s.get(0);if(a){s.on("load",()=>{s.contents().find("a").attr("target","_blank")});const i=a.contentWindow.document;let e=this.sanitizeHtml(this.model.get(this.name)||"");const o=this.getThemeManager().getParam("isDark")&&this.htmlHasColors(e);var u=this.getThemeManager().getParam("isDark")&&(this.htmlHasColors(e)||this.noStylesheet);const n=s.parent();if(u?n.addClass("fallback"):n.removeClass("fallback"),!this.noStylesheet){const c=a.contentWindow.document.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=this.getBasePath()+(o?this.getThemeManager().getIframeFallbackStylesheet():this.getThemeManager().getIframeStylesheet()),e=c.outerHTML+e}i.write(e),i.close();const l=s.contents().find("html body"),r=(l.find("img").each((e,t)=>{const i=$(t);"none"===i.css("max-width")&&i.css("max-width","100%")}),$(i)),d=(r.on("click",()=>{var e=new MouseEvent("click",{bubbles:!0});s[0].dispatchEvent(e)}),r.on("mouseup",()=>{var e=new MouseEvent("mouseup",{bubbles:!0});s[0].dispatchEvent(e)}),r.on("keydown",e=>{e=e.originalEvent,e=new KeyboardEvent("keydown",{bubbles:!0,code:e.code,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey});s[0].dispatchEvent(e)}),function(){var e=l.get(0);e&&e.clientWidth!==a.scrollWidth&&(a.style.height=a.scrollHeight+20+"px")}),m=(o&&n.css({paddingLeft:this.fallbackBodySideMargin+"px",paddingRight:this.fallbackBodySideMargin+"px",paddingTop:this.fallbackBodyTopMargin+"px"}),10),p=function(e,t){if(l.css("height",""),!(200<(e=e||0))){e++;var i=r.height()-a.scrollHeight;if(void 0!==t&&i===t)return l.css("height",a.clientHeight-m+"px"),void d();i?(t=a.scrollHeight+m,a.style.height=t+"px",p(e,i)):d()}},h=function(e){if(e){if(a.scrollHeight>=r.height())return}else s.css({overflowY:"hidden",overflowX:"hidden"}),a.style.height="0px";const t=s.contents().find("html body");let i=t.height();0===i&&(i=t.children().height()+100),a.style.height=i+"px",p(),e||s.css({overflowY:"hidden",overflowX:"scroll"})};s.css({visibility:"hidden"}),setTimeout(()=>{h(),s.css({visibility:"visible"}),s.on("load",()=>{var e;h(!0),o&&!this.noStylesheet&&(e=a.contentWindow.getComputedStyle(l.get(0)).backgroundColor,n.css({backgroundColor:e}))})},40),this.model.get(this.name)||s.addClass("hidden");let t=$(window).width();$(window).off("resize."+this.cid),$(window).on("resize."+this.cid,()=>{$(window).width()!==t&&(h(),t=$(window).width())})}}else this.$element=this.$el.find(".html-container");else this.$el.find(".plain").removeClass("hidden")}enableWysiwygMode(){if(this.$element){this.$element.addClass("hidden"),this.$summernote.removeClass("hidden");var t=this.getValueForEdit();this.$summernote.html(t),this.$summernote.find("style").remove(),this.$summernote.find('link[ref="stylesheet"]').remove();const i=Espo.Utils.cloneDeep($.summernote.options.keyMap);i.pc["CTRL+K"]="espoLink.show",i.mac["CMD+K"]="espoLink.show",i.pc["CTRL+DELETE"]="removeFormat",i.mac["CMD+DELETE"]="removeFormat",delete i.pc["CTRL+ENTER"],delete i.mac["CMD+ENTER"],delete i.pc["CTRL+BACKSLASH"],delete i.mac["CMD+BACKSLASH"];t=this.toolbar;let e=new Date;const s=1e3*this.changeInterval,a={espoView:this,lang:this.getConfig().get("language"),keyMap:i,callbacks:{onImageUpload:e=>{e=e[0];Espo.Ui.notify(this.translate("Uploading...")),this.uploadInlineAttachment(e).then(e=>{e="?entryPoint=attachment&id="+e.id;this.$summernote.summernote("insertImage",e),Espo.Ui.notify(!1)})},onBlur:()=>{this.trigger("change")},onKeydown:()=>{Date.now()-e>s&&(this.trigger("change"),e=Date.now())}},onCreateLink(e){return e},toolbar:t,buttons:this.buttons,dialogsInBody:this.$el,codeviewFilter:!0,tableClassName:this.tableClassName,tableBorderWidth:this.tableBorderWidth,tableCellPadding:this.tableCellPadding};if(this.height)a.height=this.height;else{let e=this.$el.closest(".modal-body");e.length||(e=$(window)),(this.$scrollable=e).off("scroll."+this.cid+"-edit"),e.on("scroll."+this.cid+"-edit",e=>{this.onScrollEdit(e)})}this.minHeight&&(a.minHeight=this.minHeight),this.destroySummernote(),this.$summernote.summernote(a),this.summernoteIsInitialized=!0,this.$toolbar=this.$el.find(".note-toolbar"),this.$area=this.$el.find(".note-editing-area"),this.$noteEditor=this.$el.find("> .note-editor")}}focusOnInlineEdit(){this.$noteEditor?this.$summernote.summernote("focus"):super.focusOnInlineEdit()}uploadInlineAttachment(a){return new Promise((i,s)=>{this.getModelFactory().create("Attachment",t=>{const e=new FileReader;e.onload=e=>{t.set("name",a.name),t.set("type",a.type),t.set("role","Inline Attachment"),t.set("global",!0),t.set("size",a.size),this.model.id&&t.set("relatedId",this.model.id),t.set("relatedType",this.model.entityType),t.set("file",e.target.result),t.set("field",this.name),t.save().then(()=>i(t)).catch(()=>s())},e.readAsDataURL(a)})})}destroySummernote(){this.summernoteIsInitialized&&this.$summernote&&(this.$summernote.summernote("destroy"),this.summernoteIsInitialized=!1)}plainToHtml(e){return(e=e||"").replace(/\n/g,"<br>")}htmlToPlain(e){e=(e=e||"").replace(/<br\s*\/?>/gm,"\n").replace(/<\/p\s*\/?>/gm,"\n\n");const t=$("<div>").html(e);return t.find("style").remove(),t.find('link[ref="stylesheet"]').remove(),t.text()}disableWysiwygMode(){this.destroySummernote(),this.$noteEditor=null,this.$summernote&&this.$summernote.addClass("hidden"),this.$element.removeClass("hidden"),this.$scrollable&&this.$scrollable.off("scroll."+this.cid+"-edit")}fetch(){const t={};if(!this.model.has("isHtml")||this.model.get("isHtml")){let e=this.$summernote.summernote("code");"<p><br></p>"===e&&(e="");const i='<img src="'+window.location.origin+window.location.pathname+"?entryPoint=attachment";e=e.replace(new RegExp(i.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),'<img src="?entryPoint=attachment'),t[this.name]=e}else t[this.name]=this.$element.val(),this.fetchEmptyValueAsNull&&(t[this.name]||(t[this.name]=null));return this.model.has("isHtml")&&this.hasBodyPlainField&&(this.model.get("isHtml")?t[this.name+"Plain"]=this.htmlToPlain(t[this.name]):t[this.name+"Plain"]=t[this.name]),t}onScrollEdit(e){const t=$(e.target);var e=this.$toolbar.height(),i=this.$toolbar.parent().width();let s,a;if(t.get(0)===window.document){const r=t.find(".detail-button-container:not(.hidden)");var o=r.offset();o&&(s=o.top+r.height(),a=s-$(window).scrollTop())}else{o=t.offset();o&&(s=o.top,a=s-$(window).scrollTop())}var o=this.$el.offset().top,n=o+this.$el.height()-e;let l=!1;if(l=s>o&&n>s?!0:l)return this.$toolbar.css({top:a+"px",width:i+"px"}),this.$toolbar.addClass("sticked"),void this.$area.css({marginTop:e+"px",backgroundColor:""});this.$toolbar.css({top:"",width:""}),this.$toolbar.removeClass("sticked"),this.$area.css({marginTop:""})}attachFile(){const e=this.$el.closest(".record");e.find('.field[data-name="'+this.params.attachmentField+'"] input.file').click()}initEspoPlugin(){var e=this.getLanguage().get("Global","sets","summernote")||{image:{},link:{},video:{}};(0,i.init)(e)}htmlHasColors(e){return!!~e.indexOf("background-color:")||(!!~e.indexOf("color:")||!!~e.indexOf('<font color="'))}}e.default=a}),define("views/fields/varchar-column",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchTypeList=["startsWith","contains","equals","endsWith","like","isEmpty","isNotEmpty"];fetchSearch(){var e=this.fetchSearchType()||"startsWith";if(~["isEmpty","isNotEmpty"].indexOf(e))return"isEmpty"===e?{typeFront:e,where:{type:"or",value:[{type:"columnIsNull",field:this.name},{type:"columnEquals",field:this.name,value:""}]}}:{typeFront:e,where:{type:"and",value:[{type:"columnNotEquals",field:this.name,value:""},{type:"columnIsNotNull",field:this.name,value:null}]}};let t=this.$element.val().toString().trim();return(t=t.trim())?{value:t,type:"column".Espo.Utils.upperCaseFirst(e),data:{type:e,value:t}}:null}}e.default=s}),define("views/fields/users",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),"no"===this.assignmentPermission&&(this.readOnly=!0),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission||"no"===this.assignmentPermission)return["onlyMyTeam"]}getSelectPrimaryFilterName(){return"active"}}e.default=s}),define("views/fields/teams",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission||"no"===this.assignmentPermission)return["onlyMy"]}}e.default=s}),define("views/fields/range-currency",["exports","views/fields/range-float","views/fields/currency","ui/select"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class o extends t.default{type="rangeCurrency";editTemplate="fields/range-currency/edit";data(){return{currencyField:this.currencyField,currencyValue:this.model.get(this.fromCurrencyField)||this.getPreferences().get("defaultCurrency")||this.getConfig().get("defaultCurrency"),currencyList:this.currencyList,...super.data()}}setup(){super.setup();var e=Espo.Utils.upperCaseFirst(this.name);this.fromCurrencyField="from"+e+"Currency",this.toCurrencyField="to"+e+"Currency",this.currencyField=this.name+"Currency",this.currencyList=this.getConfig().get("currencyList")||["USD"],this.decimalPlaces=this.getConfig().get("currencyDecimalPlaces")}setupAutoNumericOptions(){this.autoNumericOptions={digitGroupSeparator:this.thousandSeparator||"",decimalCharacter:this.decimalMark,modifyValueOnWheel:!1,selectOnFocus:!1,decimalPlaces:this.decimalPlaces,allowDecimalPadding:!0,showWarnings:!1,formulaMode:!0},null===this.decimalPlaces&&(this.autoNumericOptions.decimalPlaces=this.decimalPlacesRawValue,this.autoNumericOptions.decimalPlacesRawValue=this.decimalPlacesRawValue,this.autoNumericOptions.allowDecimalPadding=!1)}afterRender(){super.afterRender(),this.mode===this.MODE_EDIT&&(this.$currency=this.$el.find('[data-name="'+this.currencyField+'"]'),s.default.init(this.$currency))}formatNumber(e){return i.default.prototype.formatNumberDetail.call(this,e)}getValueForDisplay(){let e=this.model.get(this.fromField),t=this.model.get(this.toField);e=isNaN(e)?null:e,t=isNaN(t)?null:t;var i=this.model.get(this.fromCurrencyField)||this.model.get(this.toCurrencyField),i=this.getMetadata().get(["app","currency","symbolMap",i])||i;return null!==e&&null!==t?this.formatNumber(e)+" &#8211 "+this.formatNumber(t)+" "+i:e?"&#62;&#61; "+this.formatNumber(e)+" "+i:t?"&#60;&#61; "+this.formatNumber(t)+" "+i:this.translate("None")}fetch(){const e=super.fetch();var t=this.$currency.val();return null!==e[this.fromField]?e[this.fromCurrencyField]=t:e[this.fromCurrencyField]=null,null!==e[this.toField]?e[this.toCurrencyField]=t:e[this.toCurrencyField]=null,e}}e.default=o}),define("views/fields/person-name",["exports","views/fields/varchar","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="personName";detailTemplate="fields/person-name/detail";editTemplate="fields/person-name/edit";editTemplateLastFirst="fields/person-name/edit-last-first";editTemplateLastFirstMiddle="fields/person-name/edit-last-first-middle";editTemplateFirstMiddleLast="fields/person-name/edit-first-middle-last";validations=["required","pattern"];data(){let e=super.data();return e.ucName=Espo.Utils.upperCaseFirst(this.name),e.salutationValue=this.model.get(this.salutationField),e.firstValue=this.model.get(this.firstField),e.lastValue=this.model.get(this.lastField),e.middleValue=this.model.get(this.middleField),e.salutationOptions=this.model.getFieldParam(this.salutationField,"options"),this.isEditMode()&&(e.firstMaxLength=this.model.getFieldParam(this.firstField,"maxLength"),e.lastMaxLength=this.model.getFieldParam(this.lastField,"maxLength"),e.middleMaxLength=this.model.getFieldParam(this.middleField,"maxLength")),e.valueIsSet=this.model.has(this.firstField)||this.model.has(this.lastField),this.isDetailMode()?e.isNotEmpty=!!(e.firstValue||e.lastValue||e.salutationValue||e.middleValue):this.isListMode()&&(e.isNotEmpty=!!e.firstValue||!!e.lastValue||!!e.middleValue),(e.isNotEmpty&&this.isDetailMode()||this.isListMode())&&(e.formattedValue=this.getFormattedValue()),e}setup(){super.setup();var e=Espo.Utils.upperCaseFirst(this.name);this.salutationField="salutation"+e,this.firstField="first"+e,this.lastField="last"+e,this.middleField="middle"+e}afterRender(){super.afterRender(),this.isEditMode()&&(this.$salutation=this.$el.find('[data-name="'+this.salutationField+'"]'),this.$first=this.$el.find('[data-name="'+this.firstField+'"]'),this.$last=this.$el.find('[data-name="'+this.lastField+'"]'),this.formatHasMiddle()&&(this.$middle=this.$el.find('[data-name="'+this.middleField+'"]')),this.$salutation.on("change",()=>{this.trigger("change")}),this.$first.on("change",()=>{this.trigger("change")}),this.$last.on("change",()=>{this.trigger("change")}),i.default.init(this.$salutation))}getFormattedValue(){let e=this.model.get(this.salutationField);var t=this.model.get(this.firstField),i=this.model.get(this.lastField),s=this.model.get(this.middleField);return e=e&&this.getLanguage().translateOption(e,"salutationName",this.model.entityType),this.formatName({salutation:e,first:t,middle:s,last:i})}_getTemplateName(){if(this.isEditMode()){var e="editTemplate"+Espo.Utils.upperCaseFirst(this.getFormat().toString());if(e in this)return this[e]}return super._getTemplateName()}getFormat(){return this.format=this.format||this.getConfig().get("personNameFormat")||"firstLast",this.format}formatHasMiddle(){var e=this.getFormat();return"firstMiddleLast"===e||"lastFirstMiddle"===e}validateRequired(){var e=this.isRequired(),t=e=>{var t;if(this.model.isRequired(e)&&!this.model.get(e))return t=this.translate("fieldIsRequired","messages").replace("{field}",this.translate(e,"fields",this.model.entityType)),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};if(e&&(!this.model.get(this.firstField)&&!this.model.get(this.lastField)))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,'[data-name="'+this.lastField+'"]'),!0;let i=!1;return i=t(this.salutationField)||i,i=t(this.firstField)||i,i=t(this.lastField)||i,i=t(this.middleField)||i}validatePattern(){let e=!1;return e=this.fieldValidatePattern(this.firstField)||e,e=this.fieldValidatePattern(this.lastField)||e,e=this.fieldValidatePattern(this.middleField)||e}hasRequiredMarker(){return!!this.isRequired()||(this.model.getFieldParam(this.salutationField,"required")||this.model.getFieldParam(this.firstField,"required")||this.model.getFieldParam(this.middleField,"required")||this.model.getFieldParam(this.lastField,"required"))}fetch(){let e={};return e[this.salutationField]=this.$salutation.val()||null,e[this.firstField]=this.$first.val().trim()||null,e[this.lastField]=this.$last.val().trim()||null,this.formatHasMiddle()&&(e[this.middleField]=this.$middle.val().trim()||null),e[this.name]=this.formatName({first:e[this.firstField],last:e[this.lastField],middle:e[this.middleField]}),e}formatName(e){let t;var i=this.getFormat();let s=[];return s.push(e.salutation),"firstLast"===i?(s.push(e.first),s.push(e.last)):"lastFirst"===i?(s.push(e.last),s.push(e.first)):"firstMiddleLast"===i?(s.push(e.first),s.push(e.middle),s.push(e.last)):"lastFirstMiddle"===i?(s.push(e.last),s.push(e.first),s.push(e.middle)):(s.push(e.first),s.push(e.last)),t=""===(t=s.filter(e=>!!e).join(" ").trim())?null:t}}e.default=a}),define("views/fields/password",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="password";detailTemplate="fields/password/detail";editTemplate="fields/password/edit";validations=["required","confirm"];events={'click [data-action="change"]':function(){this.changePassword()}};changePassword(){this.$el.find('[data-action="change"]').addClass("hidden"),this.$element.removeClass("hidden"),this.changing=!0}data(){return{isNew:this.model.isNew(),...super.data()}}validateConfirm(){var e;if(this.model.has(this.name+"Confirm"))return this.model.get(this.name)!==this.model.get(this.name+"Confirm")?(e=this.translate("fieldBadPasswordConfirm","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}afterRender(){super.afterRender(),this.changing=!1,this.params.readyToChange&&this.changePassword()}fetch(){return this.model.isNew()||this.changing?super.fetch():{}}}e.default=s}),define("views/fields/number",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="number";validations=[];inlineEditDisabled=!0;readOnly=!0;fetch(){return{}}}e.default=s}),define("views/fields/map",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="map";detailTemplate="fields/map/detail";listTemplate="fields/map/detail";addressField;provider;height=300;DEFAULT_PROVIDER="Google";data(){const e=super.data();return e.hasAddress=this.hasAddress(),e}setup(){this.addressField=this.name.slice(0,this.name.length-3),this.provider=this.provider||this.getConfig().get("mapProvider")||this.DEFAULT_PROVIDER,this.height=this.options.height||this.params.height||this.height;const e=Object.keys(this.getMetadata().get("fields.address.fields")||{}).map(e=>this.addressField+Espo.Utils.upperCaseFirst(e));this.listenTo(this.model,"sync",t=>{let i=!1;e.forEach(e=>{t.hasChanged(e)&&(i=!0)}),i&&this.isRendered()&&this.reRender()}),this.listenTo(this.model,"after:save",()=>{this.isRendered()&&this.reRender()})}hasAddress(){return!!this.model.get(this.addressField+"City")||!!this.model.get(this.addressField+"PostalCode")}onRemove(){$(window).off("resize."+this.cid)}afterRender(){this.addressData={city:this.model.get(this.addressField+"City"),street:this.model.get(this.addressField+"Street"),postalCode:this.model.get(this.addressField+"PostalCode"),country:this.model.get(this.addressField+"Country"),state:this.model.get(this.addressField+"State")},this.$map=this.$el.find(".map"),this.hasAddress()&&this.renderMap()}renderMap(){this.processSetHeight(!0),"auto"===this.height&&($(window).off("resize."+this.cid),$(window).on("resize."+this.cid,this.processSetHeight.bind(this)));var e,t=this.getMetadata().get(["app","mapProviders",this.provider,"renderer"]);t?Espo.loader.require(t,e=>{new e(this).render(this.addressData)}):(t="afterRender"+this.provider.replace(/\s+/g,""),"function"!=typeof this[t]?(e=this.getMetadata().get(["clientDefs","AddressMap","implementations",this.provider]))&&Espo.loader.require(e,e=>e.render(this)):this[t]())}processSetHeight(e){let t=this.height;"auto"===this.height&&(t=this.$el.parent().height(),e&&t<=0)?setTimeout(()=>this.processSetHeight(!0),50):this.$map.css("height",t+"px")}}e.default=s}),define("views/fields/link-parent",["exports","views/fields/base","helpers/record-modal","ui/select"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s),i=a(i);class o extends t.default{type="linkParent";listTemplate="fields/link-parent/list";detailTemplate="fields/link-parent/detail";editTemplate="fields/link-parent/edit";searchTemplate="fields/link-parent/search";listLinkTemplate="fields/link-parent/list-link";nameName=null;idName=null;typeName=null;foreignScope=null;foreignScopeList=null;autocompleteDisabled=!1;selectRecordsView="views/modals/select-records";createDisabled=!1;searchTypeList=["is","isEmpty","isNotEmpty"];selectPrimaryFilterName=null;selectBoolFilterList=null;autocompleteMaxCount=null;forceSelectAllAttributes=!1;mandatorySelectAttributeList=null;initialSearchIsNotIdle=!0;events={'auxclick a[href]:not([role="button"])':function(e){this.isReadMode()&&1===e.button&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),this.quickView())}};data(){let e=this.model.get(this.nameName),t=(!e&&this.model.get(this.idName)&&this.model.get(this.typeName)&&(e=this.translate(this.model.get(this.typeName),"scopeNames")),null);return(this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST&&this.displayScopeColorInListMode)&&this.foreignScope&&(t=this.getHelper().getScopeColorIconHtml(this.foreignScope)),{...super.data(),idName:this.idName,nameName:this.nameName,typeName:this.typeName,idValue:this.model.get(this.idName),nameValue:e,typeValue:this.model.get(this.typeName),foreignScope:this.foreignScope,foreignScopeList:this.foreignScopeList,valueIsSet:this.model.has(this.idName)||this.model.has(this.typeName),iconHtml:t,displayEntityType:this.displayEntityType&&this.model.get(this.typeName)}}getSelectFilters(){return null}getSelectBoolFilterList(){return this.selectBoolFilterList}getSelectPrimaryFilterName(){return this.selectPrimaryFilterName}getCreateAttributes(){return null}setup(){this.nameName=this.name+"Name",this.typeName=this.name+"Type",this.idName=this.name+"Id",this.foreignScopeList=this.options.foreignScopeList||this.foreignScopeList,this.foreignScopeList=this.foreignScopeList||this.params.entityList||this.model.getLinkParam(this.name,"entityList")||[],this.foreignScopeList=Espo.Utils.clone(this.foreignScopeList).filter(e=>{if(!this.getMetadata().get(["scopes",e,"disabled"]))return!0}),this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0],this.foreignScope&&!~this.foreignScopeList.indexOf(this.foreignScope)&&this.foreignScopeList.unshift(this.foreignScope),this.listenTo(this.model,"change:"+this.typeName,()=>{this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0]}),"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.isListMode()||(this.addActionHandler("selectLink",()=>{Espo.Ui.notify(" ... ");var e=this.getMetadata().get("clientDefs."+this.foreignScope+".modalViews.select")||this.selectRecordsView,t=!this.createDisabled&&this.isEditMode();this.createView("dialog",e,{scope:this.foreignScope,createButton:t,filters:this.getSelectFilters(),boolFilterList:this.getSelectBoolFilterList(),primaryFilterName:this.getSelectPrimaryFilterName(),createAttributes:t?this.getCreateAttributes():null,mandatorySelectAttributeList:this.getMandatorySelectAttributeList(),forceSelectAllAttributes:this.isForceSelectAllAttributes()},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),this.select(e)})})}),this.addActionHandler("clearLink",()=>{this.foreignScopeList.length&&(this.foreignScope=this.foreignScopeList[0],i.default.setValue(this.$elementType,this.foreignScope)),this.$elementName.val(""),this.$elementId.val(""),this.trigger("change")}),this.events['change select[data-name="'+this.typeName+'"]']=e=>{this.foreignScope=e.currentTarget.value,this.$elementName.val(""),this.$elementId.val("")})}setupSearch(){var e=this.getSearchParamsData().type;"is"!==e&&e||(this.searchData.idValue=this.getSearchParamsData().idValue||this.searchParams.valueId,this.searchData.nameValue=this.getSearchParamsData().nameValue||this.searchParams.valueName,this.searchData.typeValue=this.getSearchParamsData().typeValue||this.searchParams.valueType),this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}handleSearchType(e){~["is"].indexOf(e)?this.$el.find("div.primary").removeClass("hidden"):this.$el.find("div.primary").addClass("hidden")}select(e){this.$elementName.val(e.get("name")||e.id),this.$elementId.val(e.get("id")),this.trigger("change")}getMandatorySelectAttributeList(){return this.mandatorySelectAttributeList}isForceSelectAllAttributes(){return this.forceSelectAllAttributes}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}getAutocompleteUrl(){let t=this.foreignScope+"?maxSize="+this.getAutocompleteMaxCount();if(!this.isForceSelectAllAttributes()){let e=["id","name"];this.getMandatorySelectAttributeList()&&(e=e.concat(this.getMandatorySelectAttributeList())),t+="&select="+e.join(",")}var e=this.getSelectBoolFilterList(),e=(e&&(t+="&"+$.param({boolFilterList:e})),this.getSelectPrimaryFilterName());return e&&(t+="&"+$.param({primaryFilter:e})),t}afterRender(){if(this.isEditMode()||this.isSearchMode()){this.$elementId=this.$el.find('input[data-name="'+this.idName+'"]'),this.$elementName=this.$el.find('input[data-name="'+this.nameName+'"]'),this.$elementType=this.$el.find('select[data-name="'+this.typeName+'"]'),this.$elementName.on("change",()=>{""===this.$elementName.val()&&(this.$elementName.val(""),this.$elementId.val(""),this.trigger("change"))}),this.$elementType.on("change",()=>{this.$elementName.val(""),this.$elementId.val(""),this.trigger("change")}),this.$elementName.on("blur",e=>{setTimeout(()=>{this.mode===this.MODE_EDIT&&(e.currentTarget.value=this.model.get(this.nameName)||"")},100),this.autocompleteDisabled||setTimeout(()=>this.$elementName.autocomplete("clear"),300)}),this.autocompleteDisabled||(this.$elementName.autocomplete({serviceUrl:e=>this.getAutocompleteUrl(e),minChars:1,paramName:"q",noCache:!0,triggerSelectOnValidInput:!1,autoSelectFirst:!0,beforeRender:e=>{this.$elementName.hasClass("input-sm")&&e.addClass("small")},formatResult:e=>this.getHelper().escapeString(e.name),transformResult:e=>{e=JSON.parse(e);let t=[];return e.list.forEach(e=>{t.push({id:e.id,name:e.name||e.id,data:e.id,value:e.name||e.id,attributes:e})}),{suggestions:t}},onSelect:t=>{this.getModelFactory().create(this.foreignScope,e=>{e.set(t.attributes),this.select(e),this.$elementName.focus()})}}),this.$elementName.off("focus.autocomplete"),this.$elementName.on("focus",()=>this.$elementName.get(0).select()),this.$elementName.attr("autocomplete","espo-"+this.name),i.default.init(this.$elementType,{}));let e=this.$elementName;this.once("render",()=>{e.autocomplete("dispose")}),this.once("remove",()=>{e.autocomplete("dispose")})}var e;"search"===this.mode&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}))}getValueForDisplay(){return this.model.get(this.nameName)}validateRequired(){var e;if(this.isRequired()&&(null===this.model.get(this.idName)||!this.model.get(this.typeName)))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}fetch(){let e={};return e[this.typeName]=this.$elementType.val()||null,e[this.nameName]=this.$elementName.val()||null,e[this.idName]=this.$elementId.val()||null,null===e[this.idName]&&(e[this.typeName]=null),e}fetchSearch(){var e=this.$el.find("select.search-type").val();if("isEmpty"===e)return{type:"isNull",field:this.idName,data:{type:e}};if("isNotEmpty"===e)return{type:"isNotNull",field:this.idName,data:{type:e}};var e=this.$elementType.val(),t=this.$elementName.val(),i=this.$elementId.val();return e?i?{type:"and",attribute:this.idName,value:[{type:"equals",field:this.idName,value:i},{type:"equals",field:this.typeName,value:e}],data:{type:"is",idValue:i,nameValue:t,typeValue:e}}:{type:"and",attribute:this.idName,value:[{type:"isNotNull",field:this.idName},{type:"equals",field:this.typeName,value:e}],data:{type:"is",typeValue:e}}:null}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront}quickView(){var t=this.model.get(this.idName),i=this.model.get(this.typeName);if(t&&i){let e=new s.default(this.getMetadata(),this.getAcl());e.showDetail(this,{id:t,scope:i})}}}e.default=o}),define("views/fields/link-one",["exports","views/fields/link"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchTypeList=["is","isEmpty","isNotEmpty","isOneOf"];fetchSearch(){var e=this.$el.find("select.search-type").val(),t=this.$el.find('[data-name="'+this.idName+'"]').val();return"isOneOf"===e?{type:"linkedWith",field:this.name,value:this.searchData.oneOfIdList,data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}}:"is"!==e&&e?"isEmpty"===e?{type:"isNotLinked",data:{type:e}}:"isNotEmpty"===e?{type:"isLinked",data:{type:e}}:void 0:!!t&&{type:"linkedWith",field:this.name,value:t,data:{type:e,nameValue:this.$el.find('[data-name="'+this.nameName+'"]').val()}}}}e.default=s}),define("views/fields/link-multiple-with-status",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.columnsName=this.name+"Columns",this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{}),this.listenTo(this.model,"change:"+this.columnsName,()=>{this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{})}),this.statusField=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.name,"columns","status"]),this.styleMap=this.getMetadata().get(["entityDefs",this.foreignScope,"fields",this.statusField,"style"])||{}}getAttributeList(){const e=super.getAttributeList();return e.push(this.name+"Columns"),e}getDetailLinkHtml(e,t){var i=(this.columns[e]||{}).status;if(!i)return super.getDetailLinkHtml(e,t);i=this.styleMap[i];if(!i||!~["success","danger"].indexOf(i))return super.getDetailLinkHtml(e,t);let s="";return"success"===i?s="fas fa-check text-success small":"danger"===i&&(s="fas fa-times text-danger small"),'<span class="'+s+'"></span> '+super.getDetailLinkHtml(e,t)}}e.default=s}),define("views/fields/link-multiple-with-role",["exports","views/fields/link-multiple","ui/select"],function(e,t,d){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),d=i(d);class s extends t.default{roleType="enum";columnName="role";roleFieldIsForeign=!0;emptyRoleValue=null;rolePlaceholderText=null;roleMaxLength=50;ROLE_TYPE_ENUM="enum";ROLE_TYPE_VARCHAR="varchar";setup(){super.setup(),this.columnsName=this.name+"Columns",this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{}),this.listenTo(this.model,"change:"+this.columnsName,()=>{this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{})}),this.roleField=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.name,"columns",this.columnName]),this.displayRoleAsLabel=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.roleField,"displayAsLabel"]),this.roleFieldScope=this.roleFieldIsForeign?this.foreignScope:this.model.entityType,this.roleType!==this.ROLE_TYPE_ENUM||this.forceRoles||(this.roleList=this.getMetadata().get(["entityDefs",this.roleFieldScope,"fields",this.roleField,"options"]),this.roleList||(this.roleList=[],this.skipRoles=!0))}getAttributeList(){const e=super.getAttributeList();return e.push(this.name+"Columns"),e}getDetailLinkHtml(i,e){!(e=e||this.nameHash[i]||i)&&i&&(e=this.translate(this.foreignScope,"scopeNames"));let s=(this.columns[i]||{})[this.columnName]||"",a=(this.emptyRoleValue&&s===this.emptyRoleValue&&(s=""),$("<div>").append($("<a>").attr("href","#"+this.foreignScope+"/view/"+i).attr("data-id",i).text(e)));if(!this.isDetailMode()||(e=this.getIconHtml(i))&&a.prepend(e),s){let e=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.roleField,"style",s]),t="text";this.displayRoleAsLabel&&e&&"default"!==e?(t="label label-sm label","muted"===e&&(e="default")):e=e||"muted",t=t+"-"+e;i=this.roleType===this.ROLE_TYPE_ENUM?this.getLanguage().translateOption(s,this.roleField,this.roleFieldScope):s;a.append($("<span>").text(" "),$("<span>").addClass("text-muted chevron-right"),$("<span>").text(" "),$("<span>").text(i).addClass("small").addClass(t))}return a.get(0).outerHTML}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){let t=[];return this.ids.forEach(e=>{t.push(this.getDetailLinkHtml(e))}),t.join("")}}deleteLink(e){this.trigger("delete-link",e),this.trigger("delete-link:"+e),this.deleteLinkHtml(e);var t=this.ids.indexOf(e);-1<t&&this.ids.splice(t,1),delete this.nameHash[e],delete this.columns[e],this.afterDeleteLink(e),this.trigger("change")}addLink(e,t){~this.ids.indexOf(e)||(this.ids.push(e),this.nameHash[e]=t,this.columns[e]={},this.columns[e][this.columnName]=null,this.addLinkHtml(e,t),this.trigger("add-link",e),this.trigger("add-link:"+e)),this.trigger("change")}getJQSelect(e,s){let a=$("<select>").addClass("role form-control input-sm").attr("data-id",e);return this.roleList.forEach(e=>{var t=this.getLanguage().translateOption(e,this.roleField,this.roleFieldScope);let i=$("<option>").val(e).text(t);e===(s||"")&&i.attr("selected","selected"),a.append(i)}),a}addLinkHtml(e,t){if(t=t||e,this.isSearchMode()||this.skipRoles)return super.addLinkHtml(e,t);var i=(this.columns[e]||{})[this.columnName];let s=this.$el.find(".link-container"),a=$("<div>").addClass("form-inline clearfix").addClass("list-group-item link-with-role link-group-item-with-columns").addClass("link-"+e);var o=$("<a>").attr("role","button").attr("tabindex","0").attr("data-id",e).attr("data-action","clearLink").addClass("pull-right").append($("<span>").addClass("fas fa-times"));let n=$("<div>").addClass("pull-left");var l,o=$("<div>").append(o),t=$("<div>").addClass("link-item-name").text(t).append("&nbsp;");let r;if((r=this.roleType===this.ROLE_TYPE_ENUM?this.getJQSelect(e,i):(l=this.rolePlaceholderText||this.translate(this.roleField,"fields",this.roleFieldScope),$("<input>").addClass("role form-control input-sm").attr("maxlength",this.roleMaxLength).attr("placeholder",l).attr("data-id",e).attr("value",i||"")))&&n.append($("<span>").addClass("link-item-column").addClass("link-item-column-"+r.get(0).tagName.toLowerCase()).append(r)),n.append(t),a.append(n).append(o),s.append(a),r&&"SELECT"===r.get(0).tagName&&d.default.init(r),this.isEditMode()&&r){let t=t=>{if(t&&t.length&&null!==t.val()){let e=t.val().toString().trim();t=t.data("id");""===e&&(e=null),this.columns[t]=this.columns[t]||{},this.columns[t][this.columnName]=e}};r.on("change",e=>{t($(e.currentTarget)),this.trigger("change")}),t(r)}return a}fetch(){let e=super.fetch();return this.skipRoles||(e[this.columnsName]=Espo.Utils.cloneDeep(this.columns)),e}}e.default=s}),define("views/fields/link-multiple-with-columns-with-primary",["exports","views/fields/link-multiple-with-columns","views/fields/link-multiple-with-primary"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{primaryLink;getAttributeList(){let e=super.getAttributeList();return e.push(this.primaryIdAttribute),e.push(this.primaryNameAttribute),e}setup(){this.primaryLink=this.primaryLink||this.model.getFieldParam(this.name,"primaryLink"),this.primaryIdAttribute=this.primaryLink+"Id",this.primaryNameAttribute=this.primaryLink+"Name",super.setup(),this.events['click [data-action="switchPrimary"]']=e=>{let t=$(e.currentTarget);e=t.data("id");a.default.prototype.switchPrimary.call(this,e)},this.primaryId=this.model.get(this.primaryIdAttribute),this.primaryName=this.model.get(this.primaryNameAttribute),this.listenTo(this.model,"change:"+this.primaryIdAttribute,()=>{this.primaryId=this.model.get(this.primaryIdAttribute),this.primaryName=this.model.get(this.primaryNameAttribute)})}setPrimaryId(e){this.primaryId=e,this.primaryName=e?this.nameHash[e]:null,this.trigger("change")}renderLinks(){this.primaryId&&this.addLinkHtml(this.primaryId,this.primaryName),this.ids.forEach(e=>{e!==this.primaryId&&this.addLinkHtml(e,this.nameHash[e])})}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){let t=[];if(this.primaryId&&t.push(this.getDetailLinkHtml(this.primaryId,this.primaryName)),this.ids.length)return this.ids.forEach(e=>{e!==this.primaryId&&t.push(this.getDetailLinkHtml(e))}),t.map(e=>$("<div>").append(e).get(0).outerHTML).join("")}}deleteLink(e){e===this.primaryId&&this.setPrimaryId(null),super.deleteLink(e)}deleteLinkHtml(e){super.deleteLinkHtml(e),this.managePrimaryButton()}addLinkHtml(e,t){if(t=t||e,this.isSearchMode())return super.addLinkHtml(e,t);if(this.skipRoles)return a.default.prototype.addLinkHtml.call(this,e,t);let i=super.addLinkHtml(e,t);t=e===this.primaryId,t=$("<span>").addClass("fas fa-star fa-sm").addClass(t?"":"text-muted");let s=$("<button>").attr("type","button").addClass("btn btn-link btn-sm pull-right hidden").attr("title",this.translate("Primary")).attr("data-action","switchPrimary").attr("data-id",e).append(t);return s.insertAfter(i.children().first().children().first()),this.managePrimaryButton(),i}managePrimaryButton(){let t=this.$el.find('button[data-action="switchPrimary"]');if(1<t.length?t.removeClass("hidden"):t.addClass("hidden"),0===t.filter(".active").length){let e=t.first();e.length&&(e.addClass("active").children().removeClass("text-muted"),this.setPrimaryId(e.data("id")))}}fetch(){const e=super.fetch();return e[this.primaryIdAttribute]=this.primaryId,e[this.primaryNameAttribute]=this.primaryName,e}}e.default=s}),define("views/fields/link-multiple-category-tree",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{selectRecordsView="views/modals/select-category-tree-records";autocompleteDisabled=!1;getUrl(e){return"#"+this.entityType+"/list/categoryId="+e}fetchSearch(){const e=super.fetchSearch();return e&&(e.type="inCategory",e)}}e.default=s}),define("views/fields/link-category-tree",["exports","views/fields/link"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{selectRecordsView="views/modals/select-category-tree-records";autocompleteDisabled=!1;fetchSearch(){const e=super.fetchSearch();return e&&("is"===e.typeFront&&(e.field=this.name,e.type="inCategory"),e)}getUrl(){var e=this.model.get(this.idName);return e?"#"+this.entityType+"/list/categoryId="+e:null}}e.default=s}),define("views/fields/json-object",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="jsonObject";listTemplate="fields/json-object/detail";detailTemplate="fields/json-object/detail";data(){const e=super.data();return e.valueIsSet=this.model.has(this.name),e.isNotEmpty=!!this.model.get(this.name),e}getValueForDisplay(){var e=this.model.get(this.name);return e?JSON.stringify(e,null,2).replace(/(\r\n|\n|\r)/gm,"<br>").replace(/\s/g,"&nbsp;"):null}}e.default=s}),define("views/fields/image",["exports","views/fields/file"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="image";showPreview=!0;accept=["image.source+/@([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])?\.)+[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]/.source);validateEmailAddress(){var e=this.model.get(this.name);return!!e&&(""!==e&&!this.emailAddressRe.test(e)&&(e=this.translate("fieldShouldBeEmail","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0))}}e.default=s}),define("views/fields/duration",["exports","views/fields/enum","ui/select","moment"],function(e,t,a,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a),o=i(o);class s extends t.default{type="duration";listTemplate="fields/base/detail";detailTemplate="fields/varchar/detail";editTemplate="fields/duration/edit";data(){return{valueIsSet:this.model.has(this.startField)&&this.model.has(this.endField),durationOptions:this.durationOptions,...super.data()}}calculateSeconds(){this.seconds=0;var e=this.model.get(this.startField);let t=this.model.get(this.endField);if((this.isEditMode()||this.isDetailMode())&&this.model.isNew()&&(this.seconds=this.model.getFieldParam(this.name,"default")||0),this.model.get("isAllDay")){var i=this.model.get(this.startField+"Date"),s=this.model.get(this.endField+"Date");if(i&&s)return void(this.seconds=(0,o.default)(s).add(1,"days").unix()-(0,o.default)(i).unix())}e&&t?this.seconds=(0,o.default)(this.model.get(this.endField)).unix()-(0,o.default)(this.model.get(this.startField)).unix():e&&(t=this._getDateEnd(),this.model.set(this.endField,t,{silent:!0}))}init(){super.init(),this.listenTo(this,"render",()=>{this.calculateSeconds(),this.durationOptions="",this.getOptions().forEach(e=>{let t=$("<option>").val(e).text(this.stringifyDuration(e));e===this.seconds&&t.attr("selected","selected"),this.durationOptions+=t.get(0).outerHTML}),this.stringValue=this.stringifyDuration(this.seconds)})}getOptions(){let e=Espo.Utils.clone(this.model.getFieldParam(this.name,"options")??[]);return this.model.get("isAllDay")||-1!==e.indexOf(this.seconds)||e.push(this.seconds),e.sort((e,t)=>e-t),e}setup(){if(this.startField=this.model.getFieldParam(this.name,"start"),this.endField=this.model.getFieldParam(this.name,"end"),!this.startField||!this.endField)throw new Error("Bad definition for field '"+this.name+"'.");this.calculateSeconds(),this.blockDateEndChangeListener=!1,this.listenTo(this.model,"change:"+this.endField,(e,t,i)=>{var s,a;this.blockDateEndChangeListener||(s=this.model.get(this.startField),(a=this.model.get(this.endField))&&s&&(this.seconds=(0,o.default)(a).unix()-(0,o.default)(s).unix(),i.updatedByDuration||this.updateDuration()))}),this.listenTo(this.model,"change:"+this.startField,(e,t,i)=>{var s;if(i.ui)return!this.model.get(this.startField+"Date")||0!=(s=this.seconds%86400)&&(this.seconds=this.seconds-s+86400),this.blockDateEndChangeListener=!0,setTimeout(()=>this.blockDateEndChangeListener=!1,100),this.updateDateEnd(),void setTimeout(()=>this.updateDuration(),50);!this.isEditMode()&&i.xhr||this.updateDateEnd()})}getValueForDisplay(){return this.stringValue}stringifyDuration(e){if(!e)return"0";if(e<60)return"0";var t=Math.floor(e/86400),i=(e%=86400,Math.floor(e/3600)),e=(e%=3600,Math.floor(e/60));let s=[];return t&&s.push(t+""+this.getLanguage().translate("d","durationUnits")),i&&s.push(i+""+this.getLanguage().translate("h","durationUnits")),e&&s.push(e+""+this.getLanguage().translate("m","durationUnits")),s.join(" ")}focusOnInlineEdit(){a.default.focus(this.$duration)}afterRender(){let e=this.getParentView();var t,i,s;e&&"getView"in e&&(this.endFieldView=e.getView(this.endField)),this.isEditMode()&&(this.$duration=this.$el.find(".main-element"),this.$duration.on("change",()=>{this.seconds=parseInt(this.$duration.val()),this.updateDateEnd()}),t=this.model.get(this.startField),i=this.model.get(this.endField),s=this.$duration.val(),!i&&t&&s&&this.endFieldView&&(this.endFieldView.isRendered()?this.updateDateEnd():this.endFieldView.once("after:render",()=>{this.updateDateEnd()})),a.default.init(this.$duration,{sortBy:"$score",sortDirection:"desc",score:(e,t)=>{t=parseInt(t.value),e=parseInt(e);if(isNaN(e))return 0;var i=Number.MAX_SAFE_INTEGER-t;return 0===e&&0===t||60*e===t||60*e*60===t||60*e*60*24===t?i:0},load:(i,s)=>{i=parseInt(i);if(!(isNaN(i)||i<=0||59<i)){let t=[],e=60*i;if(t.push({value:e.toString(),text:this.stringifyDuration(e)}),i<=9){let e=3600*i;t.push({value:e.toString(),text:this.stringifyDuration(e)})}s(t)}}}))}_getDateEndDate(){var e=this.seconds,t=this.model.get(this.startField+"Date");if(t){if(!e)return t;t=o.default.utc(t).unix()+e;return o.default.unix(t).utc().add(-1,"day").format(this.getDateTime().internalDateFormat)}}_getDateEnd(){var t=this.seconds,i=this.model.get(this.startField);if(i){let e;return e=t?(t=o.default.utc(i).unix()+t,o.default.unix(t).utc().format(this.getDateTime().internalDateTimeFormat)):i}}updateDateEnd(){let e;if(this.model.get("isAllDay"))return e=this._getDateEndDate(),void setTimeout(()=>{this.model.set(this.endField+"Date",e,{updatedByDuration:!0})},1);e=this._getDateEnd(),setTimeout(()=>{this.model.set(this.endField,e,{updatedByDuration:!0}),this.model.set(this.endField+"Date",null)},1)}updateDuration(){let e=this.seconds;var t;if(this.isEditMode()&&this.$duration&&this.$duration.length)return t=this.getOptions().map(e=>({value:e.toString(),text:this.stringifyDuration(e)})),a.default.setValue(this.$duration,""),a.default.setOptions(this.$duration,t),void a.default.setValue(this.$duration,e.toString());this.reRender()}fetch(){return{}}}e.default=s}),define("views/fields/datetime-short",["exports","views/fields/datetime","moment"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{listTemplate="fields/datetime-short/list";detailTemplate="fields/datetime-short/detail";data(){let e=super.data();return this.mode!==this.MODE_LIST&&this.mode!==this.MODE_DETAIL||(e.fullDateValue=super.getDateStringValue()),e}getDateStringValue(){if(this.mode!==this.MODE_LIST&&this.mode!==this.MODE_DETAIL)return super.getDateStringValue();var e=this.model.get(this.name);if(!e)return super.getDateStringValue();let t=this.getDateTime().timeFormat,i=(this.params.hasSeconds&&(t=t.replace(/:mm/,":mm:ss")),this.getDateTime().toMoment(e)),s=(0,a.default)().tz(this.getDateTime().timeZone||"UTC");if(i.unix()>s.clone().startOf("day").unix()&&i.unix()<s.clone().add(1,"days").startOf("day").unix())return i.format(t);e=this.getDateTime().getReadableShortDateFormat();return i.format("YYYY")===s.format("YYYY")?i.format(e):i.format(e+", YY")}}e.default=s}),define("views/fields/datetime-optional",["exports","views/fields/datetime","moment"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{type="datetimeOptional";setup(){super.setup(),this.noneOption=this.translate("None"),this.nameDate=this.name+"Date"}isDate(){var e=this.model.get(this.nameDate);return!(!e||""===e)}data(){let e=super.data();var t;return this.isDate()&&(t=this.model.get(this.nameDate),e.date=this.getDateTime().toDisplayDate(t),e.time=this.noneOption),e}getDateStringValue(){var e;return this.isDate()?(e=this.model.get(this.nameDate),this.stringifyDateValue(e)):super.getDateStringValue()}setDefaultTime(){this.$time.val(this.noneOption)}initTimepicker(){let e=this.$time,t={step:this.params.minuteStep||30,scrollDefaultNow:!0,timeFormat:this.timeFormatMap[this.getDateTime().timeFormat],noneOption:[{label:this.noneOption,value:this.noneOption}]};(this.emptyTimeInInlineEditDisabled&&this.isInlineEditMode()||this.noneOptionIsHidden)&&delete t.noneOption,e.timepicker(t),e.parent().find("button.time-picker-btn").on("click",()=>{e.timepicker("show")})}fetch(){let e={};var t=this.$date.val(),i=this.$time.val();let s=null;return i!==this.noneOption&&""!==i?(""!==t&&""!==i&&(s=this.parse(t+" "+i)),e[this.name]=s,e[this.nameDate]=null):""!==t?(e[this.nameDate]=this.getDateTime().fromDisplayDate(t),i=e[this.nameDate]+" 00:00:00",i=a.default.tz(i,this.getConfig().get("timeZone")||"UTC").add(this.isEnd?1:0,"days").utc().format(this.getDateTime().internalDateTimeFullFormat),e[this.name]=i):(e[this.nameDate]=null,e[this.name]=null),e}validateAfter(){var e=this.model.getFieldParam(this.name,"after");if(e){var t=e+"Date",i=this.model.get(this.name)||this.model.get(this.nameDate),t=this.model.get(e)||this.model.get(t);if(i&&t)return(this.validateAfterAllowSameDay&&this.model.get(this.nameDate)?(0,a.default)(i).unix()<(0,a.default)(t).unix():(0,a.default)(i).unix()<=(0,a.default)(t).unix())?(i=this.translate("fieldShouldAfter","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(i),!0):void 0}}validateBefore(){var e=this.model.getFieldParam(this.name,"before");if(e){var t=e+"Date",i=this.model.get(this.name)||this.model.get(this.nameDate),t=this.model.get(e)||this.model.get(t);if(i&&t)return(0,a.default)(i).unix()>=(0,a.default)(t).unix()?(i=this.translate("fieldShouldBefore","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(i),!0):void 0}}validateRequired(){var e;if(this.isRequired())return null===this.model.get(this.name)&&null===this.model.get(this.nameDate)?(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}}e.default=s}),define("views/fields/currency-list",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){this.params.options=[],(this.getConfig().get("currencyList")||[]).forEach(e=>{this.params.options.push(e)})}}e.default=s}),define("views/fields/complex-expression",["exports","views/fields/text"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};let s;class a extends t.default{detailTemplate="fields/formula/detail";editTemplate="fields/formula/edit";height=50;maxLineDetailCount=80;maxLineEditCount=200;events={'click [data-action="addAttribute"]':function(){this.addAttribute()},'click [data-action="addFunction"]':function(){this.addFunction()}};setup(){super.setup(),this.height=this.options.height||this.params.height||this.height,this.maxLineDetailCount=this.options.maxLineDetailCount||this.params.maxLineDetailCount||this.maxLineDetailCount,this.maxLineEditCount=this.options.maxLineEditCount||this.params.maxLineEditCount||this.maxLineEditCount,this.targetEntityType=this.options.targetEntityType||this.params.targetEntityType||this.targetEntityType,this.containerId="editor-"+Math.floor(1e4*Math.random()+1).toString(),this.mode!==this.MODE_EDIT&&this.mode!==this.MODE_DETAIL||this.wait(this.requireAce()),this.on("remove",()=>{this.editor&&this.editor.destroy()})}requireAce(){return Espo.loader.requirePromise("lib!ace").then(e=>{s=e;let t=[Espo.loader.requirePromise("lib!ace-ext-language_tools")];return this.getThemeManager().getParam("isDark")&&t.push(Espo.loader.requirePromise("lib!ace-theme-tomorrow_night")),Promise.all(t)})}data(){let e=super.data();return e.containerId=this.containerId,e.targetEntityType=this.targetEntityType,e.hasInsert=!0,e}afterRender(){if(super.afterRender(),this.$editor=this.$el.find("#"+this.containerId),this.$editor.length&&(this.mode===this.MODE_EDIT||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST)){this.$editor.css("fontSize","14px"),this.mode===this.MODE_EDIT&&this.$editor.css("minHeight",this.height+"px");const e=this.editor=s.edit(this.containerId);e.setOptions({maxLines:this.mode===this.MODE_EDIT?this.maxLineEditCount:this.maxLineDetailCount}),this.getThemeManager().getParam("isDark")&&e.setOptions({theme:"ace/theme/tomorrow_night"}),this.isEditMode()&&(e.getSession().on("change",()=>{this.trigger("change",{ui:!0})}),e.getSession().setUseWrapMode(!0)),this.isReadMode()&&(e.setReadOnly(!0),e.renderer.$cursorLayer.element.style.display="none",e.renderer.setShowGutter(!1)),e.setShowPrintMargin(!1),e.getSession().setUseWorker(!1),e.commands.removeCommand("find"),e.setHighlightActiveLine(!1),this.isReadMode()||this.initAutocomplete()}}fetch(){let e={};return e[this.name]=this.editor.getValue(),e}getFunctionDataList(){return this.getMetadata().get(["app","complexExpression","functionList"])||[]}initAutocomplete(){let d=this.getFunctionDataList().filter(e=>e.insertText),h=this.getFormulaAttributeList();s.require("ace/ext/language_tools"),this.editor.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),this.editor.completers=[{identifierRegexps:[/[\\a-zA-Z0-9{}\[\].$'"]/],getCompletions:function(e,t,i,s,a){let o=d.filter(e=>{let t=e.name.toLowerCase();return 0===t.indexOf(s.toLowerCase())}),n=o.map(e=>({caption:e.name+"()",value:e.insertText,meta:e.returnType||null})),l=h.filter(e=>0===e.indexOf(s));var r=l.map(e=>({name:e,value:e,meta:"attribute"}));a(null,n=n.concat(r))}}]}getFormulaAttributeList(){if(!this.targetEntityType)return[];let s=this.getFieldManager().getEntityTypeAttributeList(this.targetEntityType).sort(),a=(s.unshift("id"),this.getMetadata().get(["entityDefs",this.targetEntityType,"links"])||{}),i=[];return Object.keys(a).forEach(e=>{var t=a[e].type;t&&~["hasMany","hasOne","belongsTo"].indexOf(t)&&i.push(e)}),i.sort(),i.forEach(t=>{var i=a[t].entity;if(i&&!a[t].disabled){let e=this.getFieldManager().getEntityTypeAttributeList(i).sort();e.forEach(e=>{s.push(t+"."+e)})}}),s}addAttribute(){this.createView("dialog","views/admin/formula/modals/add-attribute",{scope:this.targetEntityType,attributeList:this.getFormulaAttributeList()},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.editor.insert(e),this.clearView("dialog")})})}addFunction(){this.createView("dialog","views/admin/complex-expression/modals/add-function",{scope:this.targetEntityType,functionDataList:this.getFunctionDataList()},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.editor.insert(e),this.clearView("dialog")})})}}e.default=a}),define("views/fields/complex-created",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{detailTemplateContent=`<span data-name="{{baseName}}At" class="field">{{{atField}}}</span>
        <span class="text-muted chevron-right"></span>
        <span data-name="{{baseName}}By" class="field">{{{byField}}}</span>`;baseName="created";getAttributeList(){return[this.fieldAt,this.fieldBy]}init(){this.baseName=this.options.baseName||this.baseName,this.fieldAt=this.baseName+"At",this.fieldBy=this.baseName+"By",super.init()}setup(){super.setup(),this.createField("at"),this.createField("by")}data(){return{baseName:this.baseName,...super.data()}}createField(e){var t=this.baseName+Espo.Utils.upperCaseFirst(e),i=this.model.getFieldType(t)||"base",i=this.model.getFieldParam(t,"view")||this.getFieldManager().getViewName(i);this.createView(e+"Field",i,{name:t,model:this.model,mode:this.MODE_DETAIL,readOnly:!0,readOnlyLocked:!0,selector:'[data-name="'+t+'"]'})}fetch(){return{}}}e.default=s}),define("views/fields/colorpicker",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="varchar";detailTemplate="fields/colorpicker/detail";listTemplate="fields/colorpicker/detail";editTemplate="fields/colorpicker/edit";setup(){super.setup(),this.wait(Espo.loader.requirePromise("lib!bootstrap-colorpicker"))}afterRender(){var e;super.afterRender(),this.isEditMode()&&(e=!!this.$el.closest(".modal").length,this.$element.parent().colorpicker({format:"hex",container:e&&this.$el}),e&&this.$el.find(".colorpicker").css("position","relative").addClass("pull-right"),this.$element.on("change",()=>{""===this.$element.val()&&this.$el.find(".input-group-addon > i").css("background-color","transparent")}))}}e.default=s}),define("views/fields/barcode",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};let s,o;class a extends t.default{type="barcode";listTemplate="fields/barcode/detail";detailTemplate="fields/barcode/detail";setup(){this.validations.push("valid");let e=255;switch(this.params.codeType){case"EAN2":e=2;break;case"EAN5":e=5;break;case"EAN8":e=8;break;case"EAN13":e=13;break;case"UPC":e=12;break;case"UPCE":e=11;break;case"ITF14":e=14;break;case"pharmacode":e=6}this.params.maxLength=e,"QRcode"!==this.params.codeType?(this.isSvg=!0,this.wait(Espo.loader.requirePromise("lib!jsbarcode").then(e=>s=e))):this.wait(Espo.loader.requirePromise("lib!qrcodejs").then(e=>o=e)),super.setup(),$(window).on("resize."+this.cid,()=>{this.isRendered()&&this.controlWidth()}),this.listenTo(this.recordHelper,"panel-show",()=>this.controlWidth())}data(){const e=super.data();return e.isSvg=this.isSvg,e}onRemove(){$(window).off("resize."+this.cid)}afterRender(){if(super.afterRender(),this.isListMode()||this.isDetailMode()){const e=this.model.get(this.name);e&&("QRcode"===this.params.codeType?this.initQrcode(e):$(this.getSelector()+" .barcode").length?this.initBarcode(e):setTimeout(()=>{this.initBarcode(e),this.controlWidth()},100)),this.controlWidth()}}initQrcode(t){let i=128;192<t.length&&(i*=2),this.isListMode()&&(i=64);var s=this.$el.width();s<i&&s&&(i=s);const a=this.$el.find(".barcode");s=e=>{e={text:t,width:i,height:i,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e||o.CorrectLevel.H};new o(a.get(0),e)};try{s()}catch(e){try{a.empty(),s(o.CorrectLevel.L)}catch(e){console.error(this.name+": "+e.message)}}}initBarcode(e){try{s(this.getSelector()+" .barcode",e,{format:this.params.codeType,height:50,fontSize:14,margin:0,lastChar:this.params.lastChar})}catch(e){console.error(this.name,e)}}controlWidth(){this.$el.find(".barcode").css("max-width",this.$el.width()+"px")}validateValid(){if("QRcode"!==this.params.codeType){var e=this.model.get(this.name);if(e){let t;try{s({},e,{format:this.params.codeType,lastChar:this.params.lastChar,valid:e=>t=e})}catch(e){return!0}if(!t)return e=this.translate("barcodeInvalid","messages").replace("{field}",this.getLabelText()).replace("{type}",this.params.codeType),this.showValidationMessage(e),!0}}}}e.default=a}),define("views/fields/autoincrement",["exports","views/fields/int"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="autoincrement";validations=[];inlineEditDisabled=!0;readOnly=!0;disableFormatting=!0;parse(e){return e=null!==(e=""!==e?e:null)?-1!==e.indexOf(".")||-1!==e.indexOf(",")?NaN:parseInt(e):e}fetch(){return{}}}e.default=s}),define("views/fields/assigned-users",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),"no"===this.assignmentPermission&&(this.readOnly=!0),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission)return["onlyMyTeam"]}getSelectPrimaryFilterName(){return"active"}getDetailLinkHtml(e,t){var i=super.getDetailLinkHtml(e),e=this.isDetailMode()?this.getHelper().getAvatarHtml(e,"small",14,"avatar-link"):"";return e?e+" "+i:i}}e.default=s}),define("views/fields/assigned-user",["exports","views/fields/user-with-avatar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),"no"===this.assignmentPermission&&this.setReadOnly(!0),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission)return["onlyMyTeam"]}getSelectPrimaryFilterName(){return"active"}getEmptyAutocompleteResult(){return{list:[{id:this.getUser().id,name:this.getUser().get("name")}]}}}e.default=s}),define("views/fields/array-int",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="arrayInt";fetchFromDom(){let s=[];this.$el.find(".list-group .list-group-item").each((e,t)=>{let i=$(t).data("value");("string"==typeof i||i instanceof String)&&(i=parseInt($(t).data("value"))),s.push(i)}),this.selected=s}addValue(e){e=parseInt(e),isNaN(e)||super.addValue(e)}removeValue(e){var t;e=parseInt(e),isNaN(e)||(t=e.toString().replace(/"/g,'\\"'),this.$list.children('[data-value="'+t+'"]').remove(),t=this.selected.indexOf(e),this.selected.splice(t,1),this.trigger("change"))}}e.default=s}),define("views/fields/address",["exports","views/fields/base","views/fields/varchar"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="address";listTemplate="fields/address/detail";detailTemplate="fields/address/detail";editTemplate="fields/address/edit";editTemplate1="fields/address/edit-1";editTemplate2="fields/address/edit-2";editTemplate3="fields/address/edit-3";editTemplate4="fields/address/edit-4";searchTemplate="fields/address/search";postalCodeField;streetField;cityField;stateField;countryField;validations=["required","pattern"];events={'click [data-action="viewMap"]':function(e){e.preventDefault(),e.stopPropagation(),this.viewMapAction()}};data(){let t=super.data();return t.ucName=Espo.Utils.upperCaseFirst(this.name),this.addressPartList.forEach(e=>{t[e+"Value"]=this.model.get(this[e+"Field"])}),this.mode!==this.MODE_DETAIL&&this.mode!==this.MODE_LIST||(t.formattedAddress=this.getFormattedAddress(),t.isNone=null===t.formattedAddress,-1===t.formattedAddress&&(t.formattedAddress=null,t.isLoading=!0),this.params.viewMap&&this.canBeDisplayedOnMap()&&(t.viewMap=!0,t.viewMapLink="#AddressMap/view/"+this.model.entityType+"/"+this.model.id+"/"+this.name)),this.isEditMode()&&(t.stateMaxLength=this.stateMaxLength,t.streetMaxLength=this.streetMaxLength,t.postalCodeMaxLength=this.postalCodeMaxLength,t.cityMaxLength=this.cityMaxLength,t.countryMaxLength=this.countryMaxLength),t}setupSearch(){this.searchData.value=this.getSearchParamsData().value||this.searchParams.additionalValue}canBeDisplayedOnMap(){return!!this.model.get(this.name+"City")||!!this.model.get(this.name+"PostalCode")}getFormattedAddress(){let t=!1,i=!1;if(this.addressAttributeList.forEach(e=>{t=t||this.model.get(e),i=i||this.model.has(e)}),!t)return this.mode===this.MODE_LIST?"":i?null:-1;var e="getFormattedAddress"+this.getAddressFormat().toString();return e in this?this[e]():void 0}getFormattedAddress1(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let o="";return t&&(o+=t),(i||s||e)&&(""!==o&&(o+="\n"),i&&(o+=i),s&&(i&&(o+=", "),o+=s),e&&((i||s)&&(o+=" "),o+=e)),a&&(""!==o&&(o+="\n"),o+=a),o}getFormattedAddress2(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let o="";return t&&(o+=t),(i||e)&&(""!==o&&(o+="\n"),e&&(o+=e,i&&(o+=" ")),i&&(o+=i)),(s||a)&&(""!==o&&(o+="\n"),s&&(o+=s,a&&(o+=" ")),a&&(o+=a)),o}getFormattedAddress3(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let o="";return a&&(o+=a),(i||s||e)&&(""!==o&&(o+="\n"),e&&(o+=e),s&&(e&&(o+=" "),o+=s),i&&((e||s)&&(o+=" "),o+=i)),t&&(""!==o&&(o+="\n"),o+=t),o}getFormattedAddress4(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let o="";return t&&(o+=t),i&&(""!==o&&(o+="\n"),o+=i),(a||s||e)&&(""!==o&&(o+="\n"),a&&(o+=a),s&&(a&&(o+=" - "),o+=s),e&&((a||s)&&(o+=" "),o+=e)),o}_getTemplateName(){if(this.mode===this.MODE_EDIT){var e="editTemplate"+this.getAddressFormat().toString();if(e in this)return this[e]}return super._getTemplateName()}getAddressFormat(){return this.getConfig().get("addressFormat")||1}afterRender(){var e;this.mode===this.MODE_EDIT&&(this.$street=this.$el.find('[data-name="'+this.streetField+'"]'),this.$postalCode=this.$el.find('[data-name="'+this.postalCodeField+'"]'),this.$state=this.$el.find('[data-name="'+this.stateField+'"]'),this.$city=this.$el.find('[data-name="'+this.cityField+'"]'),this.$country=this.$el.find('[data-name="'+this.countryField+'"]'),this.$street.on("change",()=>{this.trigger("change")}),this.$postalCode.on("change",()=>{this.trigger("change")}),this.$state.on("change",()=>{this.trigger("change")}),this.$city.on("change",()=>{this.trigger("change")}),this.$country.on("change",()=>{this.trigger("change")}),(e=this.getConfig().get("addressCountryList")||[]).length&&(this.$country.autocomplete({minChars:0,lookup:e,maxHeight:200,formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:(e,t,i)=>0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length,onSelect:()=>{this.trigger("change"),this.$country.focus()}}),this.$country.on("focus",()=>{this.$country.val()||this.$country.autocomplete("onValueChange")}),this.once("render",()=>{this.$country.autocomplete("dispose")}),this.once("remove",()=>{this.$country.autocomplete("dispose")}),this.$country.attr("autocomplete","espo-country")),(e=this.getConfig().get("addressCityList")||[]).length&&(this.$city.autocomplete({minChars:0,lookup:e,maxHeight:200,formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:(e,t,i)=>0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length,onSelect:()=>{this.trigger("change"),this.$city.focus()}}),this.$city.on("focus",()=>{this.$city.val()||this.$city.autocomplete("onValueChange")}),this.once("render",()=>{this.$city.autocomplete("dispose")}),this.once("remove",()=>{this.$city.autocomplete("dispose")}),this.$city.attr("autocomplete","espo-city")),(e=this.getConfig().get("addressStateList")||[]).length&&(this.$state.autocomplete({minChars:0,lookup:e,maxHeight:200,formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:function(e,t,i){return 0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length},onSelect:()=>{this.trigger("change"),this.$state.focus()}}),this.$state.on("focus",()=>{this.$state.val()||this.$state.autocomplete("onValueChange")}),this.once("render",()=>{this.$state.autocomplete("dispose")}),this.once("remove",()=>{this.$state.autocomplete("dispose")}),this.$state.attr("autocomplete","espo-state")),this.controlStreetTextareaHeight(),this.$street.on("input",()=>{this.controlStreetTextareaHeight()}))}controlStreetTextareaHeight(e){var t=this.$street.prop("scrollHeight"),i=this.$street.prop("clientHeight");void 0!==e||0!==i?i!==e&&(i+1<t&&(e=this.$street.prop("rows"),this.$street.attr("rows",e+1),this.controlStreetTextareaHeight(i)),0===this.$street.val().length&&this.$street.attr("rows",1)):setTimeout(this.controlStreetTextareaHeight.bind(this),10)}setup(){super.setup();let e=this.getMetadata().get(["fields",this.type,"actualFields"])||[];this.addressAttributeList=[],this.addressPartList=[],e.forEach(e=>{var t=this.name+Espo.Utils.upperCaseFirst(e);this.addressAttributeList.push(t),this.addressPartList.push(e),this[e+"Field"]=t,this[e+"MaxLength"]=this.getMetadata().get(["entityDefs",this.entityType,"fields",t,"maxLength"])})}validateRequired(){var e=e=>{var t;if(this.model.isRequired(e)&&""===this.model.get(e))return t=this.translate("fieldIsRequired","messages").replace("{field}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};let t=!1;return t=e(this.postalCodeField)||t,t=e(this.streetField)||t,t=e(this.stateField)||t,t=e(this.cityField)||t,t=e(this.countryField)||t}isRequired(){return this.model.getFieldParam(this.postalCodeField,"required")||this.model.getFieldParam(this.streetField,"required")||this.model.getFieldParam(this.stateField,"required")||this.model.getFieldParam(this.cityField,"required")||this.model.getFieldParam(this.countryField,"required")}validatePattern(){var e;let t=!1;for(e of[this.postalCodeField,this.stateField,this.cityField,this.countryField])t=i.default.prototype.fieldValidatePattern.call(this,e)||t;return t}fetch(){let t={},e=(t[this.postalCodeField]=this.$postalCode.val().toString().trim(),t[this.streetField]=this.$street.val().toString().trim(),t[this.stateField]=this.$state.val().toString().trim(),t[this.cityField]=this.$city.val().toString().trim(),t[this.countryField]=this.$country.val().toString().trim(),[this.postalCodeField,this.streetField,this.stateField,this.cityField,this.countryField]);return e.forEach(e=>{""===t[e]&&(t[e]=null)}),t}fetchSearch(){var e=this.$el.find("input.main-element").val().toString().trim();return e?{type:"or",value:[{type:"like",field:this.postalCodeField,value:e+"%"},{type:"like",field:this.streetField,value:e+"%"},{type:"like",field:this.cityField,value:e+"%"},{type:"like",field:this.stateField,value:e+"%"},{type:"like",field:this.countryField,value:e+"%"}],data:{value:e}}:null}viewMapAction(){this.createView("mapDialog","views/modals/view-map",{model:this.model,field:this.name},e=>e.render())}}e.default=a}),define("views/fields/address-state",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){var e=this.getConfig().get("addressStateList")||[];e.length&&(this.params.options=Espo.Utils.clone(e))}}e.default=s}),define("views/fields/address-country",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){var e=this.getConfig().get("addressCountryList")||[];e.length&&(this.params.options=Espo.Utils.clone(e))}}e.default=s}),define("views/fields/address-city",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){var e=this.getConfig().get("addressCityList")||[];e.length&&(this.params.options=Espo.Utils.clone(e))}}e.default=s}),define("views/dashlets/stream",["exports","views/dashlets/abstract/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Stream";templateContent='<div class="list-container">{{{list}}}</div>';actionRefresh(){this.getRecordView()&&this.getRecordView().showNewRecords()}afterRender(){this.getCollectionFactory().create("Note",e=>{(this.collection=e).url="Stream",e.maxSize=this.getOption("displayRecords"),this.getOption("skipOwn")&&(e.data.skipOwn=!0),e.fetch().then(()=>{this.createView("list","views/stream/record/list",{selector:"> .list-container",collection:e,isUserStream:!0,noEdit:!1},e=>{e.render()})})})}getRecordView(){return this.getView("list")}setupActionList(){this.actionList.unshift({name:"viewList",text:this.translate("View"),iconHtml:'<span class="fas fa-align-justify"></span>',url:"#Stream"}),this.getUser().isPortal()||this.actionList.unshift({name:"create",text:this.translate("Create Post","labels"),iconHtml:'<span class="fas fa-plus"></span>'})}actionCreate(){this.createView("dialog","views/stream/modals/create-post",{},e=>{e.render(),this.listenToOnce(e,"after:save",()=>{e.close(),this.actionRefresh()})})}actionViewList(){this.getRouter().navigate("#Stream",{trigger:!0})}}e.default=s}),define("views/dashlets/records",["exports","views/dashlets/abstract/record-list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Records";rowActionsView="views/record/row-actions/view-and-edit";listView="views/email/record/list-expanded";init(){super.init(),this.scope=this.getOption("entityType")}getSearchData(){const e={primary:this.getOption("primaryFilter")},t=("all"===e.primary&&delete e.primary,{});return(this.getOption("boolFilterList")||[]).forEach(e=>{t[e]=!0}),e.bool=t,e}setupActionList(){var e=this.getOption("entityType");e&&this.getAcl().checkScope(e,"create")&&this.actionList.unshift({name:"create",text:this.translate("Create "+e,"labels",e),iconHtml:'<span class="fas fa-plus"></span>',url:"#"+e+"/create"})}}e.default=s}),define("views/dashlets/memo",["exports","views/dashlets/abstract/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Memo";templateContent=`
        {{#if text}}
        <div class="complex-text complex-text-memo">{{complexText text}}</div>
        {{/if}}
    `;data(){return{text:this.getOption("text")}}afterAdding(){this.getContainerView().actionOptions()}}e.default=s}),define("views/dashlets/iframe",["exports","views/dashlets/abstract/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Iframe";templateContent='<iframe style="margin: 0; border: 0;"></iframe>';afterRender(){const e=this.$el.find("iframe");var t=this.getOption("url"),t=(t&&e.attr("src",t),this.$el.addClass("no-padding"),this.$el.css("overflow","hidden"),this.$el.height());e.css("height",t),e.css("width","100%")}afterAdding(){this.getContainerView().actionOptions()}}e.default=s}),define("views/dashlets/emails",["exports","views/dashlets/abstract/record-list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Emails";scope="Emails";rowActionsView="views/email/record/row-actions/dashlet";listView="views/email/record/list-expanded";setupActionList(){this.getAcl().checkScope(this.scope,"create")&&this.actionList.unshift({name:"compose",text:this.translate("Compose Email","labels",this.scope),iconHtml:'<span class="fas fa-plus"></span>'})}actionCompose(){var e=this.getCreateAttributes()||{},t=(Espo.Ui.notify(" ... "),this.getMetadata().get("clientDefs."+this.scope+".modalViews.compose")||"views/modals/compose-email");this.createView("modal",t,{scope:this.scope,attributes:e},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"after:save",()=>{this.actionRefresh()})})}getSearchData(){return{advanced:[{attribute:"folderId",type:"inFolder",value:this.getOption("folder")||"inbox"}]}}}e.default=s}),define("views/dashlets/options/base",["exports","views/modal","model","views/record/edit-for-modal"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class o extends t.default{template="dashlets/options/base";cssName="options-modal";className="dialog dialog-record";name="";escapeDisabled=!0;saveDisabled=!1;buttonList=[{name:"save",label:"Apply",style:"primary",title:"Ctrl+Enter"},{name:"cancel",label:"Cancel",title:"Esc"}];shortcutKeys={"Control+Enter":"save",Escape:function(t){if(!this.saveDisabled){t.stopPropagation(),t.preventDefault();let e=this.getRecordView().getFocusedFieldView();e&&this.model.set(e.fetch(),{skipReRender:!0}),this.getRecordView().isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionClose()):this.actionClose()}}};data(){return{options:this.optionsData}}getDetailLayout(){let e=this.getMetadata().get(["dashlets",this.name,"options","layout"]);if(e)return e;e=[{rows:[]}];let t=0,i=[];for(var s in this.fields)t%2||(i=[],e[0].rows.push(i)),i.push({name:s}),t++;return e}init(){super.init(),this.fields=Espo.Utils.cloneDeep(this.options.fields),this.fieldList=Object.keys(this.fields),this.optionsData=this.options.optionsData,this.name=this.options.name}setup(){this.id="dashlet-options";let e=this.model=new i.default;e.name="DashletOptions",e.setDefs({fields:this.fields}),e.set(this.optionsData),this.dataObject={dashletName:this.name,userId:this.options.userId},e.dashletName=this.name,e.userId=this.options.userId,this.middlePanelDefs={},this.middlePanelDefsList=[],this.setupBeforeFinal(),this.recordView=new s.default({model:e,detailLayout:this.getDetailLayout(),dataObject:this.dataObject}),this.assignView("record",this.recordView,".record"),this.$header=$("<span>").append($("<span>").text(this.getLanguage().translate("Dashlet Options"))," &middot; ",$("<span>").text(this.getLanguage().translate(this.name,"dashlets")))}setupBeforeFinal(){}onBackdropClick(){this.getRecordView().isChanged||this.close()}getRecordView(){return this.recordView}fetchAttributes(){var e=this.getRecordView().fetch();return this.getRecordView().validate()?null:e}actionSave(){var e=this.fetchAttributes();null!=e&&this.trigger("save",e)}getFieldViews(e){return this.hasView("record")?this.getRecordView().getFieldViews(e):{}}getFieldView(e){return(this.getFieldViews(!0)||{})[e]||null}hideField(e,t){this.getRecordView()?this.getRecordView().hideField(e,t):this.whenRendered().then(()=>this.hideField(e),t)}showField(e){this.getRecordView()?this.getRecordView().showField(e):this.whenRendered().then(()=>this.showField(e))}}e.default=o}),define("views/dashlets/fields/records/sort-direction",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})}})}),define("views/dashlets/fields/records/sort-by",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})},setupOptions:function(){var t,i,e=this.model.get("entityType"),s=e;e?(t=this.getMetadata().get("entityDefs."+s+".fields")||{},e=Object.keys(t).filter(e=>!t[e].notStorable).sort((e,t)=>this.translate(e,"fields",s).localeCompare(this.translate(t,"fields",s))),i={},e.forEach(e=>{i[e]=this.translate(e,"fields",s)}),this.params.options=e,this.translatedOptions=i):this.params.options=[]}})}),define("views/dashlets/fields/records/primary-filter",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})},setupOptions:function(){var e,t=this.model.get("entityType");t?(e=this.getMetadata().get(["clientDefs",t,"filterList"])||[],this.params.options=[],e.forEach(e=>{if("object"==typeof e&&e.name)return!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser(),null,!0))&&void this.params.options.push(e.name);this.params.options.push(e)}),this.params.options.unshift("all"),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"presetFilters",t)})):this.params.options=[]}})}),define("views/dashlets/fields/records/expanded-layout",["exports","views/fields/base","ui/multi-select"],function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),o=i(o);class s extends t.default{listTemplate="dashlets/fields/records/expanded-layout/edit";detailTemplate="dashlets/fields/records/expanded-layout/edit";editTemplate="dashlets/fields/records/expanded-layout/edit";delimiter=":,:";getRowHtml(e,t){let i=[];return(e=e||[]).forEach(e=>{i.push(e.name)}),$("<div>").append($("<input>").attr("type","text").addClass("row-"+t.toString()).attr("value",i.join(this.delimiter))).get(0).outerHTML}afterRender(){this.$container=this.$el.find(">.layout-container");let e=(this.model.get(this.name)||{}).rows||[],a=((e=Espo.Utils.cloneDeep(e)).push([]),this.getFieldDataList());e.forEach((e,t)=>{e=this.getRowHtml(e,t);let i=$(e),s=(this.$container.append(i),i.find("input"));t={items:a,delimiter:this.delimiter,matchAnyWord:this.matchAnyWord,draggable:!0};o.default.init(s,t),s.on("change",()=>{this.trigger("change"),this.reRender()})})}getFieldDataList(){const i=this.model.get("entityType")||this.getMetadata().get(["dashlets",this.dataObject.dashletName,"entityType"]);if(!i)return[];let t=this.getMetadata().get(["entityDefs",i,"fields"])||{},s=this.getAcl().getScopeForbiddenFieldList(i),e=Object.keys(t).sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))).filter(e=>!(t[e].disabled||t[e].listLayoutDisabled||t[e].utility)&&(!(t[e].layoutAvailabilityList&&!t[e].layoutAvailabilityList.includes("list"))&&-1===s.indexOf(e))),a=[];return e.forEach(e=>{a.push({value:e,text:this.translate(e,"fields",i)})}),a}fetch(){var a={rows:[]};this.$el.find("input").each((e,t)=>{let i=[],s=($(t).val()||"").split(this.delimiter);0!==(s=1===s.length&&""===s[0]?[]:s).length&&(s.forEach(e=>{let t={name:e};"name"===e&&(t.link=!0),i.push(t)}),a.rows.push(i))});let e={};return e[this.name]=a,e}}e.default=s}),define("views/dashlets/fields/records/entity-type",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.on("change",()=>{var e,t={primaryFilter:null,boolFilterList:[],title:this.translate("Records","dashlets"),sortBy:null,sortDirection:"asc",expandedLayout:{rows:[]}},i=this.model.get("entityType");i&&(t.title=this.translate(i,"scopeNamesPlural"),t.sortBy=this.getMetadata().get(["entityDefs",i,"collection","orderBy"]),e=this.getMetadata().get(["entityDefs",i,"collection","order"]),t.sortDirection=e||"asc",t.expandedLayout={rows:[[{name:"name",link:!0,scope:i}]]}),this.model.set(t)})},setupOptions:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled")&&this.getAcl().checkScope(e,"read")&&this.getMetadata().get(["scopes",e,"entity"])&&this.getMetadata().get(["scopes",e,"object"]))return!0}).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames"))),this.params.options.unshift("")}})}),define("views/dashlets/fields/records/bool-filter-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})},setupOptions:function(){var e,t=this.model.get("entityType");t?(e=this.getMetadata().get(["clientDefs",t,"boolFilterList"])||[],this.params.options=[],e.forEach(e=>{if("object"==typeof e&&e.name)return!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser(),null,!0))&&void this.params.options.push(e.name);this.params.options.push(e)}),this.getMetadata().get(["scopes",t,"stream"])&&this.getAcl().checkScope(t,"stream")&&this.params.options.push("followed"),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"boolFilters",t)})):this.params.options=[]}})}),define("views/dashlets/fields/emails/folder",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{folderDataList;setup(){super.setup();var e=this.dataObject.userId??this.getUser().id;this.wait(Espo.Ajax.getRequest("EmailFolder/action/listAll",{userId:e}).then(e=>this.folderDataList=e.list).then(()=>this.setupOptions())),this.setupOptions()}setupOptions(){this.folderDataList&&(this.params.options=this.folderDataList.map(e=>e.id).filter(e=>"inbox"!==e&&"trash"!==e),this.params.options.unshift(""),this.translatedOptions={"":this.translate("inbox","presetFilters","Email")},this.folderDataList.forEach(e=>{this.translatedOptions[e.id]=e.name}))}}e.default=s}),define("controllers/user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getCollection(e){return super.getCollection().then(e=>(e.data.userType="internal",e))}createViewView(e,t,i){t.get("deleted")?super.createViewView(e,t,i="views/deleted-detail"):t.isPortal()?this.getRouter().dispatch("PortalUser","view",{id:t.id,model:t}):t.isApi()?this.getRouter().dispatch("ApiUser","view",{id:t.id,model:t}):super.createViewView(e,t,i)}}e.default=s}),define("controllers/team",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return"read"===e||!!this.getUser().isAdmin()}}e.default=s}),define("controllers/stream",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.main("views/stream",{displayTitle:!0},e=>{e.render()})}actionPosts(){this.main("views/stream",{displayTitle:!0,filter:"posts"},e=>{e.render()})}actionUpdates(){this.main("views/stream",{displayTitle:!0,filter:"updates"},e=>{e.render()})}}e.default=s}),define("controllers/record-tree",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="listTree";beforeView(e){super.beforeView(e),(e=e||{}).model&&(e.model.unset("childCollection"),e.model.unset("childList"))}beforeListTree(){this.handleCheckAccess("read")}actionListTree(){this.getCollection().then(e=>{e.url=e.entityType+"/action/listTree",this.main(this.getViewName("listTree"),{scope:this.name,collection:e})})}}e.default=s}),define("controllers/preferences",["exports","controllers/record","models/preferences"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{defaultAction="own";getModel(e,t){const i=new s.default;return i.settings=this.getConfig(),i.defs=this.getMetadata().get("entityDefs.Preferences"),e&&e.call(this,i),new Promise(e=>{e(i)})}checkAccess(e){return!0}actionOwn(){this.actionEdit({id:this.getUser().id})}actionList(){}}e.default=a}),define("controllers/portal-user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="User";getCollection(e){return super.getCollection().then(e=>(e.data.userType="portal",e))}createViewView(e,t,i){if(!t.isPortal())return t.isApi()?void this.getRouter().dispatch("ApiUser","view",{id:t.id,model:t}):void this.getRouter().dispatch("User","view",{id:t.id,model:t});super.createViewView(e,t,i)}actionCreate(e){(e=e||{}).attributes=e.attributes||{},e.attributes.type="portal",super.actionCreate(e)}checkAccess(e){return"yes"===this.getAcl().getPermissionLevel("portalPermission")}}e.default=s}),define("controllers/password-change-request",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionPasswordChange(e){if(!(e=e||{}).id)throw new Error;this.entire("views/user/password-change-request",{requestId:e.id,strengthParams:e.strengthParams,notFound:e.notFound},e=>{e.render()})}}e.default=s}),define("controllers/notification",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.main("views/notification/list",{},e=>{e.render()})}}e.default=s}),define("controllers/note",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionView(e){const t=e.id;if(!t)throw new Espo.Exceptions.NotFound;const i=this.getMetadata().get(["clientDefs",this.name,"views","detail"])||"views/note/detail";let s;this.showLoadingNotification(),this.modelFactory.create("Note").then(e=>((s=e).id=t,s.fetch({main:!0}))).then(()=>{this.hideLoadingNotification(),this.main(i,{model:s})})}}e.default=s}),define("controllers/login-as",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionLogin(e){var t=e.anotherUser,e=e.username;if(!t)throw new Error("No anotherUser.");this.baseController.login({anotherUser:t,username:e}),this.listenToOnce(this.baseController,"login",()=>{this.baseController.once("router-set",()=>{var e=window.location.href.split("?")[0];window.location.replace(e)})})}}e.default=s}),define("controllers/lead-capture-opt-in-confirmation",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionOptInConfirmationSuccess(e){var t=this.getMetadata().get(["clientDefs","LeadCapture","optInConfirmationSuccessView"])||"views/lead-capture/opt-in-confirmation-success";this.entire(t,{resultData:e},e=>{e.render()})}actionOptInConfirmationExpired(e){var t=this.getMetadata().get(["clientDefs","LeadCapture","optInConfirmationExpiredView"])||"views/lead-capture/opt-in-confirmation-expired";this.entire(t,{resultData:e},e=>{e.render()})}}e.default=s}),define("controllers/last-viewed",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="ActionHistoryRecord";checkAccess(e){return this.getAcl().check(this.entityType,e)}}e.default=s}),define("controllers/import",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";storedData;checkAccessGlobal(){return!!this.getAcl().checkScope("Import")}checkAccess(e){return!!this.getAcl().checkScope("Import")}actionIndex(e){let t=null,i=((e=e||{}).step&&(t=parseInt(t)),null),s=null;e.formData&&(this.storedData=void 0),this.storedData&&(i=this.storedData.formData,s=this.storedData.fileContents),i||(t=null),i=i||e.formData,this.main("views/import/index",{step:t,formData:i,fileContents:s,fromAdmin:e.fromAdmin},e=>{this.listenTo(e,"change",()=>{this.storedData={formData:e.formData,fileContents:e.fileContents}}),this.listenTo(e,"done",()=>{this.storedData=void 0}),e.render()})}}e.default=s}),define("controllers/home",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionIndex(){this.main("views/home",null)}}e.default=s}),define("controllers/external-account",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="list";actionList(){this.collectionFactory.create("ExternalAccount",e=>{e.once("sync",()=>{this.main("ExternalAccount.Index",{collection:e})}),e.fetch()})}actionEdit(e){const t=e.id;this.collectionFactory.create("ExternalAccount",e=>{e.once("sync",()=>{this.main("ExternalAccount.Index",{collection:e,id:t})}),e.fetch()})}}e.default=s}),define("controllers/email",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{prepareModelView(e,t){super.prepareModelView(e,t),this.listenToOnce(e,"after:send",()=>{var e=this.name+"List";this.getStoredMainView(e)&&this.clearStoredMainView(e)})}}e.default=s}),define("controllers/dashboard",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.main("views/dashboard",{displayTitle:!0},e=>{e.render()})}}e.default=s}),define("controllers/address-map",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.error404()}actionView(i){this.modelFactory.create(i.entityType).then(t=>{t.id=i.id,t.fetch().then(()=>{var e=this.getMetadata().get(["AddressMap","view"])||"views/address-map/view";this.main(e,{model:t,field:i.field})})})}}e.default=s}),define("controllers/about",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="about";actionAbout(){this.main("About",{},e=>{e.render()})}}e.default=s}),define("collections/tree",["exports","collection"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{createSeed(){const e=new this.constructor;return e.url=this.url,e.model=this.model,e.name=this.name,e.entityType=this.entityType,e.defs=this.defs,e}prepareAttributes(e,t){t=super.prepareAttributes(e,t);const i=this.clone(),s=(i.reset(),this.path=e.path,this.categoryData=e.data||null,(e,i)=>{e.forEach(e=>{e.depth=i;const t=this.createSeed();if(e.childList)return e.childList.length&&(s(e.childList,i+1),t.set(e.childList)),void(e.childCollection=t);null!==e.childList?e.childCollection=t:e.childCollection=null})});return s(t,0),t}fetch(e){return(e=e||{}).data=e.data||{},this.parentId&&(e.data.parentId=this.parentId),e.data.maxDepth=this.maxDepth,super.fetch(e)}}e.default=s}),define("collections/note",["exports","collection"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{prepareAttributes(e,t){var i=this.total,s=super.prepareAttributes(e,t);return t.data&&t.data.after&&(0<=i&&0<=e.total?this.total=i+e.total:this.total=i),s}fetchNew(e){return(e=e||{}).data=e.data||{},e.fetchNew=!0,e.noRebuild=!0,e.lengthBeforeFetch=this.length,this.length&&(e.data.after=this.models[0].get("createdAt"),e.remove=!1,e.at=0,e.maxSize=null),this.fetch(e)}}e.default=s}),define("acl/user",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkModelRead(e,t,i){return!(!e.isPortal()||"yes"!==this.get("portalPermission"))||this.checkModel(e,t,"read",i)}checkIsOwner(e){return this.getUser().id===e.id}}e.default=s}),define("acl/team",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkInTeam(e){const t=this.getUser().getTeamIdList();return-1!==t.indexOf(e.id)}}e.default=s}),define("acl/preferences",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return this.getUser().id===e.id}}e.default=s}),define("acl/notification",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return this.getUser().id===e.get("userId")}}e.default=s}),define("acl/import",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkScope(e,t,i,s){return!!e}checkModelRead(e,t,i){return!0}checkIsOwner(e){return this.getUser().id===e.get("createdById")}checkModelDelete(e,t,i){return!0}}e.default=s}),define("acl/foreign",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return!0}checkInTeam(e){return!0}}e.default=s}),define("acl/email",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkModelRead(e,t,i){var s=this.checkModel(e,t,"read",i);if(s)return!0;if(!1===t)return!1;if("no"===(t||{}).read)return!1;if(e.has("usersIds")){if(~(e.get("usersIds")||[]).indexOf(this.getUser().id))return!0}else if(i)return null;return s}checkIsOwner(e){return this.getUser().id===e.get("assignedUserId")||this.getUser().id===e.get("createdById")||(e.has("assignedUsersIds")?!!~(e.get("assignedUsersIds")||[]).indexOf(this.getUser().id):null)}checkModelEdit(e,t,i){return"Draft"===e.get("status")&&e.get("createdById")===this.getUser().id||this.checkModel(e,t,"edit",i)}checkModelDelete(e,t,i){i=this.checkModel(e,t,"delete",i);return!!i||!1!==t&&("no"!==(t||{}).read&&(e.get("createdById")===this.getUser().id&&"Sent"!==e.get("status")&&"Archived"!==e.get("status")||i))}}e.default=s}),Espo.loader.mapBundleFile("admin","client/lib/espo-admin.js"),Espo.loader.mapBundleFile("crm","client/lib/espo-crm.js"),Espo.loader.mapBundleDependencies("chart",["flotr2","espo-funnel-chart"]),Espo.loader.mapBundleFile("chart","client/lib/espo-chart.js"),Espo.loader.mapBundleDependencies("calendar",["fullcalendar"]),Espo.loader.mapBundleFile("calendar","client/lib/espo-calendar.js"),Espo.loader.mapBundleDependencies("timeline",["vis-data","vis-timeline"]),Espo.loader.mapBundleFile("timeline","client/lib/espo-timeline.js"),Espo.loader.mapBundleFile("extra","client/lib/espo-extra.js"),Espo.loader.addBundleMapping({"views/admin/layouts/base":"admin","views/admin/layouts/rows":"admin","views/admin/layouts/side-panels-detail":"admin","views/admin/dynamic-logic/conditions-string/item-base":"admin","views/admin/layouts/grid":"admin","views/admin/layouts/default-page":"admin","views/admin/layouts/bottom-panels-detail":"admin","views/admin/layouts/modals/create":"admin","views/admin/dynamic-logic/conditions-string/item-operator-only-base":"admin","views/admin/dynamic-logic/conditions/field-types/base":"admin","views/outbound-email/fields/test-send":"admin","views/role/record/table":"admin","views/role/record/list":"admin","views/role/record/edit":"admin","views/role/record/detail":"admin","views/inbound-email/record/detail":"admin","views/admin/index":"admin","views/admin/link-manager/index":"admin","views/admin/layouts/list":"admin","views/admin/layouts/index":"admin","views/admin/layouts/detail":"admin","views/admin/layouts/bottom-panels-edit":"admin","views/admin/integrations/edit":"admin","views/admin/field-manager/fields/options":"admin","views/admin/entity-manager/record/edit-formula":"admin","views/admin/entity-manager/modals/export":"admin","views/admin/dynamic-logic/conditions-string/item-operator-only-date":"admin","views/admin/dynamic-logic/conditions-string/group-base":"admin","views/admin/dynamic-logic/conditions/group-base":"admin","views/admin/dynamic-logic/conditions/field-types/link-multiple":"admin","views/email-account/fields/test-send":"admin","views/email-account/fields/test-connection":"admin","views/email-account/fields/folders":"admin","views/email-account/fields/folder":"admin","helpers/misc/authentication-provider":"admin","views/settings/record/edit":"admin","views/settings/edit":"admin","views/templates/event/record/detail":"admin","views/scheduled-job/list":"admin","views/scheduled-job/record/list":"admin","views/scheduled-job/record/detail":"admin","views/scheduled-job/record/panels/log":"admin","views/scheduled-job/fields/scheduling":"admin","views/scheduled-job/fields/job":"admin","views/role/list":"admin","views/role/record/detail-side":"admin","views/role/record/panels/side":"admin","views/role/modals/add-field":"admin","views/portal-role/list":"admin","views/portal-role/record/table":"admin","views/portal-role/record/list":"admin","views/portal-role/record/edit":"admin","views/portal-role/record/detail":"admin","views/lead-capture-log-record/modals/detail":"admin","views/lead-capture/opt-in-confirmation-success":"admin","views/lead-capture/opt-in-confirmation-expired":"admin","views/lead-capture/record/list":"admin","views/lead-capture/record/detail":"admin","views/lead-capture/record/panels/request":"admin","views/lead-capture/fields/smtp-account":"crm","views/lead-capture/fields/phone-number-country":"admin","views/lead-capture/fields/field-list":"admin","views/lead-capture/fields/api-key":"admin","views/layout-set/layouts":"admin","views/layout-set/record/list":"admin","views/layout-set/fields/layout-list":"admin","views/layout-set/fields/edit":"admin","views/inbound-email/record/list":"admin","views/inbound-email/record/edit":"admin","views/inbound-email/fields/test-send":"admin","views/inbound-email/fields/test-connection":"admin","views/inbound-email/fields/target-user-position":"admin","views/inbound-email/fields/folders":"admin","views/inbound-email/fields/folder":"admin","views/inbound-email/fields/email-address":"admin","views/authentication-provider/record/edit":"admin","views/authentication-provider/record/detail":"admin","views/authentication-provider/fields/method":"admin","views/admin/user-interface":"admin","views/admin/sms":"admin","views/admin/settings":"admin","views/admin/outbound-emails":"admin","views/admin/notifications":"admin","views/admin/jobs-settings":"admin","views/admin/inbound-emails":"admin","views/admin/currency":"admin","views/admin/authentication":"admin","views/admin/upgrade/ready":"admin","views/admin/upgrade/index":"admin","views/admin/upgrade/done":"admin","views/admin/template-manager/index":"admin","views/admin/template-manager/edit":"admin","views/admin/system-requirements/index":"admin","views/admin/panels/notifications":"admin","views/admin/link-manager/modals/edit":"admin","views/admin/link-manager/fields/foreign-link-entity-type-list":"admin","views/admin/layouts/side-panels-edit":"admin","views/admin/layouts/side-panels-edit-small":"admin","views/admin/layouts/side-panels-detail-small":"admin","views/admin/layouts/relationships":"admin","views/admin/layouts/mass-update":"admin","views/admin/layouts/list-small":"admin","views/admin/layouts/kanban":"admin","views/admin/layouts/filters":"admin","views/admin/layouts/detail-small":"admin","views/admin/layouts/detail-convert":"admin","views/admin/layouts/default-side-panel":"admin","views/admin/layouts/bottom-panels-edit-small":"admin","views/admin/layouts/record/edit-attributes":"admin","views/admin/layouts/modals/panel-attributes":"admin","views/admin/layouts/modals/edit-attributes":"admin","views/admin/layouts/fields/width-complex":"admin","views/admin/label-manager/index":"admin","views/admin/label-manager/edit":"admin","views/admin/label-manager/category":"admin","views/admin/job/list":"admin","views/admin/job/record/list":"admin","views/admin/job/record/detail-small":"admin","views/admin/job/modals/detail":"admin","views/admin/job/fields/name":"admin","views/admin/integrations/oauth2":"admin","views/admin/integrations/index":"admin","views/admin/integrations/google-maps":"admin","views/admin/formula-sandbox/index":"admin","views/admin/formula-sandbox/record/edit":"admin","views/admin/formula/modals/add-function":"admin","views/admin/formula/modals/add-attribute":"admin","views/admin/formula/fields/attribute":"admin","views/admin/field-manager/list":"admin","views/admin/field-manager/index":"admin","views/admin/field-manager/header":"admin","views/admin/field-manager/edit":"admin","views/admin/field-manager/modals/add-field":"admin","views/admin/field-manager/fields/source-list":"admin","views/admin/field-manager/fields/pattern":"admin","views/admin/field-manager/fields/options-with-style":"admin","views/admin/field-manager/fields/options-reference":"admin","views/admin/field-manager/fields/not-actual-options":"admin","views/admin/field-manager/fields/entity-list":"admin","views/admin/field-manager/fields/dynamic-logic-options":"admin","views/admin/field-manager/fields/dynamic-logic-conditions":"admin","views/admin/field-manager/fields/currency-default":"admin","views/admin/field-manager/fields/phone/default":"admin","views/admin/field-manager/fields/options/default":"admin","views/admin/field-manager/fields/options/default-multi":"admin","views/admin/field-manager/fields/link-multiple/default":"admin","views/admin/field-manager/fields/link/default":"admin","views/admin/field-manager/fields/foreign/link":"admin","views/admin/field-manager/fields/foreign/field":"admin","views/admin/field-manager/fields/date/default":"admin","views/admin/field-manager/fields/date/after-before":"admin","views/admin/extensions/ready":"admin","views/admin/extensions/index":"admin","views/admin/extensions/done":"admin","views/admin/entity-manager/scope":"admin","views/admin/entity-manager/index":"admin","views/admin/entity-manager/formula":"admin","views/admin/entity-manager/edit":"admin","views/admin/entity-manager/record/edit":"admin","views/admin/entity-manager/modals/select-icon":"admin","views/admin/entity-manager/modals/select-formula":"admin","views/admin/entity-manager/fields/icon-class":"admin","views/admin/entity-manager/fields/duplicate-check-field-list":"admin","views/admin/dynamic-logic/modals/edit":"admin","views/admin/dynamic-logic/modals/add-field":"admin","views/admin/dynamic-logic/fields/user-id":"admin","views/admin/dynamic-logic/fields/field":"admin","views/admin/dynamic-logic/conditions-string/item-value-varchar":"admin","views/admin/dynamic-logic/conditions-string/item-value-link":"admin","views/admin/dynamic-logic/conditions-string/item-value-enum":"admin","views/admin/dynamic-logic/conditions-string/item-multiple-values-base":"admin","views/admin/dynamic-logic/conditions-string/item-is-today":"admin","views/admin/dynamic-logic/conditions-string/item-in-past":"admin","views/admin/dynamic-logic/conditions-string/item-in-future":"admin","views/admin/dynamic-logic/conditions-string/group-not":"admin","views/admin/dynamic-logic/conditions/or":"admin","views/admin/dynamic-logic/conditions/not":"admin","views/admin/dynamic-logic/conditions/and":"admin","views/admin/dynamic-logic/conditions/field-types/multi-enum":"admin","views/admin/dynamic-logic/conditions/field-types/link":"admin","views/admin/dynamic-logic/conditions/field-types/link-parent":"admin","views/admin/dynamic-logic/conditions/field-types/enum":"admin","views/admin/dynamic-logic/conditions/field-types/date":"admin","views/admin/dynamic-logic/conditions/field-types/current-user":"admin","views/admin/dynamic-logic/conditions/field-types/current-user-teams":"admin","views/admin/complex-expression/modals/add-function":"admin","views/admin/authentication/fields/test-connection":"admin","views/admin/auth-token/list":"admin","views/admin/auth-token/record/list":"admin","views/admin/auth-token/record/detail":"admin","views/admin/auth-token/record/detail-small":"admin","views/admin/auth-token/record/row-actions/default":"admin","views/admin/auth-token/modals/detail":"admin","views/admin/auth-log-record/list":"admin","views/admin/auth-log-record/record/list":"admin","views/admin/auth-log-record/record/detail":"admin","views/admin/auth-log-record/record/detail-small":"admin","views/admin/auth-log-record/modals/detail":"admin","controllers/role":"admin","controllers/portal-role":"admin","controllers/layout-set":"admin","controllers/inbound-email":"admin","controllers/api-user":"admin","controllers/admin":"admin","modules/crm/views/meeting/fields/attendees":"crm","modules/crm/views/meeting/fields/contacts":"crm","modules/crm/knowledge-base-helper":"crm","modules/crm/views/task/record/list":"crm","modules/crm/views/record/panels/tasks":"crm","modules/crm/views/record/panels/activities":"crm","modules/crm/views/opportunity/record/edit":"crm","modules/crm/views/meeting/detail":"crm","modules/crm/views/meeting/record/list":"crm","modules/crm/views/mass-email/record/edit":"crm","modules/crm/views/document/modals/select-records":"crm","modules/crm/views/dashlets/options/chart":"crm","modules/crm/views/contact/record/detail":"crm","modules/crm/views/call/record/list":"crm","modules/crm/views/call/fields/contacts":"crm","modules/crm/acl/meeting":"crm","views/notification/items/base":"crm","handlers/create-related":"crm","handlers/row-action":"crm","modules/crm/views/user/record/panels/tasks":"crm","modules/crm/views/task/list":"crm","modules/crm/views/task/detail":"crm","modules/crm/views/task/record/list-expanded":"crm","modules/crm/views/task/record/detail":"crm","modules/crm/views/task/record/row-actions/default":"crm","modules/crm/views/task/record/row-actions/dashlet":"crm","modules/crm/views/task/modals/detail":"crm","modules/crm/views/task/fields/priority-for-dashlet":"crm","modules/crm/views/task/fields/is-overdue":"crm","modules/crm/views/task/fields/date-end":"crm","modules/crm/views/target-list/record/detail":"crm","modules/crm/views/target-list/record/row-actions/opted-out":"crm","modules/crm/views/target-list/record/row-actions/default":"crm","modules/crm/views/target-list/record/panels/relationship":"crm","modules/crm/views/target-list/record/panels/opted-out":"crm","modules/crm/views/target-list/fields/target-status":"crm","modules/crm/views/target-list/fields/including-action-list":"crm","modules/crm/views/stream/notes/event-confirmation":"crm","modules/crm/views/record/list-activities-dashlet":"crm","modules/crm/views/record/row-actions/tasks":"crm","modules/crm/views/record/row-actions/relationship-target":"crm","modules/crm/views/record/row-actions/history":"crm","modules/crm/views/record/row-actions/activities":"crm","modules/crm/views/record/row-actions/activities-dashlet":"crm","modules/crm/views/record/panels/target-lists":"crm","modules/crm/views/record/panels/history":"crm","modules/crm/views/opportunity/detail":"crm","modules/crm/views/opportunity/record/list":"crm","modules/crm/views/opportunity/record/kanban":"crm","modules/crm/views/opportunity/record/edit-small":"crm","modules/crm/views/opportunity/record/panels/activities":"crm","modules/crm/views/opportunity/fields/stage":"crm","modules/crm/views/opportunity/fields/lead-source":"crm","modules/crm/views/opportunity/fields/last-stage":"crm","modules/crm/views/opportunity/fields/contacts":"crm","modules/crm/views/opportunity/fields/contact-role":"crm","modules/crm/views/opportunity/admin/field-manager/fields/probability-map":"crm","modules/crm/views/notification/items/event-attendee":"crm","modules/crm/views/meeting/popup-notification":"crm","modules/crm/views/meeting/record/list-expanded":"crm","modules/crm/views/meeting/record/edit-small":"crm","modules/crm/views/meeting/record/detail":"crm","modules/crm/views/meeting/record/row-actions/default":"crm","modules/crm/views/meeting/record/row-actions/dashlet":"crm","modules/crm/views/meeting/record/panels/scheduler":"crm","modules/crm/views/meeting/record/panels/attendees":"crm","modules/crm/views/meeting/modals/send-invitations":"crm","modules/crm/views/meeting/modals/send-cancellation":"crm","modules/crm/views/meeting/modals/detail":"crm","modules/crm/views/meeting/modals/acceptance-status":"crm","modules/crm/views/meeting/fields/users":"crm","modules/crm/views/meeting/fields/reminders":"crm","modules/crm/views/meeting/fields/date-start":"crm","modules/crm/views/meeting/fields/date-end":"crm","modules/crm/views/meeting/fields/acceptance-status":"crm","modules/crm/views/mass-email/detail":"crm","modules/crm/views/mass-email/record/list-for-campaign":"crm","modules/crm/views/mass-email/record/edit-small":"crm","modules/crm/views/mass-email/record/detail":"crm","modules/crm/views/mass-email/record/detail-bottom":"crm","modules/crm/views/mass-email/record/row-actions/for-campaign":"crm","modules/crm/views/mass-email/modals/send-test":"crm","modules/crm/views/mass-email/fields/smtp-account":"crm","modules/crm/views/mass-email/fields/from-address":"crm","modules/crm/views/mass-email/fields/email-template":"crm","modules/crm/views/lead/detail":"crm","modules/crm/views/lead/convert":"crm","modules/crm/views/lead/record/detail":"crm","modules/crm/views/lead/record/detail-side":"crm","modules/crm/views/lead/record/panels/converted-to":"crm","modules/crm/views/lead/fields/industry":"crm","modules/crm/views/lead/fields/created-opportunity":"crm","modules/crm/views/lead/fields/created-contact":"crm","modules/crm/views/lead/fields/acceptance-status":"crm","modules/crm/views/knowledge-base-article/list":"crm","modules/crm/views/knowledge-base-article/record/list":"crm","modules/crm/views/knowledge-base-article/record/edit":"crm","modules/crm/views/knowledge-base-article/record/edit-quick":"crm","modules/crm/views/knowledge-base-article/record/detail":"crm","modules/crm/views/knowledge-base-article/record/detail-quick":"crm","modules/crm/views/knowledge-base-article/modals/select-records":"crm","modules/crm/views/knowledge-base-article/fields/status":"crm","modules/crm/views/knowledge-base-article/fields/language":"crm","modules/crm/views/fields/ico":"crm","modules/crm/views/event-confirmation/confirmation":"crm","modules/crm/views/email-queue-item/list":"crm","modules/crm/views/email-queue-item/record/list":"crm","modules/crm/views/document/list":"crm","modules/crm/views/document/fields/name":"crm","modules/crm/views/document/fields/file":"crm","modules/crm/views/dashlets/tasks":"crm","modules/crm/views/dashlets/meetings":"crm","modules/crm/views/dashlets/calls":"crm","modules/crm/views/dashlets/calendar":"crm","modules/crm/views/dashlets/activities":"crm","modules/crm/views/dashlets/options/sales-pipeline":"crm","modules/crm/views/dashlets/options/calendar":"crm","modules/crm/views/dashlets/options/activities":"crm","modules/crm/views/dashlets/options/sales-pipeline/fields/team":"crm","modules/crm/views/contact/detail":"crm","modules/crm/views/contact/record/detail-small":"crm","modules/crm/views/contact/modals/select-for-portal-user":"crm","modules/crm/views/contact/fields/title":"crm","modules/crm/views/contact/fields/opportunity-role":"crm","modules/crm/views/contact/fields/name-for-account":"crm","modules/crm/views/contact/fields/accounts":"crm","modules/crm/views/contact/fields/account":"crm","modules/crm/views/contact/fields/account-role":"crm","modules/crm/views/case/record/detail":"crm","modules/crm/views/case/record/panels/activities":"crm","modules/crm/views/case/fields/contacts":"crm","modules/crm/views/case/fields/contact":"crm","modules/crm/views/campaign-tracking-url/record/edit":"crm","modules/crm/views/campaign-tracking-url/record/edit-small":"crm","modules/crm/views/campaign-log-record/fields/data":"crm","modules/crm/views/campaign/unsubscribe":"crm","modules/crm/views/campaign/tracking-url":"crm","modules/crm/views/campaign/subscribe-again":"crm","modules/crm/views/campaign/detail":"crm","modules/crm/views/campaign/record/detail":"crm","modules/crm/views/campaign/record/detail-bottom":"crm","modules/crm/views/campaign/record/panels/campaign-stats":"crm","modules/crm/views/campaign/record/panels/campaign-log-records":"crm","modules/crm/views/campaign/modals/mail-merge-pdf":"crm","modules/crm/views/campaign/fields/template":"crm","modules/crm/views/campaign/fields/int-with-percentage":"crm","modules/crm/views/call/detail":"crm","modules/crm/views/call/record/list-expanded":"crm","modules/crm/views/call/record/edit-small":"crm","modules/crm/views/call/record/detail":"crm","modules/crm/views/call/record/row-actions/default":"crm","modules/crm/views/call/record/row-actions/dashlet":"crm","modules/crm/views/call/fields/leads":"crm","modules/crm/views/call/fields/date-end":"crm","modules/crm/views/calendar/mode-buttons":"crm","modules/crm/views/calendar/calendar-page":"crm","modules/crm/views/calendar/record/shared-options":"crm","modules/crm/views/calendar/record/edit-view":"crm","modules/crm/views/calendar/modals/shared-options":"crm","modules/crm/views/calendar/modals/edit":"crm","modules/crm/views/calendar/modals/edit-view":"crm","modules/crm/views/calendar/fields/users":"crm","modules/crm/views/calendar/fields/teams":"crm","modules/crm/views/admin/entity-manager/fields/status-list":"crm","modules/crm/views/activities/list":"crm","modules/crm/views/account/detail":"crm","modules/crm/views/account/fields/shipping-address":"crm","modules/crm/view-setup-handlers/document/record-list-drag-n-drop":"crm","modules/crm/handlers/task/menu":"crm","modules/crm/handlers/task/detail-actions":"crm","modules/crm/handlers/opportunity/contacts-create":"crm","modules/crm/handlers/knowledge-base-article/send-in-email":"crm","modules/crm/handlers/knowledge-base-article/move":"crm","modules/crm/handlers/case/detail-actions":"crm","modules/crm/handlers/campaign/mass-emails-create":"crm","modules/crm/controllers/unsubscribe":"crm","modules/crm/controllers/tracking-url":"crm","modules/crm/controllers/lead":"crm","modules/crm/controllers/event-confirmation":"crm","modules/crm/controllers/calendar":"crm","modules/crm/controllers/activities":"crm","modules/crm/acl-portal/document":"crm","modules/crm/acl-portal/contact":"crm","modules/crm/acl-portal/account":"crm","modules/crm/acl/mass-email":"crm","modules/crm/acl/campaign-tracking-url":"crm","modules/crm/acl/call":"crm","modules/crm/views/dashlets/abstract/chart":"chart","modules/crm/views/dashlets/sales-pipeline":"chart","modules/crm/views/dashlets/sales-by-month":"chart","modules/crm/views/dashlets/opportunities-by-stage":"chart","modules/crm/views/dashlets/opportunities-by-lead-source":"chart","modules/crm/views/calendar/calendar":"calendar","modules/crm/views/scheduler/scheduler":"timeline","modules/crm/views/calendar/timeline":"timeline","views/email/record/detail":"extra","views/email/fields/email-address":"extra","views/user/record/detail":"extra","views/user/record/detail-side":"extra","views/settings/fields/theme":"extra","views/settings/fields/tab-list":"extra","views/settings/fields/quick-create-list":"extra","views/import/record/panels/imported":"extra","views/email-template/record/detail":"extra","views/email-account/record/detail":"extra","views/email/detail":"extra","views/email/record/list":"extra","views/email/record/edit":"extra","views/email/fields/person-string-data":"extra","views/email/fields/from-address-varchar":"extra","helpers/misc/field-language":"extra","handlers/select-related":"extra","handlers/login":"extra","handlers/map/renderer":"extra","views/wysiwyg/modals/insert-link":"extra","views/wysiwyg/modals/insert-image":"extra","views/working-time-range/fields/users":"extra","views/working-time-range/fields/date-end":"extra","views/working-time-calendar/fields/time-ranges":"extra","views/working-time-calendar/fields/time-ranges/item-edit":"extra","views/working-time-calendar/fields/time-ranges/item-detail":"extra","views/webhook/record/list":"extra","views/webhook/fields/user":"extra","views/webhook/fields/event":"extra","views/user-security/modals/two-factor-sms":"extra","views/user-security/modals/two-factor-email":"extra","views/user-security/modals/totp":"extra","views/user/password-change-request":"extra","views/user/list":"extra","views/user/detail":"extra","views/user/record/list":"extra","views/user/record/edit":"extra","views/user/record/edit-side":"extra","views/user/record/edit-quick":"extra","views/user/record/detail-quick":"extra","views/user/record/detail-quick-side":"extra","views/user/record/detail-bottom":"extra","views/user/record/row-actions/relationship-followers":"extra","views/user/record/row-actions/default":"extra","views/user/record/panels/stream":"extra","views/user/record/panels/default-side":"extra","views/user/modals/select-followers":"extra","views/user/modals/security":"extra","views/user/modals/password":"extra","views/user/modals/mass-update":"extra","views/user/modals/login-as":"extra","views/user/modals/detail":"extra","views/user/modals/access":"extra","views/user/fields/user-name":"extra","views/user/fields/teams":"extra","views/user/fields/password":"extra","views/user/fields/name":"extra","views/user/fields/generate-password":"extra","views/user/fields/contact":"extra","views/user/fields/avatar":"extra","views/user/fields/auto-follow-entity-type-list":"extra","views/template/record/edit":"extra","views/template/record/detail":"extra","views/template/fields/variables":"extra","views/template/fields/font-face":"extra","views/template/fields/entity-type":"extra","views/template/fields/body":"extra","views/team/record/list":"extra","views/team/record/edit":"extra","views/team/record/detail":"extra","views/team/modals/detail":"extra","views/site-portal/navbar":"extra","views/site-portal/master":"extra","views/site-portal/header":"extra","views/site/navbar/quick-create":"extra","views/settings/modals/tab-list-field-add":"extra","views/settings/modals/edit-tab-group":"extra","views/settings/modals/edit-tab-divider":"extra","views/settings/fields/time-format":"extra","views/settings/fields/thousand-separator":"extra","views/settings/fields/stream-email-notifications-entity-list":"extra","views/settings/fields/sms-provider":"extra","views/settings/fields/phone-number-preferred-country-list":"extra","views/settings/fields/pdf-engine":"extra","views/settings/fields/outbound-email-from-address":"extra","views/settings/fields/oidc-teams":"extra","views/settings/fields/oidc-redirect-uri":"extra","views/settings/fields/language":"extra","views/settings/fields/history-entity-list":"extra","views/settings/fields/group-tab-list":"extra","views/settings/fields/global-search-entity-list":"extra","views/settings/fields/fiscal-year-shift":"extra","views/settings/fields/email-address-lookup-entity-type-list":"extra","views/settings/fields/default-currency":"extra","views/settings/fields/date-format":"extra","views/settings/fields/dashboard-layout":"extra","views/settings/fields/currency-rates":"extra","views/settings/fields/currency-list":"extra","views/settings/fields/calendar-entity-list":"extra","views/settings/fields/busy-ranges-entity-list":"extra","views/settings/fields/authentication-method":"extra","views/settings/fields/auth-two-fa-method-list":"extra","views/settings/fields/assignment-notifications-entity-list":"extra","views/settings/fields/assignment-email-notifications-entity-list":"extra","views/settings/fields/address-preview":"extra","views/settings/fields/activities-entity-list":"extra","views/preferences/edit":"extra","views/preferences/record/edit":"extra","views/preferences/fields/week-start":"extra","views/preferences/fields/time-zone":"extra","views/preferences/fields/time-format":"extra","views/preferences/fields/theme":"extra","views/preferences/fields/tab-list":"extra","views/preferences/fields/signature":"extra","views/preferences/fields/language":"extra","views/preferences/fields/default-currency":"extra","views/preferences/fields/date-format":"extra","views/preferences/fields/dashboard-tab-list":"extra","views/preferences/fields/auto-follow-entity-type-list":"extra","views/preferences/fields/assignment-notifications-ignore-entity-type-list":"extra","views/preferences/fields/assignment-email-notifications-ignore-entity-type-list":"extra","views/portal-user/list":"extra","views/portal/record/list":"extra","views/portal/fields/tab-list":"extra","views/portal/fields/quick-create-list":"extra","views/portal/fields/custom-id":"extra","views/personal-data/record/record":"extra","views/personal-data/modals/personal-data":"extra","views/outbound-email/modals/test-send":"extra","views/notification/record/list":"extra","views/notification/items/system":"extra","views/notification/items/message":"extra","views/notification/items/entity-removed":"extra","views/notification/items/email-received":"extra","views/notification/items/assign":"extra","views/notification/fields/read":"extra","views/notification/fields/read-with-menu":"extra","views/notification/fields/container":"extra","views/last-viewed/list":"extra","views/last-viewed/record/list":"extra","views/import-error/fields/validation-failures":"extra","views/import-error/fields/line-number":"extra","views/import/step2":"extra","views/import/step1":"extra","views/import/list":"extra","views/import/index":"extra","views/import/detail":"extra","views/import/record/list":"extra","views/import/record/detail":"extra","views/import/record/row-actions/duplicates":"extra","views/import/record/panels/updated":"extra","views/import/record/panels/duplicates":"extra","views/group-email-folder/record/list":"extra","views/group-email-folder/record/row-actions/default":"extra","views/external-account/oauth2":"extra","views/external-account/index":"extra","views/extension/record/row-actions":"extra","views/extension/record/list":"extra","views/export/record/record":"extra","views/export/modals/idle":"extra","views/export/modals/export":"extra","views/event/fields/name-for-history":"extra","views/email-template/list":"extra","views/email-template/record/edit":"extra","views/email-template/record/edit-quick":"extra","views/email-template/record/panels/information":"extra","views/email-template/fields/insert-field":"extra","views/email-template/fields/body":"extra","views/email-folder/list":"extra","views/email-folder/list-side":"extra","views/email-folder/record/list":"extra","views/email-folder/record/row-actions/default":"extra","views/email-folder/modals/select-folder":"extra","views/email-filter/record/list":"extra","views/email-filter/modals/edit":"extra","views/email-filter/fields/parent":"extra","views/email-filter/fields/email-folder":"extra","views/email-filter/fields/action":"extra","views/email-account/list":"extra","views/email-account/record/list":"extra","views/email-account/record/edit":"extra","views/email-account/modals/select-folder":"extra","views/email-account/fields/email-folder":"extra","views/email-account/fields/email-address":"extra","views/email/list":"extra","views/email/record/list-related":"extra","views/email/record/list-expanded":"extra","views/email/record/edit-quick":"extra","views/email/record/detail-side":"extra","views/email/record/detail-quick":"extra","views/email/record/compose":"extra","views/email/record/row-actions/default":"extra","views/email/record/row-actions/dashlet":"extra","views/email/record/panels/event":"extra","views/email/record/panels/default-side":"extra","views/email/modals/insert-field":"extra","views/email/modals/detail":"extra","views/email/modals/body-plain":"extra","views/email/modals/attachments":"extra","views/email/fields/subject":"extra","views/email/fields/select-template":"extra","views/email/fields/replies":"extra","views/email/fields/replied":"extra","views/email/fields/person-string-data-for-expanded":"extra","views/email/fields/icon":"extra","views/email/fields/has-attachment":"extra","views/email/fields/from-email-address":"extra","views/email/fields/email-address-varchar":"extra","views/email/fields/created-event":"extra","views/email/fields/create-event":"extra","views/email/fields/compose-from-address":"extra","views/email/fields/body":"extra","views/dashboard-template/detail":"extra","views/dashboard-template/record/list":"extra","views/dashboard-template/modals/deploy-to-users":"extra","views/dashboard-template/modals/deploy-to-team":"extra","views/attachment/record/list":"extra","views/attachment/record/detail":"extra","views/attachment/modals/select-one":"extra","views/attachment/modals/detail":"extra","views/attachment/fields/parent":"extra","views/attachment/fields/name":"extra","views/api-user/list":"extra","views/address-map/view":"extra","views/action-history-record/record/list":"extra","views/action-history-record/modals/detail":"extra","views/action-history-record/fields/target":"extra","views/action-history-record/fields/target-type":"extra","helpers/misc/list-select-attributes":"extra","handlers/working-time-range":"extra","handlers/import":"extra","handlers/email-filter":"extra","handlers/select-related/same-account":"extra","handlers/select-related/same-account-many":"extra","handlers/map/google-maps-renderer":"extra","handlers/login/oidc":"extra","acl-portal/preferences":"extra","acl-portal/notification":"extra","acl-portal/email":"extra"}),Espo.layoutTemplates={record:'<% var hasHiddenPanel = false; %>\r\n\r\n<% _.each(layout, function (panel, columnNumber) { %>\r\n    <% hasHiddenPanel = panel.hidden || hasHiddenPanel; %>\r\n    <div\r\n        class="panel panel-<%= panel.style %><%= panel.label ? \' headered\' : \'\' %><%= panel.tabNumber ? \' tab-hidden\' : \'\' %><% if (panel.name) { %>{{#if hiddenPanels.<%= panel.name %>}} hidden{{/if}}<% } %>"\r\n        <% if (panel.name) print(\'data-name="\'+panel.name+\'"\') %>\r\n        <% if (panel.style) print(\'data-style="\'+panel.style+\'"\') %>\r\n        data-tab="<%= panel.tabNumber %>"\r\n    >\r\n        <% if (panel.label) { %>\r\n        <div class="panel-heading"><h4 class="panel-title"><%= panel.label %></h4></div>\r\n        <% } %>\r\n        <div class="panel-body panel-body-form">\r\n\r\n        <% var rows = panel.rows || [] %>\r\n        <% var columns = panel.columns || [] %>\r\n\r\n        <% _.each(rows, function (row, rowNumber) { %>\r\n            <div class="row">\r\n            <% var columnCount = row.length; %>\r\n            <% _.each(row, function (cell, cellNumber) { %>\r\n\r\n                <%\r\n                    var spanClassBase;\r\n                    if (columnCount === 1) {\r\n                        spanClassBase = \'col-sm-12\';\r\n                    } else if (columnCount === 2) {\r\n                        spanClassBase = \'col-sm-6\';\r\n                    } else if (columnCount === 3) {\r\n                        spanClassBase = \'col-sm-4\';\r\n                    } else if (columnCount === 4) {\r\n                        spanClassBase = \'col-md-3 col-sm-6\';\r\n                    } else {\r\n                        spanClass = \'col-sm-12\';\r\n                    }\r\n                %>\r\n                <% if (cell != false) { %>\r\n                    <%\r\n                        var spanClass;\r\n                        if (columnCount === 1 || cell.fullWidth) {\r\n                            spanClass = \'col-sm-12\';\r\n                        } else if (columnCount === 2) {\r\n                            if (cell.span === 2) {\r\n                                spanClass = \'col-sm-12\';\r\n                            } else {\r\n                                spanClass = \'col-sm-6\';\r\n                            }\r\n                        } else if (columnCount === 3) {\r\n                            if (cell.span === 2) {\r\n                                spanClass = \'col-sm-8\';\r\n                            } else if (cell.span === 3) {\r\n                                spanClass = \'col-sm-12\';\r\n                            } else {\r\n                                spanClass = \'col-sm-4\';\r\n                            }\r\n                        } else if (columnCount === 4) {\r\n                            if (cell.span === 2) {\r\n                                spanClass = \'col-sm-6\';\r\n                            } else if (cell.span === 3) {\r\n                                spanClass = \'col-sm-9\';\r\n                            } else if (cell.span === 4) {\r\n                                spanClass = \'col-sm-12\';\r\n                            } else {\r\n                                spanClass = \'col-md-3 col-sm-6\';\r\n                            }\r\n                        } else {\r\n                            spanClass = \'col-sm-12\';\r\n                        }\r\n                    %>\r\n                    <div\r\n                        class="cell <%= spanClass %> form-group<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden-cell{{/if}}<% } %>"\r\n                        data-name="<%= cell.field %>"\r\n                        tabindex="-1"\r\n                    >\r\n                        <% if (!cell.noLabel) { %><label class="control-label<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><span class="label-text"><%\r\n                            if (\'customLabel\' in cell) {\r\n                                print (cell.customLabel);\r\n                            } else {\r\n                                var label = cell.label || cell.field;\r\n                                print ("{{translate \\""+label+"\\" scope=\\""+model.name+"\\" category=\'fields\'}}");\r\n                            }\r\n                        %></span></label><% } %>\r\n                        <div class="field<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><%\r\n                            if (\'customCode\' in cell) {\r\n                                print (cell.customCode);\r\n                            } else {\r\n                                print ("{{{this."+cell.name+"}}}");\r\n                            }\r\n                        %></div>\r\n                    </div>\r\n                <% } else { %>\r\n                    <div class="<%= spanClassBase %>"></div>\r\n                <% } %>\r\n            <% }); %>\r\n            </div>\r\n        <% }); %>\r\n\r\n        <%\r\n            var columnCount = columns.length;\r\n            if (columnCount) {\r\n                %>\r\n            <div class="row">\r\n                <%\r\n            }\r\n        %>\r\n        <% _.each(columns, function (column, columnNumber) { %>\r\n            <%\r\n                var spanClass;\r\n                if (!columnCount) return;\r\n\r\n                if (columnCount === 1 || column.fullWidth) {\r\n                    spanClass = \'col-sm-12\';\r\n                } else if (columnCount === 2) {\r\n                    if (column.span === 2) {\r\n                        spanClass = \'col-sm-12\';\r\n                    } else {\r\n                        spanClass = \'col-sm-6\';\r\n                    }\r\n                } else if (columnCount === 3) {\r\n                    if (column.span === 2) {\r\n                        spanClass = \'col-sm-8\';\r\n                    } else if (column.span === 3) {\r\n                        spanClass = \'col-sm-12\';\r\n                    } else {\r\n                        spanClass = \'col-sm-4\';\r\n                    }\r\n                } else if (columnCount === 4) {\r\n                    if (column.span === 2) {\r\n                        spanClass = \'col-sm-6\';\r\n                    } else if (column.span === 3) {\r\n                        spanClass = \'col-sm-9\';\r\n                    } else if (column.span === 4) {\r\n                        spanClass = \'col-sm-12\';\r\n                    } else {\r\n                        spanClass = \'col-md-3 col-sm-6\';\r\n                    }\r\n                } else {\r\n                    spanClass = \'col-sm-12\';\r\n                }\r\n            %>\r\n            <div class="column <%= spanClass %>">\r\n                <% _.each(column, function (cell, cellNumber) { %>\r\n                    <div class="cell form-group<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden-cell{{/if}}<% } %>" data-name="<%= cell.field %>">\r\n                        <% if (!cell.noLabel) { %><label class="control-label<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><span class="label-text"><%\r\n                            if (\'customLabel\' in cell) {\r\n                                print (cell.customLabel);\r\n                            } else {\r\n                                print ("{{translate \\""+cell.field+"\\" scope=\\""+model.name+"\\" category=\'fields\'}}");\r\n                            }\r\n                        %></span></label><% } %>\r\n                        <div class="field<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><%\r\n                            if (\'customCode\' in cell) {\r\n                                print (cell.customCode);\r\n                            } else {\r\n                                print ("{{{this."+cell.name+"}}}");\r\n                            }\r\n                        %></div>\r\n                    </div>\r\n                <% }); %>\r\n            </div>\r\n        <% }); %>\r\n        <%\r\n            if (columnCount) {\r\n                %>\r\n            </div>\r\n                <%\r\n            }\r\n        %>\r\n        </div>\r\n    </div>\r\n<% }); %>\r\n\r\n<%\r\nif (hasHiddenPanel) {\r\n%>\r\n<div class="panel panel-default panels-show-more-delimiter" data-name="showMoreDelimiter" data-tab="0">\r\n    <a role="button" tabindex="0" data-action="showMoreDetailPanels" title="{{translate \'Show more\'}}">\r\n        <span class="fas fa-ellipsis-h fa-lg"></span>\r\n    </a>\r\n</div>\r\n<%\r\n}\r\n%>\r\n',"list-row":"<% _.each(layout, function (defs, key) { %>\r\n    <%\r\n        var width = null;\r\n        if (defs.options && defs.options.defs && 'width' in defs.options.defs) {\r\n            width = (defs.options.defs.width + '%') || null;\r\n        }\r\n        if (defs.options && defs.options.defs && 'widthPx' in defs.options.defs) {\r\n            width = defs.options.defs.widthPx || null;\r\n        }\r\n        var align = false;\r\n        if (defs.options && defs.options.defs) {\r\n            align = defs.options.defs.align || false;\r\n        }\r\n    %>\r\n    <td\r\n        class=\"cell\"\r\n        data-name=\"<%= defs.columnName %>\"\r\n        <% if (width || align) { %>\r\n        style=\"<% if (width) print('width: ' + width); %>;<% if (align) print(' text-align: ' + align);%>\"\r\n        <% } %>\r\n    >\r\n    <%\r\n            var tag = 'tag' in defs ? defs.tag : false;\r\n            if (tag) {\r\n                print( '<' + tag);\r\n                if ('id' in defs) {\r\n                    print(' id=\"'+defs.id+'\"');\r\n                }\r\n                if ('class' in defs) {\r\n                    print(' class=\"'+defs.class+'\"');\r\n                };\r\n                print('>');\r\n            }\r\n        %>{{{this.<%= defs.name %>}}}<%\r\n            if (tag) {\r\n                print( '</' + tag + '>');\r\n            }\r\n    %>\r\n    </td>\r\n<% }); %>\r\n","list-row-expanded":"<% if (layout.right) { %>\r\n<div class=\"pull-right right cell\" data-name=\"buttons\">\r\n    {{{<%= layout.right.name %>}}}\r\n</div>\r\n<% } %>\r\n<% _.each(layout.rows, function (row, key) { %>\r\n    <div class=\"expanded-row\"><% _.each(row, function (defs, key) { %>{{#ifNotEmptyHtml this.<%= defs.name %>}}<span class=\"cell\" data-name=\"<%= defs.field %>\"><%\r\n                var tag = 'tag' in defs ? defs.tag : false;\r\n                if (tag) {\r\n                    print( '<' + tag);\r\n                    if ('id' in defs) {\r\n                        print(' id=\"'+defs.id+'\"');\r\n                    }\r\n                    if ('class' in defs) {\r\n                        print(' class=\"'+defs.class+'\"');\r\n                    };\r\n                    print('>');\r\n                }\r\n            %>{{{this.<%= defs.name %>}}}<%\r\n                if (tag) {\r\n                    print( '</' + tag + '>');\r\n                }\r\n        %></span>{{/ifNotEmptyHtml}}<% }); %></div>\r\n<% }); %>\r\n",default:"<% _.each(layout, function (defs, key) {\r\n        var tag = 'tag' in defs ? defs.tag : 'div';\r\n        print( '<' + tag);\r\n        if ('id' in defs) {\r\n            print(' id=\"'+defs.id+'\"');\r\n        }\r\n        if ('class' in defs) {\r\n            print(' class=\"'+defs.class+'\"');\r\n        }\r\n        print('>');\r\n    %>\r\n        {{{this.<%= defs.name %>}}}\r\n        <%= '</' + tag + '>' %>\r\n<% }); %>\r\n","columns-2":"<% _.each(layout, function (row, rowNumber) { %>\r\n    <div class=\"col-sm-6\">\r\n    <% _.each(row, function (defs, key) { %>\r\n        <%\r\n            var tag = 'tag' in defs ? defs.tag : 'div';\r\n            print( '<' + tag);\r\n            if ('id' in defs) {\r\n                print(' id=\"'+defs.id+'\"');\r\n            }\r\n            print(' class=\"');\r\n            if ('class' in defs) {\r\n                print(defs.class);\r\n            };\r\n            print('\"');\r\n            print('>');\r\n        %>\r\n            {{{this.<%= defs.name %>}}}\r\n            <%= '</' + tag + '>' %>\r\n    <% }); %>\r\n    </div>\r\n<% }); %>\r\n"};
